<!DOCTYPE html>
<html lang="{{ lang or 'en' }}" {% if is_rtl_language(lang) %}dir="rtl"{% endif %} data-theme="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <meta name="theme-color" content="#3ECDC1" id="theme-color-meta">
    
    <title>{% block title %}{{ t('app_name', lang) }}{% endblock %}</title>
    
    <!-- PWA Manifest -->
    <link rel="manifest" href="{{ url_for('static', filename='manifest.json') }}">
    
    <!-- Icons -->
    <link rel="icon" type="image/x-icon" href="{{ url_for('static', filename='images/favicon.ico') }}">
    <link rel="apple-touch-icon" href="{{ url_for('static', filename='images/icon-192.png') }}">
    
    <!-- CSS -->
    <link rel="stylesheet" href="{{ url_for('static', filename='css/liquid-glass.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/mobile.css') }}">
    {% block extra_css %}{% endblock %}
    
    <!-- Preload критические ресурсы -->
    <link rel="preload" href="{{ url_for('static', filename='css/liquid-glass.css') }}" as="style">
    <link rel="preload" href="{{ url_for('static', filename='js/theme-controller.js') }}" as="script">
</head>
<body class="mobile-body">
    <!-- Навигация -->
    <nav class="mobile-nav glass-nav">
        {% include 'mobile/nav.html' %}
    </nav>

    <!-- Основной контент -->
    <main class="mobile-main" id="main-content">
        {% block content %}{% endblock %}
    </main>

    <!-- Нижнее меню -->
    <nav class="mobile-bottom-nav glass-nav">
        <a href="{{ url_for('main_bp.welcome') }}" class="nav-item {% if request.endpoint == 'main_bp.welcome' %}active{% endif %}">
            <i class="bi bi-house-fill"></i>
            <span>{{ t('home', lang) }}</span>
        </a>
        <a href="{{ url_for('learning_map_bp.learning_map') }}" class="nav-item {% if 'learning' in request.endpoint %}active{% endif %}">
            <i class="bi bi-map-fill"></i>
            <span>{{ t('learning', lang) }}</span>
        </a>
        <a href="{{ url_for('tests_bp.tests') }}" class="nav-item {% if 'tests' in request.endpoint %}active{% endif %}">
            <i class="bi bi-list-check"></i>
            <span>{{ t('tests', lang) }}</span>
        </a>
        <a href="{{ url_for('main_bp.profile') }}" class="nav-item {% if request.endpoint == 'main_bp.profile' %}active{% endif %}">
            <i class="bi bi-person-fill"></i>
            <span>{{ t('profile', lang) }}</span>
        </a>
    </nav>

    <!-- Уведомления -->
    <div id="notification-container" class="notification-container"></div>

    <!-- Scripts -->
    <script src="{{ url_for('static', filename='js/theme-controller.js') }}"></script>
    <script src="{{ url_for('static', filename='js/mobile-app.js') }}"></script>
    {% block extra_js %}{% endblock %}

    <!-- Service Worker регистрация -->
    <script>
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', function() {
                navigator.serviceWorker.register('/static/sw.js')
                    .then(function(registration) {
                        console.log('SW registered: ', registration);
                    })
                    .catch(function(registrationError) {
                        console.log('SW registration failed: ', registrationError);
                    });
            });
        }
    </script>
</body>
</html> 