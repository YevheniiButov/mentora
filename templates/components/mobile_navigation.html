<!-- templates/components/mobile_navigation.html -->
<!-- Унифицированный компонент мобильной навигации -->

<!-- Верхняя навигация (header) -->
<header class="mobile-header">
    <div class="mobile-header-content">
        <!-- Кнопка назад (показывается когда нужно) -->
        {% if show_back_button %}
        <button class="mobile-back-btn" onclick="history.back()" aria-label="{{ t('go_back', lang) or 'Go back' }}">
            <i class="bi bi-arrow-left"></i>
        </button>
        {% endif %}
        
        <!-- Breadcrumbs или заголовок -->
        <div class="mobile-header-title">
            {% if show_logo %}
                <img src="{{ nav_config.logo_url or '/static/images/logo.png' }}" 
                     alt="{{ t('dental_academy', lang) or 'Dental Academy' }}" 
                     class="mobile-header-logo"
                     onerror="this.style.display='none'; this.nextElementSibling.style.display='block';">
                <h1 style="display: none;">{{ t('dental_academy', lang) or 'Dental Academy' }}</h1>
            {% elif breadcrumbs and breadcrumbs|length > 0 %}
                <nav class="mobile-breadcrumbs" aria-label="{{ t('breadcrumbs', lang) or 'Breadcrumbs' }}">
                    {% for crumb in breadcrumbs %}
                        {% if not loop.last %}
                            <a href="{{ crumb.url if crumb.url else '#' }}">
                                {{ t(crumb.title, lang) if crumb.title else (crumb.title or '') }}
                            </a>
                            <i class="bi bi-chevron-right"></i>
                        {% else %}
                            <span class="current">
                                {{ t(crumb.title, lang) if crumb.title else (crumb.title or '') }}
                            </span>
                        {% endif %}
                    {% endfor %}
                </nav>
            {% else %}
                <h1>
                    {% if page_title %}
                        {{ t(page_title, lang) or page_title }}
                    {% else %}
                        {{ t('dental_academy', lang) or 'Become a Tandarts' }}
                    {% endif %}
                </h1>
            {% endif %}
        </div>
        
        <!-- Дополнительные кнопки (настройки, профиль и т.д.) -->
        <div class="mobile-header-actions">
            {% if show_profile_button %}
            <a href="{{ url_for('mobile.profile', lang=lang) if lang else url_for('mobile.profile', lang='en') }}" 
               class="header-action-btn" 
               aria-label="{{ t('profile', lang) or 'Profile' }}">
                <i class="bi bi-person-circle"></i>
            </a>
            {% endif %}
            
            {% if show_settings_button %}
            <a href="{{ url_for('mobile.settings', lang=lang) if lang else url_for('mobile.settings', lang='en') }}" 
               class="header-action-btn"
               aria-label="{{ t('settings', lang) or 'Settings' }}">
                <i class="bi bi-gear"></i>
            </a>
            {% endif %}
            
            {% if show_language_selector %}
            <div class="mobile-language-selector">
                <button class="current-language" aria-label="{{ t('select_language', lang) or 'Select Language' }}">
                    {% set current_country = get_country_code(lang) if lang else 'gb' %}
                    <img src="/static/images/flags/{{ current_country }}.svg" 
                         alt="{{ lang or 'en' }}" 
                         onerror="this.style.display='none'">
                    <span class="sr-only">{{ lang or 'en' }}</span>
                </button>
                <ul class="language-options">
                    {% set available_languages = get_language_names() if get_language_names else {
                        'en': 'English', 'ru': 'Русский', 'nl': 'Nederlands',
                        'uk': 'Українська', 'es': 'Español', 'pt': 'Português',
                        'tr': 'Türkçe', 'fa': 'فارسی', 'ar': 'العربية'
                    } %}
                    {% for code, name in available_languages.items() %}
                    <li>
                        {% if request and request.endpoint and request.view_args %}
                            {% set view_args_copy = request.view_args.copy() %}
                            {% set _ = view_args_copy.pop('lang', None) %}
                            <a href="{{ url_for(request.endpoint, lang=code, **view_args_copy) }}">
                        {% else %}
                            <a href="{{ url_for('mobile.welcome', lang=code) }}">
                        {% endif %}
                            {% set country_code = get_country_code(code) if get_country_code else code %}
                            <img src="/static/images/flags/{{ country_code }}.svg" 
                                 alt="{{ code }}" 
                                 onerror="this.style.display='none'">
                            <span>{{ name }}</span>
                        </a>
                    </li>
                    {% endfor %}
                </ul>
            </div>
            {% endif %}
        </div>
    </div>
    
    <!-- Прогресс бар (для тестов, уроков) -->
    {% if show_progress and progress_data %}
    <div class="mobile-progress-container">
        <div class="mobile-progress-bar">
            <div class="progress-fill" style="width: {{ progress_data.percentage or 0 }}%"></div>
        </div>
        <span class="progress-text">
            {{ progress_data.current or 0 }}/{{ progress_data.total or 0 }}
        </span>
    </div>
    {% endif %}
</header>

<!-- Нижняя навигация -->
{% if show_bottom_nav %}
<nav class="mobile-bottom-nav" id="bottomNav" role="navigation" aria-label="{{ t('main_navigation', lang) or 'Main navigation' }}">
    {% set active_section = get_active_nav_item(request.endpoint) if request and request.endpoint else 'home' %}
    
    {% if current_user.is_authenticated %}
        <!-- Навигация для авторизованных пользователей -->
        <a href="{{ url_for('mobile.welcome', lang=lang) if lang else url_for('mobile.welcome', lang='en') }}" 
           class="nav-item {{ 'active' if active_section == 'home' else '' }}"
           aria-label="{{ t('home', lang) or 'Home' }}">
            <i class="bi bi-house"></i>
            <span>{{ t('home', lang) or 'Home' }}</span>
        </a>
        
        <a href="{{ url_for('mobile.learning_map', lang=lang) if lang else url_for('mobile.learning_map', lang='en') }}" 
           class="nav-item {{ 'active' if active_section == 'learning' else '' }}"
           aria-label="{{ t('learning', lang) or 'Learning' }}">
            <i class="bi bi-book"></i>
            <span>{{ t('learning', lang) or 'Learning' }}</span>
        </a>
        
        <a href="{{ url_for('assessment_bp.intro', lang=lang) if lang else url_for('assessment_bp.intro', lang='en') }}" 
           class="nav-item {{ 'active' if active_section == 'assessment' else '' }}"
           aria-label="{{ t('navigation.assessment', lang) or 'Assessment' }}">
            <i class="bi bi-clipboard-check"></i>
            <span>{{ t('navigation.assessment', lang) or 'Assessment' }}</span>
        </a>
        
        <a href="{{ url_for('mobile.tests', lang=lang) if lang else url_for('mobile.tests', lang='en') }}" 
           class="nav-item {{ 'active' if active_section == 'tests' else '' }}"
           aria-label="{{ t('tests', lang) or 'Tests' }}">
            <i class="bi bi-list-check"></i>
            <span>{{ t('tests', lang) or 'Tests' }}</span>
        </a>
        
        <a href="/{{ lang or 'en' }}/virtual-patient" 
           class="nav-item {{ 'active' if active_section == 'patients' else '' }}"
           aria-label="{{ t('patients', lang) or 'Virtual Patients' }}">
            <i class="bi bi-person-heart"></i>
            <span>{{ t('patients', lang) or 'Patients' }}</span>
        </a>
        
        <a href="{{ url_for('main_bp.home', lang=lang) }}" 
           class="nav-item {{ 'active' if active_section == 'ai' else '' }}"
           aria-label="{{ t('ai_assistant', lang) or 'AI Assistant' }}">
            <i class="fas fa-robot"></i>
            <span>{{ t('ai_assistant', lang) or 'AI' }}</span>
        </a>
    {% else %}
        <!-- Навигация для неавторизованных пользователей -->
        <a href="{{ url_for('main_bp.home', lang=lang) if lang else url_for('main_bp.home', lang='en') }}" 
           class="nav-item {{ 'active' if active_section == 'home' else '' }}"
           aria-label="{{ t('home', lang) or 'Home' }}">
            <i class="bi bi-house"></i>
            <span>{{ t('home', lang) or 'Главная' }}</span>
        </a>
        
        <a href="{{ url_for('mobile.subjects_view', lang=lang) if lang else url_for('mobile.subjects_view', lang='en') }}" 
           class="nav-item {{ 'active' if active_section == 'subjects' else '' }}"
           aria-label="{{ t('subjects', lang) or 'Subjects' }}">
            <i class="bi bi-book"></i>
            <span>{{ t('subjects', lang) or 'Предметы' }}</span>
        </a>
        
        <a href="{{ url_for('mobile.register', lang=lang) if lang else url_for('mobile.register', lang='en') }}" 
           class="nav-item {{ 'active' if active_section == 'register' else '' }}"
           aria-label="{{ t('register', lang) or 'Register' }}">
            <i class="bi bi-person-plus"></i>
            <span>{{ t('register', lang) or 'Регистрация' }}</span>
        </a>
        
        <a href="{{ url_for('mobile.login', lang=lang) if lang else url_for('mobile.login', lang='en') }}" 
           class="nav-item {{ 'active' if active_section == 'login' else '' }}"
           aria-label="{{ t('login', lang) or 'Login' }}">
            <i class="bi bi-box-arrow-in-right"></i>
            <span>{{ t('login', lang) or 'Вход' }}</span>
        </a>
    {% endif %}
</nav>
{% endif %}

<!-- CSS стили (используем существующие классы и добавляем недостающие) -->
<style>
/* ===== iOS 26 LIQUID GLASS МОБИЛЬНАЯ НАВИГАЦИЯ ===== */
.mobile-header {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    z-index: 1000;
    background: var(--glass-nav);
    backdrop-filter: blur(var(--blur-lg));
    -webkit-backdrop-filter: blur(var(--blur-lg));
    border-bottom: 1px solid var(--border-glass);
    box-shadow: var(--shadow-lg);
    transition: var(--transition-glass);
}

/* Темная тема для header */
[data-theme="dark"] .mobile-header {
    background: var(--header-bg);
    backdrop-filter: blur(var(--blur-xl));
    border-bottom: 1px solid var(--border-glass);
    box-shadow: var(--shadow-xl);
}

.mobile-header-content {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 1rem;
    max-width: 100%;
}

.mobile-back-btn {
    background: var(--glass-secondary);
    backdrop-filter: blur(var(--blur-sm));
    border: 1px solid var(--border-glass);
    border-radius: 12px;
    width: 44px;
    height: 44px;
    display: flex;
    align-items: center;
    justify-content: center;
    color: var(--text-primary);
    font-size: 1.2rem;
    transition: var(--transition-smooth);
    cursor: pointer;
    position: relative;
    overflow: hidden;
}

.mobile-back-btn::before {
    content: '';
    position: absolute;
    top: 0;
    left: -100%;
    width: 100%;
    height: 100%;
    background: var(--glass-shine);
    transition: left 0.5s ease;
}

.mobile-back-btn:hover::before {
    left: 100%;
}

.mobile-back-btn:hover {
    background: var(--glass-primary);
    border-color: var(--border-glass-strong);
    transform: translateY(-2px);
    color: var(--text-primary);
    box-shadow: var(--shadow-lg);
}

.mobile-header-title {
    flex: 1;
    text-align: center;
    margin: 0 1rem;
}

.mobile-header-title h1 {
    color: var(--text-primary);
    font-weight: 600;
    font-size: 1.2rem;
    margin: 0;
    text-shadow: 0 1px 3px rgba(0, 0, 0, 0.3);
}

.mobile-breadcrumbs {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    color: white;
    font-size: 0.9rem;
}

.mobile-breadcrumbs a {
    color: rgba(255, 255, 255, 0.8);
    text-decoration: none;
    transition: color 0.2s;
}

.mobile-breadcrumbs a:hover {
    color: white;
}

.mobile-breadcrumbs .current {
    color: white;
    font-weight: 500;
}

.mobile-header-logo {
    height: 32px;
    width: auto;
}

.mobile-header-actions {
    display: flex;
    align-items: center;
    gap: 0.5rem;
}

.header-action-btn {
    background: rgba(255, 255, 255, 0.2);
    border: none;
    border-radius: 20px;
    width: 40px;
    height: 40px;
    display: flex;
    align-items: center;
    justify-content: center;
    color: white;
    font-size: 1rem;
    transition: all 0.3s ease;
    text-decoration: none;
}

.header-action-btn:hover {
    background: rgba(255, 255, 255, 0.3);
    color: white;
    transform: translateY(-2px);
}

.mobile-progress-container {
    background: rgba(255, 255, 255, 0.1);
    padding: 0.5rem 1rem;
    border-top: 1px solid rgba(255, 255, 255, 0.1);
}

.mobile-progress-bar {
    background: rgba(255, 255, 255, 0.2);
    border-radius: 10px;
    height: 6px;
    overflow: hidden;
    margin-bottom: 0.5rem;
}

.progress-fill {
    height: 100%;
    background: linear-gradient(90deg, #28a745, #20c997);
    border-radius: 10px;
    transition: width 1s ease;
}

.progress-text {
    font-size: 0.8rem;
    color: rgba(255, 255, 255, 0.9);
    text-align: center;
}

/* ===== НИЖНЯЯ НАВИГАЦИЯ - LIQUID GLASS ===== */
.mobile-bottom-nav {
    position: fixed;
    bottom: 0;
    left: 0;
    right: 0;
    height: 70px;
    background: var(--glass-nav);
    backdrop-filter: blur(var(--blur-lg));
    -webkit-backdrop-filter: blur(var(--blur-lg));
    border-top: 1px solid var(--border-glass);
    display: flex;
    align-items: center;
    justify-content: space-around;
    z-index: 1000;
    padding: 0.5rem;
    box-shadow: 0 -4px 20px rgba(0, 0, 0, 0.1);
    transition: var(--transition-glass);
}

[data-theme="dark"] .mobile-bottom-nav {
    background: var(--sidebar-bg);
    backdrop-filter: blur(var(--blur-xl));
    border-top: 1px solid var(--border-glass);
    box-shadow: 0 -4px 20px rgba(0, 0, 0, 0.3);
}

.nav-item {
    display: flex;
    flex-direction: column;
    align-items: center;
    text-decoration: none;
    color: var(--text-secondary);
    transition: var(--transition-smooth);
    padding: 0.5rem;
    border-radius: 12px;
    min-width: 60px;
    flex: 1;
    justify-content: center;
    position: relative;
    overflow: hidden;
    backdrop-filter: blur(var(--blur-sm));
}

.nav-item::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: var(--glass-secondary);
    border: 1px solid var(--border-glass);
    border-radius: 12px;
    opacity: 0;
    transition: var(--transition-smooth);
}

.nav-item:hover::before,
.nav-item:focus::before {
    opacity: 1;
}

.nav-item:hover,
.nav-item:focus {
    color: var(--primary-500);
    transform: translateY(-2px);
    text-decoration: none;
    box-shadow: var(--shadow-md);
}

.nav-item.active::before {
    opacity: 1;
    background: var(--glass-primary);
    border-color: var(--border-glass-strong);
}

.nav-item.active {
    color: var(--primary-500);
    transform: translateY(-2px);
    box-shadow: var(--shadow-lg), var(--glow-primary);
}

.nav-item i {
    font-size: 1.2rem;
    margin-bottom: 0.25rem;
    line-height: 1;
}

.nav-item span {
    font-size: 0.7rem;
    font-weight: 500;
    text-align: center;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
    max-width: 100%;
}

.mobile-language-selector {
    position: relative;
}

.current-language {
    background: rgba(255,255,255,0.2);
    border: none;
    border-radius: 20px;
    padding: 0.4rem 0.8rem;
    display: flex;
    align-items: center;
    gap: 0.3rem;
    color: white;
    cursor: pointer;
    transition: all 0.3s ease;
}

.current-language:hover {
    background: rgba(255,255,255,0.3);
    transform: translateY(-2px);
}

.current-language img {
    width: 20px;
    height: 15px;
    border-radius: 2px;
    object-fit: cover;
}

.language-options {
    position: absolute;
    top: 100%;
    right: 0;
    background: rgba(0, 0, 0, 0.9);
    backdrop-filter: blur(20px);
    -webkit-backdrop-filter: blur(20px);
    border: 1px solid rgba(255, 255, 255, 0.2);
    border-radius: 12px;
    box-shadow: 0 8px 25px rgba(0, 0, 0, 0.3);
    padding: 0.5rem 0;
    margin: 0;
    list-style: none;
    min-width: 150px;
    display: none;
    z-index: 1001;
}

.mobile-language-selector:hover .language-options {
    display: block;
}

.language-options li a {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    padding: 0.5rem 1rem;
    color: rgba(255, 255, 255, 0.9);
    text-decoration: none;
    transition: all 0.3s ease;
}

.language-options li a:hover {
    background: rgba(255, 255, 255, 0.1);
    color: white;
}

.language-options img {
    width: 20px;
    height: 15px;
    border-radius: 2px;
    object-fit: cover;
}

/* Отступы для контента */
.mobile-content {
    margin-top: 60px;
    margin-bottom: 80px;
    padding: 1rem;
}

.mobile-content.with-progress {
    margin-top: 100px;
}

/* Скрытые элементы для screen readers */
.sr-only {
    position: absolute;
    width: 1px;
    height: 1px;
    padding: 0;
    margin: -1px;
    overflow: hidden;
    clip: rect(0, 0, 0, 0);
    white-space: nowrap;
    border: 0;
}

/* Адаптивность */
@media (max-width: 480px) {
    .mobile-header-content {
        padding: 0.75rem;
    }
    
    .mobile-header-title h1 {
        font-size: 1rem;
    }
    
    .nav-item span {
        font-size: 0.6rem;
    }
    
    .nav-item i {
        font-size: 1.1rem;
    }
    
    .mobile-content {
        padding: 0.75rem;
        margin-bottom: 75px;
    }
}

/* ===== GLASS-ЭФФЕКТ ДЛЯ НАВИГАЦИИ ===== */
.mobile-header, .mobile-bottom-nav {
    background: rgba(20, 20, 30, 0.7);
    backdrop-filter: blur(16px);
    -webkit-backdrop-filter: blur(16px);
    color: #fff;
    box-shadow: 0 4px 24px 0 rgba(0,0,0,0.10);
    border: none;
}

.mobile-header *, .mobile-bottom-nav *,
.mobile-header i, .mobile-bottom-nav i {
    color: #fff !important;
    fill: #fff !important;
}
</style>

<!-- JavaScript для дополнительной функциональности -->
<script>
document.addEventListener('DOMContentLoaded', function() {
    // Добавляем haptic feedback для мобильных устройств
    if ('vibrate' in navigator) {
        document.querySelectorAll('.nav-item, .mobile-back-btn, .header-action-btn').forEach(function(element) {
            element.addEventListener('click', function() {
                navigator.vibrate(10);
            });
        });
    }
    
    // Автоскрытие языкового селектора при клике вне его
    document.addEventListener('click', function(event) {
        const languageSelector = document.querySelector('.mobile-language-selector');
        if (languageSelector && !languageSelector.contains(event.target)) {
            const options = languageSelector.querySelector('.language-options');
            if (options) {
                options.style.display = 'none';
            }
        }
    });
    
    // Показ/скрытие языкового меню по клику
    const currentLanguageBtn = document.querySelector('.current-language');
    if (currentLanguageBtn) {
        currentLanguageBtn.addEventListener('click', function(event) {
            event.stopPropagation();
            const options = document.querySelector('.language-options');
            if (options) {
                options.style.display = options.style.display === 'block' ? 'none' : 'block';
            }
        });
    }
});
</script> 