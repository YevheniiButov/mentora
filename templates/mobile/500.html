{% extends "mobile_base.html" %}

{% block title %}500 - Server Error | Dental Academy{% endblock %}

{% block page_styles %}
.error-container {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    min-height: calc(100vh - 140px);
    padding: 2rem 1rem;
    text-align: center;
    position: relative;
}

.error-animation {
    position: relative;
    margin-bottom: 2rem;
    animation: shake 2s ease-in-out infinite;
}

.broken-tooth {
    font-size: 8rem;
    color: rgba(255, 255, 255, 0.8);
    position: relative;
    filter: drop-shadow(0 10px 20px rgba(0, 0, 0, 0.3));
}

.crack-overlay {
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: linear-gradient(45deg, transparent 45%, rgba(255, 255, 255, 0.3) 47%, rgba(255, 255, 255, 0.3) 53%, transparent 55%);
    animation: crackFlash 3s ease-in-out infinite;
}

.error-sparks {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
}

.spark {
    position: absolute;
    width: 4px;
    height: 4px;
    background: var(--primary);
    border-radius: 50%;
    animation: sparkFly 2s ease-out infinite;
}

.spark:nth-child(1) {
    animation-delay: 0s;
    transform: translate(-20px, -30px);
}

.spark:nth-child(2) {
    animation-delay: 0.3s;
    transform: translate(25px, -20px);
}

.spark:nth-child(3) {
    animation-delay: 0.6s;
    transform: translate(-15px, 25px);
}

.spark:nth-child(4) {
    animation-delay: 0.9s;
    transform: translate(30px, 20px);
}

.error-number {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    font-size: 2.5rem;
    font-weight: 900;
    color: var(--error);
    text-shadow: 0 0 20px rgba(239, 68, 68, 0.5);
    animation: errorGlow 2s ease-in-out infinite alternate;
}

.error-card {
    background: rgba(255, 255, 255, 0.15);
    backdrop-filter: blur(20px);
    -webkit-backdrop-filter: blur(20px);
    border: 1px solid rgba(255, 255, 255, 0.2);
    border-radius: 24px;
    padding: 2rem;
    margin-bottom: 2rem;
    box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
    max-width: 400px;
    width: 100%;
    position: relative;
    overflow: hidden;
}

.error-card::before {
    content: '';
    position: absolute;
    top: 0;
    left: -100%;
    width: 100%;
    height: 100%;
    background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
    animation: cardShimmer 3s ease-in-out infinite;
}

.error-title {
    color: white;
    font-size: 1.5rem;
    font-weight: 700;
    margin-bottom: 1rem;
    animation: slideInUp 0.8s ease-out;
}

.error-message {
    color: rgba(255, 255, 255, 0.9);
    font-size: 1rem;
    line-height: 1.6;
    margin-bottom: 2rem;
    animation: slideInUp 0.8s ease-out 0.2s both;
}

.status-indicator {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    margin-bottom: 1.5rem;
    padding: 0.75rem;
    background: rgba(239, 68, 68, 0.2);
    border: 1px solid rgba(239, 68, 68, 0.3);
    border-radius: 12px;
    animation: slideInUp 0.8s ease-out 0.3s both;
}

.status-dot {
    width: 12px;
    height: 12px;
    background: var(--error);
    border-radius: 50%;
    animation: pulse 2s ease-in-out infinite;
}

.status-text {
    color: white;
    font-weight: 600;
    font-size: 0.9rem;
}

.action-buttons {
    display: flex;
    flex-direction: column;
    gap: 1rem;
    animation: slideInUp 0.8s ease-out 0.4s both;
}

.action-btn {
    background: linear-gradient(135deg, var(--primary), var(--primary-dark));
    border: none;
    border-radius: 16px;
    padding: 1rem 2rem;
    color: white;
    font-weight: 600;
    text-decoration: none;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 0.5rem;
    transition: all 0.3s ease;
    box-shadow: 0 4px 15px rgba(62, 205, 193, 0.3);
    position: relative;
    overflow: hidden;
}

.action-btn:hover {
    transform: translateY(-2px);
    box-shadow: 0 8px 25px rgba(62, 205, 193, 0.4);
    color: white;
}

.action-btn.secondary {
    background: rgba(255, 255, 255, 0.1);
    border: 1px solid rgba(255, 255, 255, 0.2);
    box-shadow: none;
}

.action-btn.secondary:hover {
    background: rgba(255, 255, 255, 0.2);
}

.retry-btn {
    background: linear-gradient(135deg, var(--warning), #f59e0b);
}

.retry-btn:hover {
    box-shadow: 0 8px 25px rgba(250, 204, 21, 0.4);
}

.loading-spinner {
    display: none;
    width: 20px;
    height: 20px;
    border: 2px solid rgba(255, 255, 255, 0.3);
    border-radius: 50%;
    border-top-color: white;
    animation: spin 1s ease-in-out infinite;
}

.technical-info {
    background: rgba(0, 0, 0, 0.3);
    border-radius: 12px;
    padding: 1rem;
    margin-top: 1rem;
    font-family: 'Courier New', monospace;
    font-size: 0.8rem;
    color: rgba(255, 255, 255, 0.7);
    border-left: 4px solid var(--error);
    animation: slideInUp 0.8s ease-out 0.6s both;
}

.floating-debris {
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    pointer-events: none;
    overflow: hidden;
}

.debris {
    position: absolute;
    width: 8px;
    height: 8px;
    background: rgba(255, 255, 255, 0.3);
    border-radius: 2px;
    animation: fall 4s linear infinite;
}

.debris:nth-child(1) {
    left: 10%;
    animation-delay: 0s;
}

.debris:nth-child(2) {
    left: 30%;
    animation-delay: 1s;
}

.debris:nth-child(3) {
    left: 50%;
    animation-delay: 2s;
}

.debris:nth-child(4) {
    left: 70%;
    animation-delay: 3s;
}

.debris:nth-child(5) {
    left: 90%;
    animation-delay: 1.5s;
}

@keyframes shake {
    0%, 100% { transform: translateX(0) rotate(0deg); }
    25% { transform: translateX(-2px) rotate(-1deg); }
    75% { transform: translateX(2px) rotate(1deg); }
}

@keyframes crackFlash {
    0%, 100% { opacity: 0; }
    50% { opacity: 1; }
}

@keyframes sparkFly {
    0% {
        opacity: 1;
        transform: scale(1);
    }
    100% {
        opacity: 0;
        transform: scale(0.5) translate(50px, -50px);
    }
}

@keyframes errorGlow {
    from { text-shadow: 0 0 20px rgba(239, 68, 68, 0.5); }
    to { text-shadow: 0 0 30px rgba(239, 68, 68, 0.8), 0 0 40px rgba(239, 68, 68, 0.6); }
}

@keyframes cardShimmer {
    0% { left: -100%; }
    100% { left: 100%; }
}

@keyframes slideInUp {
    from {
        opacity: 0;
        transform: translateY(30px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}

@keyframes pulse {
    0%, 100% { opacity: 1; transform: scale(1); }
    50% { opacity: 0.5; transform: scale(0.8); }
}

@keyframes spin {
    to { transform: rotate(360deg); }
}

@keyframes fall {
    0% {
        top: -10px;
        opacity: 1;
    }
    100% {
        top: 100vh;
        opacity: 0;
    }
}

/* –¢–µ–º–Ω–∞—è —Ç–µ–º–∞ */
[data-theme="dark"] .error-card {
    background: rgba(0, 0, 0, 0.4);
    border-color: rgba(255, 255, 255, 0.1);
}

[data-theme="dark"] .technical-info {
    background: rgba(0, 0, 0, 0.5);
}
{% endblock %}

{% block header_left %}
<button class="theme-toggle" onclick="goHome()">
    <i class="bi bi-house"></i>
</button>
{% endblock %}

{% block content %}
<div class="error-container">
    <!-- Floating Background Debris -->
    <div class="floating-debris">
        <div class="debris"></div>
        <div class="debris"></div>
        <div class="debris"></div>
        <div class="debris"></div>
        <div class="debris"></div>
    </div>

    <!-- Main Error Animation -->
    <div class="error-animation">
        <div class="broken-tooth">ü¶∑</div>
        <div class="crack-overlay"></div>
        <div class="error-sparks">
            <div class="spark"></div>
            <div class="spark"></div>
            <div class="spark"></div>
            <div class="spark"></div>
        </div>
        <div class="error-number">500</div>
    </div>

    <!-- Error Information Card -->
    <div class="error-card">
        <h1 class="error-title">
            {% if lang == 'ru' %}
                –í–Ω—É—Ç—Ä–µ–Ω–Ω—è—è –æ—à–∏–±–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞
            {% elif lang == 'nl' %}
                Interne serverfout
            {% elif lang == 'uk' %}
                –í–Ω—É—Ç—Ä—ñ—à–Ω—è –ø–æ–º–∏–ª–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞
            {% elif lang == 'es' %}
                Error interno del servidor
            {% elif lang == 'pt' %}
                Erro interno do servidor
            {% elif lang == 'tr' %}
                ƒ∞√ß sunucu hatasƒ±
            {% elif lang == 'fa' %}
                ÿÆÿ∑ÿß€å ÿØÿßÿÆŸÑ€å ÿ≥ÿ±Ÿàÿ±
            {% else %}
                Internal Server Error
            {% endif %}
        </h1>

        <div class="status-indicator">
            <div class="status-dot"></div>
            <div class="status-text">
                {% if lang == 'ru' %}
                    –°–∏—Å—Ç–µ–º–∞ –≤—Ä–µ–º–µ–Ω–Ω–æ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞
                {% elif lang == 'nl' %}
                    Systeem tijdelijk niet beschikbaar
                {% elif lang == 'uk' %}
                    –°–∏—Å—Ç–µ–º–∞ —Ç–∏–º—á–∞—Å–æ–≤–æ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞
                {% elif lang == 'es' %}
                    Sistema temporalmente no disponible
                {% elif lang == 'pt' %}
                    Sistema temporariamente indispon√≠vel
                {% elif lang == 'tr' %}
                    Sistem ge√ßici olarak kullanƒ±lamƒ±yor
                {% elif lang == 'fa' %}
                    ÿ≥€åÿ≥ÿ™ŸÖ ŸÖŸàŸÇÿ™ÿßŸã ÿØÿ± ÿØÿ≥ÿ™ÿ±ÿ≥ ŸÜ€åÿ≥ÿ™
                {% else %}
                    System Temporarily Unavailable
                {% endif %}
            </div>
        </div>

        <p class="error-message">
            {% if lang == 'ru' %}
                –ù–∞—à —Å–µ—Ä–≤–µ—Ä —Å–ª–æ–º–∞–ª—Å—è –∫–∞–∫ –∑—É–± –±–µ–∑ –¥–æ–ª–∂–Ω–æ–≥–æ —É—Ö–æ–¥–∞! –ù–∞—à–∏ –∏–Ω–∂–µ–Ω–µ—Ä—ã —É–∂–µ —Ä–∞–±–æ—Ç–∞—é—Ç –Ω–∞–¥ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ–º —Å–∏—Å—Ç–µ–º—ã.
            {% elif lang == 'nl' %}
                Onze server is kapot gegaan zoals een tand zonder goede zorg! Onze ingenieurs werken al aan het herstel van het systeem.
            {% elif lang == 'uk' %}
                –ù–∞—à —Å–µ—Ä–≤–µ—Ä –∑–ª–∞–º–∞–≤—Å—è —è–∫ –∑—É–± –±–µ–∑ –Ω–∞–ª–µ–∂–Ω–æ–≥–æ –¥–æ–≥–ª—è–¥—É! –ù–∞—à—ñ —ñ–Ω–∂–µ–Ω–µ—Ä–∏ –≤–∂–µ –ø—Ä–∞—Ü—é—é—Ç—å –Ω–∞–¥ –≤—ñ–¥–Ω–æ–≤–ª–µ–Ω–Ω—è–º —Å–∏—Å—Ç–µ–º–∏.
            {% elif lang == 'es' %}
                ¬°Nuestro servidor se rompi√≥ como un diente sin el cuidado adecuado! Nuestros ingenieros ya est√°n trabajando en la restauraci√≥n del sistema.
            {% elif lang == 'pt' %}
                Nosso servidor quebrou como um dente sem os devidos cuidados! Nossos engenheiros j√° est√£o trabalhando na restaura√ß√£o do sistema.
            {% elif lang == 'tr' %}
                Sunucumuz uygun bakƒ±m yapƒ±lmayan bir di≈ü gibi bozuldu! M√ºhendislerimiz sistemin restorasyonu i√ßin √ßalƒ±≈üƒ±yor.
            {% elif lang == 'fa' %}
                ÿ≥ÿ±Ÿàÿ± ŸÖÿß ŸÖÿ´ŸÑ ÿØŸÜÿØÿßŸÜ€å ⁄©Ÿá ÿßÿ≤ ÿ¢ŸÜ ŸÖÿ±ÿßŸÇÿ®ÿ™ ŸÜÿ¥ÿØŸá ÿ¥⁄©ÿ≥ÿ™Ÿá ÿ¥ÿØŸá! ŸÖŸáŸÜÿØÿ≥ÿßŸÜ ŸÖÿß ÿØÿ± ÿ≠ÿßŸÑ ⁄©ÿßÿ± ÿ±Ÿà€å ÿ®ÿßÿ≤ÿ≥ÿßÿ≤€å ÿ≥€åÿ≥ÿ™ŸÖ Ÿáÿ≥ÿ™ŸÜÿØ.
            {% else %}
                Our server broke down like a tooth without proper care! Our engineers are already working on restoring the system.
            {% endif %}
        </p>

        <div class="action-buttons">
            <button class="action-btn retry-btn" onclick="retryConnection()" id="retryBtn">
                <i class="bi bi-arrow-clockwise" id="retryIcon"></i>
                <div class="loading-spinner" id="loadingSpinner"></div>
                <span id="retryText">
                    {% if lang == 'ru' %}
                        –ü–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å —Å–Ω–æ–≤–∞
                    {% elif lang == 'nl' %}
                        Opnieuw proberen
                    {% elif lang == 'uk' %}
                        –°–ø—Ä–æ–±—É–≤–∞—Ç–∏ –∑–Ω–æ–≤—É
                    {% elif lang == 'es' %}
                        Intentar de nuevo
                    {% elif lang == 'pt' %}
                        Tentar novamente
                    {% elif lang == 'tr' %}
                        Tekrar dene
                    {% elif lang == 'fa' %}
                        ÿØŸàÿ®ÿßÿ±Ÿá ÿ™ŸÑÿßÿ¥ ⁄©ŸÜ
                    {% else %}
                        Try Again
                    {% endif %}
                </span>
            </button>

            <a href="{{ url_for('mobile.welcome', lang=lang or 'en') }}" class="action-btn">
                <i class="bi bi-house-fill"></i>
                {% if lang == 'ru' %}
                    –ù–∞ –≥–ª–∞–≤–Ω—É—é
                {% elif lang == 'nl' %}
                    Naar home
                {% elif lang == 'uk' %}
                    –ù–∞ –≥–æ–ª–æ–≤–Ω—É
                {% elif lang == 'es' %}
                    Ir a inicio
                {% elif lang == 'pt' %}
                    Ir para casa
                {% elif lang == 'tr' %}
                    Ana sayfaya git
                {% elif lang == 'fa' %}
                    ÿ®ÿ±Ÿà ÿ®Ÿá ÿÆÿßŸÜŸá
                {% else %}
                    Go Home
                {% endif %}
            </a>

            <button class="action-btn secondary" onclick="contactSupport()">
                <i class="bi bi-headset"></i>
                {% if lang == 'ru' %}
                    –°–≤—è–∑–∞—Ç—å—Å—è —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π
                {% elif lang == 'nl' %}
                    Contact opnemen met support
                {% elif lang == 'uk' %}
                    –ó–≤'—è–∑–∞—Ç–∏—Å—è –∑ –ø—ñ–¥—Ç—Ä–∏–º–∫–æ—é
                {% elif lang == 'es' %}
                    Contactar soporte
                {% elif lang == 'pt' %}
                    Contatar suporte
                {% elif lang == 'tr' %}
                    Destekle ileti≈üim kur
                {% elif lang == 'fa' %}
                    ÿ™ŸÖÿßÿ≥ ÿ®ÿß Ÿæÿ¥ÿ™€åÿ®ÿßŸÜ€å
                {% else %}
                    Contact Support
                {% endif %}
            </button>
        </div>

        <!-- Technical Information -->
        <div class="technical-info" id="techInfo" style="display: none;">
            <div style="margin-bottom: 0.5rem; color: var(--error); font-weight: bold;">
                {% if lang == 'ru' %}
                    –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è:
                {% elif lang == 'nl' %}
                    Technische informatie:
                {% elif lang == 'uk' %}
                    –¢–µ—Ö–Ω—ñ—á–Ω–∞ —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—è:
                {% elif lang == 'es' %}
                    Informaci√≥n t√©cnica:
                {% elif lang == 'pt' %}
                    Informa√ß√µes t√©cnicas:
                {% elif lang == 'tr' %}
                    Teknik bilgi:
                {% elif lang == 'fa' %}
                    ÿßÿ∑ŸÑÿßÿπÿßÿ™ ŸÅŸÜ€å:
                {% else %}
                    Technical Information:
                {% endif %}
            </div>
            <div id="errorDetails">
                Error ID: {{ request.environ.get('REQUEST_ID', 'DT-' + range(1000, 9999) | random | string) }}<br>
                Timestamp: <span id="timestamp"></span><br>
                User Agent: <span id="userAgent"></span>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block nav_items %}
<a href="{{ url_for('mobile.welcome', lang=lang or 'en') }}" class="nav-item active">
    <div class="nav-icon">
        <i class="bi bi-house-fill"></i>
    </div>
    <span class="nav-label">{{ t('home', lang or 'en') }}</span>
</a>
<a href="{{ url_for('mobile.learning_map', lang=lang or 'en') }}" class="nav-item">
    <div class="nav-icon">
        <i class="bi bi-book"></i>
    </div>
    <span class="nav-label">{{ t('learning', lang or 'en') }}</span>
</a>
<a href="{{ url_for('ai.ai_chat', lang=lang or 'en') }}" class="nav-item">
    <div class="nav-icon">
        <i class="fas fa-robot"></i>
    </div>
    <span class="nav-label">{{ t('ai_assistant', lang or 'en') }}</span>
</a>
<a href="#" class="nav-item" onclick="reportProblem()">
    <div class="nav-icon">
        <i class="bi bi-bug"></i>
    </div>
    <span class="nav-label">{{ t('report', lang or 'en') }}</span>
</a>
{% endblock %}

{% block extra_js %}
<script>
let retryCount = 0;
const maxRetries = 3;

function retryConnection() {
    if (retryCount >= maxRetries) {
        showMaxRetriesMessage();
        return;
    }

    const btn = document.getElementById('retryBtn');
    const icon = document.getElementById('retryIcon');
    const spinner = document.getElementById('loadingSpinner');
    const text = document.getElementById('retryText');
    
    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–ø–∏–Ω–Ω–µ—Ä
    icon.style.display = 'none';
    spinner.style.display = 'block';
    btn.disabled = true;
    
    // –û–±–Ω–æ–≤–ª—è–µ–º —Ç–µ–∫—Å—Ç
    const loadingTexts = {
        'ru': '–ü–æ–≤—Ç–æ—Ä–Ω–æ–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ...',
        'nl': 'Opnieuw verbinden...',
        'uk': '–ü–æ–≤—Ç–æ—Ä–Ω–µ –ø—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è...',
        'es': 'Reconectando...',
        'pt': 'Reconectando...',
        'tr': 'Yeniden baƒülanƒ±yor...',
        'fa': 'ÿØÿ± ÿ≠ÿßŸÑ ÿßÿ™ÿµÿßŸÑ ŸÖÿ¨ÿØÿØ...',
        'en': 'Reconnecting...'
    };
    
    const lang = '{{ lang or "en" }}';
    text.textContent = loadingTexts[lang] || loadingTexts['en'];
    
    retryCount++;
    
    // –°–∏–º—É–ª—è—Ü–∏—è –ø–æ–ø—ã—Ç–∫–∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è
    setTimeout(() => {
        // –í —Ä–µ–∞–ª—å–Ω–æ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ –∑–¥–µ—Å—å –±—ã–ª–∞ –±—ã –ø—Ä–æ–≤–µ—Ä–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞
        const success = Math.random() > 0.7; // 30% —à–∞–Ω—Å —É—Å–ø–µ—Ö–∞
        
        if (success) {
            window.location.reload();
        } else {
            // –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∫–Ω–æ–ø–∫—É
            icon.style.display = 'block';
            spinner.style.display = 'none';
            btn.disabled = false;
            
            const retryTexts = {
                'ru': `–ü–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å —Å–Ω–æ–≤–∞ (${maxRetries - retryCount})`,
                'nl': `Opnieuw proberen (${maxRetries - retryCount})`,
                'uk': `–°–ø—Ä–æ–±—É–≤–∞—Ç–∏ –∑–Ω–æ–≤—É (${maxRetries - retryCount})`,
                'es': `Intentar de nuevo (${maxRetries - retryCount})`,
                'pt': `Tentar novamente (${maxRetries - retryCount})`,
                'tr': `Tekrar dene (${maxRetries - retryCount})`,
                'fa': `ÿØŸàÿ®ÿßÿ±Ÿá ÿ™ŸÑÿßÿ¥ ⁄©ŸÜ (${maxRetries - retryCount})`,
                'en': `Try Again (${maxRetries - retryCount})`
            };
            
            text.textContent = retryTexts[lang] || retryTexts['en'];
            
            // –ê–Ω–∏–º–∞—Ü–∏—è —Ç—Ä—è—Å–∫–∏
            btn.style.animation = 'shake 0.5s ease-in-out';
            setTimeout(() => {
                btn.style.animation = '';
            }, 500);
        }
    }, 2000);
}

function showMaxRetriesMessage() {
    const messages = {
        'ru': '–ü—Ä–µ–≤—ã—à–µ–Ω–æ –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ–ø—ã—Ç–æ–∫. –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, —Å–≤—è–∂–∏—Ç–µ—Å—å —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π.',
        'nl': 'Maximum aantal pogingen overschreden. Neem contact op met support.',
        'uk': '–ü–µ—Ä–µ–≤–∏—â–µ–Ω–æ –º–∞–∫—Å–∏–º–∞–ª—å–Ω—É –∫—ñ–ª—å–∫—ñ—Å—Ç—å —Å–ø—Ä–æ–±. –ë—É–¥—å –ª–∞—Å–∫–∞, –∑–≤–µ—Ä–Ω—ñ—Ç—å—Å—è –¥–æ –ø—ñ–¥—Ç—Ä–∏–º–∫–∏.',
        'es': 'M√°ximo n√∫mero de intentos excedido. Por favor contacte a soporte.',
        'pt': 'N√∫mero m√°ximo de tentativas excedido. Por favor contate o suporte.',
        'tr': 'Maksimum deneme sayƒ±sƒ± a≈üƒ±ldƒ±. L√ºtfen destekle ileti≈üime ge√ßin.',
        'fa': 'ÿ≠ÿØÿß⁄©ÿ´ÿ± ÿ™ÿπÿØÿßÿØ ÿ™ŸÑÿßÿ¥ ÿ™ÿ¨ÿßŸàÿ≤ ÿ¥ÿØŸá. ŸÑÿ∑ŸÅÿßŸã ÿ®ÿß Ÿæÿ¥ÿ™€åÿ®ÿßŸÜ€å ÿ™ŸÖÿßÿ≥ ÿ®⁄Ø€åÿ±€åÿØ.',
        'en': 'Maximum retry attempts exceeded. Please contact support.'
    };
    
    const lang = '{{ lang or "en" }}';
    alert(messages[lang] || messages['en']);
    contactSupport();
}

function contactSupport() {
    const messages = {
        'ru': '–ü–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É –ø–æ–¥–¥–µ—Ä–∂–∫–∏...',
        'nl': 'Doorverwijzen naar supportpagina...',
        'uk': '–ü–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–Ω—è –Ω–∞ —Å—Ç–æ—Ä—ñ–Ω–∫—É –ø—ñ–¥—Ç—Ä–∏–º–∫–∏...',
        'es': 'Redirigiendo a la p√°gina de soporte...',
        'pt': 'Redirecionando para a p√°gina de suporte...',
        'tr': 'Destek sayfasƒ±na y√∂nlendiriliyor...',
        'fa': 'ŸáÿØÿß€åÿ™ ÿ®Ÿá ÿµŸÅÿ≠Ÿá Ÿæÿ¥ÿ™€åÿ®ÿßŸÜ€å...',
        'en': 'Redirecting to support page...'
    };
    
    const lang = '{{ lang or "en" }}';
    alert(messages[lang] || messages['en']);
    
    // –í —Ä–µ–∞–ª—å–Ω–æ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ –∑–¥–µ—Å—å –±—ã–ª –±—ã —Ä–µ–¥–∏—Ä–µ–∫—Ç –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É –ø–æ–¥–¥–µ—Ä–∂–∫–∏
    // window.location.href = '/support';
}

function toggleTechInfo() {
    const techInfo = document.getElementById('techInfo');
    const isVisible = techInfo.style.display !== 'none';
    
    if (isVisible) {
        techInfo.style.display = 'none';
    } else {
        // –ó–∞–ø–æ–ª–Ω—è–µ–º —Ç–µ—Ö–Ω–∏—á–µ—Å–∫—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é
        document.getElementById('timestamp').textContent = new Date().toISOString();
        document.getElementById('userAgent').textContent = navigator.userAgent;
        techInfo.style.display = 'block';
    }
}

function goHome() {
    window.location.href = "{{ url_for('mobile.welcome', lang=lang or 'en') }}";
}

// –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –ø–æ–ø—ã—Ç–∫–∞ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è —á–µ—Ä–µ–∑ 30 —Å–µ–∫—É–Ω–¥
setTimeout(() => {
    if (retryCount === 0) {
        retryConnection();
    }
}, 30000);

// –î–æ–±–∞–≤–ª—è–µ–º –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –∫ —Å–ª–æ–º–∞–Ω–Ω–æ–º—É –∑—É–±—É
document.querySelector('.broken-tooth').addEventListener('click', function() {
    this.parentElement.style.animation = 'shake 0.5s ease-in-out';
    setTimeout(() => {
        this.parentElement.style.animation = 'shake 2s ease-in-out infinite';
    }, 500);
});
</script>
{% endblock %} 