{% extends "mobile_base.html" %}

{% set nav_config = get_navigation_config('tests',
    show_logo=True,
    show_back_button=False,
    show_bottom_nav=True,
    show_profile_button=True,
    show_settings_button=True,
    show_language_selector=True,
    page_title=t('test_system', lang)
) %}

{% block title %}{{ t('test_system', lang) }} - {{ t('dental_academy', lang) }}{% endblock %}

{% block extra_css %}
<style>
    /* ===== TEST SYSTEM –í –°–¢–ò–õ–ò–°–¢–ò–ö–ï AI ===== */
    
    /* –ó–∞–≥–æ–ª–æ–≤–æ—á–Ω—ã–π —Å—Ç–∞—Ç—É—Å –±–∞—Ä */
    .test-status-bar {
        background: rgba(255, 255, 255, 0.1);
        backdrop-filter: blur(20px);
        -webkit-backdrop-filter: blur(20px);
        border: 1px solid rgba(255, 255, 255, 0.2);
        border-radius: 12px;
        padding: 1rem;
        margin-bottom: 1.5rem;
        display: flex;
        align-items: center;
        justify-content: space-between;
    }
    
    .test-status-info {
        display: flex;
        align-items: center;
        gap: 8px;
        color: white;
    }
    
    .test-status-icon {
        width: 8px;
        height: 8px;
        border-radius: 50%;
        background: #3ECDC1;
        animation: pulse 2s infinite;
    }
    
    @keyframes pulse {
        0%, 100% { opacity: 1; }
        50% { opacity: 0.5; }
    }
    
    .test-system-badge {
        padding: 4px 12px;
        background: rgba(255, 255, 255, 0.1);
        border-radius: 12px;
        font-size: 0.8rem;
        font-weight: 500;
        color: rgba(255, 255, 255, 0.8);
    }
    
    /* –ü—Ä–∏–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω—ã–π —Ç–µ–∫—Å—Ç */
    .welcome-message {
        background: rgba(255, 255, 255, 0.1);
        backdrop-filter: blur(20px);
        -webkit-backdrop-filter: blur(20px);
        border: 1px solid rgba(255, 255, 255, 0.2);
        border-radius: 20px;
        padding: 2rem;
        margin-bottom: 1.5rem;
        text-align: center;
        color: white;
        animation: slideInMessage 0.3s ease-out;
    }
    
    @keyframes slideInMessage {
        from {
            opacity: 0;
            transform: translateY(20px);
        }
        to {
            opacity: 1;
            transform: translateY(0);
        }
    }
    
    .welcome-icon {
        font-size: 3rem;
        margin-bottom: 1rem;
        opacity: 0.8;
    }
    
    .welcome-title {
        font-size: 1.5rem;
        font-weight: 700;
        margin-bottom: 0.5rem;
        background: linear-gradient(135deg, #ffffff, #3ECDC1);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
    }
    
    .welcome-description {
        opacity: 0.9;
        line-height: 1.5;
        font-size: 1rem;
    }
    
    /* –û–ø—Ü–∏–∏ —Ç–µ—Å—Ç–æ–≤ –≤ —Å—Ç–∏–ª–µ AI —á–∞—Ç–∞ */
    .test-options-container {
        display: flex;
        flex-direction: column;
        gap: 1rem;
    }
    
    .test-option-card {
        background: rgba(255, 255, 255, 0.1);
        backdrop-filter: blur(20px);
        -webkit-backdrop-filter: blur(20px);
        border: 1px solid rgba(255, 255, 255, 0.2);
        border-radius: 16px;
        padding: 1.5rem;
        transition: all 0.3s ease;
        cursor: pointer;
        text-decoration: none;
        color: white;
        position: relative;
        overflow: hidden;
    }
    
    .test-option-card:hover {
        transform: translateY(-5px);
        background: rgba(255, 255, 255, 0.15);
        border-color: rgba(62, 205, 193, 0.4);
        box-shadow: 0 10px 30px rgba(62, 205, 193, 0.2);
        color: white;
    }
    
    .test-option-header {
        display: flex;
        align-items: center;
        gap: 1rem;
        margin-bottom: 1rem;
    }
    
    .test-option-icon {
        width: 50px;
        height: 50px;
        background: linear-gradient(135deg, #3ECDC1, #2B9E94);
        border-radius: 12px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 1.5rem;
        color: white;
        box-shadow: 0 4px 15px rgba(62, 205, 193, 0.3);
    }
    
    .test-option-info {
        flex: 1;
    }
    
    .test-option-title {
        font-size: 1.2rem;
        font-weight: 600;
        margin-bottom: 0.25rem;
        color: white;
    }
    
    .test-option-meta {
        font-size: 0.85rem;
        color: rgba(255, 255, 255, 0.7);
        display: flex;
        align-items: center;
        gap: 1rem;
    }
    
    .test-option-meta span {
        display: flex;
        align-items: center;
        gap: 0.25rem;
    }
    
    .test-option-description {
        font-size: 0.95rem;
        line-height: 1.4;
        opacity: 0.9;
        margin-bottom: 1rem;
    }
    
    .test-option-features {
        display: flex;
        gap: 0.5rem;
        flex-wrap: wrap;
    }
    
    .test-feature-badge {
        background: rgba(255, 255, 255, 0.1);
        border-radius: 6px;
        padding: 0.25rem 0.5rem;
        font-size: 0.75rem;
        color: rgba(255, 255, 255, 0.8);
    }
    
    /* –ö–∞—Å—Ç–æ–º–Ω–∞—è —Ñ–æ—Ä–º–∞ –≤ —Å—Ç–∏–ª–µ AI */
    .custom-test-panel {
        background: rgba(255, 255, 255, 0.1);
        backdrop-filter: blur(20px);
        -webkit-backdrop-filter: blur(20px);
        border: 1px solid rgba(255, 255, 255, 0.2);
        border-radius: 16px;
        padding: 1.5rem;
        margin-top: 1rem;
        animation: slideInMessage 0.3s ease-out;
        display: none;
    }
    
    .custom-test-header {
        display: flex;
        align-items: center;
        gap: 0.5rem;
        margin-bottom: 1.5rem;
        color: white;
    }
    
    .custom-test-title {
        font-size: 1.1rem;
        font-weight: 600;
    }
    
    .form-section {
        margin-bottom: 1.5rem;
    }
    
    .form-label {
        display: block;
        color: white;
        font-weight: 600;
        margin-bottom: 0.75rem;
        font-size: 0.95rem;
    }
    
    /* –°–µ–ª–µ–∫—Ç–æ—Ä –∫–∞—Ç–µ–≥–æ—Ä–∏–π –≤ —Å—Ç–∏–ª–µ AI */
    .category-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
        gap: 0.75rem;
    }
    
    .category-chip {
        background: rgba(255, 255, 255, 0.1);
        border: 1px solid rgba(255, 255, 255, 0.2);
        border-radius: 12px;
        padding: 0.75rem;
        text-align: center;
        cursor: pointer;
        transition: all 0.3s ease;
        font-size: 0.9rem;
        color: white;
    }
    
    .category-chip:hover {
        background: rgba(255, 255, 255, 0.15);
        border-color: rgba(62, 205, 193, 0.4);
    }
    
    .category-chip.selected {
        background: linear-gradient(135deg, #3ECDC1, #2B9E94);
        border-color: #3ECDC1;
        box-shadow: 0 4px 15px rgba(62, 205, 193, 0.3);
    }
    
    /* –°–µ–ª–µ–∫—Ç–æ—Ä –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –≤–æ–ø—Ä–æ—Å–æ–≤ */
    .question-count-selector {
        display: flex;
        gap: 0.5rem;
        flex-wrap: wrap;
    }
    
    .count-option {
        background: rgba(255, 255, 255, 0.1);
        border: 1px solid rgba(255, 255, 255, 0.2);
        border-radius: 20px;
        padding: 0.5rem 1rem;
        cursor: pointer;
        transition: all 0.3s ease;
        font-weight: 600;
        color: white;
        min-width: 60px;
        text-align: center;
    }
    
    .count-option:hover {
        background: rgba(255, 255, 255, 0.15);
        border-color: rgba(62, 205, 193, 0.4);
    }
    
    .count-option.selected {
        background: linear-gradient(135deg, #3ECDC1, #2B9E94);
        border-color: #3ECDC1;
        box-shadow: 0 4px 15px rgba(62, 205, 193, 0.3);
    }
    
    /* –ö–Ω–æ–ø–∫–∞ –∑–∞–ø—É—Å–∫–∞ –≤ —Å—Ç–∏–ª–µ AI */
    .start-test-button {
        width: 100%;
        background: linear-gradient(135deg, #3ECDC1, #2B9E94);
        border: none;
        border-radius: 12px;
        padding: 1rem 1.5rem;
        color: white;
        font-weight: 600;
        font-size: 1rem;
        cursor: pointer;
        transition: all 0.3s ease;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 0.5rem;
        margin-top: 1rem;
    }
    
    .start-test-button:hover:not(:disabled) {
        transform: translateY(-2px);
        box-shadow: 0 8px 25px rgba(62, 205, 193, 0.4);
    }
    
    .start-test-button:disabled {
        opacity: 0.5;
        cursor: not-allowed;
        transform: none;
    }
    
    /* –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ AI —ç—Ñ—Ñ–µ–∫—Ç—ã */
    .ai-glow {
        position: relative;
    }
    
    .ai-glow::before {
        content: '';
        position: absolute;
        top: -2px;
        left: -2px;
        right: -2px;
        bottom: -2px;
        background: linear-gradient(45deg, #3ECDC1, #2B9E94, #3ECDC1);
        border-radius: inherit;
        z-index: -1;
        opacity: 0;
        transition: opacity 0.3s ease;
    }
    
    .ai-glow:hover::before {
        opacity: 0.3;
    }
    
    /* –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –≤ –≤–µ—Ä—Ö–Ω–µ–π —á–∞—Å—Ç–∏ */
    .test-stats-mini {
        display: flex;
        gap: 1rem;
        justify-content: space-around;
        margin-bottom: 1rem;
    }
    
    .stat-mini {
        text-align: center;
        color: rgba(255, 255, 255, 0.8);
    }
    
    .stat-mini-value {
        font-size: 1.1rem;
        font-weight: 700;
        color: #3ECDC1;
    }
    
    .stat-mini-label {
        font-size: 0.8rem;
        margin-top: 0.25rem;
    }
</style>
{% endblock %}

{% block content %}
<!-- AI-style Status Bar -->
<div class="test-status-bar">
    <div class="test-status-info">
        <div class="test-status-icon"></div>
        <span>{{ t('test_system_online', lang) or '–°–∏—Å—Ç–µ–º–∞ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –æ–Ω–ª–∞–π–Ω' }}</span>
    </div>
    <div class="test-system-badge">
        <i class="bi bi-cpu"></i> Smart Tests
    </div>
</div>

<!-- Welcome Message –≤ —Å—Ç–∏–ª–µ AI -->
<div class="welcome-message">
    <div class="welcome-icon">ü§ñ</div>
    <div class="welcome-title">
        {{ t('ai_test_welcome', lang) or '–£–º–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è' }}
    </div>
    <div class="welcome-description">
        {{ t('ai_test_description', lang) or '–í—ã–±–µ—Ä–∏—Ç–µ –ø–æ–¥—Ö–æ–¥—è—â–∏–π —Ç–∏–ø —Ç–µ—Å—Ç–∞. –°–∏—Å—Ç–µ–º–∞ –∞–¥–∞–ø—Ç–∏—Ä—É–µ—Ç—Å—è –ø–æ–¥ –≤–∞—à —É—Ä–æ–≤–µ–Ω—å –∑–Ω–∞–Ω–∏–π.' }}
    </div>
    
    <!-- Mini Stats -->
    <div class="test-stats-mini">
        <div class="stat-mini">
            <div class="stat-mini-value">{{ total_tests_available or '50+' }}</div>
            <div class="stat-mini-label">{{ t('tests_available', lang) or '—Ç–µ—Å—Ç–æ–≤' }}</div>
        </div>
        <div class="stat-mini">
            <div class="stat-mini-value">{{ subjects_count or '9' }}</div>
            <div class="stat-mini-label">{{ t('subjects', lang) or '–ø—Ä–µ–¥–º–µ—Ç–æ–≤' }}</div>
        </div>
        <div class="stat-mini">
            <div class="stat-mini-value">{{ avg_score or '85%' }}</div>
            <div class="stat-mini-label">{{ t('avg_score', lang) or '—Å—Ä–µ–¥–Ω–∏–π –±–∞–ª–ª' }}</div>
        </div>
    </div>
</div>

<!-- Test Options –≤ —Å—Ç–∏–ª–µ AI —á–∞—Ç–∞ -->
<div class="test-options-container">
    <!-- Quick Test -->
    <a href="{{ url_for('tests_bp.setup_test', lang=lang) }}" class="test-option-card ai-glow">
        <div class="test-option-header">
            <div class="test-option-icon">
                <i class="bi bi-lightning-charge"></i>
            </div>
            <div class="test-option-info">
                <div class="test-option-title">{{ t('quick_test', lang) or '–ë—ã—Å—Ç—Ä—ã–π —Ç–µ—Å—Ç' }}</div>
                <div class="test-option-meta">
                    <span><i class="bi bi-clock"></i> 5-15 –º–∏–Ω</span>
                    <span><i class="bi bi-question-circle"></i> 5-10 –≤–æ–ø—Ä–æ—Å–æ–≤</span>
                </div>
            </div>
        </div>
        <div class="test-option-description">
            {{ t('quick_test_desc', lang) or '–ë—ã—Å—Ç—Ä–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –∫–ª—é—á–µ–≤—ã—Ö –∑–Ω–∞–Ω–∏–π. –ò–¥–µ–∞–ª—å–Ω–æ –¥–ª—è –ø–æ–≤—Ç–æ—Ä–µ–Ω–∏—è –ø–µ—Ä–µ–¥ –∑–∞–Ω—è—Ç–∏–µ–º.' }}
        </div>
        <div class="test-option-features">
            <span class="test-feature-badge">{{ t('adaptive', lang) or '–ê–¥–∞–ø—Ç–∏–≤–Ω—ã–π' }}</span>
            <span class="test-feature-badge">{{ t('instant_results', lang) or '–ú–≥–Ω–æ–≤–µ–Ω–Ω—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã' }}</span>
        </div>
    </a>
    
    <!-- Full Test -->
    <a href="{{ url_for('tests_bp.setup_test', lang=lang) }}" class="test-option-card ai-glow">
        <div class="test-option-header">
            <div class="test-option-icon">
                <i class="bi bi-clipboard-check"></i>
            </div>
            <div class="test-option-info">
                <div class="test-option-title">{{ t('comprehensive_test', lang) or '–ü–æ–ª–Ω—ã–π —Ç–µ—Å—Ç' }}</div>
                <div class="test-option-meta">
                    <span><i class="bi bi-clock"></i> 20-45 –º–∏–Ω</span>
                    <span><i class="bi bi-question-circle"></i> 20-30 –≤–æ–ø—Ä–æ—Å–æ–≤</span>
                </div>
            </div>
        </div>
        <div class="test-option-description">
            {{ t('comprehensive_test_desc', lang) or '–ì–ª—É–±–æ–∫–∞—è –æ—Ü–µ–Ω–∫–∞ –∑–Ω–∞–Ω–∏–π –ø–æ –≤—Å–µ–º –∞—Å–ø–µ–∫—Ç–∞–º —Ç–µ–º—ã. –ü–æ–¥—Ä–æ–±–Ω–∞—è –æ–±—Ä–∞—Ç–Ω–∞—è —Å–≤—è–∑—å.' }}
        </div>
        <div class="test-option-features">
            <span class="test-feature-badge">{{ t('detailed_analysis', lang) or '–î–µ—Ç–∞–ª—å–Ω—ã–π –∞–Ω–∞–ª–∏–∑' }}</span>
            <span class="test-feature-badge">{{ t('progress_tracking', lang) or '–û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞' }}</span>
        </div>
    </a>
    
    <!-- Custom Test -->
    <div class="test-option-card ai-glow" onclick="toggleCustomTest()">
        <div class="test-option-header">
            <div class="test-option-icon">
                <i class="bi bi-gear"></i>
            </div>
            <div class="test-option-info">
                <div class="test-option-title">{{ t('custom_test', lang) or '–ù–∞—Å—Ç—Ä–æ–∏—Ç—å —Ç–µ—Å—Ç' }}</div>
                <div class="test-option-meta">
                    <span><i class="bi bi-sliders"></i> {{ t('customizable', lang) or '–ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º—ã–π' }}</span>
                    <span><i class="bi bi-bullseye"></i> {{ t('targeted', lang) or '–¶–µ–ª–µ–≤–æ–π' }}</span>
                </div>
            </div>
        </div>
        <div class="test-option-description">
            {{ t('custom_test_desc', lang) or '–°–æ–∑–¥–∞–π—Ç–µ —Ç–µ—Å—Ç –ø–æ–¥ —Å–≤–æ–∏ –ø–æ—Ç—Ä–µ–±–Ω–æ—Å—Ç–∏: –≤—ã–±–µ—Ä–∏—Ç–µ —Ç–µ–º—É, —Å–ª–æ–∂–Ω–æ—Å—Ç—å –∏ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –≤–æ–ø—Ä–æ—Å–æ–≤.' }}
        </div>
        <div class="test-option-features">
            <span class="test-feature-badge">{{ t('flexible', lang) or '–ì–∏–±–∫–∏–π' }}</span>
            <span class="test-feature-badge">{{ t('topic_focused', lang) or '–§–æ–∫—É—Å –Ω–∞ —Ç–µ–º–µ' }}</span>
        </div>
    </div>
</div>

<!-- Custom Test Panel -->
<div class="custom-test-panel" id="customTestPanel">
    <div class="custom-test-header">
        <i class="bi bi-robot"></i>
        <span class="custom-test-title">{{ t('ai_test_configurator', lang) or 'AI –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ç–æ—Ä —Ç–µ—Å—Ç–∞' }}</span>
    </div>
    
    <form method="POST" action="{{ url_for('tests_bp.start_custom_test', lang=lang) }}">
        <div class="form-section">
            <label class="form-label">
                <i class="bi bi-folder"></i> {{ t('select_category', lang) or '–í—ã–±–µ—Ä–∏—Ç–µ –∫–∞—Ç–µ–≥–æ—Ä–∏—é:' }}
            </label>
            <div class="category-grid">
                {% for category in categories %}
                <div class="category-chip" onclick="selectCategory(this, '{{ category.name }}')" data-category="{{ category.name }}">
                    {{ category.name }}
                </div>
                {% endfor %}
            </div>
        </div>
        
        <div class="form-section">
            <label class="form-label">
                <i class="bi bi-hash"></i> {{ t('question_count', lang) or '–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –≤–æ–ø—Ä–æ—Å–æ–≤:' }}
            </label>
            <div class="question-count-selector">
                <div class="count-option" onclick="selectCount(this, 5)">5</div>
                <div class="count-option selected" onclick="selectCount(this, 10)">10</div>
                <div class="count-option" onclick="selectCount(this, 15)">15</div>
                <div class="count-option" onclick="selectCount(this, 20)">20</div>
                <div class="count-option" onclick="selectCount(this, 30)">30</div>
            </div>
        </div>
        
        <input type="hidden" name="category" id="selectedCategory">
        <input type="hidden" name="length" id="selectedLength" value="10">
        
        <button type="submit" class="start-test-button" id="startCustomTest" disabled>
            <i class="bi bi-play-fill"></i>
            {{ t('start_ai_test', lang) or '–ó–∞–ø—É—Å—Ç–∏—Ç—å AI —Ç–µ—Å—Ç' }}
        </button>
    </form>
</div>
{% endblock %}

{% block extra_js %}
<script>
// –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –∫–∞—Å—Ç–æ–º–Ω–æ–π –ø–∞–Ω–µ–ª–∏
function toggleCustomTest() {
    const panel = document.getElementById('customTestPanel');
    panel.style.display = panel.style.display === 'none' ? 'block' : 'none';
}

// –í—ã–±–æ—Ä –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
function selectCategory(element, category) {
    document.querySelectorAll('.category-chip').forEach(chip => {
        chip.classList.remove('selected');
    });
    element.classList.add('selected');
    document.getElementById('selectedCategory').value = category;
    checkFormValidity();
}

// –í—ã–±–æ—Ä –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –≤–æ–ø—Ä–æ—Å–æ–≤
function selectCount(element, count) {
    document.querySelectorAll('.count-option').forEach(option => {
        option.classList.remove('selected');
    });
    element.classList.add('selected');
    document.getElementById('selectedLength').value = count;
    checkFormValidity();
}

// –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤–∞–ª–∏–¥–Ω–æ—Å—Ç–∏ —Ñ–æ—Ä–º—ã
function checkFormValidity() {
    const category = document.getElementById('selectedCategory').value;
    const count = document.getElementById('selectedLength').value;
    const button = document.getElementById('startCustomTest');
    
    button.disabled = !category || !count;
}

// –î–æ–±–∞–≤–ª—è–µ–º —Ç–∞–∫—Ç–∏–ª—å–Ω—É—é –æ–±—Ä–∞—Ç–Ω—É—é —Å–≤—è–∑—å
document.querySelectorAll('.test-option-card, .category-chip, .count-option').forEach(element => {
    element.addEventListener('touchstart', function() {
        if (navigator.vibrate) {
            navigator.vibrate(50);
        }
    });
});

console.log('ü§ñ AI Test System - –≥–æ—Ç–æ–≤!');
</script>
{% endblock %} 