{% extends "mobile_base.html" %}

{% set nav_config = get_navigation_config('profile',
    show_back_button=false,
    show_profile_button=false,
    show_settings_button=true,
    show_language_selector=true,
    page_title='profile'
) %}

{% block title %}{{ t('profile', lang) }} - Dental Academy{% endblock %}

{% block extra_css %}
<style>
    /* ===== –°–û–í–†–ï–ú–ï–ù–ù–´–ô –ú–û–ë–ò–õ–¨–ù–´–ô –ü–†–û–§–ò–õ–¨ ===== */
    :root {
        --mobile-primary: #3ECDC1;
        --mobile-primary-dark: #2BB6AC;
        --mobile-secondary: #667eea;
        --mobile-accent: #764ba2;
        --mobile-glass-bg: rgba(255, 255, 255, 0.1);
        --mobile-glass-border: rgba(255, 255, 255, 0.2);
        --mobile-glass-hover: rgba(255, 255, 255, 0.15);
        --mobile-shadow: 0 8px 32px rgba(0, 0, 0, 0.15);
        --mobile-shadow-hover: 0 12px 40px rgba(0, 0, 0, 0.2);
        --mobile-radius: 20px;
        --mobile-radius-lg: 24px;
        --mobile-transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    }
    
    /* –ü–ª–∞–≤–∞—é—â–∏–µ —á–∞—Å—Ç–∏—Ü—ã –¥–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö */
    .mobile-particles {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        pointer-events: none;
        z-index: 1;
        overflow: hidden;
    }
    
    .mobile-particle {
        position: absolute;
        width: 3px;
        height: 3px;
        background: rgba(255, 255, 255, 0.4);
        border-radius: 50%;
        animation: mobile-float 12s linear infinite;
    }
    
    @keyframes mobile-float {
        0% { 
            transform: translateY(100vh) rotate(0deg);
            opacity: 0;
        }
        10% { opacity: 0.6; }
        90% { opacity: 0.6; }
        100% { 
            transform: translateY(-100vh) rotate(180deg);
            opacity: 0;
        }
    }
    
    /* ===== HERO –ü–†–û–§–ò–õ–¨ HEADER ===== */
    .profile-header {
        background: var(--mobile-glass-bg);
        backdrop-filter: blur(20px);
        -webkit-backdrop-filter: blur(20px);
        border: 1px solid var(--mobile-glass-border);
        border-radius: var(--mobile-radius-lg);
        padding: 2.5rem 1.5rem;
        margin-bottom: 1.5rem;
        text-align: center;
        position: relative;
        overflow: hidden;
        box-shadow: var(--mobile-shadow);
        transition: var(--mobile-transition);
    }
    
    .profile-header::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: linear-gradient(135deg, rgba(62, 205, 193, 0.08), rgba(43, 158, 148, 0.08));
        z-index: -1;
    }
    
    .profile-header:active {
        transform: scale(0.98);
        box-shadow: var(--mobile-shadow-hover);
    }
    
    /* ===== –°–û–í–†–ï–ú–ï–ù–ù–´–ô –ê–í–ê–¢–ê–† ===== */
    .profile-avatar {
        width: 120px;
        height: 120px;
        border-radius: 50%;
        background: linear-gradient(135deg, var(--mobile-primary), var(--mobile-primary-dark));
        display: flex;
        align-items: center;
        justify-content: center;
        margin: 0 auto 1.5rem;
        color: white;
        font-size: 3rem;
        font-weight: 700;
        box-shadow: 0 15px 35px rgba(62, 205, 193, 0.4);
        position: relative;
        overflow: hidden;
        transition: var(--mobile-transition);
    }
    
    .profile-avatar::before {
        content: '';
        position: absolute;
        top: -50%;
        left: -50%;
        width: 200%;
        height: 200%;
        background: radial-gradient(circle, rgba(255,255,255,0.15) 0%, transparent 70%);
        transition: all 0.5s ease;
        opacity: 0;
    }
    
    .profile-avatar:active {
        transform: scale(1.05);
        box-shadow: 0 20px 45px rgba(62, 205, 193, 0.5);
    }
    
    .profile-avatar:active::before {
        opacity: 1;
        animation: mobile-shimmer 1s ease-in-out;
    }
    
    @keyframes mobile-shimmer {
        0%, 100% { transform: translateX(-100%) translateY(-100%) rotate(45deg); }
        50% { transform: translateX(100%) translateY(100%) rotate(45deg); }
    }
    
    .profile-name {
        color: white;
        font-size: 1.5rem;
        font-weight: 700;
        margin-bottom: 0.5rem;
    }
    
    .profile-email {
        color: rgba(255, 255, 255, 0.8);
        font-size: 0.9rem;
        margin-bottom: 1rem;
    }
    
    .profile-stats {
        display: grid;
        grid-template-columns: repeat(3, 1fr);
        gap: 1rem;
        margin-top: 1rem;
    }
    
    .profile-stat {
        text-align: center;
    }
    
    .profile-stat-value {
        color: white;
        font-size: 1.25rem;
        font-weight: 700;
    }
    
    .profile-stat-label {
        color: rgba(255, 255, 255, 0.7);
        font-size: 0.75rem;
        text-transform: uppercase;
        letter-spacing: 0.5px;
    }
    
    /* –°–µ–∫—Ü–∏–∏ –ø—Ä–æ—Ñ–∏–ª—è */
    .profile-section {
        background: rgba(255, 255, 255, 0.1);
        backdrop-filter: blur(20px);
        -webkit-backdrop-filter: blur(20px);
        border: 1px solid rgba(255, 255, 255, 0.2);
        border-radius: 16px;
        margin-bottom: 1rem;
        overflow: hidden;
    }
    
    .profile-section-header {
        padding: 1rem 1.5rem;
        border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        display: flex;
        align-items: center;
        gap: 0.75rem;
    }
    
    .profile-section-icon {
        width: 40px;
        height: 40px;
        background: rgba(255, 255, 255, 0.1);
        border-radius: 10px;
        display: flex;
        align-items: center;
        justify-content: center;
        color: #3ECDC1;
        font-size: 1.1rem;
    }
    
    .profile-section-title {
        color: white;
        font-size: 1rem;
        font-weight: 600;
        flex: 1;
    }
    
    .profile-section-content {
        padding: 0;
    }
    
    .profile-menu-item {
        display: flex;
        align-items: center;
        padding: 1rem 1.5rem;
        color: white;
        text-decoration: none;
        border-bottom: 1px solid rgba(255, 255, 255, 0.05);
        transition: all 0.3s ease;
    }
    
    .profile-menu-item:last-child {
        border-bottom: none;
    }
    
    .profile-menu-item:hover {
        background: rgba(255, 255, 255, 0.1);
        transform: translateX(5px);
    }
    
    .profile-menu-icon {
        width: 24px;
        height: 24px;
        margin-right: 1rem;
        color: #3ECDC1;
        font-size: 1rem;
    }
    
    .profile-menu-content {
        flex: 1;
    }
    
    .profile-menu-title {
        font-weight: 500;
        margin-bottom: 0.25rem;
    }
    
    .profile-menu-subtitle {
        font-size: 0.85rem;
        color: rgba(255, 255, 255, 0.7);
    }
    
    .profile-menu-arrow {
        color: rgba(255, 255, 255, 0.5);
        font-size: 0.9rem;
    }
    
    /* –ü—Ä–æ–≥—Ä–µ—Å—Å –æ–±—É—á–µ–Ω–∏—è */
    .learning-progress {
        padding: 1.5rem;
    }
    
    .progress-item {
        display: flex;
        align-items: center;
        justify-content: space-between;
        margin-bottom: 1rem;
    }
    
    .progress-item:last-child {
        margin-bottom: 0;
    }
    
    .progress-info {
        flex: 1;
    }
    
    .progress-title {
        color: white;
        font-weight: 500;
        margin-bottom: 0.25rem;
    }
    
    .progress-subtitle {
        color: rgba(255, 255, 255, 0.7);
        font-size: 0.85rem;
    }
    
    .progress-value {
        color: #3ECDC1;
        font-weight: 600;
        margin-left: 1rem;
    }
    
    .progress-bar {
        width: 100%;
        height: 6px;
        background: rgba(255, 255, 255, 0.1);
        border-radius: 3px;
        margin-top: 0.5rem;
        overflow: hidden;
    }
    
    .progress-fill {
        height: 100%;
        background: linear-gradient(90deg, #3ECDC1, #2B9E94);
        border-radius: 3px;
        transition: width 0.3s ease;
    }
    
    /* –ë—ã—Å—Ç—Ä—ã–µ –¥–µ–π—Å—Ç–≤–∏—è */
    .quick-actions {
        display: grid;
        grid-template-columns: repeat(2, 1fr);
        gap: 1rem;
        padding: 1.5rem;
    }
    
    .quick-action {
        background: rgba(255, 255, 255, 0.1);
        border: 1px solid rgba(255, 255, 255, 0.2);
        border-radius: 12px;
        padding: 1rem;
        text-align: center;
        text-decoration: none;
        color: white;
        transition: all 0.3s ease;
    }
    
    .quick-action:hover {
        background: rgba(255, 255, 255, 0.2);
        transform: translateY(-2px);
        box-shadow: 0 8px 25px rgba(255, 255, 255, 0.1);
    }
    
    .quick-action-icon {
        font-size: 1.5rem;
        margin-bottom: 0.5rem;
        color: #3ECDC1;
    }
    
    .quick-action-title {
        font-weight: 500;
        font-size: 0.9rem;
    }
    
    /* –ö–Ω–æ–ø–∫–∞ –≤—ã—Ö–æ–¥–∞ */
    .logout-button {
        background: rgba(239, 68, 68, 0.1);
        border: 1px solid rgba(239, 68, 68, 0.3);
        color: #ef4444;
        width: 100%;
        padding: 1rem;
        border-radius: 12px;
        font-weight: 500;
        cursor: pointer;
        transition: all 0.3s ease;
        margin-top: 1rem;
    }
    
    .logout-button:hover {
        background: rgba(239, 68, 68, 0.2);
        transform: translateY(-1px);
    }
</style>
{% endblock %}

{% block content %}
<!-- –ü–ª–∞–≤–∞—é—â–∏–µ —á–∞—Å—Ç–∏—Ü—ã –¥–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö -->
<div class="mobile-particles" id="mobileParticles"></div>

<!-- –•–µ–¥–µ—Ä –ø—Ä–æ—Ñ–∏–ª—è -->
<div class="profile-header">
    <div class="profile-avatar">
        {{ current_user.first_name[0] if current_user.first_name else 'U' }}{{ current_user.last_name[0] if current_user.last_name else '' }}
    </div>
    <h1 class="profile-name">
        {{ current_user.first_name or current_user.username }} {{ current_user.last_name or '' }}
    </h1>
    <p class="profile-email">{{ current_user.email }}</p>
    
    <div class="profile-stats">
        <div class="profile-stat">
            <div class="profile-stat-value">{{ (user_stats.completed_lessons if user_stats else 0) or 0 }}</div>
            <div class="profile-stat-label">{{ t('lessons', lang) or '–£—Ä–æ–∫–∏' }}</div>
        </div>
        <div class="profile-stat">
            <div class="profile-stat-value">{{ (user_stats.test_scores if user_stats else 0) or 0 }}%</div>
            <div class="profile-stat-label">{{ t('avg_score', lang) or '–°—Ä–µ–¥–Ω–∏–π –±–∞–ª–ª' }}</div>
        </div>
        <div class="profile-stat">
            <div class="profile-stat-value">{{ (user_stats.study_streak if user_stats else 0) or 0 }}</div>
            <div class="profile-stat-label">{{ t('streak', lang) or '–î–Ω–µ–π –ø–æ–¥—Ä—è–¥' }}</div>
        </div>
    </div>
</div>

<!-- –ü—Ä–æ–≥—Ä–µ—Å—Å –æ–±—É—á–µ–Ω–∏—è -->
<div class="profile-section">
    <div class="profile-section-header">
        <div class="profile-section-icon">
            <i class="fas fa-chart-line"></i>
        </div>
        <h2 class="profile-section-title">{{ t('learning_progress', lang) or '–ü—Ä–æ–≥—Ä–µ—Å—Å –æ–±—É—á–µ–Ω–∏—è' }}</h2>
    </div>
    <div class="profile-section-content">
        <div class="learning-progress">
            <div class="progress-item">
                <div class="progress-info">
                    <div class="progress-title">{{ t('overall_progress', lang) or '–û–±—â–∏–π –ø—Ä–æ–≥—Ä–µ—Å—Å' }}</div>
                    <div class="progress-subtitle">{{ (user_progress.completed_modules if user_progress else 0) or 0 }} {{ t('of', lang) or '–∏–∑' }} {{ (user_progress.total_modules if user_progress else 0) or 0 }} {{ t('modules', lang) or '–º–æ–¥—É–ª–µ–π' }}</div>
                </div>
                <div class="progress-value">{{ (user_progress.overall_percentage if user_progress else 0) or 0 }}%</div>
            </div>
            <div class="progress-bar">
                <div class="progress-fill" data-progress="{{ (user_progress.overall_percentage if user_progress else 0) or 0 }}"></div>
            </div>
        </div>
    </div>
</div>

<!-- –ë—ã—Å—Ç—Ä—ã–µ –¥–µ–π—Å—Ç–≤–∏—è -->
<div class="profile-section">
    <div class="profile-section-header">
        <div class="profile-section-icon">
            <i class="fas fa-bolt"></i>
        </div>
        <h2 class="profile-section-title">{{ t('quick_actions', lang) or '–ë—ã—Å—Ç—Ä—ã–µ –¥–µ–π—Å—Ç–≤–∏—è' }}</h2>
    </div>
    <div class="profile-section-content">
        <div class="quick-actions">
            <a href="{{ url_for('mobile.learning_map', lang=lang) }}" class="quick-action">
                <div class="quick-action-icon">üìö</div>
                <div class="quick-action-title">{{ t('continue_learning', lang) or '–ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å –æ–±—É—á–µ–Ω–∏–µ' }}</div>
            </a>
            <a href="{{ url_for('mobile.tests', lang=lang) }}" class="quick-action">
                <div class="quick-action-icon">üéØ</div>
                <div class="quick-action-title">{{ t('take_test', lang) or '–ü—Ä–æ–π—Ç–∏ —Ç–µ—Å—Ç' }}</div>
            </a>
            <a href="{{ url_for('ai.ai_chat', lang=lang) }}" class="quick-action">
                <div class="quick-action-icon">ü§ñ</div>
                <div class="quick-action-title">{{ t('ask_ai', lang) or '–°–ø—Ä–æ—Å–∏—Ç—å AI' }}</div>
            </a>
            <a href="{{ url_for('virtual_patient_bp.scenarios_list', lang=lang) }}" class="quick-action">
                <div class="quick-action-icon">üë®‚Äç‚öïÔ∏è</div>
                <div class="quick-action-title">{{ t('virtual_patients', lang) or '–í–∏—Ä—Ç—É–∞–ª—å–Ω—ã–µ –ø–∞—Ü–∏–µ–Ω—Ç—ã' }}</div>
            </a>
        </div>
    </div>
</div>

<!-- –ù–∞—Å—Ç—Ä–æ–π–∫–∏ -->
<div class="profile-section">
    <div class="profile-section-header">
        <div class="profile-section-icon">
            <i class="fas fa-cog"></i>
        </div>
        <h2 class="profile-section-title">{{ t('settings', lang) or '–ù–∞—Å—Ç—Ä–æ–π–∫–∏' }}</h2>
    </div>
    <div class="profile-section-content">
        <a href="{{ url_for('main_bp.profile', lang=lang) }}" class="profile-menu-item">
            <div class="profile-menu-icon">
                <i class="fas fa-user-edit"></i>
            </div>
            <div class="profile-menu-content">
                <div class="profile-menu-title">{{ t('edit_profile', lang) or '–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ—Ñ–∏–ª—å' }}</div>
                <div class="profile-menu-subtitle">{{ t('change_personal_info', lang) or '–ò–∑–º–µ–Ω–∏—Ç—å –ª–∏—á–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é' }}</div>
            </div>
            <div class="profile-menu-arrow">
                <i class="fas fa-chevron-right"></i>
            </div>
        </a>
        
        <a href="{{ url_for('mobile.settings', lang=lang) }}" class="profile-menu-item">
            <div class="profile-menu-icon">
                <i class="fas fa-bell"></i>
            </div>
            <div class="profile-menu-content">
                <div class="profile-menu-title">{{ t('notifications', lang) or '–£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è' }}</div>
                <div class="profile-menu-subtitle">{{ t('manage_notifications', lang) or '–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è–º–∏' }}</div>
            </div>
            <div class="profile-menu-arrow">
                <i class="fas fa-chevron-right"></i>
            </div>
        </a>
        
        <a href="{{ url_for('mobile.settings', lang=lang) }}" class="profile-menu-item">
            <div class="profile-menu-icon">
                <i class="fas fa-shield-alt"></i>
            </div>
            <div class="profile-menu-content">
                <div class="profile-menu-title">{{ t('privacy', lang) or '–ü—Ä–∏–≤–∞—Ç–Ω–æ—Å—Ç—å' }}</div>
                <div class="profile-menu-subtitle">{{ t('privacy_settings', lang) or '–ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ø—Ä–∏–≤–∞—Ç–Ω–æ—Å—Ç–∏' }}</div>
            </div>
            <div class="profile-menu-arrow">
                <i class="fas fa-chevron-right"></i>
            </div>
        </a>
    </div>
</div>

<!-- –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è -->
<div class="profile-section">
    <div class="profile-section-header">
        <div class="profile-section-icon">
            <i class="fas fa-info-circle"></i>
        </div>
        <h2 class="profile-section-title">{{ t('information', lang) or '–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è' }}</h2>
    </div>
    <div class="profile-section-content">
        <a href="#" onclick="showComingSoon()" class="profile-menu-item">
            <div class="profile-menu-icon">
                <i class="fas fa-question-circle"></i>
            </div>
            <div class="profile-menu-content">
                <div class="profile-menu-title">{{ t('help_support', lang) or '–ü–æ–º–æ—â—å –∏ –ø–æ–¥–¥–µ—Ä–∂–∫–∞' }}</div>
                <div class="profile-menu-subtitle">{{ t('get_help', lang) or '–ü–æ–ª—É—á–∏—Ç—å –ø–æ–º–æ—â—å' }}</div>
            </div>
            <div class="profile-menu-arrow">
                <i class="fas fa-chevron-right"></i>
            </div>
        </a>
        
        <a href="#" onclick="showComingSoon()" class="profile-menu-item">
            <div class="profile-menu-icon">
                <i class="fas fa-info"></i>
            </div>
            <div class="profile-menu-content">
                <div class="profile-menu-title">{{ t('about_app', lang) or '–û –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏' }}</div>
                <div class="profile-menu-subtitle">{{ t('version_info', lang) or '–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –≤–µ—Ä—Å–∏–∏' }}</div>
            </div>
            <div class="profile-menu-arrow">
                <i class="fas fa-chevron-right"></i>
            </div>
        </a>
    </div>
</div>

<!-- –ö–Ω–æ–ø–∫–∞ –≤—ã—Ö–æ–¥–∞ -->
<button class="logout-button" onclick="logout()">
    <i class="fas fa-sign-out-alt" style="margin-right: 0.5rem;"></i>
    {{ t('logout', lang) or '–í—ã–π—Ç–∏' }}
</button>
{% endblock %}

{% block extra_js %}
<script>
// ===== –°–û–ó–î–ê–ù–ò–ï –ú–û–ë–ò–õ–¨–ù–´–• –ß–ê–°–¢–ò–¶ =====
function createMobileParticles() {
    const container = document.getElementById('mobileParticles');
    if (!container) return;
    
    const particleCount = 20; // –ú–µ–Ω—å—à–µ —á–∞—Å—Ç–∏—Ü –¥–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö
    
    for (let i = 0; i < particleCount; i++) {
        const particle = document.createElement('div');
        particle.className = 'mobile-particle';
        
        // –°–ª—É—á–∞–π–Ω—ã–µ –ø–æ–∑–∏—Ü–∏–∏ –∏ —Ä–∞–∑–º–µ—Ä—ã
        particle.style.left = Math.random() * 100 + '%';
        particle.style.top = '100%';
        particle.style.animationDuration = (Math.random() * 8 + 6) + 's';
        particle.style.animationDelay = Math.random() * 5 + 's';
        
        // –°–ª—É—á–∞–π–Ω—ã–µ —Ü–≤–µ—Ç–∞
        const colors = [
            'rgba(62, 205, 193, 0.4)',
            'rgba(102, 126, 234, 0.4)', 
            'rgba(139, 92, 246, 0.4)',
            'rgba(255, 255, 255, 0.3)'
        ];
        particle.style.background = colors[Math.floor(Math.random() * colors.length)];
        
        container.appendChild(particle);
    }
}

// ===== –¢–ê–ö–¢–ò–õ–¨–ù–ê–Ø –û–ë–†–ê–¢–ù–ê–Ø –°–í–Ø–ó–¨ =====
function addHapticFeedback() {
    const touchElements = document.querySelectorAll('.profile-menu-item, .quick-action, .logout-button');
    
    touchElements.forEach(element => {
        element.addEventListener('touchstart', function() {
            if ('vibrate' in navigator) {
                navigator.vibrate(10); // –õ–µ–≥–∫–∞—è –≤–∏–±—Ä–∞—Ü–∏—è
            }
            this.style.transform = 'scale(0.98)';
        });
        
        element.addEventListener('touchend', function() {
            this.style.transform = 'scale(1)';
        });
    });
}

// ===== PULL-TO-REFRESH =====
let startY = 0;
let currentY = 0;
let pullDistance = 0;
const maxPullDistance = 80;

function setupPullToRefresh() {
    const container = document.body;
    
    container.addEventListener('touchstart', function(e) {
        if (window.scrollY === 0) {
            startY = e.touches[0].clientY;
        }
    });
    
    container.addEventListener('touchmove', function(e) {
        if (window.scrollY === 0 && startY > 0) {
            currentY = e.touches[0].clientY;
            pullDistance = Math.max(0, currentY - startY);
            
            if (pullDistance > 0 && pullDistance <= maxPullDistance) {
                e.preventDefault();
                const opacity = Math.min(pullDistance / maxPullDistance, 1);
                document.body.style.transform = `translateY(${pullDistance * 0.5}px)`;
                document.body.style.opacity = 1 - (opacity * 0.1);
            }
        }
    });
    
    container.addEventListener('touchend', function() {
        if (pullDistance > maxPullDistance) {
            // –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞–µ–º —Å—Ç—Ä–∞–Ω–∏—Ü—É
            window.location.reload();
        } else {
            // –í–æ–∑–≤—Ä–∞—â–∞–µ–º –æ–±—Ä–∞—Ç–Ω–æ
            document.body.style.transform = '';
            document.body.style.opacity = '';
        }
        startY = 0;
        pullDistance = 0;
    });
}

// ===== –§–£–ù–ö–¶–ò–ò –ü–†–û–§–ò–õ–Ø =====
function logout() {
    if (confirm('{{ t("confirm_logout", lang) or "–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ –≤—ã–π—Ç–∏?" }}')) {
        const button = event.target;
        const originalText = button.innerHTML;
        button.innerHTML = '<i class="fas fa-spinner fa-spin" style="margin-right: 0.5rem;"></i>{{ t("logging_out", lang) or "–í—ã—Ö–æ–¥..." }}';
        button.disabled = true;
        
        // –î–æ–±–∞–≤–ª—è–µ–º haptic feedback
        if ('vibrate' in navigator) {
            navigator.vibrate([50, 100, 50]);
        }
        
        fetch('{{ url_for("mobile.logout", lang=lang) }}', {
            method: 'GET',
            headers: {
                'X-CSRFToken': document.querySelector('meta[name="csrf-token"]').content
            }
        })
        .then(response => {
            if (response.ok) {
                localStorage.clear();
                sessionStorage.clear();
                
                // –ê–Ω–∏–º–∞—Ü–∏—è –ø–µ—Ä–µ—Ö–æ–¥–∞
                document.body.style.opacity = '0';
                document.body.style.transform = 'scale(0.95)';
                
                setTimeout(() => {
                    window.location.href = '{{ url_for("mobile.login", lang=lang) }}';
                }, 300);
            } else {
                throw new Error('Logout failed');
            }
        })
        .catch(error => {
            console.error('Error during logout:', error);
            button.innerHTML = originalText;
            button.disabled = false;
            
            // –í–∏–±—Ä–∞—Ü–∏—è –æ—à–∏–±–∫–∏
            if ('vibrate' in navigator) {
                navigator.vibrate([100, 50, 100, 50, 100]);
            }
            
            showMobileNotification('{{ t("logout_error", lang) or "–û—à–∏–±–∫–∞ –ø—Ä–∏ –≤—ã—Ö–æ–¥–µ" }}', 'error');
        });
    }
}

function showComingSoon() {
    if ('vibrate' in navigator) {
        navigator.vibrate(20);
    }
    showMobileNotification('{{ t("coming_soon", lang) or "–≠—Ç–∞ —Ñ—É–Ω–∫—Ü–∏—è —Å–∫–æ—Ä–æ –±—É–¥–µ—Ç –¥–æ—Å—Ç—É–ø–Ω–∞!" }}', 'info');
}

// ===== –ú–û–ë–ò–õ–¨–ù–´–ï –£–í–ï–î–û–ú–õ–ï–ù–ò–Ø =====
function showMobileNotification(message, type = 'info') {
    const notification = document.createElement('div');
    notification.className = 'mobile-notification';
    notification.style.cssText = `
        position: fixed;
        top: 20px;
        left: 20px;
        right: 20px;
        z-index: 9999;
        padding: 1rem 1.5rem;
        border-radius: 16px;
        background: var(--mobile-glass-bg);
        backdrop-filter: blur(20px);
        border: 1px solid var(--mobile-glass-border);
        color: white;
        box-shadow: var(--mobile-shadow);
        transform: translateY(-100px);
        transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        font-weight: 500;
    `;
    
    const icons = {
        success: '‚úì',
        error: '‚úï',
        info: '‚Ñπ',
        warning: '‚ö†'
    };
    
    notification.innerHTML = `
        <div style="display: flex; align-items: center; gap: 0.75rem;">
            <span style="font-size: 1.2rem;">${icons[type] || icons.info}</span>
            <span>${message}</span>
        </div>
    `;
    
    document.body.appendChild(notification);
    
    // –ê–Ω–∏–º–∞—Ü–∏—è –ø–æ—è–≤–ª–µ–Ω–∏—è
    setTimeout(() => {
        notification.style.transform = 'translateY(0)';
    }, 100);
    
    // –ê–≤—Ç–æ—É–¥–∞–ª–µ–Ω–∏–µ
    setTimeout(() => {
        notification.style.transform = 'translateY(-100px)';
        setTimeout(() => notification.remove(), 400);
    }, 3000);
}

// ===== –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø =====
document.addEventListener('DOMContentLoaded', function() {
    // –°–æ–∑–¥–∞–µ–º —á–∞—Å—Ç–∏—Ü—ã
    createMobileParticles();
    
    // –î–æ–±–∞–≤–ª—è–µ–º —Ç–∞–∫—Ç–∏–ª—å–Ω—É—é –æ–±—Ä–∞—Ç–Ω—É—é —Å–≤—è–∑—å
    addHapticFeedback();
    
    // –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º pull-to-refresh
    setupPullToRefresh();
    
    // –ê–Ω–∏–º–∞—Ü–∏—è –ø—Ä–æ–≥—Ä–µ—Å—Å-–±–∞—Ä–æ–≤
    const progressFills = document.querySelectorAll('.progress-fill');
    progressFills.forEach(fill => {
        const targetWidth = fill.getAttribute('data-progress') + '%';
        fill.style.width = '0%';
        setTimeout(() => {
            fill.style.width = targetWidth;
        }, 800);
    });
    
    // –î–æ–±–∞–≤–ª—è–µ–º –ø–ª–∞–≤–Ω—ã–µ –ø–µ—Ä–µ—Ö–æ–¥—ã –º–µ–∂–¥—É —Å—Ç—Ä–∞–Ω–∏—Ü–∞–º–∏
    const links = document.querySelectorAll('a[href^="/"]');
    links.forEach(link => {
        link.addEventListener('click', function(e) {
            if (this.target !== '_blank') {
                e.preventDefault();
                const href = this.href;
                
                document.body.style.opacity = '0.8';
                document.body.style.transform = 'scale(0.98)';
                
                setTimeout(() => {
                    window.location.href = href;
                }, 200);
            }
        });
    });
    
    // PWA –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏
    if ('serviceWorker' in navigator) {
        navigator.serviceWorker.register('/sw.js').catch(err => {
            console.log('SW registration failed');
        });
    }
    
    // –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏–µ –∑—É–º–∞ –ø—Ä–∏ –¥–≤–æ–π–Ω–æ–º —Ç–∞–ø–µ
    let lastTouchEnd = 0;
    document.addEventListener('touchend', function (event) {
        const now = (new Date()).getTime();
        if (now - lastTouchEnd <= 300) {
            event.preventDefault();
        }
        lastTouchEnd = now;
    }, false);
});

// ===== –í–ò–ó–£–ê–õ–¨–ù–´–ï –≠–§–§–ï–ö–¢–´ =====
// –î–æ–±–∞–≤–ª—è–µ–º —ç—Ñ—Ñ–µ–∫—Ç —á–∞—Å—Ç–∏—Ü –ø—Ä–∏ –Ω–∞–∂–∞—Ç–∏–∏
document.addEventListener('touchstart', function(e) {
    const touch = e.touches[0];
    createTouchParticle(touch.clientX, touch.clientY);
});

function createTouchParticle(x, y) {
    for (let i = 0; i < 3; i++) {
        const particle = document.createElement('div');
        particle.style.cssText = `
            position: fixed;
            left: ${x}px;
            top: ${y}px;
            width: 4px;
            height: 4px;
            background: rgba(62, 205, 193, 0.6);
            border-radius: 50%;
            pointer-events: none;
            z-index: 9999;
            animation: touchParticle 0.6s ease-out forwards;
        `;
        
        particle.style.setProperty('--random-x', (Math.random() - 0.5) * 100 + 'px');
        particle.style.setProperty('--random-y', (Math.random() - 0.5) * 100 + 'px');
        
        document.body.appendChild(particle);
        
        setTimeout(() => particle.remove(), 600);
    }
}

// CSS –¥–ª—è touch —á–∞—Å—Ç–∏—Ü
const touchParticleStyle = document.createElement('style');
touchParticleStyle.textContent = `
    @keyframes touchParticle {
        to {
            transform: translate(var(--random-x), var(--random-y)) scale(0);
            opacity: 0;
        }
    }
`;
document.head.appendChild(touchParticleStyle);
</script>
{% endblock %}