{% extends "base.html" %}

{% block title %}{{ t('create_learning_plan_title', lang) | default('–°–æ–∑–¥–∞–Ω–∏–µ –ø–ª–∞–Ω–∞ –æ–±—É—á–µ–Ω–∏—è') }} - Dental Academy{% endblock %}

{% block styles %}
{{ super() }}
<link rel="stylesheet" href="{{ url_for('static', filename='css/assessment.css') }}">
{% endblock %}

{% block content %}
<div class="assessment-container">
    <div class="assessment-card">
        <!-- –ó–∞–≥–æ–ª–æ–≤–æ–∫ -->
        <div class="assessment-header">
            <h1>{{ t('create_learning_plan_title', lang) | default('–°–æ–∑–¥–∞–Ω–∏–µ –ø–ª–∞–Ω–∞ –æ–±—É—á–µ–Ω–∏—è') }}</h1>
            <p>{{ t('personalize_your_plan', lang) | default('–ü–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∏—Ä—É–π—Ç–µ –≤–∞—à –ø–ª–∞–Ω –æ–±—É—á–µ–Ω–∏—è') }}</p>
        </div>
        
        <!-- –§–æ—Ä–º–∞ –ø—Ä–µ–¥–ø–æ—á—Ç–µ–Ω–∏–π -->
        <div class="preferences-section">
            <form id="preferences-form" method="POST">
                <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                
                <!-- –ò–Ω—Ç–µ–Ω—Å–∏–≤–Ω–æ—Å—Ç—å –æ–±—É—á–µ–Ω–∏—è -->
                <div class="form-section">
                    <h4>{{ t('learning_intensity', lang) | default('–ò–Ω—Ç–µ–Ω—Å–∏–≤–Ω–æ—Å—Ç—å –æ–±—É—á–µ–Ω–∏—è') }}</h4>
                    <div class="intensity-options">
                        <div class="intensity-option" onclick="selectIntensity(this, 'light')">
                            <div class="intensity-title">{{ t('light', lang) | default('–õ—ë–≥–∫–∞—è') }}</div>
                            <div class="intensity-hours">2-3 —á–∞—Å–∞ –≤ –Ω–µ–¥–µ–ª—é</div>
                            <div class="intensity-description">{{ t('light_description', lang) | default('–ú–µ–¥–ª–µ–Ω–Ω—ã–π —Ç–µ–º–ø, –ø–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è –∑–∞–Ω—è—Ç—ã—Ö –ª—é–¥–µ–π') }}</div>
                        </div>
                        
                        <div class="intensity-option" onclick="selectIntensity(this, 'moderate')">
                            <div class="intensity-title">{{ t('moderate', lang) | default('–£–º–µ—Ä–µ–Ω–Ω–∞—è') }}</div>
                            <div class="intensity-hours">4-6 —á–∞—Å–æ–≤ –≤ –Ω–µ–¥–µ–ª—é</div>
                            <div class="intensity-description">{{ t('moderate_description', lang) | default('–°–±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —Ç–µ–º–ø –¥–ª—è –±–æ–ª—å—à–∏–Ω—Å—Ç–≤–∞') }}</div>
                        </div>
                        
                        <div class="intensity-option" onclick="selectIntensity(this, 'intensive')">
                            <div class="intensity-title">{{ t('intensive', lang) | default('–ò–Ω—Ç–µ–Ω—Å–∏–≤–Ω–∞—è') }}</div>
                            <div class="intensity-hours">8-10 —á–∞—Å–æ–≤ –≤ –Ω–µ–¥–µ–ª—é</div>
                            <div class="intensity-description">{{ t('intensive_description', lang) | default('–ë—ã—Å—Ç—Ä—ã–π —Ç–µ–º–ø –¥–ª—è –∞–∫—Ç–∏–≤–Ω–æ–≥–æ –æ–±—É—á–µ–Ω–∏—è') }}</div>
                        </div>
                    </div>
                    <input type="hidden" name="intensity" id="intensity-input" value="">
                </div>
                
                <!-- –°—Ç–∏–ª—å –æ–±—É—á–µ–Ω–∏—è -->
                <div class="form-section">
                    <h4>{{ t('learning_style', lang) | default('–°—Ç–∏–ª—å –æ–±—É—á–µ–Ω–∏—è') }}</h4>
                    <div class="learning-style-grid">
                        <div class="style-option" onclick="selectStyle(this, 'visual')">
                            <div class="style-icon">üëÅÔ∏è</div>
                            <div>{{ t('visual', lang) | default('–í–∏–∑—É–∞–ª—å–Ω—ã–π') }}</div>
                        </div>
                        
                        <div class="style-option" onclick="selectStyle(this, 'auditory')">
                            <div class="style-icon">üéß</div>
                            <div>{{ t('auditory', lang) | default('–ê—É–¥–∏–∞–ª—å–Ω—ã–π') }}</div>
                        </div>
                        
                        <div class="style-option" onclick="selectStyle(this, 'kinesthetic')">
                            <div class="style-icon">‚úã</div>
                            <div>{{ t('kinesthetic', lang) | default('–ö–∏–Ω–µ—Å—Ç–µ—Ç–∏—á–µ—Å–∫–∏–π') }}</div>
                        </div>
                        
                        <div class="style-option" onclick="selectStyle(this, 'reading')">
                            <div class="style-icon">üìñ</div>
                            <div>{{ t('reading', lang) | default('–ß—Ç–µ–Ω–∏–µ') }}</div>
                        </div>
                    </div>
                    <input type="hidden" name="learning_style" id="style-input" value="">
                </div>
                
                <!-- –î–Ω–∏ –æ–±—É—á–µ–Ω–∏—è -->
                <div class="form-section">
                    <h4>{{ t('learning_days', lang) | default('–î–Ω–∏ –æ–±—É—á–µ–Ω–∏—è') }}</h4>
                    <div class="days-grid">
                        <div class="day-option" onclick="toggleDay(this, 'monday')">–ü–Ω</div>
                        <div class="day-option" onclick="toggleDay(this, 'tuesday')">–í—Ç</div>
                        <div class="day-option" onclick="toggleDay(this, 'wednesday')">–°—Ä</div>
                        <div class="day-option" onclick="toggleDay(this, 'thursday')">–ß—Ç</div>
                        <div class="day-option" onclick="toggleDay(this, 'friday')">–ü—Ç</div>
                        <div class="day-option" onclick="toggleDay(this, 'saturday')">–°–±</div>
                        <div class="day-option" onclick="toggleDay(this, 'sunday')">–í—Å</div>
                    </div>
                    <input type="hidden" name="learning_days" id="days-input" value="">
                </div>
                
                <!-- –í—Ä–µ–º—è –æ–±—É—á–µ–Ω–∏—è -->
                <div class="form-section">
                    <h4>{{ t('learning_time', lang) | default('–í—Ä–µ–º—è –æ–±—É—á–µ–Ω–∏—è') }}</h4>
                    <div class="time-options">
                        <div class="time-option" onclick="selectTime(this, 'morning')">
                            {{ t('morning', lang) | default('–£—Ç—Ä–æ') }}
                        </div>
                        <div class="time-option" onclick="selectTime(this, 'afternoon')">
                            {{ t('afternoon', lang) | default('–î–µ–Ω—å') }}
                        </div>
                        <div class="time-option" onclick="selectTime(this, 'evening')">
                            {{ t('evening', lang) | default('–í–µ—á–µ—Ä') }}
                        </div>
                        <div class="time-option" onclick="selectTime(this, 'night')">
                            {{ t('night', lang) | default('–ù–æ—á—å') }}
                        </div>
                    </div>
                    <input type="hidden" name="learning_time" id="time-input" value="">
                </div>
                
                <!-- –ö–Ω–æ–ø–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è -->
                <div class="actions-section">
                    <button type="submit" class="btn-create-plan" id="create-plan-btn" disabled>
                        <i class="bi bi-magic"></i>
                        {{ t('create_plan', lang) | default('–°–æ–∑–¥–∞—Ç—å –ø–ª–∞–Ω –æ–±—É—á–µ–Ω–∏—è') }}
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>

<script>
let selectedIntensity = '';
let selectedStyle = '';
let selectedDays = [];
let selectedTime = '';

// –í—ã–±–æ—Ä –∏–Ω—Ç–µ–Ω—Å–∏–≤–Ω–æ—Å—Ç–∏
function selectIntensity(element, intensity) {
    document.querySelectorAll('.intensity-option').forEach(opt => {
        opt.classList.remove('selected');
    });
    element.classList.add('selected');
    selectedIntensity = intensity;
    document.getElementById('intensity-input').value = intensity;
    validateForm();
}

// –í—ã–±–æ—Ä —Å—Ç–∏–ª—è –æ–±—É—á–µ–Ω–∏—è
function selectStyle(element, style) {
    document.querySelectorAll('.style-option').forEach(opt => {
        opt.classList.remove('selected');
    });
    element.classList.add('selected');
    selectedStyle = style;
    document.getElementById('style-input').value = style;
    validateForm();
}

// –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –¥–Ω–µ–π
function toggleDay(element, day) {
    element.classList.toggle('selected');
    if (element.classList.contains('selected')) {
        if (!selectedDays.includes(day)) {
            selectedDays.push(day);
        }
    } else {
        selectedDays = selectedDays.filter(d => d !== day);
    }
    document.getElementById('days-input').value = selectedDays.join(',');
    validateForm();
}

// –í—ã–±–æ—Ä –≤—Ä–µ–º–µ–Ω–∏
function selectTime(element, time) {
    document.querySelectorAll('.time-option').forEach(opt => {
        opt.classList.remove('selected');
    });
    element.classList.add('selected');
    selectedTime = time;
    document.getElementById('time-input').value = time;
    validateForm();
}

// –í–∞–ª–∏–¥–∞—Ü–∏—è —Ñ–æ—Ä–º—ã
function validateForm() {
    const isValid = selectedIntensity && selectedStyle && selectedDays.length > 0 && selectedTime;
    document.getElementById('create-plan-btn').disabled = !isValid;
}

// –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ —Ñ–æ—Ä–º—ã
document.getElementById('preferences-form').addEventListener('submit', function(e) {
    e.preventDefault();
    
    if (!validateForm()) {
        alert('{{ t("please_fill_all_fields", lang) | default("–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –∑–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –ø–æ–ª—è") }}');
        return;
    }
    
    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä –∑–∞–≥—Ä—É–∑–∫–∏
    const btn = document.getElementById('create-plan-btn');
    btn.disabled = true;
    btn.innerHTML = '<i class="bi bi-hourglass-split"></i> {{ t("creating_plan", lang) | default("–°–æ–∑–¥–∞–Ω–∏–µ –ø–ª–∞–Ω–∞...") }}';
    
    // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º —Ñ–æ—Ä–º—É
    this.submit();
});

// –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
document.addEventListener('DOMContentLoaded', function() {
    validateForm();
});
</script>
{% endblock %}
