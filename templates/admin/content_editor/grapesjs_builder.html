<!DOCTYPE html>
<html lang="{{ lang }}" data-theme="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="csrf-token" content="{{ csrf_token }}">
    <title>Professional HTML Editor - Dental Academy</title>
    
    <!-- –ë–∞–∑–æ–≤—ã–µ —Å—Ç–∏–ª–∏ –±–µ–∑ Bootstrap -->
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; }
        .btn { display: inline-block; padding: 8px 16px; border: none; border-radius: 4px; cursor: pointer; text-decoration: none; }
        .btn-primary { background: #007bff; color: white; }
        .btn-secondary { background: #6c757d; color: white; }
        .btn-success { background: #28a745; color: white; }
        .btn-danger { background: #dc3545; color: white; }
        .btn-warning { background: #ffc107; color: black; }
        .btn-info { background: #17a2b8; color: white; }
        .alert { padding: 12px; margin: 10px 0; border-radius: 4px; }
        .alert-success { background: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
        .alert-error { background: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }
        .alert-info { background: #d1ecf1; color: #0c5460; border: 1px solid #bee5eb; }
    </style>

    <!-- GrapesJS -->
    <link rel="stylesheet" href="https://unpkg.com/grapesjs/dist/css/grapes.min.css">
    <script src="https://unpkg.com/grapesjs@0.21.2/dist/grapes.min.js"></script>

    <!-- Three.js –¥–ª—è 3D –º–æ–¥–µ–ª–µ–π -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/controls/OrbitControls.js"></script>

    <!-- Monaco Editor (VS Code –¥–≤–∏–∂–æ–∫) -->
    <script src="https://unpkg.com/monaco-editor@0.34.1/min/vs/loader.js"></script>
    <script>
        require.config({ paths: { vs: 'https://unpkg.com/monaco-editor@0.34.1/min/vs' } });
    </script>

    <!-- Babel –¥–ª—è JSX –ø–∞—Ä—Å–∏–Ω–≥–∞ -->
    <script src="https://unpkg.com/@babel/standalone@7.22.0/babel.min.js"></script>

    <!-- –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Å—Ç–∏–ª–∏ -->
    <link rel="stylesheet" href="{{ url_for('static', filename='css/advanced-editors.css') }}">

    <style>
    /* –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä —Ä–µ–¥–∞–∫—Ç–æ—Ä–∞ */
    .advanced-editor {
        height: 100vh;
        display: flex;
        flex-direction: column;
        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        background: #f5f5f5;
    }

    /* –í–µ—Ä—Ö–Ω–∏–π —Ç—É–ª–±–∞—Ä */
    .editor-toolbar {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        padding: 12px 20px;
        display: flex;
        align-items: center;
        gap: 15px;
        box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        z-index: 1000;
        min-height: 60px;
    }

    .toolbar-section {
        display: flex;
        align-items: center;
        gap: 8px;
    }

    .toolbar-divider {
        width: 1px;
        height: 30px;
        background: rgba(255,255,255,0.3);
        margin: 0 10px;
    }

    .toolbar-btn {
        background: rgba(255,255,255,0.1);
        border: 1px solid rgba(255,255,255,0.2);
        color: white;
        padding: 8px 16px;
        border-radius: 6px;
        cursor: pointer;
        font-size: 14px;
        font-weight: 500;
        transition: all 0.3s ease;
        display: flex;
        align-items: center;
        gap: 6px;
        text-decoration: none;
    }

    .toolbar-btn:hover {
        background: rgba(255,255,255,0.2);
        transform: translateY(-1px);
        color: white;
        text-decoration: none;
    }

    .toolbar-btn.active {
        background: rgba(255,255,255,0.3);
    }

    .toolbar-title {
        flex: 1;
        text-align: center;
        font-size: 18px;
        font-weight: 600;
    }

    .device-buttons {
        display: flex;
        background: rgba(255,255,255,0.1);
        border-radius: 6px;
        overflow: hidden;
    }

    .device-btn {
        background: transparent;
        border: none;
        color: white;
        padding: 8px 12px;
        cursor: pointer;
        transition: background 0.3s;
    }

    .device-btn.active,
    .device-btn:hover {
        background: rgba(255,255,255,0.2);
    }

    /* –û—Å–Ω–æ–≤–Ω–∞—è –æ–±–ª–∞—Å—Ç—å —Ä–µ–¥–∞–∫—Ç–æ—Ä–∞ */
    .editor-main {
        flex: 1;
        display: flex;
        overflow: hidden;
    }

    /* –õ–µ–≤–∞—è –ø–∞–Ω–µ–ª—å */
    .editor-left {
        width: 300px;
        background: white;
        border-right: 1px solid #e0e0e0;
        display: flex;
        flex-direction: column;
        box-shadow: 2px 0 10px rgba(0,0,0,0.05);
    }

    .panel-tabs {
        display: flex;
        background: #f8f9fa;
        border-bottom: 1px solid #e0e0e0;
    }

    .panel-tab {
        flex: 1;
        padding: 12px 8px;
        text-align: center;
        cursor: pointer;
        background: transparent;
        border: none;
        font-size: 12px;
        font-weight: 600;
        color: #666;
        transition: all 0.3s;
    }

    .panel-tab.active {
        background: white;
        color: #333;
        border-bottom: 2px solid #667eea;
    }

    .panel-content {
        flex: 1;
        overflow-y: auto;
    }

    .tab-pane {
        display: none;
        height: 100%;
    }

    .tab-pane.active {
        display: block;
    }

    /* –¶–µ–Ω—Ç—Ä–∞–ª—å–Ω–∞—è –æ–±–ª–∞—Å—Ç—å - –∫–∞–Ω–≤–∞—Å */
    .editor-canvas {
        flex: 1;
        background: #ffffff;
        position: relative;
        overflow: auto;
    }

    #gjs {
        height: 100%;
        width: 100%;
    }

    /* –ü—Ä–∞–≤–∞—è –ø–∞–Ω–µ–ª—å */
    .editor-right {
        width: 320px;
        background: white;
        border-left: 1px solid #e0e0e0;
        display: flex;
        flex-direction: column;
        box-shadow: -2px 0 10px rgba(0,0,0,0.05);
    }

    /* –ù–∏–∂–Ω—è—è –ø–∞–Ω–µ–ª—å */
    .editor-bottom {
        height: 0;
        background: #2c3e50;
        color: white;
        transition: height 0.3s ease;
        overflow: hidden;
        border-top: 1px solid #34495e;
    }

    .editor-bottom.expanded {
        height: 300px;
    }

    .bottom-tabs {
        display: flex;
        background: #34495e;
        border-bottom: 1px solid #4a5568;
    }

    .bottom-tab {
        padding: 10px 20px;
        cursor: pointer;
        background: transparent;
        border: none;
        color: #ecf0f1;
        font-size: 13px;
        transition: background 0.3s;
    }

    .bottom-tab.active,
    .bottom-tab:hover {
        background: #4a5568;
    }

    .bottom-content {
        height: calc(100% - 41px);
        overflow: hidden;
    }

    /* –ú–æ–¥–∞–ª—å–Ω—ã–µ –æ–∫–Ω–∞ */
    .modal-overlay {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0,0,0,0.8);
        display: none;
        z-index: 10000;
        align-items: center;
        justify-content: center;
    }

    .modal-content {
        background: white;
        border-radius: 10px;
        box-shadow: 0 20px 60px rgba(0,0,0,0.3);
        overflow: hidden;
        max-width: 90vw;
        max-height: 90vh;
    }

    .modal-header {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        padding: 20px;
        display: flex;
        justify-content: space-between;
        align-items: center;
    }

    .modal-body {
        padding: 20px;
        max-height: calc(90vh - 80px);
        overflow-y: auto;
    }

    .close-btn {
        background: rgba(255,255,255,0.2);
        border: none;
        color: white;
        padding: 8px 16px;
        border-radius: 5px;
        cursor: pointer;
        font-size: 14px;
    }

    .close-btn:hover {
        background: rgba(255,255,255,0.3);
    }

    /* –®–∞–±–ª–æ–Ω—ã */
    .templates-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
        gap: 20px;
        padding: 20px 0;
    }

    .template-item {
        background: white;
        border: 2px solid #e0e0e0;
        border-radius: 10px;
        padding: 20px;
        text-align: center;
        cursor: pointer;
        transition: all 0.3s ease;
    }

    .template-item:hover {
        border-color: #667eea;
        transform: translateY(-2px);
        box-shadow: 0 10px 30px rgba(102, 126, 234, 0.2);
    }

    .template-preview {
        font-size: 3em;
        margin-bottom: 15px;
    }

    /* –í–µ—Ä—Å–∏–∏ */
    .versions-list {
        max-height: 400px;
        overflow-y: auto;
    }

    .version-item {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 15px;
        border: 1px solid #e0e0e0;
        border-radius: 5px;
        margin-bottom: 10px;
        cursor: pointer;
        transition: background 0.3s;
    }

    .version-item:hover {
        background: #f8f9fa;
    }

    .delete-btn {
        background: #dc3545;
        color: white;
        border: none;
        padding: 5px 10px;
        border-radius: 3px;
        cursor: pointer;
        font-size: 12px;
    }

    /* 3D Viewer */
    .model-3d-viewer {
        width: 100%;
        height: 400px;
        background: #f0f0f0;
        border-radius: 10px;
        overflow: hidden;
    }

    .model-controls {
        display: flex;
        gap: 10px;
        padding: 15px;
        background: #f8f9fa;
        border-top: 1px solid #e0e0e0;
    }

    .control-btn {
        background: #667eea;
        color: white;
        border: none;
        padding: 10px 15px;
        border-radius: 5px;
        cursor: pointer;
        font-size: 14px;
        transition: background 0.3s;
    }

    .control-btn:hover {
        background: #5a6fd8;
    }

    /* –ê—Å—Å–µ—Ç—ã */
    .assets-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
        gap: 10px;
        padding: 15px;
    }

    .asset-item {
        background: white;
        border: 1px solid #e0e0e0;
        border-radius: 5px;
        padding: 10px;
        text-align: center;
        cursor: pointer;
        transition: all 0.3s;
    }

    .asset-item:hover {
        border-color: #667eea;
        transform: scale(1.05);
    }

    /* –°—Ç–∞—Ç—É—Å-–±–∞—Ä */
    .status-bar {
        background: #2c3e50;
        color: white;
        padding: 8px 20px;
        display: flex;
        justify-content: space-between;
        align-items: center;
        font-size: 12px;
        border-top: 1px solid #34495e;
    }

    .status-item {
        display: flex;
        align-items: center;
        gap: 8px;
    }

    .status-indicator {
        width: 8px;
        height: 8px;
        border-radius: 50%;
        background: #27ae60;
    }

    .status-indicator.saving {
        background: #f39c12;
        animation: pulse 1s infinite;
    }

    .status-indicator.error {
        background: #e74c3c;
    }

    .framework-indicator {
        padding: 2px 8px;
        border-radius: 12px;
        font-size: 10px;
        font-weight: bold;
    }

    .framework-indicator.html { background: #e74c3c; }
    .framework-indicator.react { background: #3498db; }
    .framework-indicator.vue { background: #27ae60; }
    .framework-indicator.angular { background: #e67e22; }

    @keyframes pulse {
        0% { opacity: 1; }
        50% { opacity: 0.5; }
        100% { opacity: 1; }
    }

    /* Code editor */
    .code-editor {
        width: 100%;
        height: 100%;
        font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
        font-size: 14px;
        line-height: 1.5;
        background: #1e1e1e;
        color: #d4d4d4;
        border: none;
        outline: none;
        resize: none;
    }

    /* Console output */
    .console-output {
        background: #1e1e1e;
        color: #d4d4d4;
        font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
        font-size: 12px;
        padding: 10px;
        overflow-y: auto;
        height: 100%;
    }

    /* Loading overlay */
    .loading-overlay {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(255,255,255,0.95);
        z-index: 9999;
        display: flex;
        align-items: center;
        justify-content: center;
        flex-direction: column;
    }

    @keyframes loading {
        0% { transform: translateX(-100%); }
        50% { transform: translateX(0%); }
        100% { transform: translateX(100%); }
    }

    @keyframes rotate {
        from { transform: rotate(0deg); }
        to { transform: rotate(360deg); }
    }
    </style>
</head>
<body>
    <!-- –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä —Ä–µ–¥–∞–∫—Ç–æ—Ä–∞ -->
    <div class="advanced-editor">
        <!-- –í–µ—Ä—Ö–Ω–∏–π —Ç—É–ª–±–∞—Ä -->
        <div class="editor-toolbar">
            <div class="toolbar-section">
                <button class="toolbar-btn" onclick="newPage()">
                    üìÑ New
                </button>
                <button class="toolbar-btn" onclick="savePage()">
                    üíæ Save
                </button>
                <button class="toolbar-btn" onclick="previewPage()">
                    üëÅÔ∏è Preview
                </button>
            </div>

            <div class="toolbar-divider"></div>

            <div class="toolbar-section">
                <button class="toolbar-btn" onclick="undo()">
                    ‚Ü©Ô∏è Undo
                </button>
                <button class="toolbar-btn" onclick="redo()">
                    ‚Ü™Ô∏è Redo
                </button>
            </div>

            <div class="toolbar-title">
                ü¶∑ Professional HTML Editor
            </div>

            <div class="toolbar-section">
                <button class="toolbar-btn" onclick="toggleCode()">
                    üíª Code
                </button>
                <button class="toolbar-btn" onclick="openTemplates()">
                    üìã Templates
                </button>
                <button class="toolbar-btn" onclick="showVersions()">
                    üïí Versions
                </button>
            </div>

            <div class="toolbar-divider"></div>

            <div class="toolbar-section">
                <div class="device-buttons">
                    <button class="device-btn active" data-device="desktop">üñ•Ô∏è</button>
                    <button class="device-btn" data-device="tablet">üì±</button>
                    <button class="device-btn" data-device="mobile">üì±</button>
                </div>
            </div>
        </div>

        <!-- –û—Å–Ω–æ–≤–Ω–∞—è –æ–±–ª–∞—Å—Ç—å —Ä–µ–¥–∞–∫—Ç–æ—Ä–∞ -->
        <div class="editor-main">
            <!-- –õ–µ–≤–∞—è –ø–∞–Ω–µ–ª—å -->
            <div class="editor-left">
                <div class="panel-tabs">
                    <button class="panel-tab active" data-tab="blocks">
                        üß± Blocks
                    </button>
                    <button class="panel-tab" data-tab="templates">
                        üìã Templates
                    </button>
                    <button class="panel-tab" data-tab="assets">
                        üñºÔ∏è Assets
                    </button>
                    <button class="panel-tab" data-tab="3d-models">
                        ü¶∑ 3D Models
                    </button>
                </div>

                <div class="panel-content">
                    <!-- –ë–ª–æ–∫–∏ -->
                    <div class="tab-pane active" id="blocks-tab">
                        <div class="gjs-blocks-c"></div>
                    </div>

                    <!-- –®–∞–±–ª–æ–Ω—ã -->
                    <div class="tab-pane" id="templates-tab">
                        <div style="padding: 15px;">
                            <h4 style="margin: 0 0 15px 0;">Page Templates</h4>
                            <div id="templates-list">
                                <div class="template-item" onclick="applyTemplate('dental-landing')">
                                    <div class="template-preview">ü¶∑</div>
                                    <div>Dental Landing</div>
                                </div>
                                <div class="template-item" onclick="applyTemplate('clinic-about')">
                                    <div class="template-preview">üè•</div>
                                    <div>About Clinic</div>
                                </div>
                                <div class="template-item" onclick="applyTemplate('appointment-booking')">
                                    <div class="template-preview">üìÖ</div>
                                    <div>Appointment</div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- –ê—Å—Å–µ—Ç—ã -->
                    <div class="tab-pane" id="assets-tab">
                        <div style="padding: 15px;">
                            <h4 style="margin: 0 0 15px 0;">Assets</h4>
                            <div class="assets-grid" id="assets-grid">
                                <!-- –ê—Å—Å–µ—Ç—ã –±—É–¥—É—Ç –∑–∞–≥—Ä—É–∂–µ–Ω—ã –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
                            </div>
                        </div>
                    </div>

                    <!-- 3D –º–æ–¥–µ–ª–∏ -->
                    <div class="tab-pane" id="3d-models-tab">
                        <div style="padding: 15px;">
                            <h4 style="margin: 0 0 15px 0;">3D Dental Models</h4>
                            <div class="model-categories">
                                <div class="model-category">
                                    <h5>Teeth</h5>
                                    <div class="model-items">
                                        <div class="model-item" data-model="tooth-1">
                                            <div class="model-preview">ü¶∑</div>
                                            <span>Tooth 1</span>
                                        </div>
                                        <div class="model-item" data-model="tooth-2">
                                            <div class="model-preview">ü¶∑</div>
                                            <span>Tooth 2</span>
                                        </div>
                                        <div class="model-item" data-model="tooth-3">
                                            <div class="model-preview">ü¶∑</div>
                                            <span>Tooth 3</span>
                                        </div>
                                    </div>
                                </div>
                                <div class="model-category">
                                    <h5>Jaw</h5>
                                    <div class="model-items">
                                        <div class="model-item" data-model="upper-jaw">
                                            <div class="model-preview">ü¶∑</div>
                                            <span>Upper Jaw</span>
                                        </div>
                                        <div class="model-item" data-model="lower-jaw">
                                            <div class="model-preview">ü¶∑</div>
                                            <span>Lower Jaw</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- –¶–µ–Ω—Ç—Ä–∞–ª—å–Ω–∞—è –æ–±–ª–∞—Å—Ç—å - –∫–∞–Ω–≤–∞—Å -->
            <div class="editor-canvas">
                <div id="gjs"></div>
            </div>

            <!-- –ü—Ä–∞–≤–∞—è –ø–∞–Ω–µ–ª—å -->
            <div class="editor-right">
                <div class="panel-tabs">
                    <button class="panel-tab active" data-tab="styles">
                        üé® Styles
                    </button>
                    <button class="panel-tab" data-tab="layers">
                        üèóÔ∏è Layers
                    </button>
                    <button class="panel-tab" data-tab="properties">
                        ‚öôÔ∏è Properties
                    </button>
                </div>

                <div class="panel-content">
                    <!-- –°—Ç–∏–ª–∏ -->
                    <div class="tab-pane active" id="styles-tab">
                        <div class="gjs-sm-c"></div>
                    </div>

                    <!-- –°–ª–æ–∏ -->
                    <div class="tab-pane" id="layers-tab">
                        <div class="gjs-lm-c"></div>
                    </div>

                    <!-- –°–≤–æ–π—Å—Ç–≤–∞ -->
                    <div class="tab-pane" id="properties-tab">
                        <div class="gjs-tm-c"></div>
                        <div style="padding: 15px;">
                            <h4 style="margin: 0 0 15px 0;">Element Properties</h4>
                            <div id="element-properties">
                                <p style="color: #666; font-style: italic;">Select an element to edit properties</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- –ù–∏–∂–Ω—è—è –ø–∞–Ω–µ–ª—å (–∫–æ–¥) -->
        <div class="editor-bottom" id="editor-bottom">
            <div class="bottom-tabs">
                <button class="bottom-tab active" data-tab="html">HTML</button>
                <button class="bottom-tab" data-tab="css">CSS</button>
                <button class="bottom-tab" data-tab="js">JavaScript</button>
                <button class="bottom-tab" data-tab="console">Console</button>
            </div>
            <div class="bottom-content">
                <div class="code-editor" id="html-editor"></div>
                <div class="code-editor" id="css-editor" style="display: none;"></div>
                <div class="code-editor" id="js-editor" style="display: none;"></div>
                <div class="console-output" id="console-output" style="display: none; padding: 15px; font-family: monospace; font-size: 12px;"></div>
            </div>
        </div>

        <!-- –°—Ç–∞—Ç—É—Å-–±–∞—Ä -->
        <div class="status-bar">
            <div class="status-item">
                <div class="status-indicator" id="save-indicator"></div>
                <span id="save-status">Loading...</span>
            </div>
            <div class="status-item">
                <span id="framework-indicator" class="framework-indicator html">Framework: HTML</span>
            </div>
            <div class="status-item">
                <span id="cursor-position">Ln 1, Col 1</span>
            </div>
            <div class="status-item">
                <span id="element-count">0 elements</span>
            </div>
            <div class="status-item">
                <span id="page-size">0 KB</span>
            </div>
        </div>
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω—ã–µ –æ–∫–Ω–∞ -->

    <!-- Preview Modal -->
    <div class="modal-overlay" id="preview-modal">
        <div class="modal-content" style="width: 95vw; height: 95vh;">
            <div class="modal-header">
                <h3 style="margin: 0;">üëÅÔ∏è Page Preview</h3>
                <button class="close-btn" onclick="closePreview()">‚úï Close</button>
            </div>
            <div class="modal-body" style="padding: 0; height: calc(100% - 60px);">
                <iframe id="preview-frame" style="width: 100%; height: 100%; border: none;"></iframe>
            </div>
        </div>
    </div>

    <!-- Templates Modal -->
    <div class="modal-overlay" id="templates-modal">
        <div class="modal-content" style="width: 80vw; height: 80vh;">
            <div class="modal-header">
                <h3 style="margin: 0;">üìã Page Templates</h3>
                <button class="close-btn" onclick="closeTemplates()">‚úï Close</button>
            </div>
            <div class="modal-body">
                <div class="templates-grid" id="templates-grid">
                    <!-- –®–∞–±–ª–æ–Ω—ã –±—É–¥—É—Ç –∑–∞–≥—Ä—É–∂–µ–Ω—ã –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
                </div>
            </div>
        </div>
    </div>

    <!-- Versions Modal -->
    <div class="modal-overlay" id="versions-modal">
        <div class="modal-content" style="width: 70vw; height: 70vh;">
            <div class="modal-header">
                <h3 style="margin: 0;">üïí Version History</h3>
                <button class="close-btn" onclick="closeVersions()">‚úï Close</button>
            </div>
            <div class="modal-body">
                <div class="versions-list" id="versions-list">
                    <!-- –ò—Å—Ç–æ—Ä–∏—è –≤–µ—Ä—Å–∏–π –±—É–¥–µ—Ç –∑–∞–≥—Ä—É–∂–µ–Ω–∞ –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
                </div>
            </div>
        </div>
    </div>

    <!-- 3D Model Viewer Modal -->
    <div class="modal-overlay" id="model-viewer-modal">
        <div class="modal-content" style="width: 80vw; height: 80vh;">
            <div class="modal-header">
                <h3 style="margin: 0;">ü¶∑ 3D Model Viewer</h3>
                <button class="close-btn" onclick="closeModelViewer()">‚úï Close</button>
            </div>
            <div class="modal-body" style="padding: 0;">
                <div class="model-3d-viewer" id="model-3d-viewer"></div>
                <div class="model-controls">
                    <button class="control-btn" onclick="resetCamera()">üéØ Reset View</button>
                    <button class="control-btn" onclick="toggleWireframe()">üî≤ Wireframe</button>
                    <button class="control-btn" onclick="toggleAnimation()">‚ñ∂Ô∏è Animate</button>
                    <button class="control-btn" onclick="changeColor()">üé® Color</button>
                    <button class="control-btn" onclick="addToPage()">‚ûï Add to Page</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Loading overlay -->
    <div class="loading-overlay" id="loading-overlay">
        <div style="font-size: 4em; margin-bottom: 20px; animation: rotate 2s linear infinite;">ü¶∑</div>
        <h2 style="color: #667eea; margin-bottom: 10px;">Loading Professional HTML Editor...</h2>
        <p style="color: #666;">Initializing 3D models, templates, and components</p>
        <div style="width: 300px; height: 6px; background: #e0e0e0; border-radius: 3px; overflow: hidden; margin-top: 20px;">
            <div style="width: 100%; height: 100%; background: linear-gradient(90deg, #667eea, #764ba2); animation: loading 2s ease-in-out infinite;"></div>
        </div>
    </div>

    <!-- –°–∫—Ä–∏–ø—Ç—ã -->
    <script src="{{ url_for('static', filename='js/grapesjs-builder-inline.js') }}"></script>
    
    <!-- –£–ø—Ä–æ—â–µ–Ω–Ω—ã–π —Ä–µ–¥–∞–∫—Ç–æ—Ä (–≤—Ä–µ–º–µ–Ω–Ω–æ) -->
    <script>
        console.log('üöÄ Loading Simplified Editor...');
        
        // –ü—Ä–æ—Å—Ç–∞—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è GrapesJS
        function initSimpleEditor() {
            console.log('üöÄ Initializing Simple GrapesJS Editor...');
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ DOM –≥–æ—Ç–æ–≤
            if (!document.body) {
                console.warn('‚ö†Ô∏è Body not ready, waiting...');
                setTimeout(initSimpleEditor, 100);
                return;
            }
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
            const container = document.getElementById('gjs');
            if (!container) {
                console.error('‚ùå GrapesJS container not found');
                return;
            }
            
            try {
                // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º GrapesJS —Å –±–∞–∑–æ–≤—ã–º–∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏
                window.editor = grapesjs.init({
                    container: '#gjs',
                    height: '100%',
                    width: 'auto',
                    storageManager: {
                        type: 'local',
                        autosave: true,
                        autoload: true,
                        stepsBeforeSave: 1
                    },
                    deviceManager: {
                        devices: [
                            {
                                name: 'Desktop',
                                width: '',
                            },
                            {
                                name: 'Tablet',
                                width: '768px',
                                widthMedia: '992px',
                            },
                            {
                                name: 'Mobile',
                                width: '320px',
                                widthMedia: '480px',
                            }
                        ]
                    },
                    blockManager: {
                        appendTo: '#blocks',
                        blocks: [
                            {
                                id: 'section',
                                label: 'Section',
                                attributes: { class: 'fa fa-square-o' },
                                content: `<section class="section">
                                    <h2>This is a section</h2>
                                    <div>This is a box</div>
                                </section>`,
                            },
                            {
                                id: 'text',
                                label: 'Text',
                                attributes: { class: 'fa fa-text-width' },
                                content: '<div data-gjs-type="text">Insert your text here</div>',
                            },
                            {
                                id: 'image',
                                label: 'Image',
                                attributes: { class: 'fa fa-image' },
                                content: { type: 'image' },
                                activate: true,
                            }
                        ]
                    },
                    layerManager: {
                        appendTo: '.layers-container'
                    },
                    styleManager: {
                        appendTo: '.styles-container',
                        sectors: [{
                            name: 'Dimension',
                            open: false,
                            buildProps: ['width', 'min-height', 'padding'],
                            properties: [
                                {
                                    type: 'integer',
                                    name: 'The width',
                                    property: 'width',
                                    units: ['px', '%'],
                                    defaults: 'auto',
                                    min: 0,
                                }
                            ]
                        }, {
                            name: 'Typography',
                            open: false,
                            buildProps: ['font-family', 'font-size', 'font-weight', 'letter-spacing', 'color', 'line-height', 'text-align', 'text-decoration', 'text-shadow'],
                            properties: [
                                { name: 'Font', property: 'font-family' },
                                { name: 'Weight', property: 'font-weight' },
                                { name: 'Font color', property: 'color' }
                            ]
                        }, {
                            name: 'Decorations',
                            open: false,
                            buildProps: ['border-radius-c', 'background-color', 'border-radius', 'border', 'box-shadow', 'background'],
                            properties: [
                                { name: 'Border radius', property: 'border-radius' },
                                { name: 'Background', property: 'background' }
                            ]
                        }]
                    },
                    traitManager: {
                        appendTo: '.traits-container'
                    },
                    canvas: {
                        styles: [
                            'https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css'
                        ],
                        scripts: [
                            'https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js'
                        ]
                    }
                });
                
                console.log('‚úÖ Simple GrapesJS editor initialized successfully!');
                
            } catch (error) {
                console.error('‚ùå Failed to initialize GrapesJS:', error);
            }
        }
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ DOM
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', initSimpleEditor);
        } else {
            initSimpleEditor();
        }
    </script>
</body>
</html> 