{% extends "admin/master.html" %}

{% block title %}–í–µ–±-—Ä–µ–¥–∞–∫—Ç–æ—Ä –∫–æ–Ω—Ç–µ–Ω—Ç–∞{% endblock %}

{% block head %}
    {{ super() }}
    <!-- GrapesJS CSS -->
    <link rel="stylesheet" href="https://unpkg.com/grapesjs/dist/css/grapes.min.css">
    <!-- GrapesJS Preset Webpage -->
    <link rel="stylesheet" href="https://unpkg.com/grapesjs-preset-webpage/dist/grapesjs-preset-webpage.min.css">
    <!-- Custom styles -->
    <style>
        .editor-container {
            height: calc(100vh - 200px);
            border: 1px solid #ddd;
            border-radius: 8px;
            overflow: hidden;
        }
        .editor-toolbar {
            background: #f8f9fa;
            padding: 10px;
            border-bottom: 1px solid #ddd;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .editor-actions {
            display: flex;
            gap: 10px;
        }
        .gjs-cv-canvas {
            top: 0 !important;
        }
        .gjs-pn-panel {
            background: #2c3e50;
        }
        .gjs-pn-btn {
            color: #ecf0f1;
        }
        .gjs-pn-btn:hover {
            background: #34495e;
        }
        .template-selector {
            margin-bottom: 15px;
        }
        .template-card {
            border: 2px solid #e9ecef;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        .template-card:hover {
            border-color: #007bff;
            box-shadow: 0 4px 8px rgba(0,123,255,0.1);
        }
        .template-card.selected {
            border-color: #007bff;
            background: #f8f9ff;
        }
        .template-preview {
            max-width: 100%;
            height: 100px;
            object-fit: cover;
            border-radius: 4px;
            margin-bottom: 10px;
        }
        .template-info h6 {
            margin: 0 0 5px 0;
            color: #495057;
        }
        .template-info p {
            margin: 0;
            font-size: 0.875rem;
            color: #6c757d;
        }
    </style>
{% endblock %}

{% block body %}
<div class="container-fluid">
    <div class="row">
        <div class="col-12 mb-4">
            <div class="d-flex justify-content-between align-items-center">
                <h1><i class="fas fa-edit"></i> üé® –í–µ–±-—Ä–µ–¥–∞–∫—Ç–æ—Ä –∫–æ–Ω—Ç–µ–Ω—Ç–∞</h1>
                <div class="editor-actions">
                    <button class="btn btn-outline-secondary" onclick="showTemplates()">
                        <i class="fas fa-th-large"></i> –®–∞–±–ª–æ–Ω—ã
                    </button>
                    <button class="btn btn-outline-info" onclick="previewContent()">
                        <i class="fas fa-eye"></i> –ü—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä
                    </button>
                    <button class="btn btn-success" onclick="saveContent()">
                        <i class="fas fa-save"></i> –°–æ—Ö—Ä–∞–Ω–∏—Ç—å
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- –®–∞–±–ª–æ–Ω—ã -->
    <div id="templates-section" class="row mb-4" style="display: none;">
        <div class="col-12">
            <div class="card">
                <div class="card-header">
                    <h5><i class="fas fa-th-large"></i> –í—ã–±–µ—Ä–∏—Ç–µ —à–∞–±–ª–æ–Ω</h5>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-3">
                            <div class="template-card" onclick="loadTemplate('lesson')">
                                <img src="{{ url_for('static', filename='images/template-lesson.jpg') }}" 
                                     alt="Lesson Template" class="template-preview" 
                                     onerror="this.src='data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjAwIiBoZWlnaHQ9IjEwMCIgdmlld0JveD0iMCAwIDIwMCAxMDAiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CjxyZWN0IHdpZHRoPSIyMDAiIGhlaWdodD0iMTAwIiBmaWxsPSIjZGRkIi8+Cjx0ZXh0IHg9IjEwMCIgeT0iNTAiIGZvbnQtZmFtaWx5PSJBcmlhbCIgZm9udC1zaXplPSIxNCIgZmlsbD0iIzk5OSIgdGV4dC1hbmNob3I9Im1pZGRsZSI+0JjQvdC00LXQutGB0Y8g0L3QvtCy0YvQuSDQutC+0LzQv9Cw0L3QuNC4PC90ZXh0Pgo8L3N2Zz4K'">
                                <div class="template-info">
                                    <h6>–£—Ä–æ–∫</h6>
                                    <p>–®–∞–±–ª–æ–Ω –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è —É—á–µ–±–Ω–æ–≥–æ —É—Ä–æ–∫–∞ —Å —Ç–µ–∫—Å—Ç–æ–º, –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è–º–∏ –∏ —Ç–µ—Å—Ç–∞–º–∏</p>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="template-card" onclick="loadTemplate('quiz')">
                                <img src="{{ url_for('static', filename='images/template-quiz.jpg') }}" 
                                     alt="Quiz Template" class="template-preview"
                                     onerror="this.src='data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjAwIiBoZWlnaHQ9IjEwMCIgdmlld0JveD0iMCAwIDIwMCAxMDAiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CjxyZWN0IHdpZHRoPSIyMDAiIGhlaWdodD0iMTAwIiBmaWxsPSIjZGRkIi8+Cjx0ZXh0IHg9IjEwMCIgeT0iNTAiIGZvbnQtZmFtaWx5PSJBcmlhbCIgZm9udC1zaXplPSIxNCIgZmlsbD0iIzk5OSIgdGV4dC1hbmNob3I9Im1pZGRsZSI+0KLQtdC60YHRgiDQv9C+0LvRg9GH0LXQvdC40Y8g0L3QvtCy0YvQuSDQutC+0LzQv9Cw0L3QuNC4PC90ZXh0Pgo8L3N2Zz4K'">
                                <div class="template-info">
                                    <h6>–¢–µ—Å—Ç</h6>
                                    <p>–®–∞–±–ª–æ–Ω –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–æ–≥–æ —Ç–µ—Å—Ç–∞ —Å –≤–æ–ø—Ä–æ—Å–∞–º–∏ –∏ –æ—Ç–≤–µ—Ç–∞–º–∏</p>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="template-card" onclick="loadTemplate('case')">
                                <img src="{{ url_for('static', filename='images/template-case.jpg') }}" 
                                     alt="Case Template" class="template-preview"
                                     onerror="this.src='data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjAwIiBoZWlnaHQ9IjEwMCIgdmlld0JveD0iMCAwIDIwMCAxMDAiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CjxyZWN0IHdpZHRoPSIyMDAiIGhlaWdodD0iMTAwIiBmaWxsPSIjZGRkIi8+Cjx0ZXh0IHg9IjEwMCIgeT0iNTAiIGZvbnQtZmFtaWx5PSJBcmlhbCIgZm9udC1zaXplPSIxNCIgZmlsbD0iIzk5OSIgdGV4dC1hbmNob3I9Im1pZGRsZSI+0JrQsNGA0YLQsCDQv9C+0LvRg9GH0LXQvdC40Y8g0L3QvtCy0YvQuSDQutC+0LzQv9Cw0L3QuNC4PC90ZXh0Pgo8L3N2Zz4K'">
                                <div class="template-info">
                                    <h6>–ö–ª–∏–Ω–∏—á–µ—Å–∫–∏–π —Å–ª—É—á–∞–π</h6>
                                    <p>–®–∞–±–ª–æ–Ω –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –∫–ª–∏–Ω–∏—á–µ—Å–∫–æ–≥–æ —Å–ª—É—á–∞—è —Å –æ–ø–∏—Å–∞–Ω–∏–µ–º –ø–∞—Ü–∏–µ–Ω—Ç–∞</p>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="template-card" onclick="loadTemplate('blank')">
                                <img src="{{ url_for('static', filename='images/template-blank.jpg') }}" 
                                     alt="Blank Template" class="template-preview"
                                     onerror="this.src='data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjAwIiBoZWlnaHQ9IjEwMCIgdmlld0JveD0iMCAwIDIwMCAxMDAiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CjxyZWN0IHdpZHRoPSIyMDAiIGhlaWdodD0iMTAwIiBmaWxsPSIjZGRkIi8+Cjx0ZXh0IHg9IjEwMCIgeT0iNTAiIGZvbnQtZmFtaWx5PSJBcmlhbCIgZm9udC1zaXplPSIxNCIgZmlsbD0iIzk5OSIgdGV4dC1hbmNob3I9Im1pZGRsZSI+0JHQtdC30LDRgtGMINC90L7QstGL0Lkg0LrQvtC80L/QsNC90LjQuDwvdGV4dD4KPC9zdmc+Cg=='">
                                <div class="template-info">
                                    <h6>–ü—É—Å—Ç–æ–π —à–∞–±–ª–æ–Ω</h6>
                                    <p>–ù–∞—á–Ω–∏—Ç–µ —Å —á–∏—Å—Ç–æ–≥–æ –ª–∏—Å—Ç–∞ –∏ —Å–æ–∑–¥–∞–π—Ç–µ –∫–æ–Ω—Ç–µ–Ω—Ç —Å –Ω—É–ª—è</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- –†–µ–¥–∞–∫—Ç–æ—Ä -->
    <div class="row">
        <div class="col-12">
            <div class="card">
                <div class="card-header">
                    <h5><i class="fas fa-palette"></i> –†–µ–¥–∞–∫—Ç–æ—Ä –∫–æ–Ω—Ç–µ–Ω—Ç–∞</h5>
                </div>
                <div class="card-body p-0">
                    <div id="gjs" class="editor-container">
                        <!-- GrapesJS –±—É–¥–µ—Ç –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω –∑–¥–µ—Å—å -->
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –ø—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä–∞ -->
<div class="modal fade" id="previewModal" tabindex="-1">
    <div class="modal-dialog modal-xl">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">–ü—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä –∫–æ–Ω—Ç–µ–Ω—Ç–∞</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <div id="preview-content"></div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block tail %}
    {{ super() }}
    <!-- GrapesJS JS -->
    <script src="https://unpkg.com/grapesjs/dist/grapes.min.js"></script>
    <!-- GrapesJS Preset Webpage -->
    <script src="https://unpkg.com/grapesjs-preset-webpage/dist/grapesjs-preset-webpage.min.js"></script>
    <!-- GrapesJS Plugin Forms -->
    <script src="https://unpkg.com/grapesjs-plugin-forms/dist/grapesjs-plugin-forms.min.js"></script>
    
    <script>
        let editor;
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è GrapesJS
        document.addEventListener('DOMContentLoaded', function() {
            editor = grapesjs.init({
                container: '#gjs',
                height: '100%',
                width: 'auto',
                storageManager: false,
                panels: {
                    defaults: [
                        {
                            id: 'basic-actions',
                            el: '.panel__basic-actions',
                            buttons: [
                                {
                                    id: 'visibility',
                                    active: true,
                                    className: 'btn-toggle-borders',
                                    label: '<u>B</u>',
                                    command: 'sw-visibility',
                                },
                            ],
                        },
                    ],
                },
                deviceManager: {
                    devices: [
                        {
                            name: 'Desktop',
                            width: '',
                        },
                        {
                            name: 'Tablet',
                            width: '768px',
                            widthMedia: '992px',
                        },
                        {
                            name: 'Mobile',
                            width: '320px',
                            widthMedia: '480px',
                        },
                    ],
                },
                plugins: [
                    'grapesjs-preset-webpage',
                    'grapesjs-plugin-forms'
                ],
                pluginsOpts: {
                    'grapesjs-preset-webpage': {
                        modalImportTitle: '–ò–º–ø–æ—Ä—Ç —à–∞–±–ª–æ–Ω–∞',
                        modalImportLabel: '–í—Å—Ç–∞–≤—å—Ç–µ –∑–¥–µ—Å—å –≤–∞—à HTML/CSS –∫–æ–¥',
                        modalImportContent: '',
                        textCleanCanvas: '–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ –æ—á–∏—Å—Ç–∏—Ç—å —Ö–æ–ª—Å—Ç?',
                    }
                },
                canvas: {
                    styles: [
                        'https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css',
                        'https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css'
                    ],
                    scripts: [
                        'https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js'
                    ]
                }
            });
            
            // –ó–∞–≥—Ä—É–∂–∞–µ–º –±–∞–∑–æ–≤—ã–π —à–∞–±–ª–æ–Ω –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
            loadTemplate('blank');
        });
        
        // –§—É–Ω–∫—Ü–∏–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è
        function showTemplates() {
            const templatesSection = document.getElementById('templates-section');
            templatesSection.style.display = templatesSection.style.display === 'none' ? 'block' : 'none';
        }
        
        function loadTemplate(templateType) {
            let html = '';
            let css = '';
            
            switch(templateType) {
                case 'lesson':
                    html = `
                        <div class="container mt-4">
                            <div class="row">
                                <div class="col-12">
                                    <h1 class="text-center mb-4">–ù–∞–∑–≤–∞–Ω–∏–µ —É—Ä–æ–∫–∞</h1>
                                    <div class="card">
                                        <div class="card-body">
                                            <h5 class="card-title">–í–≤–µ–¥–µ–Ω–∏–µ</h5>
                                            <p class="card-text">–í–≤–µ–¥–∏—Ç–µ –∑–¥–µ—Å—å –≤–≤–µ–¥–µ–Ω–∏–µ –∫ —É—Ä–æ–∫—É...</p>
                                            <img src="https://via.placeholder.com/600x300" class="img-fluid mb-3" alt="–ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ">
                                            <h5>–û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç–µ–Ω—Ç</h5>
                                            <p>–í–≤–µ–¥–∏—Ç–µ –∑–¥–µ—Å—å –æ—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç–µ–Ω—Ç —É—Ä–æ–∫–∞...</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    `;
                    break;
                    
                case 'quiz':
                    html = `
                        <div class="container mt-4">
                            <div class="row">
                                <div class="col-12">
                                    <h1 class="text-center mb-4">–¢–µ—Å—Ç</h1>
                                    <div class="card">
                                        <div class="card-body">
                                            <h5 class="card-title">–í–æ–ø—Ä–æ—Å 1</h5>
                                            <p>–í–≤–µ–¥–∏—Ç–µ –∑–¥–µ—Å—å –≤–æ–ø—Ä–æ—Å...</p>
                                            <div class="form-check">
                                                <input class="form-check-input" type="radio" name="q1" id="q1a">
                                                <label class="form-check-label" for="q1a">–í–∞—Ä–∏–∞–Ω—Ç A</label>
                                            </div>
                                            <div class="form-check">
                                                <input class="form-check-input" type="radio" name="q1" id="q1b">
                                                <label class="form-check-label" for="q1b">–í–∞—Ä–∏–∞–Ω—Ç B</label>
                                            </div>
                                            <div class="form-check">
                                                <input class="form-check-input" type="radio" name="q1" id="q1c">
                                                <label class="form-check-label" for="q1c">–í–∞—Ä–∏–∞–Ω—Ç C</label>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    `;
                    break;
                    
                case 'case':
                    html = `
                        <div class="container mt-4">
                            <div class="row">
                                <div class="col-12">
                                    <h1 class="text-center mb-4">–ö–ª–∏–Ω–∏—á–µ—Å–∫–∏–π —Å–ª—É—á–∞–π</h1>
                                    <div class="card">
                                        <div class="card-header">
                                            <h5>–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø–∞—Ü–∏–µ–Ω—Ç–µ</h5>
                                        </div>
                                        <div class="card-body">
                                            <div class="row">
                                                <div class="col-md-6">
                                                    <p><strong>–í–æ–∑—Ä–∞—Å—Ç:</strong> [–í–æ–∑—Ä–∞—Å—Ç –ø–∞—Ü–∏–µ–Ω—Ç–∞]</p>
                                                    <p><strong>–ü–æ–ª:</strong> [–ü–æ–ª –ø–∞—Ü–∏–µ–Ω—Ç–∞]</p>
                                                    <p><strong>–ñ–∞–ª–æ–±—ã:</strong> [–û—Å–Ω–æ–≤–Ω—ã–µ –∂–∞–ª–æ–±—ã]</p>
                                                </div>
                                                <div class="col-md-6">
                                                    <img src="https://via.placeholder.com/300x200" class="img-fluid" alt="–§–æ—Ç–æ –ø–∞—Ü–∏–µ–Ω—Ç–∞">
                                                </div>
                                            </div>
                                            <h5>–ê–Ω–∞–º–Ω–µ–∑</h5>
                                            <p>–í–≤–µ–¥–∏—Ç–µ –∑–¥–µ—Å—å –∞–Ω–∞–º–Ω–µ–∑ –∑–∞–±–æ–ª–µ–≤–∞–Ω–∏—è...</p>
                                            <h5>–î–∏–∞–≥–Ω–æ–∑</h5>
                                            <p>–í–≤–µ–¥–∏—Ç–µ –∑–¥–µ—Å—å –ø—Ä–µ–¥–ø–æ–ª–∞–≥–∞–µ–º—ã–π –¥–∏–∞–≥–Ω–æ–∑...</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    `;
                    break;
                    
                default: // blank
                    html = `
                        <div class="container mt-4">
                            <div class="row">
                                <div class="col-12">
                                    <h1>–ó–∞–≥–æ–ª–æ–≤–æ–∫</h1>
                                    <p>–ù–∞—á–Ω–∏—Ç–µ —Å–æ–∑–¥–∞–≤–∞—Ç—å –≤–∞—à –∫–æ–Ω—Ç–µ–Ω—Ç –∑–¥–µ—Å—å...</p>
                                </div>
                            </div>
                        </div>
                    `;
            }
            
            // –ó–∞–≥—Ä—É–∂–∞–µ–º –∫–æ–Ω—Ç–µ–Ω—Ç –≤ —Ä–µ–¥–∞–∫—Ç–æ—Ä
            editor.setComponents(html);
            editor.setStyle(css);
            
            // –°–∫—Ä—ã–≤–∞–µ–º —Å–µ–∫—Ü–∏—é —à–∞–±–ª–æ–Ω–æ–≤
            document.getElementById('templates-section').style.display = 'none';
        }
        
        function previewContent() {
            const html = editor.getHtml();
            const css = editor.getCss();
            const previewContent = document.getElementById('preview-content');
            
            previewContent.innerHTML = `
                <style>${css}</style>
                ${html}
            `;
            
            new bootstrap.Modal(document.getElementById('previewModal')).show();
        }
        
        function saveContent() {
            const html = editor.getHtml();
            const css = editor.getCss();
            
            // –ó–¥–µ—Å—å –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å AJAX –∑–∞–ø—Ä–æ—Å –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è
            console.log('HTML:', html);
            console.log('CSS:', css);
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
            alert('–ö–æ–Ω—Ç–µ–Ω—Ç —Å–æ—Ö—Ä–∞–Ω–µ–Ω! (–ø—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–æ–Ω—Å–æ–ª—å –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞)');
        }
    </script>
{% endblock %}
