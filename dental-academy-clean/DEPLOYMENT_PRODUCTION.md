# üöÄ –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ –¥–µ–ø–ª–æ—é –Ω–∞ –ø—Ä–æ–¥–∞–∫—à–µ–Ω

## –ü–æ—Å–ª–µ –¥–µ–ø–ª–æ—è –Ω–æ–≤–æ–≥–æ –∫–æ–¥–∞

### 1. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–µ–∫—É—â–µ–≥–æ —Å–æ—Å—Ç–æ—è–Ω–∏—è

```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ç–µ–∫—É—â—É—é —Ä–µ–≤–∏–∑–∏—é –≤ –ë–î
flask db current

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å head-—Ä–µ–≤–∏–∑–∏—é –≤ –∫–æ–¥–µ
flask db heads
```

### 2. –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –º–∏–≥—Ä–∞—Ü–∏–π

**–û–±—ã—á–Ω—ã–π —Å—Ü–µ–Ω–∞—Ä–∏–π (–º–∏–≥—Ä–∞—Ü–∏–∏ –ø—Ä–∏–º–µ–Ω—è—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏):**

```bash
flask db upgrade
```

**–ï—Å–ª–∏ –≤–æ–∑–Ω–∏–∫–ª–∞ –æ—à–∏–±–∫–∞ "Can't locate revision identified by 'XXX'":**

–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Å–∫—Ä–∏–ø—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:

```bash
python3 scripts/fix_migrations.py --force-sync
```

–ó–∞—Ç–µ–º —Å–Ω–æ–≤–∞:
```bash
flask db upgrade
```

**–†—É—á–Ω–æ–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ (–µ—Å–ª–∏ —Å–∫—Ä–∏–ø—Ç –Ω–µ –ø–æ–º–æ–≥):**

1. –£–∑–Ω–∞–π—Ç–µ —Ç–µ–∫—É—â–∏–π head:
```bash
flask db heads
```

2. –û–±–Ω–æ–≤–∏—Ç–µ —Ç–∞–±–ª–∏—Ü—É alembic_version –Ω–∞–ø—Ä—è–º—É—é:
```bash
python3 << 'EOF'
from app import app
from extensions import db
import sqlalchemy as sa

with app.app_context():
    head_rev = 'add_other_study_country_001'  # –ó–∞–º–µ–Ω–∏—Ç–µ –Ω–∞ –∞–∫—Ç—É–∞–ª—å–Ω—ã–π head –∏–∑ flask db heads
    try:
        db.session.execute(sa.text("UPDATE alembic_version SET version_num = :rev"), {'rev': head_rev})
        db.session.commit()
        print(f'‚úÖ Updated to {head_rev}')
    except Exception as e:
        print(f'Error: {e}')
EOF
```

3. –ü—Ä–∏–º–µ–Ω–∏—Ç–µ –º–∏–≥—Ä–∞—Ü–∏—é:
```bash
flask db upgrade
```

### 3. –ü—Ä–æ–≤–µ—Ä–∫–∞ —É—Å–ø–µ—à–Ω–æ—Å—Ç–∏

```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ –º–∏–≥—Ä–∞—Ü–∏—è –ø—Ä–∏–º–µ–Ω–µ–Ω–∞
flask db current

# –î–æ–ª–∂–Ω–æ –ø–æ–∫–∞–∑–∞—Ç—å: add_other_study_country_001 (head)
```

### 4. –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–ª–æ–Ω–∫–∏ –≤ PostgreSQL

```sql
-- –ü–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –∫ –ë–î –∏ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –Ω–∞–ª–∏—á–∏–µ –∫–æ–ª–æ–Ω–∫–∏
\c your_database_name

-- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –Ω–∞–ª–∏—á–∏–µ –∫–æ–ª–æ–Ω–∫–∏
SELECT column_name, data_type 
FROM information_schema.columns 
WHERE table_name = 'user' AND column_name = 'other_study_country';
```

–ò–ª–∏ —á–µ—Ä–µ–∑ psql –Ω–∞–ø—Ä—è–º—É—é:
```bash
psql $DATABASE_URL -c "\d user" | grep other_study_country
```

## –ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ —ç—Ç–æ–º –¥–µ–ø–ª–æ–µ

### –î–æ–±–∞–≤–ª–µ–Ω–æ –ø–æ–ª–µ `other_study_country` –≤ —Ç–∞–±–ª–∏—Ü—É `user`

- **–§–∞–π–ª –º–∏–≥—Ä–∞—Ü–∏–∏:** `migrations/versions/add_other_study_country_001_add_other_study_country_to_user.py`
- **–¢–∏–ø:** VARCHAR(100), nullable
- **–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –•—Ä–∞–Ω–∏—Ç –Ω–∞–∑–≤–∞–Ω–∏–µ —Å—Ç—Ä–∞–Ω—ã –æ–±—É—á–µ–Ω–∏—è, –µ—Å–ª–∏ –≤—ã–±—Ä–∞–Ω–∞ –æ–ø—Ü–∏—è "OTHER"

### –û–±–Ω–æ–≤–ª—ë–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã:

1. `models.py` - –¥–æ–±–∞–≤–ª–µ–Ω–æ –ø–æ–ª–µ `other_study_country`
2. `routes/profile_routes.py` - –¥–æ–±–∞–≤–ª–µ–Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –ø–æ–ª—è
3. `templates/profile/personal_info.html` - —Ñ–æ—Ä–º–∞ —É–∂–µ —Å–æ–¥–µ—Ä–∂–∏—Ç —ç—Ç–æ –ø–æ–ª–µ

## –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –º–∏–≥—Ä–∞—Ü–∏–∏

‚úÖ –ú–∏–≥—Ä–∞—Ü–∏—è –±–µ–∑–æ–ø–∞—Å–Ω–∞:
- –ü—Ä–æ–≤–µ—Ä—è–µ—Ç —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏–µ –∫–æ–ª–æ–Ω–∫–∏ –ø–µ—Ä–µ–¥ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ–º
- –ù–µ —É–¥–∞–ª–∏—Ç –¥–∞–Ω–Ω—ã–µ, –µ—Å–ª–∏ –∫–æ–ª–æ–Ω–∫–∞ —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
- –ú–æ–∂–Ω–æ –∑–∞–ø—É—Å–∫–∞—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ —Ä–∞–∑ –±–µ–∑ –≤—Ä–µ–¥–∞

## –û—Ç–∫–∞—Ç (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ)

–ï—Å–ª–∏ –Ω—É–∂–Ω–æ –æ—Ç–∫–∞—Ç–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏—é:

```bash
flask db downgrade -1
```

–≠—Ç–æ —É–¥–∞–ª–∏—Ç –∫–æ–ª–æ–Ω–∫—É `other_study_country` –∏–∑ —Ç–∞–±–ª–∏—Ü—ã `user`.

## –ö–æ–Ω—Ç—Ä–æ–ª—å–Ω—ã–π —Å–ø–∏—Å–æ–∫ –¥–µ–ø–ª–æ—è

- [ ] –ö–æ–¥ –∑–∞–¥–µ–ø–ª–æ–µ–Ω –Ω–∞ –ø—Ä–æ–¥–∞–∫—à–µ–Ω
- [ ] –ü—Ä–æ–≤–µ—Ä–µ–Ω–æ —Ç–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –º–∏–≥—Ä–∞—Ü–∏–π (`flask db current`)
- [ ] –ü—Ä–∏–º–µ–Ω–µ–Ω–∞ –º–∏–≥—Ä–∞—Ü–∏—è (`flask db upgrade`)
- [ ] –ü—Ä–æ–≤–µ—Ä–µ–Ω–æ, —á—Ç–æ –∫–æ–ª–æ–Ω–∫–∞ —Å–æ–∑–¥–∞–Ω–∞ (—á–µ—Ä–µ–∑ SQL –∏–ª–∏ `flask db current`)
- [ ] –ü—Ä–æ–≤–µ—Ä–µ–Ω–∞ —Ä–∞–±–æ—Ç–∞ —Ñ–æ—Ä–º—ã personal_info (—Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ `other_study_country`)

