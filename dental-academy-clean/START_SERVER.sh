#!/bin/bash
# –°–∫—Ä–∏–ø—Ç –¥–ª—è –∑–∞–ø—É—Å–∫–∞ Flask —Å–µ—Ä–≤–µ—Ä–∞ –Ω–∞ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–º –ø–æ—Ä—Ç—É

echo "üöÄ –ó–∞–ø—É—Å–∫ Flask —Å–µ—Ä–≤–µ—Ä–∞..."
echo ""

# –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Å—Ç–∞—Ä—ã–µ –ø—Ä–æ—Ü–µ—Å—Å—ã
echo "1Ô∏è‚É£ –û—Å—Ç–∞–Ω–æ–≤–∫–∞ —Å—Ç–∞—Ä—ã—Ö –ø—Ä–æ—Ü–µ—Å—Å–æ–≤..."
pkill -9 -f "python.*app.py" 2>/dev/null
pkill -9 -f "python.*run.py" 2>/dev/null
pkill -9 -f "flask run" 2>/dev/null
sleep 2

# –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –ø–æ—Ä—Ç—ã —Å–≤–æ–±–æ–¥–Ω—ã
echo "2Ô∏è‚É£ –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ—Ä—Ç–æ–≤..."
if lsof -i :5000 >/dev/null 2>&1; then
    echo "   ‚ö†Ô∏è –ü–æ—Ä—Ç 5000 –∑–∞–Ω—è—Ç, –ø—ã—Ç–∞–µ–º—Å—è –æ—Å–≤–æ–±–æ–¥–∏—Ç—å..."
    lsof -ti :5000 | xargs kill -9 2>/dev/null
    sleep 1
fi

if lsof -i :5002 >/dev/null 2>&1; then
    echo "   ‚ö†Ô∏è –ü–æ—Ä—Ç 5002 –∑–∞–Ω—è—Ç, –ø—ã—Ç–∞–µ–º—Å—è –æ—Å–≤–æ–±–æ–¥–∏—Ç—å..."
    lsof -ti :5002 | xargs kill -9 2>/dev/null
    sleep 1
fi

# –û—á–∏—â–∞–µ–º –∫—ç—à
echo "3Ô∏è‚É£ –û—á–∏—Å—Ç–∫–∞ –∫—ç—à–∞ Python..."
find . -type d -name __pycache__ -not -path "./venv/*" -exec rm -rf {} + 2>/dev/null
find . -name "*.pyc" -not -path "./venv/*" -delete 2>/dev/null

# –ó–∞–ø—É—Å–∫–∞–µ–º —Å–µ—Ä–≤–µ—Ä
echo "4Ô∏è‚É£ –ó–∞–ø—É—Å–∫ —Å–µ—Ä–≤–µ—Ä–∞ –Ω–∞ –ø–æ—Ä—Ç—É 5002..."
echo ""
echo "üìã –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –æ–¥–∏–Ω –∏–∑ –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤:"
echo "   –í–∞—Ä–∏–∞–Ω—Ç 1: python3 app.py"
echo "   –í–∞—Ä–∏–∞–Ω—Ç 2: PORT=5002 python3 run.py"
echo "   –í–∞—Ä–∏–∞–Ω—Ç 3: flask run --port=5002 --host=127.0.0.1 --reload"
echo ""
echo "üåê –ü–æ—Å–ª–µ –∑–∞–ø—É—Å–∫–∞ –æ—Ç–∫—Ä–æ–π—Ç–µ: http://127.0.0.1:5002/en/"
echo ""


