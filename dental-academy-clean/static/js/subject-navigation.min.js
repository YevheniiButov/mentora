document.addEventListener('DOMContentLoaded',function(){initializeNavigation();initializeThemeSystem();initializeAnimations();initializeMobileNavigation();setupLegacyCompatibility();hideSplashScreen();});function initializeNavigation(){const pathButtons=document.querySelectorAll('.learning-path-button');const expandedList=document.querySelector('.subject-list.expanded');if(expandedList){const pathId=expandedList.id.replace('path-','').replace('-subjects','');const activePathButton=document.querySelector(`.learning-path-button[data-path="${pathId}"]`);if(activePathButton){activePathButton.classList.add('active');activePathButton.setAttribute('aria-expanded','true');}}pathButtons.forEach(button=>{button.addEventListener('click',function(){const pathId=this.getAttribute('data-path');const subjectList=document.getElementById(`path-${pathId}-subjects`);if(!subjectList)return;const isExpanded=subjectList.classList.contains('expanded');document.querySelectorAll('.subject-list.expanded').forEach(list=>{if(list.id!==`path-${pathId}-subjects`){list.classList.remove('expanded');const siblingButton=document.querySelector(`[data-path="${list.id.replace('path-','').replace('-subjects','')}"]`);if(siblingButton){siblingButton.classList.remove('active');siblingButton.setAttribute('aria-expanded','false');}}});if(isExpanded){subjectList.classList.remove('expanded');this.classList.remove('active');this.setAttribute('aria-expanded','false');}else{subjectList.classList.add('expanded');this.classList.add('active');this.setAttribute('aria-expanded','true');const subjectItems=subjectList.querySelectorAll('.subject-item');subjectItems.forEach((item,index)=>{item.style.animationDelay=`${index*50}ms`;item.classList.add('animate-slide-up');});}});button.addEventListener('keydown',function(e){if(e.key==='Enter'||e.key===' '){e.preventDefault();this.click();}});});}function initializeThemeSystem(){const themeToggle=document.getElementById('themeToggle');const themeIcon=document.getElementById('themeIcon');if(!themeToggle)return;updateThemeIcon();themeToggle.addEventListener('click',function(){const currentTheme=document.documentElement.getAttribute('data-theme');const newTheme=currentTheme==='dark' ? 'light' : 'dark';document.documentElement.setAttribute('data-theme',newTheme);localStorage.setItem('theme',newTheme);updateThemeIcon();document.body.style.transition='background-color 0.3s ease,color 0.3s ease';const themeChangeEvent=new CustomEvent('themeChanged',{detail:{theme: newTheme,previousTheme: currentTheme}});window.dispatchEvent(themeChangeEvent);const message=newTheme==='dark' ?(window.AppConfig&&getTranslation ? getTranslation('dark_theme_enabled'): 'Темная тема включена'):(window.AppConfig&&getTranslation ? getTranslation('light_theme_enabled'): 'Светлая тема включена');showNotification(message,'info',2000);});function updateThemeIcon(){if(!themeIcon)return;const currentTheme=document.documentElement.getAttribute('data-theme');themeIcon.className=currentTheme==='dark' ? 'bi bi-sun' : 'bi bi-moon';}}function initializeAnimations(){animateProgressBars();animateCards();animateCounters();}function animateProgressBars(){const progressBars=document.querySelectorAll('.progress-bar-fill,.progress-fill,.vp-progress-fill');const observer=new IntersectionObserver((entries)=>{entries.forEach(entry=>{if(entry.isIntersecting){const targetWidth=entry.target.getAttribute('data-width')||entry.target.style.width;if(!entry.target.hasAttribute('data-width')){entry.target.setAttribute('data-width',targetWidth);}entry.target.style.width='0%';setTimeout(()=>{entry.target.style.width=targetWidth;},100);observer.unobserve(entry.target);}});},{threshold: 0.1});progressBars.forEach(bar=>{observer.observe(bar);});}function animateCards(){const cards=document.querySelectorAll('.module-card,.subject-card,.vp-card,.recommendation-card');const observer=new IntersectionObserver((entries)=>{entries.forEach((entry,index)=>{if(entry.isIntersecting){setTimeout(()=>{entry.target.style.opacity='1';entry.target.style.transform='translateY(0)';entry.target.classList.add('animate-slide-up');},index*100);observer.unobserve(entry.target);}});},{threshold: 0.1});cards.forEach(card=>{card.style.opacity='0';card.style.transform='translateY(20px)';card.style.transition='opacity 0.6s ease,transform 0.6s ease';observer.observe(card);});}function animateCounters(){const counters=document.querySelectorAll('.stat-value,.days-number,.circle-text');const observer=new IntersectionObserver((entries)=>{entries.forEach(entry=>{if(entry.isIntersecting){animateValue(entry.target);observer.unobserve(entry.target);}});},{threshold: 0.5});counters.forEach(counter=>{observer.observe(counter);});}function animateValue(element){const text=element.textContent;const number=parseInt(text.replace(/\D/g,''));if(isNaN(number)||number===0)return;const suffix=text.replace(number.toString(),'');const duration=1000;const steps=60;const stepValue=number/steps;let current=0;const timer=setInterval(()=>{current+=stepValue;if(current>=number){current=number;clearInterval(timer);}element.textContent=Math.floor(current)+suffix;},duration/steps);}function initializeMobileNavigation(){const mobileNavItems=document.querySelectorAll('.mobile-nav-item');mobileNavItems.forEach(item=>{if(item.tagName.toLowerCase()==='a')return;item.addEventListener('click',function(e){e.preventDefault();const pathId=this.getAttribute('data-path');const category=this.getAttribute('data-category');if(pathId&&window.AppConfig){const url=`/${window.AppConfig.currentLanguage}/learning-map/path/${pathId}`;navigateWithLoading(url);}});item.addEventListener('touchstart',function(){this.style.transform='scale(0.95)';});item.addEventListener('touchend',function(){this.style.transform='scale(1)';});});const mobileNavContainer=document.querySelector('.mobile-nav-container');if(mobileNavContainer){mobileNavContainer.style.scrollbarWidth='none';mobileNavContainer.style.msOverflowStyle='none';mobileNavContainer.style.scrollBehavior='smooth';const activeItem=mobileNavContainer.querySelector('.mobile-nav-item.active');if(activeItem){setTimeout(()=>{activeItem.scrollIntoView({behavior: 'smooth',block: 'nearest',inline: 'center'});},100);}}}function navigateWithLoading(url){if(window.showLoading){window.showLoading();}setTimeout(()=>{window.location.href=url;},200);}function setupLegacyCompatibility(){window.startModule=function(moduleId){if(!moduleId||!window.AppConfig)return;const url=`/${window.AppConfig.currentLanguage}/learning-map/module/${moduleId}/start`;navigateWithLoading(url);};window.showNotification=function(message,type='info',duration=5000){if(window.showFlashMessage){window.showFlashMessage(type,message,duration);}else{}};window.getTranslation=function(key,lang=null){const currentLang=lang||(window.AppConfig&&window.AppConfig.currentLanguage)||'en';return key;};}function hideSplashScreen(){setTimeout(()=>{const splashScreen=document.getElementById('splashScreen');if(splashScreen){splashScreen.classList.add('hidden');setTimeout(()=>{splashScreen.remove();},500);}document.body.classList.add('loaded');},2000);}function getCsrfToken(){const metaTag=document.querySelector('meta[name="csrf-token"]');return metaTag ? metaTag.getAttribute('content'): '';}function initMobileCarousel(){const container=document.querySelector('.carousel-container');const indicators=document.querySelectorAll('.carousel-indicators span');if(!container||!indicators.length)return;indicators.forEach((indicator,index)=>{indicator.addEventListener('click',()=>{container.style.transform=`translateX(-${index*(100/3)}%)`;indicators.forEach(ind=>ind.classList.remove('active'));indicator.classList.add('active');});});}class ModalManager{constructor(){this.activeModal=null;}open(modalId){const modal=document.getElementById(modalId);if(!modal)return;this.activeModal=modal;modal.style.display='flex';modal.classList.add('show');document.body.style.overflow='hidden';const firstInput=modal.querySelector('input,button,textarea,select');if(firstInput){setTimeout(()=>firstInput.focus(),100);}}close(modalId=null){const modal=modalId ? document.getElementById(modalId): this.activeModal;if(!modal)return;modal.classList.remove('show');setTimeout(()=>{modal.style.display='none';document.body.style.overflow='';this.activeModal=null;},300);}}window.modalManager=new ModalManager();window.addEventListener('error',function(e){console.error('JavaScript Error:',e.error);if(window.location.hostname==='localhost'||window.location.hostname==='127.0.0.1'){console.error('Error details:',{message: e.message,filename: e.filename,lineno: e.lineno,colno: e.colno,error: e.error});}});window.addEventListener('unhandledrejection',function(e){console.error('Unhandled Promise Rejection:',e.reason);e.preventDefault();});const DOMUtils={waitForElement: function(selector,timeout=5000){return new Promise((resolve,reject)=>{const element=document.querySelector(selector);if(element){resolve(element);return;}const observer=new MutationObserver((mutations,obs)=>{const element=document.querySelector(selector);if(element){obs.disconnect();resolve(element);}});observer.observe(document.body,{childList: true,subtree: true});setTimeout(()=>{observer.disconnect();reject(new Error(`Element ${selector}not found within ${timeout}ms`));},timeout);});},scrollToElement: function(element,offset=0){if(typeof element==='string'){element=document.querySelector(element);}if(!element)return;const headerHeight=document.querySelector('.site-header')?.offsetHeight||70;const targetPosition=element.offsetTop-headerHeight-offset;window.scrollTo({top: targetPosition,behavior: 'smooth'});},isElementVisible: function(element){if(typeof element==='string'){element=document.querySelector(element);}if(!element)return false;const rect=element.getBoundingClientRect();return(rect.top>=0&&rect.left>=0&&rect.bottom<=(window.innerHeight||document.documentElement.clientHeight)&&rect.right<=(window.innerWidth||document.documentElement.clientWidth));}};window.DOMUtils=DOMUtils;function initializePageSpecific(){const currentPage=window.location.pathname;if(currentPage.includes('subject')||currentPage.includes('learning-map')){initializeSubjectView();}if(currentPage.includes('module')){initializeModuleView();}if(currentPage.includes('lesson')){initializeLessonView();}}function initializeSubjectView(){}function initializeModuleView(){}function initializeLessonView(){}document.addEventListener('DOMContentLoaded',initializePageSpecific);if(window.location.hostname==='localhost'||window.location.search.includes('debug=true')){window.TandartsDebug={showAllElements: function(){document.querySelectorAll('.hidden,[style*="display: none"]').forEach(el=>{el.style.display='block';el.style.opacity='1';el.classList.remove('hidden');});},highlightClickable: function(){document.querySelectorAll('button,a,[onclick],[data-bs-toggle]').forEach(el=>{el.style.outline='2px solid red';});},checkTranslations: function(){const untranslated=[];document.querySelectorAll('[data-translate]').forEach(el=>{const key=el.getAttribute('data-translate');if(el.textContent===key){untranslated.push(key);}});},showPerformance: function(){if(window.performance){const navigation=performance.getEntriesByType('navigation')[0];}}};}