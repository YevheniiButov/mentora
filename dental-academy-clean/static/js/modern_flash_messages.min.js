class ModernFlashMessages{constructor(){this.container=null;this.messages=new Map();this.maxMessages=5;this.defaultDuration=5000;this.isInitialized=false;this.init();}init(){if(this.isInitialized)return;this.createContainer();this.processExistingMessages();this.setupEventListeners();this.isInitialized=true;}createContainer(){this.container=document.getElementById('flash-container');if(!this.container){this.container=document.createElement('div');this.container.id='flash-container';this.container.className='flash-container';document.body.appendChild(this.container);}this.updateContainerPosition();}updateContainerPosition(){if(!this.container)return;const headerHeight=this.getHeaderHeight();Object.assign(this.container.style,{position: 'fixed',top: `${headerHeight+20}px`,right: '20px',zIndex: '1050',maxWidth: '400px',pointerEvents: 'none'});}getHeaderHeight(){const header=document.querySelector('.modern-header')||document.querySelector('header')||document.querySelector('.navbar');if(header){return header.offsetHeight;}return window.innerWidth<=768 ? 60 : 70;}processExistingMessages(){if(!this.container)return;const existingMessages=this.container.querySelectorAll('.flash-message');existingMessages.forEach(message=>{this.enhanceMessage(message);this.autoHideMessage(message);});}enhanceMessage(messageElement){if(!messageElement||messageElement.dataset.enhanced)return;messageElement.style.pointerEvents='auto';messageElement.dataset.enhanced='true';if(!messageElement.querySelector('.flash-close')){this.addCloseButton(messageElement);}setTimeout(()=>{messageElement.classList.add('show');},10);}addCloseButton(messageElement){const closeButton=document.createElement('button');closeButton.className='flash-close';closeButton.innerHTML='<i class="bi bi-x"></i>';closeButton.onclick=()=>this.hideMessage(messageElement);const content=messageElement.querySelector('.flash-content');if(content){content.appendChild(closeButton);}else{messageElement.appendChild(closeButton);}}autoHideMessage(messageElement,duration=this.defaultDuration){if(!messageElement)return;const messageId=this.generateMessageId();messageElement.dataset.messageId=messageId;const timer=setTimeout(()=>{this.hideMessage(messageElement);},duration);this.messages.set(messageId,{element: messageElement,timer: timer});}generateMessageId(){return 'msg_'+Date.now()+'_'+Math.random().toString(36).substr(2,9);}showMessage(type,text,duration=this.defaultDuration){if(!this.container){this.createContainer();}this.cleanupOldMessages();const messageElement=this.createMessageElement(type,text);this.container.appendChild(messageElement);this.enhanceMessage(messageElement);this.autoHideMessage(messageElement,duration);return messageElement;}createMessageElement(type,text){const messageElement=document.createElement('div');messageElement.className=`flash-message alert alert-${type}`;const iconHtml=this.getIconForType(type);messageElement.innerHTML=`<div class="flash-content"><div class="flash-icon">${iconHtml}</div><div class="flash-text">${text}</div></div>`;return messageElement;}getIconForType(type){const icons={success: '<i class="bi bi-check-circle-fill"></i>',error: '<i class="bi bi-exclamation-triangle-fill"></i>',danger: '<i class="bi bi-exclamation-triangle-fill"></i>',warning: '<i class="bi bi-exclamation-circle-fill"></i>',info: '<i class="bi bi-info-circle-fill"></i>'};return icons[type]||icons.info;}hideMessage(messageElement){if(!messageElement||messageElement.classList.contains('hiding'))return;messageElement.classList.add('hiding');const messageId=messageElement.dataset.messageId;if(messageId&&this.messages.has(messageId)){const messageData=this.messages.get(messageId);if(messageData.timer){clearTimeout(messageData.timer);}this.messages.delete(messageId);}setTimeout(()=>{if(messageElement.parentNode){messageElement.parentNode.removeChild(messageElement);}},300);}cleanupOldMessages(){if(!this.container)return;const messages=this.container.querySelectorAll('.flash-message');if(messages.length>=this.maxMessages){const oldestMessage=messages[0];if(oldestMessage){this.hideMessage(oldestMessage);}}}setupEventListeners(){const resizeHandler=()=>{this.updateContainerPosition();};let resizeTimer;window.addEventListener('resize',()=>{clearTimeout(resizeTimer);resizeTimer=setTimeout(resizeHandler,100);});let scrollTimer;window.addEventListener('scroll',()=>{clearTimeout(scrollTimer);scrollTimer=setTimeout(()=>{this.updateContainerPosition();},100);},{passive: true});}success(text,duration){return this.showMessage('success',text,duration);}error(text,duration){return this.showMessage('error',text,duration);}warning(text,duration){return this.showMessage('warning',text,duration);}info(text,duration){return this.showMessage('info',text,duration);}clearAll(){if(!this.container)return;const messages=this.container.querySelectorAll('.flash-message');messages.forEach(message=>{this.hideMessage(message);});this.messages.forEach(messageData=>{if(messageData.timer){clearTimeout(messageData.timer);}});this.messages.clear();}destroy(){this.clearAll();if(this.container&&this.container.parentNode){this.container.parentNode.removeChild(this.container);}this.isInitialized=false;}}if(typeof window.modernFlashMessages==='undefined'){window.modernFlashMessages=new ModernFlashMessages();}window.ModernFlashMessages=ModernFlashMessages;window.showFlashMessage=function(type,message,duration){return window.modernFlashMessages.showMessage(type,message,duration);};window.hideAllFlashMessages=function(){return window.modernFlashMessages.clearAll();};if(document.readyState==='loading'){document.addEventListener('DOMContentLoaded',()=>{if(window.modernFlashMessages&&!window.modernFlashMessages.isInitialized){window.modernFlashMessages.init();}});}else{if(window.modernFlashMessages&&!window.modernFlashMessages.isInitialized){window.modernFlashMessages.init();}}