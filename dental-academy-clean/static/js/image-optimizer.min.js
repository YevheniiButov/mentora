class ImageOptimizer{constructor(){this.supportsWebP=this.checkWebPSupport();this.init();}checkWebPSupport(){const canvas=document.createElement('canvas');canvas.width=1;canvas.height=1;return canvas.toDataURL('image/webp').indexOf('data:image/webp')===0;}init(){this.optimizeImages();}optimizeImages(){const images=document.querySelectorAll('img[data-src],img[src*=".png"],img[src*=".jpg"],img[src*=".jpeg"]');images.forEach(img=>{this.optimizeImage(img);});}optimizeImage(img){const currentSrc=img.src||img.getAttribute('data-src');if(!currentSrc)return;const webpSrc=this.getWebPSrc(currentSrc);if(this.supportsWebP&&webpSrc){const webpImg=new Image();webpImg.onload=()=>{img.src=webpSrc;img.classList.add('webp-loaded');};webpImg.onerror=()=>{};webpImg.src=webpSrc;}}getWebPSrc(originalSrc){const baseName=originalSrc.replace(/\.(png|jpg|jpeg)$/i,'');return `${baseName}_optimized.webp`;}static optimize(src,callback){const optimizer=new ImageOptimizer();const webpSrc=optimizer.getWebPSrc(src);if(optimizer.supportsWebP){const testImg=new Image();testImg.onload=()=>callback(webpSrc);testImg.onerror=()=>callback(src);testImg.src=webpSrc;}else{callback(src);}}}document.addEventListener('DOMContentLoaded',()=>{new ImageOptimizer();});window.ImageOptimizer=ImageOptimizer;