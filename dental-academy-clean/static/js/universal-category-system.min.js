class UniversalCategorySystem{constructor(options={}){this.config={categorySelector: '.learning-path-button',listSelector: '.subject-list',itemSelector: '.subcategory-item',expandedClass: 'expanded',forceVisibleClass: 'force-visible',debugMode: options.debug||false,animationDuration: 400,useFallback: true,autoInit: true,...options};this.isInitialized=false;this.categories=new Map();this.activeCategory=null;this.stats={categoriesFound: 0,successfulToggles: 0,fallbackUsed: 0,errors: 0};this.log('ðŸš€ Ð˜Ð½Ð¸Ñ†Ð¸Ð°Ð»Ð¸Ð·Ð°Ñ†Ð¸Ñ UniversalCategorySystem');if(this.config.autoInit){this.init();}}log(message,...args){if(this.config.debugMode){console.log(`[CategorySystem] ${message}`,...args);}}warn(message,...args){console.warn(`[CategorySystem] âš ï¸ ${message}`,...args);}error(message,...args){console.error(`[CategorySystem] âŒ ${message}`,...args);this.stats.errors++;}init(){if(document.readyState==='loading'){document.addEventListener('DOMContentLoaded',()=>this.setup());}else{setTimeout(()=>this.setup(),50);}this.setupMutationObserver();}setup(){this.log('ðŸ“± ÐÐ°ÑÑ‚Ñ€Ð¾Ð¹ÐºÐ° ÑƒÐ½Ð¸Ð²ÐµÑ€ÑÐ°Ð»ÑŒÐ½Ð¾Ð¹ ÑÐ¸ÑÑ‚ÐµÐ¼Ñ‹ ÐºÐ°Ñ‚ÐµÐ³Ð¾Ñ€Ð¸Ð¹');try{this.scanCategories();this.setupEventDelegation();if(this.config.debugMode){this.enableDebugMode();}this.injectFallbackStyles();this.testCSSAnimations();this.isInitialized=true;this.log('âœ… Ð¡Ð¸ÑÑ‚ÐµÐ¼Ð° ÐºÐ°Ñ‚ÐµÐ³Ð¾Ñ€Ð¸Ð¹ Ð³Ð¾Ñ‚Ð¾Ð²Ð° Ðº Ñ€Ð°Ð±Ð¾Ñ‚Ðµ');this.logStats();window.categorySystem=this;}catch(error){this.error('ÐžÑˆÐ¸Ð±ÐºÐ° Ð¿Ñ€Ð¸ Ð¸Ð½Ð¸Ñ†Ð¸Ð°Ð»Ð¸Ð·Ð°Ñ†Ð¸Ð¸:',error);}}scanCategories(){const categoryButtons=document.querySelectorAll(this.config.categorySelector);this.stats.categoriesFound=categoryButtons.length;this.log(`ðŸ” ÐÐ°Ð¹Ð´ÐµÐ½Ð¾ ÐºÐ°Ñ‚ÐµÐ³Ð¾Ñ€Ð¸Ð¹: ${categoryButtons.length}`);if(categoryButtons.length===0){this.warn('ÐšÐ°Ñ‚ÐµÐ³Ð¾Ñ€Ð¸Ð¸ Ð½Ðµ Ð½Ð°Ð¹Ð´ÐµÐ½Ñ‹!ÐŸÑ€Ð¾Ð²ÐµÑ€ÑŒÑ‚Ðµ ÑÐµÐ»ÐµÐºÑ‚Ð¾Ñ€:',this.config.categorySelector);this.warn('Ð˜Ñ‰ÐµÐ¼ ÑÐ»ÐµÐ¼ÐµÐ½Ñ‚Ñ‹ Ñ ÐºÐ»Ð°ÑÑÐ¾Ð¼ .learning-path-button(LearningPath)Ð¸Ð»Ð¸ .content-category(ContentCategory)');return;}categoryButtons.forEach((button,index)=>{this.registerCategory(button,index);});}registerCategory(button,index){const categoryId=button.getAttribute('data-path')||button.getAttribute('data-category');if(!categoryId){this.error(`ÐšÐ½Ð¾Ð¿ÐºÐ° ${index}Ð½Ðµ Ð¸Ð¼ÐµÐµÑ‚ Ð°Ñ‚Ñ€Ð¸Ð±ÑƒÑ‚Ð° data-path Ð¸Ð»Ð¸ data-category:`,button);return;}let listId=`path-${categoryId}-subjects`;let list=document.getElementById(listId);if(!list){listId=`category-${categoryId}-subcategories`;list=document.getElementById(listId);}if(!list){this.error(`Ð¡Ð¿Ð¸ÑÐ¾Ðº Ð½Ðµ Ð½Ð°Ð¹Ð´ÐµÐ½ Ð´Ð»Ñ ÐºÐ°Ñ‚ÐµÐ³Ð¾Ñ€Ð¸Ð¸ ${categoryId}: #${listId}`);return;}const categoryData={id: categoryId,button,list,items: list.querySelectorAll(this.config.itemSelector),isExpanded: false};this.categories.set(categoryId,categoryData);button.setAttribute('aria-expanded','false');button.setAttribute('aria-controls',listId);button.setAttribute('role','button');button.setAttribute('tabindex','0');if(button.tagName==='BUTTON'&&!button.hasAttribute('type')){button.setAttribute('type','button');}this.log(`âœ… ÐšÐ°Ñ‚ÐµÐ³Ð¾Ñ€Ð¸Ñ Ð·Ð°Ñ€ÐµÐ³Ð¸ÑÑ‚Ñ€Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð°: ID=${categoryId},ÑÐ»ÐµÐ¼ÐµÐ½Ñ‚Ð¾Ð²=${categoryData.items.length}`);}setupEventDelegation(){document.addEventListener('click',(e)=>{const categoryButton=e.target.closest(this.config.categorySelector);if(categoryButton){e.preventDefault();e.stopPropagation();const categoryId=categoryButton.getAttribute('data-path')||categoryButton.getAttribute('data-category');if(categoryId){this.toggleCategory(categoryId);}}});document.addEventListener('keydown',(e)=>{if(e.key==='Enter'||e.key===' '){const categoryButton=e.target.closest(this.config.categorySelector);if(categoryButton){e.preventDefault();const categoryId=categoryButton.getAttribute('data-path')||categoryButton.getAttribute('data-category');if(categoryId){this.toggleCategory(categoryId);}}}});this.log('ðŸ“¡ Event delegation Ð½Ð°ÑÑ‚Ñ€Ð¾ÐµÐ½');}setupMutationObserver(){const observer=new MutationObserver((mutations)=>{let newCategoriesFound=false;mutations.forEach((mutation)=>{mutation.addedNodes.forEach((node)=>{if(node.nodeType===Node.ELEMENT_NODE){const newCategories=node.querySelectorAll ? node.querySelectorAll(this.config.categorySelector): [];if(newCategories.length>0){newCategoriesFound=true;}if(node.matches&&node.matches(this.config.categorySelector)){newCategoriesFound=true;}}});});if(newCategoriesFound){this.log('ðŸ”„ ÐžÐ±Ð½Ð°Ñ€ÑƒÐ¶ÐµÐ½Ñ‹ Ð½Ð¾Ð²Ñ‹Ðµ ÐºÐ°Ñ‚ÐµÐ³Ð¾Ñ€Ð¸Ð¸,Ð¿ÐµÑ€ÐµÑÐºÐ°Ð½Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ðµ...');setTimeout(()=>this.scanCategories(),100);}});observer.observe(document.body,{childList: true,subtree: true});this.log('ðŸ‘ï¸ MutationObserver Ð°ÐºÑ‚Ð¸Ð²ÐµÐ½');}toggleCategory(categoryId){this.log(`ðŸ”„ ÐŸÐµÑ€ÐµÐºÐ»ÑŽÑ‡ÐµÐ½Ð¸Ðµ ÐºÐ°Ñ‚ÐµÐ³Ð¾Ñ€Ð¸Ð¸: ${categoryId}`);const category=this.categories.get(categoryId);if(!category){this.error(`ÐšÐ°Ñ‚ÐµÐ³Ð¾Ñ€Ð¸Ñ Ð½Ðµ Ð½Ð°Ð¹Ð´ÐµÐ½Ð°: ${categoryId}`);return false;}try{const wasExpanded=category.isExpanded;this.closeAllCategories(categoryId);if(wasExpanded){this.closeCategory(categoryId);}else{this.openCategory(categoryId);}this.stats.successfulToggles++;return true;}catch(error){this.error(`ÐžÑˆÐ¸Ð±ÐºÐ° Ð¿Ñ€Ð¸ Ð¿ÐµÑ€ÐµÐºÐ»ÑŽÑ‡ÐµÐ½Ð¸Ð¸ ÐºÐ°Ñ‚ÐµÐ³Ð¾Ñ€Ð¸Ð¸ ${categoryId}:`,error);if(this.config.useFallback){this.forceCategoryToggle(categoryId);}return false;}}openCategory(categoryId){const category=this.categories.get(categoryId);if(!category)return;this.log(`ðŸ”“ ÐžÑ‚ÐºÑ€Ñ‹Ñ‚Ð¸Ðµ ÐºÐ°Ñ‚ÐµÐ³Ð¾Ñ€Ð¸Ð¸: ${categoryId}`);const{button,list,items}=category;list.classList.add(this.config.expandedClass);list.setAttribute('data-expanded','true');button.setAttribute('aria-expanded','true');if(this.config.useFallback){setTimeout(()=>{if(this.getComputedOpacity(list)<0.5){this.log(`ðŸ”§ CSS Ð½Ðµ Ñ€Ð°Ð±Ð¾Ñ‚Ð°ÐµÑ‚ Ð´Ð»Ñ ${categoryId},Ð¸ÑÐ¿Ð¾Ð»ÑŒÐ·ÑƒÐµÐ¼ fallback`);this.applyFallbackStyles(list,items,true);this.stats.fallbackUsed++;}},100);}category.isExpanded=true;this.activeCategory=categoryId;setTimeout(()=>{button.scrollIntoView({behavior: 'smooth',block: 'nearest',inline: 'nearest'});},200);this.log(`âœ… ÐšÐ°Ñ‚ÐµÐ³Ð¾Ñ€Ð¸Ñ ${categoryId}Ð¾Ñ‚ÐºÑ€Ñ‹Ñ‚Ð°`);}closeCategory(categoryId){const category=this.categories.get(categoryId);if(!category)return;this.log(`ðŸ”’ Ð—Ð°ÐºÑ€Ñ‹Ñ‚Ð¸Ðµ ÐºÐ°Ñ‚ÐµÐ³Ð¾Ñ€Ð¸Ð¸: ${categoryId}`);const{button,list,items}=category;list.classList.remove(this.config.expandedClass,this.config.forceVisibleClass);list.removeAttribute('data-expanded');button.setAttribute('aria-expanded','false');this.clearFallbackStyles(list,items);category.isExpanded=false;if(this.activeCategory===categoryId){this.activeCategory=null;}this.log(`âœ… ÐšÐ°Ñ‚ÐµÐ³Ð¾Ñ€Ð¸Ñ ${categoryId}Ð·Ð°ÐºÑ€Ñ‹Ñ‚Ð°`);}closeAllCategories(exceptCategoryId=null){this.categories.forEach((category,categoryId)=>{if(categoryId!==exceptCategoryId&&category.isExpanded){this.closeCategory(categoryId);}});}forceCategoryToggle(categoryId){this.log(`âš¡ ÐŸÑ€Ð¸Ð½ÑƒÐ´Ð¸Ñ‚ÐµÐ»ÑŒÐ½Ð¾Ðµ Ð¿ÐµÑ€ÐµÐºÐ»ÑŽÑ‡ÐµÐ½Ð¸Ðµ ÐºÐ°Ñ‚ÐµÐ³Ð¾Ñ€Ð¸Ð¸: ${categoryId}`);const category=this.categories.get(categoryId);if(!category)return;const{list,items}=category;const isCurrentlyVisible=list.classList.contains(this.config.forceVisibleClass);if(isCurrentlyVisible){list.classList.remove(this.config.forceVisibleClass);this.clearFallbackStyles(list,items);category.isExpanded=false;}else{this.closeAllCategories(categoryId);list.classList.add(this.config.forceVisibleClass);this.applyFallbackStyles(list,items,true);category.isExpanded=true;this.activeCategory=categoryId;}this.stats.fallbackUsed++;}applyFallbackStyles(list,items,visible){if(visible){Object.assign(list.style,{display: 'block',maxHeight: 'none',opacity: '1',overflow: 'visible',visibility: 'visible',transform: 'translateY(0)',marginTop: '0.75rem',paddingTop: '0.5rem'});items.forEach((item,index)=>{setTimeout(()=>{Object.assign(item.style,{opacity: '1',transform: 'translateX(0)',visibility: 'visible'});},index*50);});}else{list.style.cssText='';items.forEach(item=>{item.style.cssText='';});}}clearFallbackStyles(list,items){list.style.cssText='';items.forEach(item=>{item.style.cssText='';});}getComputedOpacity(element){return parseFloat(window.getComputedStyle(element).opacity)||0;}testCSSAnimations(){const testElement=document.createElement('div');testElement.className=this.config.listSelector.replace('.','')+' '+this.config.expandedClass;testElement.style.position='absolute';testElement.style.left='-9999px';document.body.appendChild(testElement);const opacity=this.getComputedOpacity(testElement);document.body.removeChild(testElement);if(opacity<0.8){this.warn('CSS Ð°Ð½Ð¸Ð¼Ð°Ñ†Ð¸Ð¸ Ð¼Ð¾Ð³ÑƒÑ‚ Ñ€Ð°Ð±Ð¾Ñ‚Ð°Ñ‚ÑŒ Ð½ÐµÐºÐ¾Ñ€Ñ€ÐµÐºÑ‚Ð½Ð¾,Ð²ÐºÐ»ÑŽÑ‡ÐµÐ½ fallback Ñ€ÐµÐ¶Ð¸Ð¼');this.config.useFallback=true;}else{this.log('âœ… CSS Ð°Ð½Ð¸Ð¼Ð°Ñ†Ð¸Ð¸ Ñ€Ð°Ð±Ð¾Ñ‚Ð°ÑŽÑ‚ ÐºÐ¾Ñ€Ñ€ÐµÐºÑ‚Ð½Ð¾');}}injectFallbackStyles(){const style=document.createElement('style');style.textContent=` ${this.config.listSelector}.${this.config.forceVisibleClass}{display: block!important;max-height: none!important;opacity: 1!important;overflow: visible!important;visibility: visible!important;}${this.config.listSelector}.${this.config.forceVisibleClass}${this.config.itemSelector}{opacity: 1!important;transform: none!important;visibility: visible!important;}`;document.head.appendChild(style);this.log('ðŸ’‰ Fallback ÑÑ‚Ð¸Ð»Ð¸ Ð´Ð¾Ð±Ð°Ð²Ð»ÐµÐ½Ñ‹');}enableDebugMode(){this.log('ðŸ› ÐžÑ‚Ð»Ð°Ð´Ð¾Ñ‡Ð½Ñ‹Ð¹ Ñ€ÐµÐ¶Ð¸Ð¼ Ð¾Ñ‚ÐºÐ»ÑŽÑ‡ÐµÐ½');}logStats(){if(this.config.debugMode){console.log('Ð¡Ñ‚Ð°Ñ‚Ð¸ÑÑ‚Ð¸ÐºÐ°:',this.stats);}}openCategoryById(categoryId){this.closeAllCategories();this.openCategory(categoryId);}closeAllCategoriesPublic(){this.closeAllCategories();}refreshCategories(){this.log('ðŸ”„ ÐžÐ±Ð½Ð¾Ð²Ð»ÐµÐ½Ð¸Ðµ ÑÐ¿Ð¸ÑÐºÐ° ÐºÐ°Ñ‚ÐµÐ³Ð¾Ñ€Ð¸Ð¹');this.categories.clear();this.scanCategories();}getStats(){return{...this.stats};}debug(){if(this.config.debugMode){console.log('UniversalCategorySystem Ñ€Ð°Ð±Ð¾Ñ‚Ð°ÐµÑ‚');return{categories: this.categories.size,active: this.activeCategory};}return null;}}document.addEventListener('DOMContentLoaded',()=>{setTimeout(()=>{window.universalCategorySystem=new UniversalCategorySystem({debug: false});},100);});if(typeof module!=='undefined'&&module.exports){module.exports=UniversalCategorySystem;}