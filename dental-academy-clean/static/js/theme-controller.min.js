class ThemeController{constructor(){this.systemTheme=window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light';this.theme=localStorage.getItem('theme')||'light';this.isDark=this.calculateIsDark();this.init();}calculateIsDark(){if(this.theme==='system'){return this.systemTheme==='dark';}else if(this.theme==='toggle'){return localStorage.getItem('isDark')==='true';}return this.theme==='dark';}init(){this.applyTheme();window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change',e=>{this.systemTheme=e.matches ? 'dark' : 'light';if(this.theme==='system'){this.isDark=this.calculateIsDark();this.applyTheme();}});}applyTheme(){document.documentElement.setAttribute('data-theme',this.isDark ? 'dark' : 'light');this.notifyThemeChange();}toggleTheme(){if(this.theme!=='toggle'){this.theme='toggle';this.isDark=true;}else{this.isDark=!this.isDark;}localStorage.setItem('theme',this.theme);localStorage.setItem('isDark',this.isDark);this.applyTheme();}notifyThemeChange(){const event=new CustomEvent('themechange',{detail:{theme: this.theme,isDark: this.isDark,appliedTheme: this.isDark ? 'dark' : 'light'}});window.dispatchEvent(event);}}document.addEventListener('DOMContentLoaded',()=>{window.themeController=new ThemeController();});