window.Mentora={version: '1.0.0',debug: false,currentUser: null,csrfToken: null,init(){document.addEventListener('DOMContentLoaded',()=>{this.initializeApp();});},initializeApp(){this.loadConfiguration();this.initializeComponents();this.bindEventListeners();this.log('Mentora initialized successfully');},loadConfiguration(){this.csrfToken=this.getMetaContent('csrf-token');this.currentUser=JSON.parse(this.getMetaContent('user-data')||'null');if(window.AppConfig){this.currentLanguage=window.AppConfig.currentLanguage;this.isAuthenticated=window.AppConfig.isAuthenticated==='true';this.userId=window.AppConfig.userId;}},initializeComponents(){this.themeManager.init();this.navigationManager.init();this.flashMessages.init();this.loadingManager.init();this.formManager.init();},bindEventListeners(){window.addEventListener('unhandledrejection',this.handleError.bind(this));window.addEventListener('popstate',this.handlePopState.bind(this));document.addEventListener('visibilitychange',this.handleVisibilityChange.bind(this));},getMetaContent(name){const meta=document.querySelector(`meta[name="${name}"]`);return meta ? meta.getAttribute('content'): null;},log(message,level='info'){if(this.debug){console[level](`[Mentora] ${message}`);}},handleError(event){this.log(`Unhandled error: ${event.reason}`,'error');this.flashMessages.show('Произошла ошибка. Пожалуйста,попробуйте еще раз.','error');},handlePopState(event){this.log('Navigation state changed');},handleVisibilityChange(){if(document.hidden){this.log('Page hidden');}else{this.log('Page visible');}}};Mentora.themeManager={currentTheme: 'light',init(){this.loadSavedTheme();this.bindThemeButtons();Mentora.log('Theme manager initialized');},loadSavedTheme(){const savedTheme=localStorage.getItem('dental-academy-theme')||'light';this.setTheme(savedTheme);},setTheme(theme){const validThemes=['light','dark','gradient'];if(!validThemes.includes(theme)){theme='light';}this.currentTheme=theme;document.documentElement.setAttribute('data-theme',theme);localStorage.setItem('dental-academy-theme',theme);this.updateThemeButtons();Mentora.log(`Theme changed to: ${theme}`);},bindThemeButtons(){document.addEventListener('click',(e)=>{if(e.target.matches('[data-theme]')){const theme=e.target.getAttribute('data-theme');this.setTheme(theme);}});},updateThemeButtons(){const buttons=document.querySelectorAll('[data-theme]');buttons.forEach(button=>{const theme=button.getAttribute('data-theme');button.classList.toggle('active',theme===this.currentTheme);});}};Mentora.navigationManager={init(){this.bindMobileToggle();this.highlightActiveLinks();Mentora.log('Navigation manager initialized');},bindMobileToggle(){const toggler=document.querySelector('.navbar-toggler');const collapse=document.querySelector('.navbar-collapse');if(toggler&&collapse){toggler.addEventListener('click',()=>{collapse.classList.toggle('show');toggler.classList.toggle('active');});}},bindDropdowns(){},highlightActiveLinks(){const currentPath=window.location.pathname;const navLinks=document.querySelectorAll('.nav-link');navLinks.forEach(link=>{const href=link.getAttribute('href');if(href&&currentPath===href){link.classList.add('active');}});}};Mentora.flashMessages={container: null,init(){this.container=document.getElementById('flash-container');this.autoHideMessages();Mentora.log('Flash messages initialized');},show(message,type='info',duration=5000){if(!this.container)return;const messageElement=this.createMessage(message,type);this.container.appendChild(messageElement);setTimeout(()=>{messageElement.classList.add('show');},100);if(duration>0){setTimeout(()=>{this.hide(messageElement);},duration);}return messageElement;},createMessage(message,type){const icons={success: 'bi-check-circle-fill',error: 'bi-exclamation-triangle-fill',warning: 'bi-exclamation-circle-fill',info: 'bi-info-circle-fill'};const messageDiv=document.createElement('div');messageDiv.className=`flash-message alert alert-${type==='error' ? 'danger' : type}`;messageDiv.innerHTML=`<div class="flash-content"><div class="flash-icon"><i class="${icons[type]||icons.info}"></i></div><div class="flash-text">${message}</div><button type="button" class="flash-close"><i class="bi bi-x"></i></button></div>`;messageDiv.querySelector('.flash-close').addEventListener('click',()=>{this.hide(messageDiv);});return messageDiv;},hide(messageElement){messageElement.classList.add('fade-out');setTimeout(()=>{if(messageElement.parentNode){messageElement.parentNode.removeChild(messageElement);}},300);},autoHideMessages(){const existingMessages=document.querySelectorAll('.flash-message');existingMessages.forEach((message,index)=>{setTimeout(()=>{message.classList.add('show');setTimeout(()=>{this.hide(message);},5000);},index*100);});}};Mentora.loadingManager={indicator: null,init(){this.indicator=document.getElementById('loading-indicator');Mentora.log('Loading manager initialized');},show(){if(this.indicator){this.indicator.classList.add('active');}},hide(){if(this.indicator){this.indicator.classList.remove('active');}}};Mentora.formManager={init(){this.bindFormSubmissions();this.addCSRFTokens();Mentora.log('Form manager initialized');},bindFormSubmissions(){document.addEventListener('submit',(e)=>{const form=e.target;if(form.tagName==='FORM'){this.handleFormSubmit(form);}});},handleFormSubmit(form){const submitBtn=form.querySelector('button[type="submit"],input[type="submit"]');if(submitBtn){submitBtn.disabled=true;const originalText=submitBtn.textContent;submitBtn.textContent='Отправка...';setTimeout(()=>{submitBtn.disabled=false;submitBtn.textContent=originalText;},10000);}},addCSRFTokens(){const forms=document.querySelectorAll('form');forms.forEach(form=>{if(!form.querySelector('input[name="csrf_token"]')&&Mentora.csrfToken){const csrfInput=document.createElement('input');csrfInput.type='hidden';csrfInput.name='csrf_token';csrfInput.value=Mentora.csrfToken;form.appendChild(csrfInput);}});}};Mentora.api={async request(url,options={}){const defaultOptions={method: 'GET',headers:{'Content-Type': 'application/json','X-CSRFToken': Mentora.csrfToken},credentials: 'same-origin'};const config={...defaultOptions,...options};try{Mentora.loadingManager.show();const response=await fetch(url,config);if(!response.ok){throw new Error(`HTTP ${response.status}: ${response.statusText}`);}return await response.json();}catch(error){Mentora.log(`API Error: ${error.message}`,'error');throw error;}finally{Mentora.loadingManager.hide();}},async get(url){return this.request(url);},async post(url,data){return this.request(url,{method: 'POST',body: JSON.stringify(data)});},async put(url,data){return this.request(url,{method: 'PUT',body: JSON.stringify(data)});},async delete(url){return this.request(url,{method: 'DELETE'});}};Mentora.utils={debounce(func,wait){let timeout;return function executedFunction(...args){const later=()=>{clearTimeout(timeout);func(...args);};clearTimeout(timeout);timeout=setTimeout(later,wait);};},throttle(func,limit){let inThrottle;return function(){const args=arguments;const context=this;if(!inThrottle){func.apply(context,args);inThrottle=true;setTimeout(()=>inThrottle=false,limit);}};},formatNumber(num){return new Intl.NumberFormat('ru-RU').format(num);},formatDuration(seconds){const hours=Math.floor(seconds/3600);const minutes=Math.floor((seconds % 3600)/60);if(hours>0){return `${hours}ч ${minutes}м`;}return `${minutes}м`;},async copyToClipboard(text){try{await navigator.clipboard.writeText(text);Mentora.flashMessages.show('Скопировано в буфер обмена','success');}catch(error){Mentora.log('Copy to clipboard failed','error');Mentora.flashMessages.show('Не удалось скопировать','error');}}};Mentora.scrollManager={init(){this.bindSmoothScrolling();},bindSmoothScrolling(){document.addEventListener('click',(e)=>{const link=e.target.closest('a[href^="#"]');if(link){e.preventDefault();const targetId=link.getAttribute('href').substring(1);const target=document.getElementById(targetId);if(target){target.scrollIntoView({behavior: 'smooth',block: 'start'});}}});}};Mentora.analytics={init(){this.trackPageView();},trackPageView(){Mentora.log(`Page view: ${window.location.pathname}`);},trackEvent(action,category='general',label=''){Mentora.log(`Event: ${category}/${action}${label ? '/'+label : ''}`);}};window.setTheme=function(theme){Mentora.themeManager.setTheme(theme);};window.showFlashMessage=function(message,type='info'){Mentora.flashMessages.show(message,type);};Mentora.init();if(typeof module!=='undefined'&&module.exports){module.exports=Mentora;}