class TemplateLoader{constructor(editor,options={}){this.editor=editor;this.options={cacheEnabled: true,cacheTimeout: 5*60*1000,showPreview: true,autoSave: true,...options};this.templates=[];this.templateCache=new Map();this.currentTemplate=null;this.isLoading=false;this.init();}init(){console.log('üîß Template Loader initializing...');console.log('üîß Current language:',window.currentLang);this.createEnhancedUI();this.setupEventListeners();console.log('‚úÖ Template Loader initialized');console.log('üîß Template selector after init:',document.querySelector('.template-selector'));console.log('üîß Template dropdown after init:',document.getElementById('template-dropdown'));}createEnhancedUI(){const openFileExplorerBtn=document.getElementById('open-file-explorer');console.log('üîß Existing open file explorer button found:',openFileExplorerBtn);if(!openFileExplorerBtn){console.log('üîß Creating new file explorer button...');const buttonContainer=document.querySelector('.d-flex.gap-2.align-items-center');if(buttonContainer){const newButton=document.createElement('button');newButton.className='btn btn-outline-primary';newButton.id='open-file-explorer';newButton.title='–û—Ç–∫—Ä—ã—Ç—å –ø—Ä–æ–≤–æ–¥–Ω–∏–∫';newButton.innerHTML='<i class="bi bi-folder2"></i>–û—Ç–∫—Ä—ã—Ç—å –ø—Ä–æ–≤–æ–¥–Ω–∏–∫';buttonContainer.appendChild(newButton);console.log('‚úÖ File explorer button created');}}}setupEventListeners(){console.log('üîß Setting up event listeners...');document.addEventListener('click',(e)=>{if(e.target.id==='open-file-explorer'||e.target.closest('#open-file-explorer')){console.log('üîß Opening File Explorer...');e.preventDefault();e.stopPropagation();if(window.fileExplorer){window.fileExplorer.open();}else{console.error('‚ùå FileExplorer instance not found');alert('–§–∞–π–ª–æ–≤—ã–π –ø—Ä–æ–≤–æ–¥–Ω–∏–∫ –Ω–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω. –û–±–Ω–æ–≤–∏—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü—É.');}}});console.log('‚úÖ Event listeners set up with delegation');}enableButtons(){const buttons=['undo-btn','redo-btn','preview-btn','save-btn'];buttons.forEach(btnId=>{const btn=document.getElementById(btnId);if(btn){btn.disabled=false;}});}updateStatus(type,text){const statusDot=document.getElementById('status-dot');const statusText=document.getElementById('status-text');if(statusDot&&statusText){statusDot.className=`status-dot ${type}`;statusText.textContent=text;}}showNotification(message,type='info'){const notification=document.createElement('div');notification.className=`notification ${type}`;notification.innerHTML=`<i class="bi bi-${type==='success' ? 'check-circle' : type==='error' ? 'exclamation-triangle' : 'info-circle'}"></i>${message}`;document.body.appendChild(notification);setTimeout(()=>{if(notification.parentElement){notification.remove();}},3000);}getCSRFToken(){return document.querySelector('meta[name="csrf-token"]')?.content||'';}getTemplateIcon(category){const icons={'core': 'file-earmark-text','learning': 'book','virtual_patient': 'person-heart','tests': 'question-circle','includes': 'code-slash'};return icons[category]||'file-earmark';}getCategoryName(category){const names={'core': '–û—Å–Ω–æ–≤–Ω—ã–µ','learning': '–û–±—É—á–µ–Ω–∏–µ','virtual_patient': '–í–∏—Ä—Ç—É–∞–ª—å–Ω—ã–π –ø–∞—Ü–∏–µ–Ω—Ç','tests': '–¢–µ—Å—Ç—ã','includes': '–í–∫–ª—é—á–µ–Ω–∏—è'};return names[category]||category;}destroy(){console.log('üîß Template Loader destroyed');if(window.fileExplorer){window.fileExplorer.destroy();window.fileExplorer=null;}}}window.TemplateLoader=TemplateLoader;document.addEventListener('DOMContentLoaded',()=>{console.log('üîß DOM loaded,waiting for editor and FileExplorer...');let attempts=0;const maxAttempts=20;const checkEditor=setInterval(()=>{attempts++;const editor=window.editor;const fileExplorer=typeof FileExplorer!=='undefined';console.log(`üîß Checking for editor and FileExplorer...(attempt ${attempts}/${maxAttempts})`,{editor:!!editor,fileExplorer});if(editor&&editor.getComponents&&fileExplorer){clearInterval(checkEditor);window.templateLoader=new TemplateLoader(editor,{cacheEnabled: true,cacheTimeout: 5*60*1000,showPreview: true,autoSave: true});console.log('üîß Template Loader auto-initialized');}else if(attempts>=maxAttempts){clearInterval(checkEditor);console.error('‚ùå Template Loader failed to initialize: editor or FileExplorer not found after maximum attempts');}},500);});