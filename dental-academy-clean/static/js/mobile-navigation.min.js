class MobileNavigation{constructor(){this.isInitialized=false;this.isDrawerOpen=false;this.init();}init(){if(this.isInitialized)return;this.setupElements();this.setupEventListeners();this.setupTouchGestures();this.isInitialized=true;}setupElements(){this.navToggle=document.getElementById('mobileNavToggle');this.drawer=document.getElementById('mobileDrawer');this.overlay=document.getElementById('mobileDrawerOverlay');this.body=document.body;if(!this.navToggle||!this.drawer||!this.overlay){console.warn('⚠️ Не найдены элементы мобильной навигации');return;}}setupEventListeners(){this.navToggle?.addEventListener('click',()=>this.toggleDrawer());this.overlay?.addEventListener('click',()=>this.closeDrawer());document.addEventListener('keydown',(e)=>{if(e.key==='Escape'&&this.isDrawerOpen){this.closeDrawer();}});this.drawer?.addEventListener('click',(e)=>{const subjectItem=e.target.closest('.subject-item');if(subjectItem){const subjectId=subjectItem.dataset.subject;if(subjectId){this.navigateToSubject(subjectId);this.closeDrawer();}}});this.drawer?.addEventListener('click',(e)=>{const pathButton=e.target.closest('.learning-path-button');if(pathButton){this.togglePathExpansion(pathButton);}});}setupTouchGestures(){let startX=0;let startY=0;let isDragging=false;document.addEventListener('touchstart',(e)=>{if(e.touches.length===1){startX=e.touches[0].clientX;startY=e.touches[0].clientY;isDragging=false;}});document.addEventListener('touchmove',(e)=>{if(e.touches.length===1&&!this.isDrawerOpen){const currentX=e.touches[0].clientX;const currentY=e.touches[0].clientY;const deltaX=currentX-startX;const deltaY=currentY-startY;if(Math.abs(deltaX)>Math.abs(deltaY)&&deltaX>50){isDragging=true;}}});document.addEventListener('touchend',(e)=>{if(isDragging&&!this.isDrawerOpen){this.openDrawer();}isDragging=false;});this.drawer?.addEventListener('touchstart',(e)=>{if(e.touches.length===1){startX=e.touches[0].clientX;startY=e.touches[0].clientY;isDragging=false;}});this.drawer?.addEventListener('touchmove',(e)=>{if(e.touches.length===1&&this.isDrawerOpen){const currentX=e.touches[0].clientX;const currentY=e.touches[0].clientY;const deltaX=currentX-startX;const deltaY=currentY-startY;if(Math.abs(deltaX)>Math.abs(deltaY)&&deltaX<-50){isDragging=true;}}});this.drawer?.addEventListener('touchend',(e)=>{if(isDragging&&this.isDrawerOpen){this.closeDrawer();}isDragging=false;});}toggleDrawer(){if(this.isDrawerOpen){this.closeDrawer();}else{this.openDrawer();}}openDrawer(){if(!this.drawer||!this.overlay||!this.navToggle)return;this.drawer.classList.add('active');this.overlay.classList.add('active');this.navToggle.classList.add('active');this.body.style.overflow='hidden';this.isDrawerOpen=true;this.drawer.style.transform='translateX(0)';}closeDrawer(){if(!this.drawer||!this.overlay||!this.navToggle)return;this.drawer.classList.remove('active');this.overlay.classList.remove('active');this.navToggle.classList.remove('active');this.body.style.overflow='';this.isDrawerOpen=false;this.drawer.style.transform='translateX(-100%)';}togglePathExpansion(button){const pathId=button.dataset.path;const subjectList=document.getElementById(`mobile-path-filter-list-${pathId}`);if(!subjectList)return;const isExpanded=subjectList.classList.contains('expanded');document.querySelectorAll('.subject-list').forEach(list=>{list.classList.remove('expanded');});if(!isExpanded){subjectList.classList.add('expanded');}const chevron=button.querySelector('.chevron-icon');if(chevron){chevron.style.transform=isExpanded ? 'rotate(0deg)' : 'rotate(90deg)';}}navigateToSubject(subjectId){const currentLang=document.documentElement.lang||'nl';const url=`/${currentLang}/learning-map/subject/${subjectId}`;window.location.href=url;}updateProgress(stats){const progressCircle=document.querySelector('.mobile-progress-circle .circle-progress');if(progressCircle&&stats.total_progress!==undefined){const circumference=2*Math.PI*36;const progress=(stats.total_progress/100)*circumference;progressCircle.style.strokeDasharray=`${progress}${circumference}`;}const progressText=document.querySelector('.mobile-progress-text');if(progressText&&stats.total_progress!==undefined){progressText.textContent=`${stats.total_progress}%`;}}}document.addEventListener('DOMContentLoaded',()=>{const isMobile=window.innerWidth<=768;if(isMobile){window.mobileNavigation=new MobileNavigation();}});window.addEventListener('resize',()=>{const isMobile=window.innerWidth<=768;if(isMobile&&!window.mobileNavigation){window.mobileNavigation=new MobileNavigation();}else if(!isMobile&&window.mobileNavigation){window.mobileNavigation.closeDrawer();window.mobileNavigation=null;}});if(typeof module!=='undefined'&&module.exports){module.exports=MobileNavigation;}