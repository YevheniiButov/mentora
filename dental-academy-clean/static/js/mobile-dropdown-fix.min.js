(function(){'use strict';let isInitialized=false;function initMobileDropdowns(){if(isInitialized)return;isInitialized=true;console.log('Initializing mobile dropdown fix...');if(document.readyState==='loading'){document.addEventListener('DOMContentLoaded',initMobileDropdowns);return;}const dropdowns=document.querySelectorAll('.dropdown');console.log('Found dropdowns:',dropdowns.length);dropdowns.forEach((dropdown,index)=>{const toggle=dropdown.querySelector('.dropdown-toggle');const menu=dropdown.querySelector('.dropdown-menu');if(!toggle||!menu){console.log(`Dropdown ${index}: missing toggle or menu`);return;}console.log(`Setting up dropdown ${index}`);setupDropdown(dropdown,toggle,menu);});}function setupDropdown(dropdown,toggle,menu){let isOpen=false;const newToggle=toggle.cloneNode(true);toggle.parentNode.replaceChild(newToggle,toggle);const newMenu=menu.cloneNode(true);menu.parentNode.replaceChild(newMenu,menu);const finalToggle=newToggle;const finalMenu=newMenu;function openDropdown(){console.log('Opening dropdown');isOpen=true;finalMenu.style.display='block';finalMenu.classList.add('show');finalToggle.classList.add('show');finalToggle.setAttribute('aria-expanded','true');positionDropdown(finalMenu,finalToggle);}function closeDropdown(){console.log('Closing dropdown');isOpen=false;finalMenu.style.display='none';finalMenu.classList.remove('show');finalToggle.classList.remove('show');finalToggle.setAttribute('aria-expanded','false');}finalToggle.addEventListener('click',function(e){e.preventDefault();e.stopPropagation();console.log('Toggle clicked,isOpen:',isOpen);if(isOpen){closeDropdown();}else{closeAllDropdowns();openDropdown();}});const menuItems=finalMenu.querySelectorAll('.dropdown-item,a,button');menuItems.forEach(item=>{item.addEventListener('click',function(e){console.log('Menu item clicked:',item.textContent);e.stopPropagation();if(item.href&&item.href!=='#'){window.location.href=item.href;return;}if(item.onclick){item.onclick();return;}const action=item.getAttribute('data-action');if(action){handleMenuAction(action,item);return;}closeDropdown();});});document.addEventListener('click',function(e){if(!dropdown.contains(e.target)){closeDropdown();}});window.addEventListener('scroll',closeDropdown);window.addEventListener('orientationchange',function(){setTimeout(closeDropdown,100);});}function positionDropdown(menu,toggle){const toggleRect=toggle.getBoundingClientRect();const menuRect=menu.getBoundingClientRect();const viewportHeight=window.innerHeight;const viewportWidth=window.innerWidth;menu.style.position='fixed';menu.style.top='auto';menu.style.left='auto';menu.style.right='auto';menu.style.bottom='auto';menu.style.transform='none';menu.style.zIndex='1050';const spaceBelow=viewportHeight-toggleRect.bottom;const spaceAbove=toggleRect.top;if(spaceBelow>=200||spaceBelow>=spaceAbove){menu.style.top=`${toggleRect.bottom+5}px`;}else{menu.style.bottom=`${viewportHeight-toggleRect.top+5}px`;}const spaceRight=viewportWidth-toggleRect.left;if(spaceRight>=200){menu.style.left=`${toggleRect.left}px`;}else{menu.style.right=`${viewportWidth-toggleRect.right}px`;}menu.style.maxWidth=`${Math.min(300,viewportWidth-20)}px`;menu.style.maxHeight=`${Math.min(400,viewportHeight*0.6)}px`;menu.style.overflowY='auto';}function closeAllDropdowns(){const allMenus=document.querySelectorAll('.dropdown-menu.show');allMenus.forEach(menu=>{menu.style.display='none';menu.classList.remove('show');});const allToggles=document.querySelectorAll('.dropdown-toggle.show');allToggles.forEach(toggle=>{toggle.classList.remove('show');toggle.setAttribute('aria-expanded','false');});}function handleMenuAction(action,element){console.log('Handling menu action:',action);switch(action){case 'logout': if(confirm('Are you sure you want to logout?')){window.location.href='/auth/logout';}break;case 'profile': window.location.href='/profile';break;case 'settings': window.location.href='/settings';break;case 'language': const lang=element.getAttribute('data-lang');if(lang){window.location.href=`/?lang=${lang}`;}break;default: console.log('Unknown action:',action);}}initMobileDropdowns();window.addEventListener('resize',function(){setTimeout(initMobileDropdowns,100);});window.MobileDropdownFix={init: initMobileDropdowns,closeAll: closeAllDropdowns};})();