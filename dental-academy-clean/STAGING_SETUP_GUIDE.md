# üöÄ STAGING ENVIRONMENT SETUP GUIDE

## **–ü–æ–ª–Ω–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ staging environment –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ–≥–æ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è IRT —Å–∏—Å—Ç–µ–º—ã**

---

## **üìã –ß–¢–û –°–û–ó–î–ê–ù–û:**

### **1. –û—Å–Ω–æ–≤–Ω—ã–µ —Å–∫—Ä–∏–ø—Ç—ã:**
- ‚úÖ `setup_staging.py` - –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ staging environment
- ‚úÖ `backup_production.py` - —Å–æ–∑–¥–∞–Ω–∏–µ –±—ç–∫–∞–ø–∞ –ø—Ä–æ–¥–∞–∫—à–Ω –ë–î
- ‚úÖ `safe_migration.py` - –±–µ–∑–æ–ø–∞—Å–Ω–∞—è –º–∏–≥—Ä–∞—Ü–∏—è —Å rollback
- ‚úÖ `monitoring_system.py` - —Å–∏—Å—Ç–µ–º–∞ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞
- ‚úÖ `feature_flags.py` - —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ feature flags

### **2. –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ–∑–¥–∞–≤–∞–µ–º—ã–µ —Ñ–∞–π–ª—ã:**
- ‚úÖ `.env.staging` - –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è staging
- ‚úÖ `run_staging.sh` - –∑–∞–ø—É—Å–∫ staging —Å–µ—Ä–≤–µ—Ä–∞
- ‚úÖ `test_irt_staging.py` - —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ IRT —Å–∏—Å—Ç–µ–º—ã
- ‚úÖ `health_check.py` - –ø—Ä–æ–≤–µ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤—å—è —Å–∏—Å—Ç–µ–º—ã
- ‚úÖ `migration_plan.json` - –ø–ª–∞–Ω –º–∏–≥—Ä–∞—Ü–∏–∏

---

## **üöÄ –ë–´–°–¢–†–´–ô –°–¢–ê–†–¢:**

### **–®–∞–≥ 1: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ staging environment**
```bash
python3 setup_staging.py
```

### **–®–∞–≥ 2: –°–æ–∑–¥–∞–Ω–∏–µ –±—ç–∫–∞–ø–∞ –ø—Ä–æ–¥–∞–∫—à–Ω –ë–î**
```bash
python3 backup_production.py
```

### **–®–∞–≥ 3: –ó–∞–ø—É—Å–∫ staging —Å–µ—Ä–≤–µ—Ä–∞**
```bash
./run_staging.sh
```

### **–®–∞–≥ 4: –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ IRT —Å–∏—Å—Ç–µ–º—ã**
```bash
./test_irt_staging.py
```

### **–®–∞–≥ 5: –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤—å—è —Å–∏—Å—Ç–µ–º—ã**
```bash
./health_check.py
```

---

## **üîß –î–ï–¢–ê–õ–¨–ù–ê–Ø –ò–ù–°–¢–†–£–ö–¶–ò–Ø:**

### **1. –ü–û–î–ì–û–¢–û–í–ö–ê STAGING ENVIRONMENT**

#### **A. –ó–∞–ø—É—Å–∫ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏:**
```bash
python3 setup_staging.py
```

**–ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç:**
- –°–æ–∑–¥–∞–µ—Ç—Å—è `.env.staging` —Å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–µ–π
- –°–æ–∑–¥–∞–µ—Ç—Å—è –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—è `staging/`
- –ö–æ–ø–∏—Ä—É–µ—Ç—Å—è –ø—Ä–æ–¥–∞–∫—à–Ω –ë–î –≤ staging
- –°–æ–∑–¥–∞—é—Ç—Å—è —Å–∫—Ä–∏–ø—Ç—ã –¥–ª—è —Ä–∞–±–æ—Ç—ã

#### **B. –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏:**
```bash
ls -la staging/
ls -la .env.staging
ls -la run_staging.sh
```

### **2. –°–û–ó–î–ê–ù–ò–ï –ë–≠–ö–ê–ü–ê –ü–†–û–î–ê–ö–®–ù –ë–î**

#### **A. –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –±—ç–∫–∞–ø:**
```bash
python3 backup_production.py
```

**–ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç:**
- –°–æ–∑–¥–∞–µ—Ç—Å—è –ø–æ–ª–Ω—ã–π –±—ç–∫–∞–ø –ø—Ä–æ–¥–∞–∫—à–Ω –ë–î
- –°–æ–∑–¥–∞–µ—Ç—Å—è –∫–æ–ø–∏—è –¥–ª—è staging
- –°–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ –±—ç–∫–∞–ø–∞
- –ü—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è —Ü–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç—å

#### **B. –†—É—á–Ω–æ–π –±—ç–∫–∞–ø (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ):**
```bash
# –î–ª—è SQLite
cp instance/app.db backups/production_backup_$(date +%Y%m%d_%H%M%S).db

# –î–ª—è PostgreSQL
pg_dump $DATABASE_URL > backups/production_backup_$(date +%Y%m%d_%H%M%S).sql
```

### **3. –ó–ê–ü–£–°–ö STAGING –°–ï–†–í–ï–†–ê**

#### **A. –ó–∞–ø—É—Å–∫ staging:**
```bash
./run_staging.sh
```

**–ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç:**
- –ó–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è staging –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
- –ó–∞–ø—É—Å–∫–∞–µ—Ç—Å—è —Å–µ—Ä–≤–µ—Ä –≤ staging —Ä–µ–∂–∏–º–µ
- –í–∫–ª—é—á–∞–µ—Ç—Å—è debug —Ä–µ–∂–∏–º
- –ê–∫—Ç–∏–≤–∏—Ä—É—é—Ç—Å—è feature flags

#### **B. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç—ã:**
```bash
curl http://localhost:5000/health
```

### **4. –¢–ï–°–¢–ò–†–û–í–ê–ù–ò–ï IRT –°–ò–°–¢–ï–ú–´**

#### **A. –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤:**
```bash
./test_irt_staging.py
```

**–ß—Ç–æ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è:**
- –î–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å IRT –º–æ–¥–µ–ª–µ–π
- –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö
- –†–∞–±–æ—Ç–∞ scipy –∏ numpy
- –¶–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç—å –¥–∞–Ω–Ω—ã—Ö

#### **B. –†—É—á–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ:**
```bash
python3 -c "
from app import app
from models import IRTParameters, DiagnosticSession
print('‚úÖ IRT models imported successfully')
"
```

### **5. –ú–û–ù–ò–¢–û–†–ò–ù–ì –°–ò–°–¢–ï–ú–´**

#### **A. –û–¥–Ω–æ–∫—Ä–∞—Ç–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞:**
```bash
./health_check.py
```

#### **B. –ù–µ–ø—Ä–µ—Ä—ã–≤–Ω—ã–π –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥:**
```bash
python3 monitoring_system.py --continuous --interval 60
```

**–ß—Ç–æ –º–æ–Ω–∏—Ç–æ—Ä–∏—Ç—Å—è:**
- –ó–¥–æ—Ä–æ–≤—å–µ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
- –î–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å IRT –º–æ–¥–µ–ª–µ–π
- –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å —Å–∏—Å—Ç–µ–º—ã
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ø–∞–º—è—Ç–∏
- API endpoints

---

## **üîÑ –ë–ï–ó–û–ü–ê–°–ù–ê–Ø –ú–ò–ì–†–ê–¶–ò–Ø:**

### **1. –ê–í–¢–û–ú–ê–¢–ò–ß–ï–°–ö–ê–Ø –ú–ò–ì–†–ê–¶–ò–Ø:**
```bash
python3 safe_migration.py
```

**–ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç:**
1. –°–æ–∑–¥–∞–µ—Ç—Å—è –±—ç–∫–∞–ø –ë–î
2. –î–æ–±–∞–≤–ª—è—é—Ç—Å—è IRT –º–æ–¥–µ–ª–∏
3. –ó–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –º–∏–≥—Ä–∞—Ü–∏—è —Å–ø–µ—Ü–∏–∞–ª—å–Ω–æ—Å—Ç–µ–π
4. –í–∫–ª—é—á–∞—é—Ç—Å—è IRT —Ñ—É–Ω–∫—Ü–∏–∏
5. –¢–µ—Å—Ç–∏—Ä—É–µ—Ç—Å—è —Å–∏—Å—Ç–µ–º–∞
6. –ü—Ä–∏ –æ—à–∏–±–∫–µ - –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π rollback

### **2. –†–£–ß–ù–ê–Ø –ú–ò–ì–†–ê–¶–ò–Ø (–ø–æ—à–∞–≥–æ–≤–æ):**

#### **–®–∞–≥ 1: –ë—ç–∫–∞–ø**
```bash
python3 backup_production.py
```

#### **–®–∞–≥ 2: –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –º–æ–¥–µ–ª–µ–π**
```bash
# –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –º–æ–¥–µ–ª–∏ –µ—Å—Ç—å –≤ models.py
grep -n "class IRTParameters" models.py
```

#### **–®–∞–≥ 3: –ú–∏–≥—Ä–∞—Ü–∏—è —Å–ø–µ—Ü–∏–∞–ª—å–Ω–æ—Å—Ç–µ–π**
```bash
python3 specialty_migration.py
```

#### **–®–∞–≥ 4: –í–∫–ª—é—á–µ–Ω–∏–µ feature flags**
```bash
python3 feature_flags.py --enable-irt
```

#### **–®–∞–≥ 5: –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ**
```bash
./test_irt_staging.py
```

---

## **üéõÔ∏è –£–ü–†–ê–í–õ–ï–ù–ò–ï FEATURE FLAGS:**

### **1. –ü—Ä–æ—Å–º–æ—Ç—Ä —Å—Ç–∞—Ç—É—Å–∞:**
```bash
python3 feature_flags.py --status
```

### **2. –í–∫–ª—é—á–µ–Ω–∏–µ IRT —Å–∏—Å—Ç–µ–º—ã:**
```bash
python3 feature_flags.py --enable-irt
```

### **3. –í–∫–ª—é—á–µ–Ω–∏–µ –ø–∏–ª–æ—Ç–Ω–æ–≥–æ —Ä–µ–∂–∏–º–∞:**
```bash
python3 feature_flags.py --pilot-mode
```

### **4. –û—Ç–∫–ª—é—á–µ–Ω–∏–µ IRT —Å–∏—Å—Ç–µ–º—ã:**
```bash
python3 feature_flags.py --disable-irt
```

### **5. –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –æ—Ç–¥–µ–ª—å–Ω—ã–º–∏ —Ñ–ª–∞–≥–∞–º–∏:**
```bash
python3 feature_flags.py --enable irt_dentists
python3 feature_flags.py --disable irt_general_practitioners
```

---

## **üìä –ú–û–ù–ò–¢–û–†–ò–ù–ì –ò –û–¢–ß–ï–¢–´:**

### **1. Health Reports:**
```bash
# –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ–∑–¥–∞—é—Ç—Å—è –≤:
ls -la health_report_*.json
```

### **2. Migration Logs:**
```bash
# –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ–∑–¥–∞—é—Ç—Å—è –≤:
ls -la migration_log_*.json
```

### **3. Backup Metadata:**
```bash
# –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ–∑–¥–∞—é—Ç—Å—è –≤:
ls -la backups/backup_metadata_*.json
```

---

## **‚ö†Ô∏è –ë–ï–ó–û–ü–ê–°–ù–û–°–¢–¨ –ò –û–¢–ö–ê–¢:**

### **1. –ê–í–¢–û–ú–ê–¢–ò–ß–ï–°–ö–ò–ô –û–¢–ö–ê–¢:**
- –ü—Ä–∏ –ª—é–±–æ–π –æ—à–∏–±–∫–µ –º–∏–≥—Ä–∞—Ü–∏–∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è rollback
- –í—Å–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –æ—Ç–∫–∞—Ç—ã–≤–∞—é—Ç—Å—è –∫ –ø—Ä–µ–¥—ã–¥—É—â–µ–º—É —Å–æ—Å—Ç–æ—è–Ω–∏—é
- –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è –±—ç–∫–∞–ø –ë–î

### **2. –†–£–ß–ù–û–ô –û–¢–ö–ê–¢:**
```bash
# –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–∑ –±—ç–∫–∞–ø–∞
python3 restore_from_backup.py backups/production_backup_YYYYMMDD_HHMMSS.db

# –û—Ç–∫–ª—é—á–µ–Ω–∏–µ IRT —Å–∏—Å—Ç–µ–º—ã
python3 feature_flags.py --disable-irt
```

### **3. –ü–†–û–í–ï–†–ö–ê –¶–ï–õ–û–°–¢–ù–û–°–¢–ò:**
```bash
# –ü–æ—Å–ª–µ –∫–∞–∂–¥–æ–≥–æ —à–∞–≥–∞
./health_check.py
```

---

## **üéØ –ü–õ–ê–ù –†–ê–ó–í–ï–†–¢–´–í–ê–ù–ò–Ø –ù–ê –ü–†–û–î–ê–ö–®–ï–ù–ï:**

### **–≠—Ç–∞–ø 1: –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ (1 –¥–µ–Ω—å)**
1. ‚úÖ –ù–∞—Å—Ç—Ä–æ–∏—Ç—å staging environment
2. ‚úÖ –°–æ–∑–¥–∞—Ç—å –±—ç–∫–∞–ø –ø—Ä–æ–¥–∞–∫—à–Ω –ë–î
3. ‚úÖ –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –≤—Å–µ –Ω–∞ staging

### **–≠—Ç–∞–ø 2: –ú–∏–≥—Ä–∞—Ü–∏—è (1 –¥–µ–Ω—å)**
1. ‚úÖ –ó–∞–ø—É—Å—Ç–∏—Ç—å –±–µ–∑–æ–ø–∞—Å–Ω—É—é –º–∏–≥—Ä–∞—Ü–∏—é
2. ‚úÖ –í–∫–ª—é—á–∏—Ç—å feature flags
3. ‚úÖ –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å —Å–∏—Å—Ç–µ–º—É

### **–≠—Ç–∞–ø 3: –ê–∫—Ç–∏–≤–∞—Ü–∏—è (1 –¥–µ–Ω—å)**
1. ‚úÖ –í–∫–ª—é—á–∏—Ç—å IRT –¥–ª—è —Å—Ç–æ–º–∞—Ç–æ–ª–æ–≥–æ–≤
2. ‚úÖ –ú–æ–Ω–∏—Ç–æ—Ä–∏—Ç—å –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å
3. ‚úÖ –°–æ–±—Ä–∞—Ç—å –ø–µ—Ä–≤—ã–µ –º–µ—Ç—Ä–∏–∫–∏

### **–≠—Ç–∞–ø 4: –†–∞—Å—à–∏—Ä–µ–Ω–∏–µ (–ø–æ –º–µ—Ä–µ –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏)**
1. ‚úÖ –í–∫–ª—é—á–∏—Ç—å IRT –¥–ª—è –≤—Ä–∞—á–µ–π –æ–±—â–µ–π –ø—Ä–∞–∫—Ç–∏–∫–∏
2. ‚úÖ –ê–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å –∫–∞–ª–∏–±—Ä–æ–≤–∫—É
3. ‚úÖ –í–∫–ª—é—á–∏—Ç—å –∞–Ω–∞–ª–∏—Ç–∏–∫—É

---

## **üö® –≠–ö–°–¢–†–ï–ù–ù–´–ï –°–ò–¢–£–ê–¶–ò–ò:**

### **1. –ü–†–û–ë–õ–ï–ú–´ –° –ë–ê–ó–û–ô –î–ê–ù–ù–´–•:**
```bash
# –ù–µ–º–µ–¥–ª–µ–Ω–Ω—ã–π –æ—Ç–∫–∞—Ç
python3 restore_from_backup.py [backup_file]
```

### **2. –ü–†–û–ë–õ–ï–ú–´ –° –ü–†–û–ò–ó–í–û–î–ò–¢–ï–õ–¨–ù–û–°–¢–¨–Æ:**
```bash
# –û—Ç–∫–ª—é—á–µ–Ω–∏–µ IRT —Å–∏—Å—Ç–µ–º—ã
python3 feature_flags.py --disable-irt
```

### **3. –û–®–ò–ë–ö–ò –í –°–ò–°–¢–ï–ú–ï:**
```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤—å—è
./health_check.py

# –ù–µ–ø—Ä–µ—Ä—ã–≤–Ω—ã–π –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥
python3 monitoring_system.py --continuous
```

---

## **üìû –ü–û–î–î–ï–†–ñ–ö–ê:**

### **–õ–æ–≥–∏ –∏ –æ—Ç—á–µ—Ç—ã:**
- `health_report_*.json` - –æ—Ç—á–µ—Ç—ã –æ –∑–¥–æ—Ä–æ–≤—å–µ —Å–∏—Å—Ç–µ–º—ã
- `migration_log_*.json` - –ª–æ–≥–∏ –º–∏–≥—Ä–∞—Ü–∏–∏
- `backup_metadata_*.json` - –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ –±—ç–∫–∞–ø–æ–≤

### **–ü–æ–ª–µ–∑–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã:**
```bash
# –°—Ç–∞—Ç—É—Å —Å–∏—Å—Ç–µ–º—ã
python3 feature_flags.py --status

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤—å—è
./health_check.py

# –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥
python3 monitoring_system.py --continuous

# –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
./test_irt_staging.py
```

---

## **üéâ –ì–û–¢–û–í–û –ö –†–ê–ó–í–ï–†–¢–´–í–ê–ù–ò–Æ!**

**Staging environment –Ω–∞—Å—Ç—Ä–æ–µ–Ω –∏ –≥–æ—Ç–æ–≤ –∫ –±–µ–∑–æ–ø–∞—Å–Ω–æ–º—É —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—é IRT —Å–∏—Å—Ç–µ–º—ã –Ω–∞ –ø—Ä–æ–¥–∞–∫—à–µ–Ω–µ!**

**–°–ª–µ–¥—É—é—â–∏–π —à–∞–≥:** –ó–∞–ø—É—Å—Ç–∏—Ç—å `python3 setup_staging.py` –∏ —Å–ª–µ–¥–æ–≤–∞—Ç—å –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è–º! üöÄ
