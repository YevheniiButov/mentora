# üîß –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –æ—à–∏–±–∫–∏ —É–¥–∞–ª–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

## üö® **–ü—Ä–æ–±–ª–µ–º—ã:**

### **1. –ü–µ—Ä–≤–∞—è –ø—Ä–æ–±–ª–µ–º–∞ (PostgreSQL):**
```
(psycopg2.errors.ForeignKeyViolation) update or delete on table "user" violates foreign key constraint "registration_visitors_user_id_fkey" on table "registration_visitors"
```

### **2. –í—Ç–æ—Ä–∞—è –ø—Ä–æ–±–ª–µ–º–∞ (SQLite):**
```
(psycopg2.errors.NotNullViolation) null value in column "author_id" of relation "forum_posts" violates not-null constraint
```

**–ü—Ä–∏—á–∏–Ω–∞:** 
- –í –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö –Ω–∞—Å—Ç—Ä–æ–µ–Ω–æ `ON DELETE SET NULL` –≤–º–µ—Å—Ç–æ `ON DELETE CASCADE`
- –ü–æ–ª–µ `author_id` –≤ —Ç–∞–±–ª–∏—Ü–µ `forum_posts` –Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å `NULL`
- –ü—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —Å–∏—Å—Ç–µ–º–∞ –ø—ã—Ç–∞–µ—Ç—Å—è –æ–±–Ω—É–ª–∏—Ç—å –≤–Ω–µ—à–Ω–∏–π –∫–ª—é—á, —á—Ç–æ –Ω–∞—Ä—É—à–∞–µ—Ç –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ `NOT NULL`

## ‚úÖ **–†–µ—à–µ–Ω–∏—è:**

### **1. –ù–µ–º–µ–¥–ª–µ–Ω–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ - –ë–µ–∑–æ–ø–∞—Å–Ω–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ**

–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Å–∫—Ä–∏–ø—Ç `delete_user_safely.py` –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —Å –æ—á–∏—Å—Ç–∫–æ–π —Å–≤—è–∑–∞–Ω–Ω—ã—Ö –∑–∞–ø–∏—Å–µ–π:

```bash
# –ü–æ–∫–∞–∑–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π —Å –¥–∞–Ω–Ω—ã–º–∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏
python3 delete_user_safely.py list

# –£–¥–∞–ª–∏—Ç—å –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
python3 delete_user_safely.py 70
```

**–ß—Ç–æ –¥–µ–ª–∞–µ—Ç —Å–∫—Ä–∏–ø—Ç:**
1. ‚úÖ –ù–∞—Ö–æ–¥–∏—Ç –≤—Å–µ –∑–∞–ø–∏—Å–∏ –≤ `registration_visitors` —Å `user_id = 70`
2. ‚úÖ –£–¥–∞–ª—è–µ—Ç –ø–æ—Å—Ç—ã —Ñ–æ—Ä—É–º–∞ (`forum_posts`)
3. ‚úÖ –£–¥–∞–ª—è–µ—Ç –ª–∞–π–∫–∏ –ø–æ—Å—Ç–æ–≤ –∏ —Ç–µ–º (`forum_post_likes`, `forum_topic_likes`)
4. ‚úÖ –£–¥–∞–ª—è–µ—Ç —Ç–µ–º—ã —Ñ–æ—Ä—É–º–∞ (`forum_topics`)
5. ‚úÖ –£–¥–∞–ª—è–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç–µ—Å—Ç–æ–≤ (`test_results`)
6. ‚úÖ –£–¥–∞–ª—è–µ—Ç —Å–µ—Å—Å–∏–∏ —Ç–µ—Å—Ç–æ–≤ (`test_sessions`)
7. ‚úÖ –£–¥–∞–ª—è–µ—Ç –ª–æ–≥–∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ (`registration_logs`)
8. ‚úÖ –£–¥–∞–ª—è–µ—Ç –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (`user_activity`)
9. ‚úÖ –£–¥–∞–ª—è–µ—Ç –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è (`user_achievement`)
10. ‚úÖ –£–¥–∞–ª—è–µ—Ç –ø—Ä–æ–≥—Ä–µ—Å—Å –æ–±—É—á–µ–Ω–∏—è (`user_progress`)
11. ‚úÖ –£–¥–∞–ª—è–µ—Ç —Å–∞–º–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
12. ‚úÖ –°–æ—Ö—Ä–∞–Ω—è–µ—Ç –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö

### **2. –î–æ–ª–≥–æ—Å—Ä–æ—á–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ - –ö–∞—Å–∫–∞–¥–Ω–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ**

–ù–∞—Å—Ç—Ä–æ–π—Ç–µ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –∫–∞—Å–∫–∞–¥–Ω–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ –¥–ª—è –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏—è –ø–æ–¥–æ–±–Ω—ã—Ö –æ—à–∏–±–æ–∫ –≤ –±—É–¥—É—â–µ–º:

```bash
# –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –∫–∞—Å–∫–∞–¥–Ω–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ
python3 fix_user_deletion_constraints.py

# –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –∫–∞—Å–∫–∞–¥–Ω–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ
python3 fix_user_deletion_constraints.py test
```

**–ß—Ç–æ –¥–µ–ª–∞–µ—Ç —Å–∫—Ä–∏–ø—Ç:**
1. ‚úÖ –£–¥–∞–ª—è–µ—Ç —Å—Ç–∞—Ä–æ–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –≤–Ω–µ—à–Ω–µ–≥–æ –∫–ª—é—á–∞
2. ‚úÖ –°–æ–∑–¥–∞–µ—Ç –Ω–æ–≤–æ–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ —Å `ON DELETE CASCADE`
3. ‚úÖ –ü—Ä–∏–º–µ–Ω—è–µ—Ç –∫–æ –≤—Å–µ–º —Ç–∞–±–ª–∏—Ü–∞–º —Å –≤–Ω–µ—à–Ω–∏–º–∏ –∫–ª—é—á–∞–º–∏ –Ω–∞ `user.id`
4. ‚úÖ –¢–µ—Å—Ç–∏—Ä—É–µ—Ç —Ä–∞–±–æ—Ç—É –∫–∞—Å–∫–∞–¥–Ω–æ–≥–æ —É–¥–∞–ª–µ–Ω–∏—è

## üìä **–°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Å–≤—è–∑–∏:**

```
user (id) 
  ‚Üì
registration_visitors (user_id) ‚Üê –°—Å—ã–ª–∞–µ—Ç—Å—è –Ω–∞ user.id
```

**–î–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:**
- –ü—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è ‚Üí –û—à–∏–±–∫–∞ ForeignKeyViolation
- –ù—É–∂–Ω–æ –≤—Ä—É—á–Ω—É—é —É–¥–∞–ª—è—Ç—å —Å–≤—è–∑–∞–Ω–Ω—ã–µ –∑–∞–ø–∏—Å–∏

**–ü–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:**
- –ü—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è ‚Üí –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —É–¥–∞–ª—è—é—Ç—Å—è –≤—Å–µ —Å–≤—è–∑–∞–Ω–Ω—ã–µ –∑–∞–ø–∏—Å–∏
- –ù–∏–∫–∞–∫–∏—Ö –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö –¥–µ–π—Å—Ç–≤–∏–π –Ω–µ —Ç—Ä–µ–±—É–µ—Ç—Å—è

## üîç **–ü—Ä–æ–≤–µ—Ä–∫–∞:**

–ü–æ—Å–ª–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –∫–∞—Å–∫–∞–¥–Ω–æ–≥–æ —É–¥–∞–ª–µ–Ω–∏—è –º–æ–∂–Ω–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è:

```sql
-- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –≤–Ω–µ—à–Ω–∏—Ö –∫–ª—é—á–µ–π
SELECT 
    tc.table_name, 
    kcu.column_name, 
    ccu.table_name AS foreign_table_name,
    tc.constraint_name
FROM 
    information_schema.table_constraints AS tc 
    JOIN information_schema.key_column_usage AS kcu
      ON tc.constraint_name = kcu.constraint_name
    JOIN information_schema.constraint_column_usage AS ccu
      ON ccu.constraint_name = tc.constraint_name
WHERE tc.constraint_type = 'FOREIGN KEY' 
AND ccu.table_name = 'user'
AND ccu.column_name = 'id';
```

## ‚ö†Ô∏è **–í–∞–∂–Ω–æ:**

1. **–†–µ–∑–µ—Ä–≤–Ω–æ–µ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ:** –í—Å–µ–≥–¥–∞ –¥–µ–ª–∞–π—Ç–µ –±—ç–∫–∞–ø –ø–µ—Ä–µ–¥ –º–∞—Å—Å–æ–≤—ã–º–∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è–º–∏
2. **–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ:** –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä—É–π—Ç–µ –∫–∞—Å–∫–∞–¥–Ω–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ –Ω–∞ —Ç–µ—Å—Ç–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö
3. **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥:** –°–ª–µ–¥–∏—Ç–µ –∑–∞ –ª–æ–≥–∞–º–∏ –ø–æ—Å–ª–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π

## üéØ **–†–µ–∑—É–ª—å—Ç–∞—Ç:**

- ‚úÖ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å ID 70 –±—É–¥–µ—Ç —É–¥–∞–ª–µ–Ω –±–µ–∑–æ–ø–∞—Å–Ω–æ
- ‚úÖ –í—Å–µ —Å–≤—è–∑–∞–Ω–Ω—ã–µ –∑–∞–ø–∏—Å–∏ –±—É–¥—É—Ç –æ—á–∏—â–µ–Ω—ã
- ‚úÖ –í –±—É–¥—É—â–µ–º —É–¥–∞–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –±—É–¥–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
- ‚úÖ –ù–∏–∫–∞–∫–∏—Ö –æ—à–∏–±–æ–∫ ForeignKeyViolation –±–æ–ª—å—à–µ –Ω–µ –±—É–¥–µ—Ç
