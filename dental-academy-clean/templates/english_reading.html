<!DOCTYPE html>
<html lang="{{ lang or 'en' }}">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>English Reading Practice - IELTS Academic Reading</title>
    
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    
    <!-- Bootstrap Icons -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css">
    
    <!-- Custom Styles -->
    <link rel="stylesheet" href="{{ url_for('static', filename='css/english-reading.css') }}">
    
</head>
<body>
<!-- Exit Button -->
<div class="exit-button-container">
    <button class="btn-exit" id="exitButton" onclick="goToLearningMap()" aria-label="Close">
        <i class="bi bi-x-lg"></i>
        <span id="exitButtonText">Back to Learning Map</span>
    </button>
</div>

<div class="english-reading-container">
    <div class="reading-header">
        <h1>IELTS Academic Reading</h1>
        <div class="timer" id="timer">00:00</div>
    </div>
    
    <div class="reading-content">
        <!-- Passage text -->
        <div class="passage-section">
            <h2 id="passageTitle" {% if passage %}data-passage-id="{{ passage.id }}"{% endif %}>{{ passage.title if passage else 'Loading...' }}</h2>
            {% if passage and passage.image_url %}
            <img src="{{ passage.image_url }}" alt="{{ passage.title }}" class="passage-image" id="passageImage">
            {% endif %}
            <div class="passage-text" id="passageText">{{ passage.text|safe if passage else 'Loading passage...' }}</div>
        </div>
        
        <!-- Questions -->
        <div class="questions-section">
            <h3>Questions</h3>
            <div id="questionsContainer"></div>
            
            <button class="btn-submit" id="submitBtn">Submit Answers</button>
        </div>
    </div>
    
    <!-- Results modal -->
    <div class="results-modal" id="resultsModal" style="display: none;">
        <div class="modal-content">
            <h2>Your Results</h2>
            <div id="resultsContent"></div>
            <button class="btn-submit" onclick="goToLearningMap()" style="margin-top: 20px;">Back to Learning Map</button>
        </div>
    </div>
</div>

<script src="{{ url_for('static', filename='js/english_reading.js') }}"></script>
<script>
    // Set passage ID for JavaScript
    {% if passage %}
    window.passageId = {{ passage.id }};
    {% else %}
    window.passageId = null;
    {% endif %}
    
    // Get language from template
    const lang = '{{ lang|default("en") }}';
    
    // Function to go back to learning map with saved tab
    function goToLearningMap() {
        // Get saved tab from localStorage (from learning map)
        const savedTab = localStorage.getItem('learningMapActiveTab') || 'individual';
        const validTabs = ['irt', 'premium', 'individual', 'games', 'progress', 'planner'];
        const tab = validTabs.includes(savedTab) ? savedTab : 'individual';
        
        // Redirect to learning map with saved tab
        window.location.href = `/${lang}/learning-map?tab=${tab}`;
    }
</script>
</body>
</html>
