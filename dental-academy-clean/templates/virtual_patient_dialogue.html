<!DOCTYPE html>
<html lang="nl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Virtual Patient - Daily Learning</title>
    
    <!-- Favicon -->
    <link rel="icon" href="{{ url_for('static', filename='favicon.ico') }}" />
    <link rel="icon" type="image/png" href="{{ url_for('static', filename='favicon.png') }}" />
    <link rel="apple-touch-icon" href="{{ url_for('static', filename='images/favicon.png') }}">
    
    <link rel="stylesheet" href="{{ url_for('static', filename='css/vp-medical-pro.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/vp-enhanced.css') }}">
    
    <style>
        :root {
            --bg-primary: #ffffff;
            --bg-secondary: #f8fafc;
            --text-primary: #1f2937;
            --text-secondary: #6b7280;
            --border-color: #e5e7eb;
            --card-bg: #ffffff;
            --shadow-color: rgba(0, 0, 0, 0.1);
        }
        
        [data-theme="dark"] {
            --bg-primary: #1a1a2e;
            --bg-secondary: #16213e;
            --text-primary: #f1f5f9;
            --text-secondary: #cbd5e1;
            --border-color: #334155;
            --card-bg: #1e293b;
            --shadow-color: rgba(0, 0, 0, 0.5);
        }
        
        @media (prefers-color-scheme: dark) {
            :root:not([data-theme]),
            :root[data-theme=""] {
                --bg-primary: #1a1a2e;
                --bg-secondary: #16213e;
                --text-primary: #f1f5f9;
                --text-secondary: #cbd5e1;
                --border-color: #334155;
                --card-bg: #1e293b;
                --shadow-color: rgba(0, 0, 0, 0.5);
            }
        }
        
        body {
            background: var(--bg-primary);
            color: var(--text-primary);
            transition: background 0.3s, color 0.3s;
        }
        
        .vp-container {
            background: var(--bg-primary);
        }
        
        .text-muted {
            color: var(--text-secondary) !important;
        }
        
        /* VP Dark Mode Overrides */
        [data-theme="dark"] .vp-container,
        [data-theme="dark"] .vp-interface,
        [data-theme="dark"] .vp-dialogue-area,
        [data-theme="dark"] .dialogue-thread {
            background: var(--bg-primary) !important;
        }
        
        [data-theme="dark"] .vp-progress-header,
        [data-theme="dark"] .patient-card,
        [data-theme="dark"] .interaction-area {
            background: var(--card-bg) !important;
            border-color: var(--border-color) !important;
        }
        
        [data-theme="dark"] .dialogue-message.from-patient .message-content {
            background: var(--bg-secondary) !important;
            color: var(--text-primary) !important;
        }
        
        [data-theme="dark"] .patient-name,
        [data-theme="dark"] .patient-meta,
        [data-theme="dark"] .toggle-label,
        [data-theme="dark"] .detail-content,
        [data-theme="dark"] .progress-text,
        [data-theme="dark"] .progress-time {
            color: var(--text-primary) !important;
        }
        
        [data-theme="dark"] .detail-section,
        [data-theme="dark"] .allergy-tag,
        [data-theme="dark"] .vital-item {
            background: var(--bg-secondary) !important;
            border-color: var(--border-color) !important;
            color: var(--text-primary) !important;
        }
        
        [data-theme="dark"] .option-button,
        [data-theme="dark"] .btn-primary,
        [data-theme="dark"] .btn-secondary {
            background: var(--card-bg) !important;
            border-color: var(--border-color) !important;
            color: var(--text-primary) !important;
        }
        
        [data-theme="dark"] .option-button:hover,
        [data-theme="dark"] .btn-primary:hover {
            background: var(--bg-secondary) !important;
        }
    </style>
</head>
<body>
    <div class="vp-container" id="vpContainer">
        
        <!-- LOADING STATE -->
        <div class="vp-loading" id="vpLoading">
            <div class="loading-spinner"></div>
            <p class="text-muted">Pati√´nt wordt geladen...</p>
        </div>
        
        <!-- MAIN INTERFACE (hidden until loaded) -->
        <div class="vp-interface" id="vpInterface" style="display: none;">
            
            <!-- TOP PROGRESS BAR -->
            <div class="vp-progress-header">
                <div class="progress-bar">
                    <div class="progress-fill" id="progressFill" style="width: 0%"></div>
                </div>
                <div class="progress-info">
                    <button class="btn-menu-toggle show-mobile" id="menuToggleBtn" aria-label="Patient info" title="Patient info" style="display: none;"></button>
                    <span class="progress-text">Stap <span id="currentStep">1</span> van <span id="totalSteps">12</span></span>
                    <span class="progress-time">
                        <span id="timeSpent">00:00</span>
                        <span class="text-xs text-muted">minuten verstreken</span>
                    </span>
                </div>
            </div>
            
            <!-- MAIN LAYOUT WRAPPER -->
            <div class="vp-layout">
                
                <!-- LEFT SIDEBAR: PATIENT INFO (Desktop only) -->
                <aside class="vp-patient-sidebar hide-mobile" id="patientSidebar">
                    <div class="patient-card">
                        
                        <!-- Patient Header -->
                        <div class="patient-header">
                            <div class="patient-avatar">
                                <span id="patientInitials">--</span>
                            </div>
                            <div class="patient-basic-info">
                                <h3 class="patient-name" id="patientName">Laden...</h3>
                                <p class="patient-meta">
                                    <span id="patientAge">--</span> jaar | 
                                    <span id="patientGender">--</span>
                                </p>
                            </div>
                        </div>
                        
                        <!-- Patient Details (Expandable) -->
                        <div class="patient-details">
                            
                            <!-- Medical History -->
                            <div class="detail-section">
                                <button class="detail-toggle" data-section="history">
                                    <span class="toggle-label">Medische geschiedenis</span>
                                    <span class="toggle-icon">‚ñº</span>
                                </button>
                                <div class="detail-content" id="detail-history" style="display: none;">
                                    <p id="patientHistory">Geen informatie beschikbaar</p>
                                </div>
                            </div>
                            
                            <!-- Allergies -->
                            <div class="detail-section">
                                <button class="detail-toggle" data-section="allergies">
                                    <span class="toggle-label">Allergie√´n</span>
                                    <span class="toggle-icon">‚ñº</span>
                                </button>
                                <div class="detail-content" id="detail-allergies" style="display: none;">
                                    <div class="allergy-list">
                                        <span class="allergy-tag" id="allergiesContainer">Geen allergie√´n</span>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Current Symptoms -->
                            <div class="detail-section">
                                <button class="detail-toggle" data-section="symptoms">
                                    <span class="toggle-label">Huidige symptomen</span>
                                    <span class="toggle-icon">‚ñº</span>
                                </button>
                                <div class="detail-content" id="detail-symptoms" style="display: none;">
                                    <div class="symptoms-list" id="symptomsContainer">
                                        <p class="text-muted">Geen symptomen gespecificeerd</p>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Vital Signs (if available) -->
                            <div class="detail-section" id="vitalSignsSection" style="display: none;">
                                <button class="detail-toggle" data-section="vitals">
                                    <span class="toggle-label">Vitale functies</span>
                                    <span class="toggle-icon">‚ñº</span>
                                </button>
                                <div class="detail-content" id="detail-vitals" style="display: none;">
                                    <div class="vitals-grid" id="vitalsContainer"></div>
                                </div>
                            </div>
                            
                            <!-- Emotional State (NEW - Enhanced VP) -->
                            <div class="detail-section" id="emotionalStateSection" style="display: block;">
                                <button class="detail-toggle" data-section="emotional">
                                    <span class="toggle-label">üé≠ Emotionele status</span>
                                    <span class="toggle-icon">‚ñº</span>
                                </button>
                                <div class="detail-content" id="detail-emotional" style="display: block;">
                                    <div class="emotional-state-grid">
                                        <!-- Trust -->
                                        <div class="emotion-bar">
                                            <div class="emotion-label">
                                                <span>üíô Vertrouwen</span>
                                                <span id="trustValue">50</span>%
                                            </div>
                                            <div class="emotion-progress">
                                                <div class="emotion-fill trust" id="trustFill" style="width: 50%"></div>
                                            </div>
                                        </div>
                                        
                                        <!-- Anxiety -->
                                        <div class="emotion-bar">
                                            <div class="emotion-label">
                                                <span>üò∞ Angst</span>
                                                <span id="anxietyValue">70</span>%
                                            </div>
                                            <div class="emotion-progress">
                                                <div class="emotion-fill anxiety" id="anxietyFill" style="width: 70%"></div>
                                            </div>
                                        </div>
                                        
                                        <!-- Pain -->
                                        <div class="emotion-bar">
                                            <div class="emotion-label">
                                                <span>üò£ Pijn</span>
                                                <span id="painValue">80</span>%
                                            </div>
                                            <div class="emotion-progress">
                                                <div class="emotion-fill pain" id="painFill" style="width: 80%"></div>
                                            </div>
                                        </div>
                                        
                                        <!-- Cooperation -->
                                        <div class="emotion-bar">
                                            <div class="emotion-label">
                                                <span>ü§ù Samenwerking</span>
                                                <span id="cooperationValue">60</span>%
                                            </div>
                                            <div class="emotion-progress">
                                                <div class="emotion-fill cooperation" id="cooperationFill" style="width: 60%"></div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                        </div>
                    </div>
                </aside>
                
                <!-- CENTER: DIALOGUE AREA -->
                <main class="vp-dialogue-area">
                    
                    <!-- Mobile Patient Card (collapsed) -->
                    <div class="patient-card-mobile show-mobile" id="mobilePatientCard">
                        <button class="card-toggle" id="mobileCardToggle">
                            <div class="card-header">
                                <div class="patient-avatar-sm">
                                    <span id="patientInitialsMobile">--</span>
                                </div>
                                <div>
                                    <p class="patient-name-sm" id="patientNameMobile">--</p>
                                    <p class="text-xs text-muted" id="patientAgeMobile">--</p>
                                </div>
                            </div>
                            <span class="toggle-arrow">‚ñº</span>
                        </button>
                        
                        <div class="card-expanded" id="mobileCardExpanded" style="display: none;">
                            <div class="detail-section">
                                <p class="text-sm mb-md"><strong>Medische geschiedenis:</strong></p>
                                <p class="text-sm" id="patientHistoryMobile">--</p>
                            </div>
                            <div class="detail-section">
                                <p class="text-sm mb-md"><strong>Allergie√´n:</strong></p>
                                <div id="allergiesMobile"></div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Dialogue Thread -->
                    <div class="dialogue-thread" id="dialogueThread">
                        <!-- Dialogue nodes –±—É–¥—É—Ç –¥–æ–±–∞–≤–ª–µ–Ω—ã —Å—é–¥–∞ JavaScript'–æ–º -->
                    </div>
                    
                    <!-- Interaction Area (Options or Fill-in) -->
                    <div class="interaction-area" id="interactionArea">
                        <div class="loading-spinner-small" id="interactionLoading" style="display: none;"></div>
                        <div id="interactionContent" style="display: none;"></div>
                    </div>
                    
                </main>
                
            </div>
            
        </div>
        
        <!-- COMPLETION MODAL -->
        <div class="vp-modal" id="completionModal" style="display: none;">
            <div class="modal-backdrop" id="modalBackdrop"></div>
            <div class="modal-content completion-modal">
                
                <div class="modal-header">
                    <h2>Goed gedaan!</h2>
                    <button class="modal-close" id="modalCloseBtn">&times;</button>
                </div>
                
                <div class="modal-body">
                    
                    <!-- Result Badge -->
                    <div class="result-badge" id="resultBadge">
                        <div class="badge-icon" id="badgeIcon">‚úì</div>
                        <div class="badge-label" id="badgeLabel">Excellent</div>
                    </div>
                    
                    <!-- Scores -->
                    <div class="result-scores">
                        <div class="score-row">
                            <span>Totaalscore:</span>
                            <span class="score-highlight" id="finalTotalScore">0</span>
                        </div>
                        <div class="score-row">
                            <span>Percentage:</span>
                            <span class="score-highlight" id="finalPercentage">0%</span>
                        </div>
                        <div class="score-row">
                            <span>Dialoog punten:</span>
                            <span id="finalDialogueScore">0</span>
                        </div>
                        <div class="score-row">
                            <span>Fill-in punten:</span>
                            <span id="finalFillInScore">0</span>
                        </div>
                    </div>
                    
                    <!-- Feedback -->
                    <div class="result-feedback">
                        <p id="feedbackMessage">Goed werk!</p>
                    </div>
                    
                    <!-- Timeline Summary -->
                    <div class="result-timeline">
                        <h4>Samenvatting van je keuzes:</h4>
                        <div class="timeline" id="resultTimeline"></div>
                    </div>
                    
                </div>
                
                <div class="modal-footer">
                    <button class="btn btn-primary" id="continueBtn">
                        Afronden
                    </button>
                </div>
                
            </div>
        </div>

        <!-- PATIENT INFO MODAL (Mobile) -->
        <div class="vp-modal" id="patientModal" style="display: none;" aria-hidden="true" role="dialog" aria-labelledby="patientModalTitle">
            <div class="modal-backdrop" id="patientModalBackdrop"></div>
            <div class="modal-content">
                <div class="modal-header">
                    <h2 id="patientModalTitle">Pati√´ntinformatie</h2>
                    <button class="modal-close" id="patientModalClose" aria-label="Sluiten">&times;</button>
                </div>
                <div class="modal-body">
                    <!-- Reuse left sidebar content quickly -->
                    <div id="patientModalContent">
                        <div class="patient-card">
                            <div class="patient-header">
                                <div class="patient-avatar"><span id="patientInitials">--</span></div>
                                <div class="patient-basic-info">
                                    <h3 class="patient-name" id="patientName">Laden...</h3>
                                    <p class="patient-meta">
                                        <span id="patientAge">--</span> jaar | 
                                        <span id="patientGender">--</span>
                                    </p>
                                </div>
                            </div>
                            <div class="patient-details">
                                <div class="detail-section">
                                    <p class="toggle-label">Medische geschiedenis</p>
                                    <div class="detail-content">
                                        <p id="patientHistory">Geen informatie beschikbaar</p>
                                    </div>
                                </div>
                                <div class="detail-section">
                                    <p class="toggle-label">Allergie√´n</p>
                                    <div class="detail-content"><div class="allergy-list"><span class="allergy-tag" id="allergiesContainer">Geen allergie√´n</span></div></div>
                                </div>
                                <div class="detail-section" id="vitalSignsSection">
                                    <p class="toggle-label">Vitale functies</p>
                                    <div class="detail-content"><div class="vitals-grid" id="vitalsContainer"></div></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
    </div>
    
    <!-- Scripts -->
    <script src="{{ url_for('static', filename='js/vp-enhanced.js') }}"></script>
    <script src="{{ url_for('static', filename='js/vp-dialogue.js') }}"></script>
    <script>
        // Theme initialization
        (function() {
            const theme = localStorage.getItem('theme') || 'light';
            document.documentElement.setAttribute('data-theme', theme);
        })();
        
        // Initialize on page load
        document.addEventListener('DOMContentLoaded', function() {
            const scenarioId = {{ scenario_id }};
            const attemptId = {{ attempt_id }};
            vpDialogue.init(scenarioId, attemptId);
        });
    </script>
</body>
</html>


