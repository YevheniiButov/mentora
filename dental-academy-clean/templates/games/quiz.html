{% extends "games/base_game.html" %}

{% block title %}Quick Quiz{% endblock %}

{% block game_title %}
    <i class="bi bi-lightning-charge-fill"></i> Quick Quiz
{% endblock %}

{% block game_subtitle %}
    Test your medical knowledge with rapid-fire questions
{% endblock %}

{% block extra_css %}
<style>
    /* LinkedIn-inspired Professional Design */
    :root {
        --game-primary: #0a66c2;
        --game-secondary: #004182;
        --game-light: #e3f2fd;
        --game-border: #e0e0e0;
        --game-text: #1d1d1d;
        --game-text-light: #666666;
        --game-bg: #ffffff;
        --game-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
        --game-shadow-hover: 0 4px 16px rgba(0, 0, 0, 0.12);
    }
    
    /* Compact layout - no scrolling needed */
    .quiz-container {
        max-width: 1000px;
        margin: 0 auto;
    }
    
    .question-card {
        background: var(--game-bg);
        border-radius: 12px;
        padding: 1.5rem;
        margin-bottom: 1rem;
        box-shadow: var(--game-shadow);
        border: 1px solid var(--game-border);
    }
    
    @media (max-width: 767px) {
        .question-card {
            padding: 1.25rem;
        }
    }
    
    .question-number {
        display: inline-block;
        padding: 0.5rem 1rem;
        background: var(--game-primary);
        color: white;
        border-radius: 6px;
        font-size: 0.85rem;
        font-weight: 600;
        margin-bottom: 1rem;
    }
    
    .question-text {
        font-size: 1.25rem;
        font-weight: 600;
        margin-bottom: 1.5rem;
        color: var(--game-text);
        line-height: 1.5;
    }
    
    @media (max-width: 767px) {
        .question-text {
            font-size: 1.1rem;
            margin-bottom: 1.25rem;
        }
    }
    
    .answers-grid {
        display: grid;
        gap: 0.75rem;
    }
    
    .answer-btn {
        padding: 1rem 1.25rem;
        border: 1px solid var(--game-border);
        background: var(--game-bg);
        border-radius: 8px;
        text-align: left;
        cursor: pointer;
        transition: all 0.2s ease;
        font-size: 1rem;
        font-weight: 500;
        color: var(--game-text);
        position: relative;
    }
    
    @media (max-width: 767px) {
        .answer-btn {
            padding: 0.875rem 1rem;
            font-size: 0.95rem;
        }
    }
    
    .answer-btn::before {
        content: '';
        position: absolute;
        left: 0;
        top: 0;
        height: 100%;
        width: 3px;
        background: var(--game-primary);
        transform: scaleY(0);
        transition: transform 0.2s;
    }
    
    .answer-btn:hover:not(:disabled) {
        border-color: var(--game-primary);
        background: var(--game-light);
        box-shadow: var(--game-shadow-hover);
    }
    
    .answer-btn:hover:not(:disabled)::before {
        transform: scaleY(1);
    }
    
    .answer-btn.selected {
        border-color: var(--game-primary);
        background: var(--game-primary);
        color: white;
    }
    
    .answer-btn.correct {
        border-color: #2e7d32;
        background: #e8f5e9;
        color: #1b5e20;
    }
    
    .answer-btn.incorrect {
        border-color: #c62828;
        background: #ffebee;
        color: #b71c1c;
    }
    
    .answer-btn:disabled {
        cursor: not-allowed;
    }
    
    .progress-bar-container {
        height: 6px;
        background: #e0e0e0;
        border-radius: 3px;
        overflow: hidden;
        margin-bottom: 1.5rem;
    }
    
    .progress-bar-fill {
        height: 100%;
        background: var(--game-primary);
        transition: width 0.3s ease;
    }
    
    .category-selector {
        margin-bottom: 1.5rem;
        text-align: center;
    }
    
    .category-selector h5 {
        font-weight: 600;
        color: var(--game-text);
        margin-bottom: 1rem;
        font-size: 0.95rem;
    }
    
    .category-btn {
        padding: 0.625rem 1.5rem;
        border: 1px solid var(--game-border);
        background: var(--game-bg);
        color: var(--game-text-light);
        border-radius: 6px;
        margin: 0.5rem;
        cursor: pointer;
        transition: all 0.2s ease;
        font-weight: 600;
        font-size: 0.9rem;
        display: inline-flex;
        align-items: center;
        gap: 0.5rem;
    }
    
    @media (max-width: 767px) {
        .category-btn {
            display: block;
            width: 100%;
            justify-content: center;
            margin: 0.5rem 0;
        }
    }
    
    .category-btn.active {
        background: var(--game-primary);
        color: white;
        border-color: var(--game-primary);
    }
    
    .category-btn:hover:not(.active) {
        border-color: var(--game-primary);
        color: var(--game-primary);
        background: var(--game-light);
    }
    
    .feedback-card {
        background: var(--game-bg);
        border-radius: 12px;
        padding: 1.5rem;
        margin-top: 1rem;
        display: none;
        box-shadow: var(--game-shadow);
        border: 1px solid var(--game-border);
    }
    
    @media (max-width: 767px) {
        .feedback-card {
            padding: 1.25rem;
        }
    }
    
    .feedback-card.show {
        display: block;
    }
    
    .explanation {
        background: #f5f5f5;
        border-left: 3px solid var(--game-primary);
        padding: 1rem;
        border-radius: 6px;
        margin-top: 1rem;
        font-size: 0.95rem;
        line-height: 1.6;
        color: var(--game-text);
    }
    
    @media (max-width: 767px) {
        .explanation {
            font-size: 0.9rem;
        }
    }
    
    .results-card {
        text-align: center;
        padding: 2rem;
    }
    
    @media (max-width: 767px) {
        .results-card {
            padding: 1.5rem 1rem;
        }
    }
    
    .score-circle {
        width: 150px;
        height: 150px;
        border-radius: 50%;
        background: var(--game-primary);
        color: white;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 2.5rem;
        font-weight: 700;
        margin: 1.5rem auto;
        box-shadow: var(--game-shadow-hover);
    }
    
    @media (max-width: 767px) {
        .score-circle {
            width: 120px;
            height: 120px;
            font-size: 2rem;
        }
    }
    
    .performance-badge {
        display: inline-block;
        padding: 0.75rem 1.5rem;
        border-radius: 8px;
        font-weight: 600;
        margin: 1rem 0;
        font-size: 1rem;
    }
    
    .badge-excellent {
        background: #2e7d32;
        color: white;
    }
    
    .badge-good {
        background: var(--game-primary);
        color: white;
    }
    
    .badge-average {
        background: #f59e0b;
        color: white;
    }
    
    .badge-needs-work {
        background: #c62828;
        color: white;
    }
    
    .game-stats {
        display: grid;
        grid-template-columns: repeat(3, 1fr);
        gap: 1rem;
        margin-bottom: 1.5rem;
        max-width: 500px;
        margin-left: auto;
        margin-right: auto;
    }
    
    @media (max-width: 767px) {
        .game-stats {
            gap: 0.75rem;
        }
    }
    
    .stats-box {
        background: var(--game-bg);
        padding: 1rem;
        border-radius: 8px;
        box-shadow: var(--game-shadow);
        text-align: center;
        border: 1px solid var(--game-border);
    }
    
    .stats-value {
        font-size: 1.5rem;
        font-weight: 700;
        color: var(--game-primary);
        margin-bottom: 0.25rem;
    }
    
    .stats-label {
        font-size: 0.75rem;
        color: var(--game-text-light);
        font-weight: 500;
        text-transform: uppercase;
        letter-spacing: 0.5px;
    }
</style>
{% endblock %}

{% block content %}
<div class="quiz-container">
    <!-- Category Selector -->
    <div class="category-selector" id="categorySelector">
        <h5>Select Category:</h5>
        <div class="d-flex flex-column flex-md-row justify-content-center flex-wrap gap-2">
            <button class="category-btn active" data-category="dental">
                <i class="bi bi-heart-pulse-fill"></i> Dental
            </button>
            <button class="category-btn" data-category="pharmacy">
                <i class="bi bi-capsule-pill"></i> Pharmacy
            </button>
            <button class="category-btn" data-category="general">
                <i class="bi bi-hospital-fill"></i> General Practice
            </button>
            <button class="category-btn" data-category="nursing">
                <i class="bi bi-bandaid-fill"></i> Nursing
            </button>
        </div>
    </div>
    
    <!-- Stats -->
    <div class="game-stats mb-4">
        <div class="stats-box">
            <div class="stats-value" id="timer">0:00</div>
            <div class="stats-label">Time</div>
        </div>
        <div class="stats-box">
            <div class="stats-value" id="score">0/10</div>
            <div class="stats-label">Score</div>
        </div>
        <div class="stats-box">
            <div class="stats-value" id="streak">0</div>
            <div class="stats-label">Streak</div>
        </div>
    </div>
    
    <!-- Start Screen -->
    <div class="game-card text-center" id="startScreen">
        <div style="font-size: 4rem; margin-bottom: 1rem;">‚ö°</div>
        <h3 class="mb-4">Ready to test your knowledge?</h3>
        <p class="lead mb-4">Answer 10 questions as quickly and accurately as you can!</p>
        <button class="btn btn-game btn-lg" id="startBtn">
            <i class="bi bi-play-fill"></i> Start Quiz
        </button>
    </div>
    
    <!-- Quiz Screen -->
    <div id="quizScreen" style="display: none;">
        <!-- Progress Bar -->
        <div class="progress-bar-container">
            <div class="progress-bar-fill" id="progressBar" style="width: 0%"></div>
        </div>
        
        <!-- Question Card -->
        <div class="question-card">
            <span class="question-number" id="questionNumber">Question 1 of 10</span>
            <div class="question-text" id="questionText"></div>
            <div class="answers-grid" id="answersGrid"></div>
        </div>
        
        <!-- Feedback Card -->
        <div class="feedback-card" id="feedbackCard">
            <h4 id="feedbackTitle" class="mb-3"></h4>
            <div class="explanation" id="explanation"></div>
            <button class="btn btn-game w-100 mt-4" id="nextBtn">
                Next Question <i class="bi bi-arrow-right"></i>
            </button>
        </div>
    </div>
    
    <!-- Results Screen -->
    <div class="game-card results-card" id="resultsScreen" style="display: none;">
        <h2 class="mb-3">Quiz Complete!</h2>
        <div class="score-circle" id="finalScore">0/10</div>
        <div class="performance-badge" id="performanceBadge">Great job!</div>
        <p class="lead mt-3" id="performanceText"></p>
        <div class="row g-3 mt-4">
            <div class="col-md-4">
                <div class="stats-box">
                    <div class="stats-value" id="finalTime">0:00</div>
                    <div class="stats-label">Total Time</div>
                </div>
            </div>
            <div class="col-md-4">
                <div class="stats-box">
                    <div class="stats-value" id="finalAccuracy">0%</div>
                    <div class="stats-label">Accuracy</div>
                </div>
            </div>
            <div class="col-md-4">
                <div class="stats-box">
                    <div class="stats-value" id="maxStreak">0</div>
                    <div class="stats-label">Best Streak</div>
                </div>
            </div>
        </div>
        <button class="btn btn-game btn-lg w-100 mt-5" onclick="resetQuiz()">
            <i class="bi bi-arrow-clockwise"></i> Play Again
        </button>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
// Question Database
const questions = {
    dental: [
        {
            question: "Wat is de Nederlandse term voor 'cavity'?",
            answers: ["Cari√´s", "Kroon", "Wortelkanaal", "Tandvlees"],
            correct: 0,
            explanation: "Cari√´s is het Nederlandse woord voor cavity (tandholte/gaatje)."
        },
        {
            question: "Welke behandeling wordt uitgevoerd bij pulpitis?",
            answers: ["Extractie", "Wortelkanaalbehandeling", "Kroonplaatsing", "Orthodontie"],
            correct: 1,
            explanation: "Bij pulpitis (ontsteking van de tandpulp) wordt vaak een wortelkanaalbehandeling uitgevoerd."
        },
        {
            question: "Wat is parodontitis?",
            answers: ["Kaakontsteking", "Tandvleesziekte", "Tanderosie", "Wortelabces"],
            correct: 1,
            explanation: "Parodontitis is een ontstekingsziekte van het tandvlees en ondersteunende weefsels."
        },
        {
            question: "Welk instrument wordt gebruikt voor het verwijderen van tandsteen?",
            answers: ["Scaler", "Excavator", "Elevator", "Forceps"],
            correct: 0,
            explanation: "Een scaler wordt gebruikt om tandsteen (calculus) te verwijderen."
        },
        {
            question: "Wat is het doel van een kroon?",
            answers: ["Tand verwijderen", "Tand beschermen", "Tanden rechtzetten", "Gebit reinigen"],
            correct: 1,
            explanation: "Een kroon beschermt en versterkt een beschadigde tand."
        },
        {
            question: "Wat betekent 'occlusie' in de tandheelkunde?",
            answers: ["Tandkleur", "Beet/bijtkracht", "Kaakgewricht", "Tandwortel"],
            correct: 1,
            explanation: "Occlusie verwijst naar de manier waarop de tanden op elkaar sluiten (de beet)."
        },
        {
            question: "Wat is alveolitis?",
            answers: ["Droge socket", "Kaakbreuk", "Tandabces", "Gingivitis"],
            correct: 0,
            explanation: "Alveolitis, ook wel 'droge socket' genoemd, is een complicatie na extractie."
        },
        {
            question: "Welke fluorideconcentratie wordt aanbevolen in tandpasta voor volwassenen?",
            answers: ["500 ppm", "1000 ppm", "1450 ppm", "2000 ppm"],
            correct: 2,
            explanation: "1450 ppm fluoride is de aanbevolen concentratie voor volwassenen in Nederland."
        },
        {
            question: "Wat is endodontie?",
            answers: ["Orthodontie", "Wortelkanaalbehandeling", "Tandextractie", "Implantologie"],
            correct: 1,
            explanation: "Endodontie is het vakgebied dat zich bezighoudt met wortelkanaalbehandelingen."
        },
        {
            question: "Wat is de functie van tandcement?",
            answers: ["Tand bevestigen", "Kroon vastmaken", "Vulling plaatsen", "Brug aanbrengen"],
            correct: 1,
            explanation: "Tandcement wordt gebruikt om kronen, bruggen en andere protheses vast te zetten."
        },
        {
            question: "Wat is xerostomie?",
            answers: ["Droge mond", "Tandpijn", "Slechte adem", "Kaakontsteking"],
            correct: 0,
            explanation: "Xerostomie is de medische term voor een droge mond, veroorzaakt door verminderde speekselproductie."
        },
        {
            question: "Hoeveel melktanden heeft een kind?",
            answers: ["16", "20", "24", "28"],
            correct: 1,
            explanation: "Een kind heeft in totaal 20 melktanden (deciduale dentitie)."
        },
        {
            question: "Wat is een amalgaamvulling?",
            answers: ["Keramische vulling", "Metaallegering vulling", "Kunststof vulling", "Gouden vulling"],
            correct: 1,
            explanation: "Amalgaam is een metaallegering van zilver, tin, koper en kwik."
        },
        {
            question: "Wat is bruxisme?",
            answers: ["Tandenknarsen", "Tandvleesontsteking", "Wortelkanaalinfectie", "Tandholte"],
            correct: 0,
            explanation: "Bruxisme is het onbewust op elkaar klemmen of knarsen van de tanden."
        },
        {
            question: "Wat betekent 'impactie' van een tand?",
            answers: [
                "Tand is gebroken",
                "Tand komt niet door",
                "Tand is ontstoken",
                "Tand is verkleurd"
            ],
            correct: 1,
            explanation: "Een ge√Ømpacteerde tand is een tand die niet volledig doorkomt in de mond."
        },
        {
            question: "Hoeveel permanente tanden heeft een volwassene (inclusief verstandskiezen)?",
            answers: ["28", "30", "32", "34"],
            correct: 2,
            explanation: "Een volwassene heeft normaal 32 permanente tanden, inclusief 4 verstandskiezen."
        }
    ],
    pharmacy: [
        {
            question: "Wat is het verschil tussen een geneesmiddel en een hulpstof?",
            answers: [
                "Er is geen verschil",
                "Geneesmiddel is werkzaam, hulpstof ondersteunt",
                "Hulpstof is werkzaam, geneesmiddel ondersteunt",
                "Beide zijn even werkzaam"
            ],
            correct: 1,
            explanation: "Een geneesmiddel bevat de werkzame stof, terwijl hulpstoffen de formulering ondersteunen."
        },
        {
            question: "Wat betekent 'contraindicatie'?",
            answers: [
                "Bijwerking",
                "Reden om niet te gebruiken",
                "Dosering",
                "Werkingsmechanisme"
            ],
            correct: 1,
            explanation: "Een contraindicatie is een reden waarom een geneesmiddel niet gebruikt mag worden."
        },
        {
            question: "Wat is farmacodynamiek?",
            answers: [
                "Effect van medicijn op lichaam",
                "Effect van lichaam op medicijn",
                "Medicijn productie",
                "Medicijn opslag"
            ],
            correct: 0,
            explanation: "Farmacodynamiek beschrijft het effect van een medicijn op het lichaam."
        },
        {
            question: "Wat is farmacokinetiek?",
            answers: [
                "Effect van medicijn op lichaam",
                "Effect van lichaam op medicijn",
                "Medicijn interacties",
                "Medicijn dosering"
            ],
            correct: 1,
            explanation: "Farmacokinetiek beschrijft wat het lichaam doet met een medicijn (absorptie, distributie, metabolisme, excretie)."
        },
        {
            question: "Wat betekent 'bijwerking'?",
            answers: [
                "Gewenst effect van medicijn",
                "Ongewenst effect van medicijn",
                "Dosering van medicijn",
                "Werkzame stof"
            ],
            correct: 1,
            explanation: "Een bijwerking is een ongewenst of onbedoeld effect van een geneesmiddel."
        },
        {
            question: "Wat is een generiek geneesmiddel?",
            answers: [
                "Merkgeneesmiddel",
                "Geneesmiddel zonder patent",
                "Experimenteel geneesmiddel",
                "Natuurlijk geneesmiddel"
            ],
            correct: 1,
            explanation: "Een generiek geneesmiddel is een kopie van een merkgeneesmiddel waarvan het patent is verlopen."
        },
        {
            question: "Wat is de therapeutische index?",
            answers: [
                "Werkzaamheid van medicijn",
                "Veiligheidsmarges tussen werkzame en toxische dosis",
                "Prijs van medicijn",
                "Houdbaarheid van medicijn"
            ],
            correct: 1,
            explanation: "De therapeutische index is de verhouding tussen de toxische en therapeutische dosis."
        },
        {
            question: "Wat betekent 'oraal' toedienen?",
            answers: [
                "Via de mond",
                "Via injectie",
                "Via de huid",
                "Via inademing"
            ],
            correct: 0,
            explanation: "Orale toediening betekent dat het medicijn via de mond wordt ingenomen."
        },
        {
            question: "Wat is een antibioticum?",
            answers: [
                "Pijnstiller",
                "Bacteriedodend medicijn",
                "Ontstekingsremmer",
                "Vitamine"
            ],
            correct: 1,
            explanation: "Antibiotica zijn medicijnen die bacteri√´n doden of hun groei remmen."
        },
        {
            question: "Wat betekent BID in medicijnvoorschrift?",
            answers: [
                "Eenmaal daags",
                "Tweemaal daags",
                "Driemaal daags",
                "Viermaal daags"
            ],
            correct: 1,
            explanation: "BID (bis in die) betekent tweemaal per dag."
        },
        {
            question: "Wat is een placebo?",
            answers: [
                "Sterk medicijn",
                "Medicijn zonder werkzame stof",
                "Antibioticum",
                "Pijnstiller"
            ],
            correct: 1,
            explanation: "Een placebo is een preparaat zonder werkzame stof, gebruikt voor onderzoek of psychologisch effect."
        },
        {
            question: "Wat zijn NSAID's?",
            answers: [
                "Antibiotica",
                "Niet-stero√Ødale ontstekingsremmers",
                "Bloeddrukverlagers",
                "Antidepressiva"
            ],
            correct: 1,
            explanation: "NSAID's (Non-Steroidal Anti-Inflammatory Drugs) zijn ontstekingsremmende pijnstillers zoals ibuprofen."
        },
        {
            question: "Wat is een capsule?",
            answers: [
                "Vloeibaar medicijn",
                "Injecteerbaar medicijn",
                "Gelatine omhulsel met medicijn",
                "Zetpil"
            ],
            correct: 2,
            explanation: "Een capsule is een gelatine-omhulsel gevuld met poeder of vloeistof medicijn."
        },
        {
            question: "Wat betekent QID in receptuur?",
            answers: [
                "Eenmaal daags",
                "Tweemaal daags",
                "Driemaal daags",
                "Viermaal daags"
            ],
            correct: 3,
            explanation: "QID (quater in die) betekent viermaal per dag."
        },
        {
            question: "Wat is anafylaxie?",
            answers: [
                "Lichte bijwerking",
                "Ernstige allergische reactie",
                "Maagklacht",
                "Hoofdpijn"
            ],
            correct: 1,
            explanation: "Anafylaxie is een levensbedreigende allergische reactie die onmiddellijke behandeling vereist."
        }
    ],
    general: [
        {
            question: "Wat is de normale bloeddruk voor een volwassene?",
            answers: ["90/60 mmHg", "120/80 mmHg", "140/90 mmHg", "160/100 mmHg"],
            correct: 1,
            explanation: "120/80 mmHg wordt beschouwd als normale bloeddruk voor volwassenen."
        },
        {
            question: "Wat is hypertensie?",
            answers: [
                "Lage bloeddruk",
                "Hoge bloeddruk",
                "Normale bloeddruk",
                "Fluctuerende bloeddruk"
            ],
            correct: 1,
            explanation: "Hypertensie is de medische term voor hoge bloeddruk."
        },
        {
            question: "Wat is diabetes mellitus?",
            answers: [
                "Hoge bloedsuiker",
                "Lage bloedsuiker",
                "Hoge bloeddruk",
                "Lage bloeddruk"
            ],
            correct: 0,
            explanation: "Diabetes mellitus is een stofwisselingsziekte waarbij de bloedsuikerspiegel te hoog is."
        },
        {
            question: "Wat is de normale lichaamstemperatuur?",
            answers: ["35¬∞C", "36¬∞C", "37¬∞C", "38¬∞C"],
            correct: 2,
            explanation: "De normale lichaamstemperatuur is ongeveer 37¬∞C (36,5-37,5¬∞C)."
        },
        {
            question: "Wat is een myocardinfarct?",
            answers: [
                "Hersenbloeding",
                "Hartinfarct",
                "Longembolie",
                "Nierfalen"
            ],
            correct: 1,
            explanation: "Myocardinfarct is de medische term voor een hartinfarct."
        },
        {
            question: "Wat is COPD?",
            answers: [
                "Hartziekte",
                "Chronische longziekte",
                "Leverziekte",
                "Nierziekte"
            ],
            correct: 1,
            explanation: "COPD (Chronic Obstructive Pulmonary Disease) is een chronische longziekte."
        },
        {
            question: "Wat is een CVA?",
            answers: [
                "Hartaanval",
                "Beroerte",
                "Astma-aanval",
                "Epileptische aanval"
            ],
            correct: 1,
            explanation: "CVA (Cerebro Vasculair Accident) is de medische term voor een beroerte."
        },
        {
            question: "Wat is de functie van rode bloedcellen?",
            answers: [
                "Infecties bestrijden",
                "Zuurstoftransport",
                "Bloedstolling",
                "Hormoonproductie"
            ],
            correct: 1,
            explanation: "Rode bloedcellen (erythrocyten) transporteren zuurstof door het lichaam."
        },
        {
            question: "Wat is aritmie?",
            answers: [
                "Hoge bloeddruk",
                "Onregelmatig hartritme",
                "Lage bloedsuiker",
                "Hoge cholesterol"
            ],
            correct: 1,
            explanation: "Aritmie is een onregelmatig hartritme."
        },
        {
            question: "Wat betekent acute zorg?",
            answers: [
                "Langdurige zorg",
                "Spoedzorg",
                "Preventieve zorg",
                "Thuiszorg"
            ],
            correct: 1,
            explanation: "Acute zorg is directe, spoedeisende medische hulp."
        },
        {
            question: "Wat is een ECG?",
            answers: [
                "Hersenscan",
                "Hartfilmpje",
                "Bloedonderzoek",
                "Longfoto"
            ],
            correct: 1,
            explanation: "Een ECG (elektrocardiogram) registreert de elektrische activiteit van het hart."
        },
        {
            question: "Wat is osteoporose?",
            answers: [
                "Gewrichtsontsteking",
                "Botontkalking",
                "Spierziekte",
                "Zenuwziekte"
            ],
            correct: 1,
            explanation: "Osteoporose is botontkalking waarbij botten zwak en brozer worden."
        },
        {
            question: "Wat is de functie van de nieren?",
            answers: [
                "Bloed pompen",
                "Voedsel verteren",
                "Afvalstoffen filteren",
                "Hormonen produceren"
            ],
            correct: 2,
            explanation: "De nieren filteren afvalstoffen uit het bloed en produceren urine."
        },
        {
            question: "Wat is astma?",
            answers: [
                "Hartziekte",
                "Chronische luchtwegaandoening",
                "Maagziekte",
                "Huidziekte"
            ],
            correct: 1,
            explanation: "Astma is een chronische ontstekingsziekte van de luchtwegen."
        },
        {
            question: "Wat is BMI?",
            answers: [
                "Bloeddruk meting",
                "Body Mass Index",
                "Bloed monster index",
                "Basis medicijn indicator"
            ],
            correct: 1,
            explanation: "BMI (Body Mass Index) is een maat voor het lichaamsgewicht ten opzichte van de lengte."
        }
    ],
    nursing: [
        {
            question: "Wat is de eerste stap bij een spoedopname?",
            answers: [
                "Medicatie toedienen",
                "ABCDE-beoordeling",
                "Pati√´nt registreren",
                "Familie informeren"
            ],
            correct: 1,
            explanation: "De ABCDE-beoordeling (Airway, Breathing, Circulation, Disability, Exposure) is de eerste stap."
        },
        {
            question: "Wat betekent ABCDE?",
            answers: [
                "Algemene Behandeling Controle Data Evaluatie",
                "Airway Breathing Circulation Disability Exposure",
                "Acute Behandeling Cardio Diagnostiek Eerste hulp",
                "Ambulance BehandelingCare Diagnose Emergency"
            ],
            correct: 1,
            explanation: "ABCDE staat voor Airway, Breathing, Circulation, Disability, Exposure - een systematische beoordeling."
        },
        {
            question: "Wat is de normale hartslag voor een volwassene?",
            answers: [
                "40-60 bpm",
                "60-100 bpm",
                "100-120 bpm",
                "120-140 bpm"
            ],
            correct: 1,
            explanation: "De normale hartslag voor een volwassene in rust is 60-100 slagen per minuut."
        },
        {
            question: "Wat is decubitus?",
            answers: [
                "Wondinfectie",
                "Doorligwond",
                "Brandwond",
                "Operatiewond"
            ],
            correct: 1,
            explanation: "Decubitus is een doorligwond die ontstaat door langdurige druk op de huid."
        },
        {
            question: "Wat betekent NPO (nihil per os)?",
            answers: [
                "Niets via de mond",
                "Geen pijnstillers",
                "Niet opstaan",
                "Normale procedure operatie"
            ],
            correct: 0,
            explanation: "NPO betekent dat een pati√´nt niets via de mond mag innemen (eten en drinken)."
        },
        {
            question: "Wat is een catheter?",
            answers: [
                "Medicijn",
                "Slangetje voor lichaamsvocht",
                "Verband",
                "Naald"
            ],
            correct: 1,
            explanation: "Een catheter is een dun buisje om vloeistoffen toe te dienen of af te voeren."
        },
        {
            question: "Wat is de Glasgow Coma Scale?",
            answers: [
                "Pijnschaal",
                "Bewustzijnsmeting",
                "Bloeddruk meting",
                "Temperatuurmeting"
            ],
            correct: 1,
            explanation: "De Glasgow Coma Scale meet het bewustzijnsniveau van een pati√´nt."
        },
        {
            question: "Wat is hygi√´nische handhygi√´ne?",
            answers: [
                "Handen wassen met water",
                "Handen desinfecteren",
                "Handschoenen dragen",
                "Handen afdrogen"
            ],
            correct: 1,
            explanation: "Hygi√´nische handhygi√´ne is het desinfecteren van handen om micro-organismen te verwijderen."
        },
        {
            question: "Wat is de juiste volgorde bij wondverzorging?",
            answers: [
                "Reinigen, desinfecteren, verbinden",
                "Verbinden, reinigen, desinfecteren",
                "Desinfecteren, verbinden, reinigen",
                "Reinigen, verbinden, desinfecteren"
            ],
            correct: 0,
            explanation: "De juiste volgorde is: reinigen, desinfecteren, en dan verbinden."
        },
        {
            question: "Wat is triage?",
            answers: [
                "Medicatie toedienen",
                "Prioritering van pati√´nten",
                "Wond verzorgen",
                "Bloeddruk meten"
            ],
            correct: 1,
            explanation: "Triage is het proces van prioritering van pati√´nten op basis van de ernst van hun toestand."
        },
        {
            question: "Wat is aspiratie?",
            answers: [
                "Inademen van vreemd materiaal",
                "Uitademen van lucht",
                "Bloeding",
                "Zwelling"
            ],
            correct: 0,
            explanation: "Aspiratie is het inademen van vreemd materiaal (zoals voedsel of braaksel) in de luchtwegen."
        },
        {
            question: "Wat betekent isolatie in de zorg?",
            answers: [
                "Pati√´nt alleen laten",
                "Scheiden van andere pati√´nten om besmetting te voorkomen",
                "Medicatie stoppen",
                "Bezoek verbieden"
            ],
            correct: 1,
            explanation: "Isolatie betekent het scheiden van een pati√´nt om verspreiding van infecties te voorkomen."
        },
        {
            question: "Wat is een infuus?",
            answers: [
                "Medicijn via de mond",
                "Vloeistof via een ader",
                "Medicijn via injectie",
                "Vloeistof via de mond"
            ],
            correct: 1,
            explanation: "Een infuus is toediening van vloeistof of medicatie rechtstreeks in een ader."
        },
        {
            question: "Wat is mobilisatie?",
            answers: [
                "Medicatie geven",
                "Pati√´nt in beweging brengen",
                "Wond verzorgen",
                "Bloedonderzoek doen"
            ],
            correct: 1,
            explanation: "Mobilisatie is het helpen van een pati√´nt om weer in beweging te komen na ziekte of operatie."
        },
        {
            question: "Wat is observatie in de verpleegkunde?",
            answers: [
                "Alleen kijken naar pati√´nt",
                "Systematisch waarnemen en vastleggen van pati√´nt gegevens",
                "Medicatie geven",
                "Pati√´nt wassen"
            ],
            correct: 1,
            explanation: "Observatie is het systematisch waarnemen, beoordelen en vastleggen van de toestand van een pati√´nt."
        }
    ]
};

// Game State
let gameState = {
    category: 'dental',
    currentQuestion: 0,
    score: 0,
    streak: 0,
    maxStreak: 0,
    startTime: null,
    timerInterval: null,
    selectedAnswer: null,
    questions: [],
    isPaused: false,
    pauseStartTime: null,
    totalPauseTime: 0,
    gameStarted: false
};

// Initialize
document.addEventListener('DOMContentLoaded', function() {
    setupCategoryButtons();
    setupAutoPause();
    
    document.getElementById('startBtn').addEventListener('click', startQuiz);
    document.getElementById('nextBtn').addEventListener('click', nextQuestion);
});

function setupCategoryButtons() {
    document.querySelectorAll('.category-btn').forEach(btn => {
        btn.addEventListener('click', function() {
            document.querySelectorAll('.category-btn').forEach(b => b.classList.remove('active'));
            this.classList.add('active');
            gameState.category = this.dataset.category;
        });
    });
}

function startQuiz() {
    const categoryQuestions = questions[gameState.category] || questions.dental;
    gameState.questions = shuffle([...categoryQuestions]).slice(0, 10);
    
    gameState.currentQuestion = 0;
    gameState.score = 0;
    gameState.streak = 0;
    gameState.maxStreak = 0;
    gameState.selectedAnswer = null;
    gameState.gameStarted = true;
    
    gameState.startTime = Date.now();
    gameState.timerInterval = setInterval(updateTimer, 1000);
    
    document.getElementById('startScreen').style.display = 'none';
    document.getElementById('categorySelector').style.display = 'none';
    document.getElementById('quizScreen').style.display = 'block';
    
    loadQuestion();
}

function loadQuestion() {
    const question = gameState.questions[gameState.currentQuestion];
    
    document.getElementById('questionNumber').textContent = 
        `Question ${gameState.currentQuestion + 1} of ${gameState.questions.length}`;
    document.getElementById('questionText').textContent = question.question;
    
    const progress = ((gameState.currentQuestion) / gameState.questions.length) * 100;
    document.getElementById('progressBar').style.width = `${progress}%`;
    
    const answersGrid = document.getElementById('answersGrid');
    answersGrid.innerHTML = '';
    
    question.answers.forEach((answer, index) => {
        const btn = document.createElement('button');
        btn.className = 'answer-btn';
        btn.textContent = answer;
        btn.addEventListener('click', () => selectAnswer(index));
        answersGrid.appendChild(btn);
    });
    
    document.getElementById('feedbackCard').classList.remove('show');
    gameState.selectedAnswer = null;
}

function selectAnswer(index) {
    if (gameState.selectedAnswer !== null) return;
    
    gameState.selectedAnswer = index;
    const question = gameState.questions[gameState.currentQuestion];
    const isCorrect = index === question.correct;
    
    if (isCorrect) {
        gameState.score++;
        gameState.streak++;
        if (gameState.streak > gameState.maxStreak) {
            gameState.maxStreak = gameState.streak;
        }
    } else {
        gameState.streak = 0;
    }
    
    const buttons = document.querySelectorAll('.answer-btn');
    buttons.forEach((btn, i) => {
        btn.disabled = true;
        if (i === question.correct) {
            btn.classList.add('correct');
        } else if (i === index && !isCorrect) {
            btn.classList.add('incorrect');
        }
    });
    
    document.getElementById('feedbackTitle').textContent = 
        isCorrect ? '‚úÖ Correct!' : '‚ùå Incorrect';
    document.getElementById('feedbackTitle').style.color = 
        isCorrect ? '#10b981' : '#ef4444';
    document.getElementById('explanation').textContent = question.explanation;
    document.getElementById('feedbackCard').classList.add('show');
    
    updateStats();
}

function nextQuestion() {
    gameState.currentQuestion++;
    
    if (gameState.currentQuestion >= gameState.questions.length) {
        showResults();
    } else {
        loadQuestion();
    }
}

function showResults() {
    clearInterval(gameState.timerInterval);
    
    document.getElementById('quizScreen').style.display = 'none';
    document.getElementById('resultsScreen').style.display = 'block';
    
    const score = gameState.score;
    const total = gameState.questions.length;
    const accuracy = Math.round((score / total) * 100);
    
    document.getElementById('finalScore').textContent = `${score}/${total}`;
    document.getElementById('finalTime').textContent = document.getElementById('timer').textContent;
    document.getElementById('finalAccuracy').textContent = `${accuracy}%`;
    document.getElementById('maxStreak').textContent = gameState.maxStreak;
    
    const badge = document.getElementById('performanceBadge');
    let message = '';
    
    if (accuracy >= 90) {
        badge.className = 'performance-badge badge-excellent';
        badge.innerHTML = '<i class="bi bi-trophy-fill"></i> Outstanding!';
        message = 'üåü You\'re a medical expert! Excellent performance!';
    } else if (accuracy >= 70) {
        badge.className = 'performance-badge badge-good';
        badge.innerHTML = '<i class="bi bi-star-fill"></i> Great Job!';
        message = 'üëç Very well done! Keep up the good work!';
    } else if (accuracy >= 50) {
        badge.className = 'performance-badge badge-average';
        badge.innerHTML = '<i class="bi bi-hand-thumbs-up"></i> Good Effort!';
        message = 'üí™ Nice try! Practice makes perfect!';
    } else {
        badge.className = 'performance-badge badge-needs-work';
        badge.innerHTML = '<i class="bi bi-book"></i> Keep Learning!';
        message = 'üìö Don\'t give up! Review the material and try again!';
    }
    
    document.getElementById('performanceText').textContent = message;
}

function updateStats() {
    document.getElementById('score').textContent = `${gameState.score}/${gameState.questions.length}`;
    document.getElementById('streak').textContent = gameState.streak;
}

function updateTimer() {
    if (!gameState.startTime) return;
    
    const elapsed = Math.floor((Date.now() - gameState.startTime) / 1000);
    const minutes = Math.floor(elapsed / 60);
    const seconds = elapsed % 60;
    document.getElementById('timer').textContent = `${minutes}:${seconds.toString().padStart(2, '0')}`;
}

function resetQuiz() {
    clearInterval(gameState.timerInterval);
    
    gameState.gameStarted = false;
    gameState.totalPauseTime = 0;
    
    document.getElementById('resultsScreen').style.display = 'none';
    document.getElementById('startScreen').style.display = 'block';
    document.getElementById('categorySelector').style.display = 'block';
    
    document.getElementById('timer').textContent = '0:00';
    document.getElementById('score').textContent = '0/10';
    document.getElementById('streak').textContent = '0';
}

function shuffle(array) {
    const newArray = [...array];
    for (let i = newArray.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [newArray[i], newArray[j]] = [newArray[j], newArray[i]];
    }
    return newArray;
}

// Auto-pause functionality
function setupAutoPause() {
    // Pause when page becomes hidden (tab switch, minimize, etc.)
    document.addEventListener('visibilitychange', function() {
        if (document.hidden) {
            pauseGame();
        } else {
            resumeGame();
        }
    });
    
    // Pause when page is about to unload (refresh, close, navigation)
    window.addEventListener('beforeunload', function() {
        pauseGame();
        // Save game state to localStorage
        saveGameState();
    });
    
    // Resume when page loads (if there's saved state)
    window.addEventListener('load', function() {
        loadGameState();
    });
}

function pauseGame() {
    if (gameState.timerInterval && !gameState.isPaused && gameState.gameStarted) {
        gameState.isPaused = true;
        gameState.pauseStartTime = Date.now();
        clearInterval(gameState.timerInterval);
        
        // Show pause indicator
        showPauseIndicator();
    }
}

function resumeGame() {
    if (gameState.isPaused && gameState.pauseStartTime && gameState.gameStarted) {
        gameState.isPaused = false;
        gameState.totalPauseTime += Date.now() - gameState.pauseStartTime;
        gameState.pauseStartTime = null;
        
        // Resume timer
        gameState.timerInterval = setInterval(updateTimer, 1000);
        
        // Hide pause indicator
        hidePauseIndicator();
    }
}

function showPauseIndicator() {
    // Create or show pause indicator
    let indicator = document.getElementById('pauseIndicator');
    if (!indicator) {
        indicator = document.createElement('div');
        indicator.id = 'pauseIndicator';
        indicator.className = 'pause-indicator';
        indicator.innerHTML = '‚è∏Ô∏è Quiz Paused';
        document.body.appendChild(indicator);
    }
    indicator.style.display = 'block';
}

function hidePauseIndicator() {
    const indicator = document.getElementById('pauseIndicator');
    if (indicator) {
        indicator.style.display = 'none';
    }
}

function saveGameState() {
    if (!gameState.gameStarted) return;
    
    const gameData = {
        category: gameState.category,
        currentQuestion: gameState.currentQuestion,
        score: gameState.score,
        streak: gameState.streak,
        maxStreak: gameState.maxStreak,
        startTime: gameState.startTime,
        totalPauseTime: gameState.totalPauseTime,
        selectedAnswer: gameState.selectedAnswer,
        questions: gameState.questions,
        gameStarted: gameState.gameStarted,
        timestamp: Date.now()
    };
    
    localStorage.setItem('quiz_game_state', JSON.stringify(gameData));
}

function loadGameState() {
    const savedData = localStorage.getItem('quiz_game_state');
    if (savedData) {
        try {
            const gameData = JSON.parse(savedData);
            
            // Check if saved game is recent (within 1 hour)
            const timeDiff = Date.now() - gameData.timestamp;
            if (timeDiff < 3600000 && gameData.gameStarted) { // 1 hour
                // Restore game state
                gameState.category = gameData.category;
                gameState.currentQuestion = gameData.currentQuestion;
                gameState.score = gameData.score;
                gameState.streak = gameData.streak;
                gameState.maxStreak = gameData.maxStreak;
                gameState.startTime = gameData.startTime;
                gameState.totalPauseTime = gameData.totalPauseTime;
                gameState.selectedAnswer = gameData.selectedAnswer;
                gameState.questions = gameData.questions;
                gameState.gameStarted = gameData.gameStarted;
                
                // Restore UI
                showQuestion();
                updateProgress();
                updateStats();
                
                // Resume timer
                gameState.timerInterval = setInterval(updateTimer, 1000);
                
                // Show restore notification
                showRestoreNotification();
            }
        } catch (e) {
            console.log('Could not restore game state:', e);
        }
    }
}

function showRestoreNotification() {
    const notification = document.createElement('div');
    notification.className = 'restore-notification';
    notification.innerHTML = 'üîÑ Quiz Restored';
    document.body.appendChild(notification);
    
    setTimeout(() => {
        notification.remove();
    }, 3000);
}

// Update timer to account for pause time
function updateTimer() {
    if (!gameState.startTime || !gameState.gameStarted) return;
    
    const elapsed = Math.floor((Date.now() - gameState.startTime - gameState.totalPauseTime) / 1000);
    const minutes = Math.floor(elapsed / 60);
    const seconds = elapsed % 60;
    document.getElementById('timer').textContent = `${minutes}:${seconds.toString().padStart(2, '0')}`;
}
</script>
{% endblock %}
