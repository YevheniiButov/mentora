{% extends "admin/base.html" %}

{% block title %}Send Professional Email - Communication Hub{% endblock %}

{% block extra_css %}
<style>
/* Send Professional Email Styles */
.send-email-container {
    max-width: 1200px;
    margin: 0 auto;
    padding: 20px;
}

.email-form {
    background: white;
    padding: 30px;
    border-radius: 15px;
    box-shadow: 0 5px 20px rgba(0,0,0,0.1);
    margin-bottom: 30px;
}

.form-group {
    margin-bottom: 20px;
}

.form-label {
    font-weight: 600;
    color: #2c3e50;
    margin-bottom: 8px;
    display: block;
}

.form-control {
    width: 100%;
    padding: 12px 15px;
    border: 2px solid #e9ecef;
    border-radius: 8px;
    font-size: 1rem;
    transition: border-color 0.3s;
}

.form-control:focus {
    outline: none;
    border-color: #667eea;
    box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
}

.btn {
    display: inline-block;
    padding: 12px 24px;
    border: none;
    border-radius: 8px;
    font-size: 1rem;
    font-weight: 600;
    text-decoration: none;
    cursor: pointer;
    transition: all 0.3s;
    text-align: center;
}

.btn-primary {
    background: #667eea;
    color: white;
}

.btn-primary:hover {
    background: #5a6fd8;
    transform: translateY(-2px);
}

.btn-secondary {
    background: #6c757d;
    color: white;
}

.btn-secondary:hover {
    background: #5a6268;
}

.template-selector {
    background: #f8f9fa;
    padding: 20px;
    border-radius: 10px;
    margin-bottom: 20px;
}

.recipient-list {
    max-height: 200px;
    overflow-y: auto;
    border: 1px solid #e9ecef;
    border-radius: 5px;
    padding: 10px;
}

.recipient-item {
    display: flex;
    align-items: center;
    padding: 8px;
    border-bottom: 1px solid #f1f3f4;
}

.recipient-item:last-child {
    border-bottom: none;
}

.recipient-checkbox {
    margin-right: 10px;
}

.preview-section {
    background: #f8f9fa;
    padding: 20px;
    border-radius: 10px;
    margin-top: 20px;
}

.preview-content {
    background: white;
    padding: 20px;
    border-radius: 8px;
    border: 1px solid #e9ecef;
}

/* Responsive */
@media (max-width: 768px) {
    .send-email-container {
        padding: 10px;
    }
    
    .email-form {
        padding: 20px;
    }
}
</style>
{% endblock %}

{% block content %}
<meta name="csrf-token" content="{{ csrf_token() }}">
<div class="send-email-container">
    <!-- Header -->
    <div class="d-flex justify-content-between align-items-center mb-4">
        <div>
            <h1 class="h3 mb-0 text-gray-800">üìß Send Professional Email</h1>
            <p class="text-muted">Send professional emails using templates</p>
        </div>
        <div>
            <a href="{{ url_for('communication.hub') }}" class="btn btn-secondary">
                <i class="fas fa-arrow-left"></i> Back to Hub
            </a>
        </div>
    </div>
    
    <!-- Email Form -->
    <div class="email-form">
        <form method="POST" id="emailForm">
            {{ csrf_token() }}
            
            <!-- Template Selection -->
            <div class="template-selector">
                <h5 class="mb-3">üìù Select Template</h5>
                <div class="form-group">
                    <label for="template_type" class="form-label">Email Template</label>
                    <select class="form-control" id="template_type" name="template_type" required>
                        <option value="">Select a template...</option>
                        <option value="welcome">Welcome Email</option>
                        <option value="follow_up">Follow-up Email</option>
                        <option value="reminder">Reminder Email</option>
                        <option value="notification">Notification Email</option>
                        <option value="custom">Custom Email</option>
                    </select>
                </div>
            </div>
            
            <!-- Recipients -->
            <div class="form-group">
                <label class="form-label">Recipients</label>
                <div class="recipient-list">
                    <div class="recipient-item">
                        <input type="checkbox" class="recipient-checkbox" name="recipients" value="all_users" id="all_users">
                        <label for="all_users">All Users</label>
                    </div>
                    <div class="recipient-item">
                        <input type="checkbox" class="recipient-checkbox" name="recipients" value="active_users" id="active_users">
                        <label for="active_users">Active Users Only</label>
                    </div>
                    <div class="recipient-item">
                        <input type="checkbox" class="recipient-checkbox" name="recipients" value="new_users" id="new_users">
                        <label for="new_users">New Users (Last 30 days)</label>
                    </div>
                </div>
            </div>
            
            <!-- Subject -->
            <div class="form-group">
                <label for="subject" class="form-label">Subject</label>
                <input type="text" class="form-control" id="subject" name="subject" required
                       placeholder="Enter email subject">
            </div>
            
            <!-- Additional Data -->
            <div class="form-group">
                <label for="additional_data" class="form-label">Additional Information</label>
                <textarea class="form-control" id="additional_data" name="additional_data" rows="4"
                          placeholder="Any additional information or custom message..."></textarea>
            </div>
            
            <!-- Preview Section -->
            <div class="preview-section">
                <h5 class="mb-3">üëÅÔ∏è Preview</h5>
                <div class="preview-content" id="previewContent">
                    <p class="text-muted">Select a template to see preview...</p>
                </div>
            </div>
            
            <!-- Submit Button -->
            <div class="form-group text-center">
                <button type="submit" class="btn btn-primary">
                    <i class="fas fa-paper-plane"></i> Send Email
                </button>
            </div>
        </form>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    const templateSelect = document.getElementById('template_type');
    const previewContent = document.getElementById('previewContent');
    const subjectInput = document.getElementById('subject');
    
    // Template previews
    const templates = {
        'welcome': {
            subject: 'Welcome to Mentora Dental Academy!',
            content: `
                <h3>Welcome to Mentora Dental Academy!</h3>
                <p>Dear [Name],</p>
                <p>We're excited to have you join our dental education platform. You now have access to:</p>
                <ul>
                    <li>Comprehensive dental courses</li>
                    <li>Interactive learning materials</li>
                    <li>Expert guidance and support</li>
                </ul>
                <p>Start your learning journey today!</p>
                <p>Best regards,<br>The Mentora Team</p>
            `
        },
        'follow_up': {
            subject: 'Continue Your Dental Education Journey',
            content: `
                <h3>Continue Your Dental Education Journey</h3>
                <p>Dear [Name],</p>
                <p>We noticed you haven't been active recently. Don't miss out on:</p>
                <ul>
                    <li>New course materials</li>
                    <li>Updated content</li>
                    <li>Community discussions</li>
                </ul>
                <p>Log in to continue your progress!</p>
                <p>Best regards,<br>The Mentora Team</p>
            `
        },
        'reminder': {
            subject: 'Reminder: Complete Your Course',
            content: `
                <h3>Course Completion Reminder</h3>
                <p>Dear [Name],</p>
                <p>This is a friendly reminder that you have an incomplete course:</p>
                <p><strong>[Course Name]</strong></p>
                <p>Complete it now to earn your certificate!</p>
                <p>Best regards,<br>The Mentora Team</p>
            `
        },
        'notification': {
            subject: 'New Content Available',
            content: `
                <h3>New Content Available</h3>
                <p>Dear [Name],</p>
                <p>We've added new content to the platform:</p>
                <ul>
                    <li>New courses</li>
                    <li>Updated materials</li>
                    <li>Expert insights</li>
                </ul>
                <p>Check it out now!</p>
                <p>Best regards,<br>The Mentora Team</p>
            `
        },
        'custom': {
            subject: 'Custom Email',
            content: `
                <h3>Custom Email</h3>
                <p>Dear [Name],</p>
                <p>This is a custom email message.</p>
                <p>Best regards,<br>The Mentora Team</p>
            `
        }
    };
    
    // Update preview when template changes
    templateSelect.addEventListener('change', function() {
        const selectedTemplate = this.value;
        
        if (selectedTemplate && templates[selectedTemplate]) {
            const template = templates[selectedTemplate];
            previewContent.innerHTML = template.content;
            subjectInput.value = template.subject;
        } else {
            previewContent.innerHTML = '<p class="text-muted">Select a template to see preview...</p>';
            subjectInput.value = '';
        }
    });
    
    // Handle form submission
    document.getElementById('emailForm').addEventListener('submit', function(e) {
        e.preventDefault();
        
        const formData = new FormData(this);
        const recipients = Array.from(document.querySelectorAll('input[name="recipients"]:checked')).map(cb => cb.value);
        
        if (recipients.length === 0) {
            alert('Please select at least one recipient group.');
            return;
        }
        
        if (confirm('Are you sure you want to send this email?')) {
            // Here you would typically send the email
            alert('Email sent successfully! (This is a demo - actual sending would be implemented)');
        }
    });
});
</script>
{% endblock %}
