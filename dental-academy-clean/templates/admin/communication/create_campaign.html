{% extends "admin/base.html" %}

{% block title %}–°–æ–∑–¥–∞—Ç—å –∫–∞–º–ø–∞–Ω–∏—é - Communication Hub{% endblock %}

{% block extra_css %}
<style>
.form-card {
    background: white;
    border-radius: 12px;
    padding: 30px;
    box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    border-top: 4px solid #3ECDC1;
}

.preview-card {
    background: white;
    border-radius: 12px;
    padding: 20px;
    box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    border-top: 4px solid #17a2b8;
}
</style>
{% endblock %}

{% block content %}
<div class="container-fluid">
    <!-- Header -->
    <div class="d-flex justify-content-between align-items-center mb-4">
        <div>
            <h1 class="h3 mb-0 text-gray-800">üì¢ –°–æ–∑–¥–∞—Ç—å –∫–∞–º–ø–∞–Ω–∏—é</h1>
            <p class="text-muted">–°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–π –∫–∞–º–ø–∞–Ω–∏–∏ –º–∞—Å—Å–æ–≤–æ–π —Ä–∞—Å—Å—ã–ª–∫–∏</p>
        </div>
        <div>
            <a href="{{ url_for('communication.campaigns') }}" class="btn btn-outline-secondary">
                <i class="bi bi-arrow-left"></i> –ù–∞–∑–∞–¥
            </a>
        </div>
    </div>

    <div class="row">
        <!-- Form -->
        <div class="col-md-8">
            <div class="form-card">
                <form method="POST">
                    <div class="row">
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="name" class="form-label">–ù–∞–∑–≤–∞–Ω–∏–µ –∫–∞–º–ø–∞–Ω–∏–∏ *</label>
                                <input type="text" class="form-control" id="name" name="name" required>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="email_type" class="form-label">–¢–∏–ø –ø–∏—Å—å–º–∞ *</label>
                                <select class="form-select" id="email_type" name="email_type" required>
                                    <option value="">–í—ã–±–µ—Ä–∏—Ç–µ —Ç–∏–ø</option>
                                    <option value="crm_lead">–ü–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–µ –∫–ª–∏–µ–Ω—Ç—ã</option>
                                    <option value="crm_follow_up">–ù–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è</option>
                                    <option value="crm_welcome">–ü—Ä–∏–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω—ã–µ</option>
                                    <option value="notification">–£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è</option>
                                    <option value="custom">–ö–∞—Å—Ç–æ–º–Ω—ã–µ</option>
                                </select>
                            </div>
                        </div>
                    </div>
                    
                    <div class="mb-3">
                        <label for="description" class="form-label">–û–ø–∏—Å–∞–Ω–∏–µ –∫–∞–º–ø–∞–Ω–∏–∏</label>
                        <textarea class="form-control" id="description" name="description" rows="2" 
                                  placeholder="–ö—Ä–∞—Ç–∫–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ —Ü–µ–ª–∏ –∫–∞–º–ø–∞–Ω–∏–∏"></textarea>
                    </div>
                    
                    <div class="mb-3">
                        <label for="subject" class="form-label">–¢–µ–º–∞ –ø–∏—Å—å–º–∞ *</label>
                        <input type="text" class="form-control" id="subject" name="subject" required>
                    </div>
                    
                    <div class="mb-3">
                        <label for="message" class="form-label">–°–æ–æ–±—â–µ–Ω–∏–µ *</label>
                        <textarea class="form-control" id="message" name="message" rows="8" required
                                  placeholder="–í–≤–µ–¥–∏—Ç–µ —Ç–µ–∫—Å—Ç —Å–æ–æ–±—â–µ–Ω–∏—è. –ú–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å HTML —Ç–µ–≥–∏ –¥–ª—è —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è."></textarea>
                    </div>
                    
                    <div class="row">
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="action_url" class="form-label">–°—Å—ã–ª–∫–∞ –¥–ª—è –∫–Ω–æ–ø–∫–∏</label>
                                <input type="url" class="form-control" id="action_url" name="action_url" 
                                       placeholder="https://example.com">
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="action_text" class="form-label">–¢–µ–∫—Å—Ç –∫–Ω–æ–ø–∫–∏</label>
                                <input type="text" class="form-control" id="action_text" name="action_text" 
                                       placeholder="–£–∑–Ω–∞—Ç—å –±–æ–ª—å—à–µ">
                            </div>
                        </div>
                    </div>
                    
                    <div class="row">
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="target_type" class="form-label">–¶–µ–ª–µ–≤–∞—è –∞—É–¥–∏—Ç–æ—Ä–∏—è *</label>
                                <select class="form-select" id="target_type" name="target_type" required>
                                    <option value="">–í—ã–±–µ—Ä–∏—Ç–µ –∞—É–¥–∏—Ç–æ—Ä–∏—é</option>
                                    <option value="users">–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏</option>
                                    <option value="contacts">–ö–æ–Ω—Ç–∞–∫—Ç—ã</option>
                                    <option value="both">–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –∏ –∫–æ–Ω—Ç–∞–∫—Ç—ã</option>
                                </select>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="target_filters" class="form-label">–§–∏–ª—å—Ç—Ä—ã (JSON)</label>
                                <textarea class="form-control" id="target_filters" name="target_filters" rows="3" 
                                          placeholder='{"status": "active", "profession": "dentist"}'></textarea>
                            </div>
                        </div>
                    </div>
                    
                    <div class="d-flex justify-content-between">
                        <a href="{{ url_for('communication.campaigns') }}" class="btn btn-outline-secondary">
                            –û—Ç–º–µ–Ω–∞
                        </a>
                        <button type="submit" class="btn btn-primary">
                            <i class="bi bi-save"></i> –°–æ–∑–¥–∞—Ç—å –∫–∞–º–ø–∞–Ω–∏—é
                        </button>
                    </div>
                </form>
            </div>
        </div>

        <!-- Preview -->
        <div class="col-md-4">
            <div class="preview-card">
                <h5 class="mb-3">üëÅÔ∏è –ü—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä</h5>
                <div id="preview-content">
                    <p class="text-muted">–ó–∞–ø–æ–ª–Ω–∏—Ç–µ —Ñ–æ—Ä–º—É –¥–ª—è –ø—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä–∞</p>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
// Live preview
function updatePreview() {
    const name = document.getElementById('name').value;
    const subject = document.getElementById('subject').value;
    const message = document.getElementById('message').value;
    const actionUrl = document.getElementById('action_url').value;
    const actionText = document.getElementById('action_text').value;
    const targetType = document.getElementById('target_type').value;
    
    let preview = '';
    
    if (name) {
        preview += `<h6 class="text-primary">${name}</h6>`;
    }
    
    if (subject) {
        preview += `<p><strong>–¢–µ–º–∞:</strong> ${subject}</p>`;
    }
    
    if (message) {
        preview += `<div class="border p-2 rounded bg-light">${message.replace(/\n/g, '<br>')}</div>`;
    }
    
    if (actionUrl && actionText) {
        preview += `<div class="mt-2"><a href="${actionUrl}" class="btn btn-sm btn-primary">${actionText}</a></div>`;
    }
    
    if (targetType) {
        preview += `<div class="mt-2"><small class="text-muted"><strong>–ê—É–¥–∏—Ç–æ—Ä–∏—è:</strong> ${targetType}</small></div>`;
    }
    
    if (!preview) {
        preview = '<p class="text-muted">–ó–∞–ø–æ–ª–Ω–∏—Ç–µ —Ñ–æ—Ä–º—É –¥–ª—è –ø—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä–∞</p>';
    }
    
    document.getElementById('preview-content').innerHTML = preview;
}

// Add event listeners
document.getElementById('name').addEventListener('input', updatePreview);
document.getElementById('subject').addEventListener('input', updatePreview);
document.getElementById('message').addEventListener('input', updatePreview);
document.getElementById('action_url').addEventListener('input', updatePreview);
document.getElementById('action_text').addEventListener('input', updatePreview);
document.getElementById('target_type').addEventListener('change', updatePreview);
</script>
{% endblock %}








