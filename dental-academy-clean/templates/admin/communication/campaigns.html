{% extends "admin/base.html" %}

{% block title %}–ö–∞–º–ø–∞–Ω–∏–∏ —Ä–∞—Å—Å—ã–ª–æ–∫ - Communication Hub{% endblock %}

{% block extra_css %}
<style>
.campaign-card {
    background: white;
    border-radius: 12px;
    padding: 20px;
    margin-bottom: 20px;
    box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    border-left: 4px solid #3ECDC1;
    transition: all 0.3s ease;
}

.campaign-card:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 20px rgba(0,0,0,0.15);
}

.campaign-card.draft { border-left-color: #6c757d; }
.campaign-card.scheduled { border-left-color: #ffc107; }
.campaign-card.running { border-left-color: #17a2b8; }
.campaign-card.completed { border-left-color: #28a745; }
.campaign-card.cancelled { border-left-color: #dc3545; }

.status-badge {
    padding: 6px 12px;
    border-radius: 20px;
    font-size: 0.8rem;
    font-weight: 500;
}

.status-draft { background: #6c757d; color: white; }
.status-scheduled { background: #ffc107; color: #000; }
.status-running { background: #17a2b8; color: white; }
.status-completed { background: #28a745; color: white; }
.status-cancelled { background: #dc3545; color: white; }

.progress-bar {
    height: 8px;
    border-radius: 4px;
}
</style>
{% endblock %}

{% block content %}
<div class="container-fluid">
    <!-- Header -->
    <div class="d-flex justify-content-between align-items-center mb-4">
        <div>
            <h1 class="h3 mb-0 text-gray-800">üì¢ –ö–∞–º–ø–∞–Ω–∏–∏ —Ä–∞—Å—Å—ã–ª–æ–∫</h1>
            <p class="text-muted">–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –º–∞—Å—Å–æ–≤—ã–º–∏ —Ä–∞—Å—Å—ã–ª–∫–∞–º–∏</p>
        </div>
        <div>
            <a href="{{ url_for('communication.create_campaign') }}" class="btn btn-primary me-2">
                <i class="bi bi-plus-circle"></i> –°–æ–∑–¥–∞—Ç—å –∫–∞–º–ø–∞–Ω–∏—é
            </a>
            <a href="{{ url_for('communication.hub') }}" class="btn btn-outline-secondary">
                <i class="bi bi-arrow-left"></i> –ù–∞–∑–∞–¥
            </a>
        </div>
    </div>

    <!-- Campaigns List -->
    {% if campaigns %}
        {% for campaign in campaigns %}
        <div class="campaign-card {{ campaign.status }}">
            <div class="row">
                <div class="col-md-8">
                    <div class="d-flex justify-content-between align-items-start mb-3">
                        <div>
                            <h5 class="mb-1">{{ campaign.name }}</h5>
                            <span class="status-badge status-{{ campaign.status }}">{{ campaign.status }}</span>
                        </div>
                        <div class="text-end">
                            <small class="text-muted">
                                –°–æ–∑–¥–∞–Ω–∞: {{ campaign.created_at.strftime('%d.%m.%Y') }}
                            </small>
                        </div>
                    </div>
                    
                    {% if campaign.description %}
                    <p class="text-muted mb-2">{{ campaign.description }}</p>
                    {% endif %}
                    
                    <div class="row mb-3">
                        <div class="col-md-6">
                            <strong>–¢–µ–º–∞:</strong> {{ campaign.subject }}
                        </div>
                        <div class="col-md-6">
                            <strong>–¢–∏–ø:</strong> {{ campaign.email_type }}
                        </div>
                    </div>
                    
                    <div class="row mb-3">
                        <div class="col-md-6">
                            <strong>–¶–µ–ª–µ–≤–∞—è –∞—É–¥–∏—Ç–æ—Ä–∏—è:</strong> {{ campaign.target_type }}
                        </div>
                        <div class="col-md-6">
                            <strong>–ü–æ–ª—É—á–∞—Ç–µ–ª–µ–π:</strong> {{ campaign.total_recipients }}
                        </div>
                    </div>
                    
                    {% if campaign.status in ['running', 'completed'] %}
                    <div class="mb-3">
                        <div class="d-flex justify-content-between mb-1">
                            <small>–ü—Ä–æ–≥—Ä–µ—Å—Å –æ—Ç–ø—Ä–∞–≤–∫–∏</small>
                            <small>{{ campaign.sent_count }} / {{ campaign.total_recipients }}</small>
                        </div>
                        <div class="progress">
                            <div class="progress-bar bg-primary" 
                                 style="width: {{ (campaign.sent_count / campaign.total_recipients * 100) if campaign.total_recipients > 0 else 0 }}%">
                            </div>
                        </div>
                    </div>
                    {% endif %}
                    
                    {% if campaign.scheduled_at %}
                    <div class="mb-2">
                        <strong>–ó–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–æ:</strong> {{ campaign.scheduled_at.strftime('%d.%m.%Y %H:%M') }}
                    </div>
                    {% endif %}
                    
                    {% if campaign.started_at %}
                    <div class="mb-2">
                        <strong>–ù–∞—á–∞—Ç–æ:</strong> {{ campaign.started_at.strftime('%d.%m.%Y %H:%M') }}
                    </div>
                    {% endif %}
                    
                    {% if campaign.completed_at %}
                    <div class="mb-2">
                        <strong>–ó–∞–≤–µ—Ä—à–µ–Ω–æ:</strong> {{ campaign.completed_at.strftime('%d.%m.%Y %H:%M') }}
                    </div>
                    {% endif %}
                </div>
                
                <div class="col-md-4">
                    <div class="row text-center mb-3">
                        <div class="col-6">
                            <div class="h5 text-primary">{{ campaign.sent_count }}</div>
                            <small class="text-muted">–û—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ</small>
                        </div>
                        <div class="col-6">
                            <div class="h5 text-success">{{ campaign.delivered_count }}</div>
                            <small class="text-muted">–î–æ—Å—Ç–∞–≤–ª–µ–Ω–æ</small>
                        </div>
                    </div>
                    
                    <div class="row text-center mb-3">
                        <div class="col-6">
                            <div class="h5 text-warning">{{ campaign.opened_count }}</div>
                            <small class="text-muted">–û—Ç–∫—Ä—ã—Ç–æ</small>
                        </div>
                        <div class="col-6">
                            <div class="h5 text-info">{{ campaign.clicked_count }}</div>
                            <small class="text-muted">–ö–ª–∏–∫–Ω—É—Ç–æ</small>
                        </div>
                    </div>
                    
                    {% if campaign.failed_count > 0 %}
                    <div class="row text-center mb-3">
                        <div class="col-12">
                            <div class="h5 text-danger">{{ campaign.failed_count }}</div>
                            <small class="text-muted">–û—à–∏–±–æ–∫</small>
                        </div>
                    </div>
                    {% endif %}
                    
                    <div class="btn-group-vertical w-100">
                        {% if campaign.status == 'draft' %}
                        <button class="btn btn-outline-primary btn-sm" onclick="editCampaign({{ campaign.id }})">
                            <i class="bi bi-pencil"></i> –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å
                        </button>
                        <button class="btn btn-outline-success btn-sm" onclick="startCampaign({{ campaign.id }})">
                            <i class="bi bi-play"></i> –ó–∞–ø—É—Å—Ç–∏—Ç—å
                        </button>
                        {% elif campaign.status == 'scheduled' %}
                        <button class="btn btn-outline-warning btn-sm" onclick="cancelCampaign({{ campaign.id }})">
                            <i class="bi bi-pause"></i> –û—Ç–º–µ–Ω–∏—Ç—å
                        </button>
                        {% elif campaign.status == 'running' %}
                        <button class="btn btn-outline-danger btn-sm" onclick="stopCampaign({{ campaign.id }})">
                            <i class="bi bi-stop"></i> –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å
                        </button>
                        {% endif %}
                        <button class="btn btn-outline-info btn-sm" onclick="viewCampaignDetails({{ campaign.id }})">
                            <i class="bi bi-eye"></i> –ü–æ–¥—Ä–æ–±–Ω–æ—Å—Ç–∏
                        </button>
                    </div>
                </div>
            </div>
        </div>
        {% endfor %}
    {% else %}
        <div class="text-center py-5">
            <i class="bi bi-broadcast" style="font-size: 4rem; color: #dee2e6;"></i>
            <h4 class="text-muted mt-3">–ö–∞–º–ø–∞–Ω–∏–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã</h4>
            <p class="text-muted">–°–æ–∑–¥–∞–π—Ç–µ —Å–≤–æ—é –ø–µ—Ä–≤—É—é –∫–∞–º–ø–∞–Ω–∏—é —Ä–∞—Å—Å—ã–ª–∫–∏</p>
            <a href="{{ url_for('communication.create_campaign') }}" class="btn btn-primary">
                <i class="bi bi-plus-circle"></i> –°–æ–∑–¥–∞—Ç—å –∫–∞–º–ø–∞–Ω–∏—é
            </a>
        </div>
    {% endif %}
</div>
{% endblock %}

{% block extra_js %}
<script>
function editCampaign(campaignId) {
    // TODO: Implement edit campaign functionality
    alert('–§—É–Ω–∫—Ü–∏—è —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∫–∞–º–ø–∞–Ω–∏–∏ –±—É–¥–µ—Ç –¥–æ–±–∞–≤–ª–µ–Ω–∞ –≤ —Å–ª–µ–¥—É—é—â–µ–π –≤–µ—Ä—Å–∏–∏');
}

function startCampaign(campaignId) {
    if (confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ –∑–∞–ø—É—Å—Ç–∏—Ç—å —ç—Ç—É –∫–∞–º–ø–∞–Ω–∏—é?')) {
        // TODO: Implement start campaign functionality
        alert('–§—É–Ω–∫—Ü–∏—è –∑–∞–ø—É—Å–∫–∞ –∫–∞–º–ø–∞–Ω–∏–∏ –±—É–¥–µ—Ç –¥–æ–±–∞–≤–ª–µ–Ω–∞ –≤ —Å–ª–µ–¥—É—é—â–µ–π –≤–µ—Ä—Å–∏–∏');
    }
}

function cancelCampaign(campaignId) {
    if (confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ –æ—Ç–º–µ–Ω–∏—Ç—å —ç—Ç—É –∫–∞–º–ø–∞–Ω–∏—é?')) {
        // TODO: Implement cancel campaign functionality
        alert('–§—É–Ω–∫—Ü–∏—è –æ—Ç–º–µ–Ω—ã –∫–∞–º–ø–∞–Ω–∏–∏ –±—É–¥–µ—Ç –¥–æ–±–∞–≤–ª–µ–Ω–∞ –≤ —Å–ª–µ–¥—É—é—â–µ–π –≤–µ—Ä—Å–∏–∏');
    }
}

function stopCampaign(campaignId) {
    if (confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ –æ—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —ç—Ç—É –∫–∞–º–ø–∞–Ω–∏—é?')) {
        // TODO: Implement stop campaign functionality
        alert('–§—É–Ω–∫—Ü–∏—è –æ—Å—Ç–∞–Ω–æ–≤–∫–∏ –∫–∞–º–ø–∞–Ω–∏–∏ –±—É–¥–µ—Ç –¥–æ–±–∞–≤–ª–µ–Ω–∞ –≤ —Å–ª–µ–¥—É—é—â–µ–π –≤–µ—Ä—Å–∏–∏');
    }
}

function viewCampaignDetails(campaignId) {
    // TODO: Implement view campaign details functionality
    alert('–§—É–Ω–∫—Ü–∏—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –¥–µ—Ç–∞–ª–µ–π –∫–∞–º–ø–∞–Ω–∏–∏ –±—É–¥–µ—Ç –¥–æ–±–∞–≤–ª–µ–Ω–∞ –≤ —Å–ª–µ–¥—É—é—â–µ–π –≤–µ—Ä—Å–∏–∏');
}
</script>
{% endblock %}
