{% extends "admin/base.html" %}

{% block title %}–°–æ–∑–¥–∞—Ç—å –ø—Ä–æ—Ñ–µ—Å—Å–∏—é - Mentora{% endblock %}

{% block extra_css %}
<style>
.form-card {
    background: white;
    border-radius: 15px;
    padding: 30px;
    box-shadow: 0 4px 20px rgba(0,0,0,0.1);
    border-left: 5px solid #007bff;
}

.form-header {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
    border-radius: 15px;
    padding: 20px;
    margin-bottom: 30px;
    text-align: center;
}

.category-icon {
    width: 40px;
    height: 40px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 1.2rem;
    margin-right: 10px;
}

.category-dental { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; }
.category-medical { background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%); color: white; }
.category-pharmacy { background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%); color: white; }
.category-other { background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%); color: white; }

.requirement-item {
    background: #f8f9fa;
    border-radius: 8px;
    padding: 15px;
    margin-bottom: 10px;
    border-left: 4px solid #007bff;
}

.big-exam-toggle {
    background: #e3f2fd;
    border-radius: 10px;
    padding: 20px;
    margin-bottom: 20px;
}
</style>
{% endblock %}

{% block content %}
<div class="container-fluid">
    <!-- Header -->
    <div class="d-flex justify-content-between align-items-center mb-4">
        <div>
            <h1 class="h3 mb-0 text-gray-800">‚ûï –°–æ–∑–¥–∞—Ç—å –ø—Ä–æ—Ñ–µ—Å—Å–∏—é</h1>
            <p class="text-muted">–î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤–æ–π –ø—Ä–æ—Ñ–µ—Å—Å–∏–∏ –≤ —Å–∏—Å—Ç–µ–º—É CRM</p>
        </div>
        <div>
            <a href="{{ url_for('admin.crm_professions') }}" class="btn btn-outline-primary">
                <i class="bi bi-arrow-left"></i> –ù–∞–∑–∞–¥ –∫ —Å–ø–∏—Å–∫—É
            </a>
        </div>
    </div>

    <div class="row justify-content-center">
        <div class="col-md-8">
            <div class="form-card">
                <div class="form-header">
                    <h4 class="mb-0">üë®‚Äç‚öïÔ∏è –ù–æ–≤–∞—è –ø—Ä–æ—Ñ–µ—Å—Å–∏—è</h4>
                    <p class="mb-0">–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –ø—Ä–æ—Ñ–µ—Å—Å–∏–∏</p>
                </div>

                <form method="POST">
                    <!-- Basic Information -->
                    <div class="mb-4">
                        <h5 class="mb-3">üìã –û—Å–Ω–æ–≤–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è</h5>
                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="name" class="form-label">–ù–∞–∑–≤–∞–Ω–∏–µ (–∞–Ω–≥–ª–∏–π—Å–∫–∏–π) *</label>
                                    <input type="text" class="form-control" id="name" name="name" required
                                           placeholder="–Ω–∞–ø—Ä–∏–º–µ—Ä: Dentist">
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="name_nl" class="form-label">–ù–∞–∑–≤–∞–Ω–∏–µ (–≥–æ–ª–ª–∞–Ω–¥—Å–∫–∏–π)</label>
                                    <input type="text" class="form-control" id="name_nl" name="name_nl"
                                           placeholder="–Ω–∞–ø—Ä–∏–º–µ—Ä: Tandarts">
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="code" class="form-label">–ö–æ–¥ –ø—Ä–æ—Ñ–µ—Å—Å–∏–∏ *</label>
                                    <input type="text" class="form-control" id="code" name="code" required
                                           placeholder="–Ω–∞–ø—Ä–∏–º–µ—Ä: DENT">
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="category" class="form-label">–ö–∞—Ç–µ–≥–æ—Ä–∏—è *</label>
                                    <select class="form-select" id="category" name="category" required>
                                        <option value="">–í—ã–±–µ—Ä–∏—Ç–µ –∫–∞—Ç–µ–≥–æ—Ä–∏—é</option>
                                        <option value="dental">ü¶∑ –°—Ç–æ–º–∞—Ç–æ–ª–æ–≥–∏—è</option>
                                        <option value="medical">ü©∫ –ú–µ–¥–∏—Ü–∏–Ω–∞</option>
                                        <option value="pharmacy">üíä –§–∞—Ä–º–∞—Ü–∏—è</option>
                                        <option value="other">üë®‚Äç‚öïÔ∏è –î—Ä—É–≥–æ–µ</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- BIG Exam Requirements -->
                    <div class="big-exam-toggle">
                        <h5 class="mb-3">üéì –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è BIG —ç–∫–∑–∞–º–µ–Ω–∞</h5>
                        <div class="form-check form-switch">
                            <input class="form-check-input" type="checkbox" id="big_exam_required" 
                                   name="big_exam_required" value="1" checked>
                            <label class="form-check-label" for="big_exam_required">
                                <strong>–¢—Ä–µ–±—É–µ—Ç—Å—è BIG —ç–∫–∑–∞–º–µ–Ω –¥–ª—è —ç—Ç–æ–π –ø—Ä–æ—Ñ–µ—Å—Å–∏–∏</strong>
                            </label>
                        </div>
                        <small class="text-muted">
                            –ï—Å–ª–∏ –≤–∫–ª—é—á–µ–Ω–æ, –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ —ç—Ç–æ–π –ø—Ä–æ—Ñ–µ—Å—Å–∏–∏ –¥–æ–ª–∂–Ω—ã –±—É–¥—É—Ç —Å–¥–∞—Ç—å BIG —ç–∫–∑–∞–º–µ–Ω
                        </small>
                    </div>

                    <!-- Description -->
                    <div class="mb-4">
                        <h5 class="mb-3">üìù –û–ø–∏—Å–∞–Ω–∏–µ</h5>
                        <div class="mb-3">
                            <label for="description" class="form-label">–û–ø–∏—Å–∞–Ω–∏–µ –ø—Ä–æ—Ñ–µ—Å—Å–∏–∏</label>
                            <textarea class="form-control" id="description" name="description" rows="4"
                                      placeholder="–û–ø–∏—à–∏—Ç–µ –ø—Ä–æ—Ñ–µ—Å—Å–∏—é, –µ—ë –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ –∏ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è..."></textarea>
                        </div>
                    </div>

                    <!-- Requirements -->
                    <div class="mb-4">
                        <h5 class="mb-3">üìã –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è</h5>
                        <div class="mb-3">
                            <label for="requirements" class="form-label">–¢—Ä–µ–±–æ–≤–∞–Ω–∏—è –∫ –ø—Ä–æ—Ñ–µ—Å—Å–∏–∏</label>
                            <textarea class="form-control" id="requirements" name="requirements" rows="4"
                                      placeholder="–£–∫–∞–∂–∏—Ç–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è –∫ –æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏—é, –æ–ø—ã—Ç—É, —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏..."></textarea>
                        </div>
                    </div>

                    <!-- Preview -->
                    <div class="mb-4">
                        <h5 class="mb-3">üëÅÔ∏è –ü—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω—ã–π –ø—Ä–æ—Å–º–æ—Ç—Ä</h5>
                        <div class="card">
                            <div class="card-body">
                                <div class="row align-items-center">
                                    <div class="col-md-2">
                                        <div class="category-icon category-other" id="preview-icon">
                                            üë®‚Äç‚öïÔ∏è
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <h5 class="mb-1" id="preview-name">–ù–∞–∑–≤–∞–Ω–∏–µ –ø—Ä–æ—Ñ–µ—Å—Å–∏–∏</h5>
                                        <p class="text-muted mb-1" id="preview-name-nl">–ì–æ–ª–ª–∞–Ω–¥—Å–∫–æ–µ –Ω–∞–∑–≤–∞–Ω–∏–µ</p>
                                        <p class="mb-0">
                                            <span class="badge bg-info" id="preview-category">–ö–∞—Ç–µ–≥–æ—Ä–∏—è</span>
                                            <span class="ms-2" id="preview-code">–ö–û–î</span>
                                        </p>
                                    </div>
                                    <div class="col-md-4 text-end">
                                        <span class="badge bg-success" id="preview-big">BIG —ç–∫–∑–∞–º–µ–Ω</span>
                                    </div>
                                </div>
                                <div class="mt-3" id="preview-description" style="display: none;">
                                    <strong>–û–ø–∏—Å–∞–Ω–∏–µ:</strong>
                                    <p class="mb-0" id="preview-description-text"></p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Submit Buttons -->
                    <div class="text-end">
                        <a href="{{ url_for('admin.crm_professions') }}" class="btn btn-secondary me-2">
                            <i class="bi bi-x-circle"></i> –û—Ç–º–µ–Ω–∞
                        </a>
                        <button type="submit" class="btn btn-primary btn-lg">
                            <i class="bi bi-check-lg"></i> –°–æ–∑–¥–∞—Ç—å –ø—Ä–æ—Ñ–µ—Å—Å–∏—é
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
// Update preview when form fields change
document.addEventListener('DOMContentLoaded', function() {
    const nameInput = document.getElementById('name');
    const nameNlInput = document.getElementById('name_nl');
    const codeInput = document.getElementById('code');
    const categorySelect = document.getElementById('category');
    const bigExamCheckbox = document.getElementById('big_exam_required');
    const descriptionTextarea = document.getElementById('description');

    // Preview elements
    const previewName = document.getElementById('preview-name');
    const previewNameNl = document.getElementById('preview-name-nl');
    const previewCode = document.getElementById('preview-code');
    const previewCategory = document.getElementById('preview-category');
    const previewIcon = document.getElementById('preview-icon');
    const previewBig = document.getElementById('preview-big');
    const previewDescription = document.getElementById('preview-description');
    const previewDescriptionText = document.getElementById('preview-description-text');

    function updatePreview() {
        // Update name
        previewName.textContent = nameInput.value || '–ù–∞–∑–≤–∞–Ω–∏–µ –ø—Ä–æ—Ñ–µ—Å—Å–∏–∏';
        previewNameNl.textContent = nameNlInput.value || '–ì–æ–ª–ª–∞–Ω–¥—Å–∫–æ–µ –Ω–∞–∑–≤–∞–Ω–∏–µ';
        previewCode.textContent = codeInput.value || '–ö–û–î';

        // Update category
        const category = categorySelect.value;
        if (category) {
            const categoryNames = {
                'dental': '–°—Ç–æ–º–∞—Ç–æ–ª–æ–≥–∏—è',
                'medical': '–ú–µ–¥–∏—Ü–∏–Ω–∞',
                'pharmacy': '–§–∞—Ä–º–∞—Ü–∏—è',
                'other': '–î—Ä—É–≥–æ–µ'
            };
            const categoryIcons = {
                'dental': 'ü¶∑',
                'medical': 'ü©∫',
                'pharmacy': 'üíä',
                'other': 'üë®‚Äç‚öïÔ∏è'
            };
            
            previewCategory.textContent = categoryNames[category];
            previewIcon.textContent = categoryIcons[category];
            previewIcon.className = `category-icon category-${category}`;
        } else {
            previewCategory.textContent = '–ö–∞—Ç–µ–≥–æ—Ä–∏—è';
            previewIcon.textContent = 'üë®‚Äç‚öïÔ∏è';
            previewIcon.className = 'category-icon category-other';
        }

        // Update BIG exam status
        if (bigExamCheckbox.checked) {
            previewBig.textContent = 'BIG —ç–∫–∑–∞–º–µ–Ω';
            previewBig.className = 'badge bg-success';
        } else {
            previewBig.textContent = '–ë–µ–∑ —ç–∫–∑–∞–º–µ–Ω–∞';
            previewBig.className = 'badge bg-secondary';
        }

        // Update description
        if (descriptionTextarea.value.trim()) {
            previewDescription.style.display = 'block';
            previewDescriptionText.textContent = descriptionTextarea.value;
        } else {
            previewDescription.style.display = 'none';
        }
    }

    // Add event listeners
    nameInput.addEventListener('input', updatePreview);
    nameNlInput.addEventListener('input', updatePreview);
    codeInput.addEventListener('input', updatePreview);
    categorySelect.addEventListener('change', updatePreview);
    bigExamCheckbox.addEventListener('change', updatePreview);
    descriptionTextarea.addEventListener('input', updatePreview);

    // Initial preview update
    updatePreview();
});

// Form validation
document.querySelector('form').addEventListener('submit', function(e) {
    const name = document.getElementById('name').value.trim();
    const code = document.getElementById('code').value.trim();
    const category = document.getElementById('category').value;

    if (!name || !code || !category) {
        e.preventDefault();
        alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –∑–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è (–Ω–∞–∑–≤–∞–Ω–∏–µ, –∫–æ–¥, –∫–∞—Ç–µ–≥–æ—Ä–∏—è)');
        return false;
    }

    // Check if code is unique (basic client-side validation)
    if (code.length < 2) {
        e.preventDefault();
        alert('–ö–æ–¥ –ø—Ä–æ—Ñ–µ—Å—Å–∏–∏ –¥–æ–ª–∂–µ–Ω —Å–æ–¥–µ—Ä–∂–∞—Ç—å –º–∏–Ω–∏–º—É–º 2 —Å–∏–º–≤–æ–ª–∞');
        return false;
    }
});
</script>
{% endblock %}
