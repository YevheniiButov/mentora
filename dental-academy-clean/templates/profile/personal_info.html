{% extends "base.html" %}

{% block title %}{{ t('personal_info', lang) | default('Personal Information') }} - Mentora{% endblock %}

{% block description %}{{ t('personal_info_description', lang) | default('Update your personal information and professional details') }}{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/auth.css') }}">
<style>
:root {
    --primary-color: #667eea;
    --primary-dark: #5568d3;
    --primary-light: #764ba2;
    --secondary-color: #f093fb;
    --success-color: #10b981;
    --error-color: #ef4444;
    --text-primary: #1f2937;
    --text-secondary: #6b7280;
    --border-color: #e5e7eb;
    --bg-light: #f9fafb;
    --bg-white: #ffffff;
    --shadow-sm: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
    --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
    --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
    --shadow-xl: 0 20px 25px -5px rgba(0, 0, 0, 0.1);
}

.personal-info-container {
    max-width: 900px;
    margin: 0 auto;
    padding: 20px;
    padding-top: 100px;
    background: linear-gradient(to bottom, #f9fafb, #ffffff);
    min-height: 100vh;
}

.personal-info-header {
    text-align: center;
    margin-bottom: 50px;
    position: relative;
}

.personal-info-header::after {
    content: '';
    position: absolute;
    bottom: -20px;
    left: 50%;
    transform: translateX(-50%);
    width: 60px;
    height: 4px;
    background: linear-gradient(90deg, var(--primary-color), var(--primary-light));
    border-radius: 2px;
}

.personal-info-header h1 {
    color: var(--text-primary);
    margin-bottom: 12px;
    font-size: 2.5rem;
    font-weight: 700;
    background: linear-gradient(135deg, var(--primary-color), var(--primary-light));
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
}

.personal-info-header p {
    color: var(--text-secondary);
    font-size: 1.1rem;
    font-weight: 400;
}

.personal-info-form {
    background: var(--bg-white);
    border-radius: 20px;
    box-shadow: var(--shadow-xl);
    padding: 40px;
    position: relative;
    overflow: hidden;
}

.personal-info-form::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    height: 4px;
    background: linear-gradient(90deg, var(--primary-color), var(--primary-light), var(--secondary-color));
}

.form-section {
    margin-bottom: 40px;
    padding: 30px;
    background: var(--bg-light);
    border-radius: 16px;
    border: 1px solid var(--border-color);
    transition: all 0.3s ease;
}

.form-section:hover {
    box-shadow: var(--shadow-md);
    transform: translateY(-2px);
}

.form-section:last-child {
    border-bottom: none;
}

.form-section h3 {
    color: var(--text-primary);
    margin-bottom: 24px;
    font-size: 1.25rem;
    font-weight: 600;
    display: flex;
    align-items: center;
    padding-bottom: 12px;
    border-bottom: 2px solid var(--border-color);
}

.form-section h3 i {
    margin-right: 12px;
    color: var(--primary-color);
    font-size: 1.3rem;
    width: 32px;
    height: 32px;
    display: flex;
    align-items: center;
    justify-content: center;
    background: linear-gradient(135deg, rgba(102, 126, 234, 0.1), rgba(118, 75, 162, 0.1));
    border-radius: 8px;
}

.form-row {
    display: flex;
    gap: 24px;
    margin-bottom: 24px;
}

.form-group {
    flex: 1;
    margin-bottom: 24px;
}

.form-group label {
    display: block;
    margin-bottom: 8px;
    font-weight: 600;
    color: var(--text-primary);
    font-size: 0.95rem;
    letter-spacing: 0.3px;
}

.form-group input,
.form-group select,
.form-group textarea {
    width: 100%;
    padding: 14px 16px;
    border: 2px solid var(--border-color);
    border-radius: 12px;
    font-size: 15px;
    transition: all 0.3s ease;
    background: var(--bg-white);
    color: var(--text-primary);
    font-family: inherit;
}

.form-group input:hover,
.form-group select:hover,
.form-group textarea:hover {
    border-color: var(--primary-color);
    box-shadow: var(--shadow-sm);
}

.form-group input:focus,
.form-group select:focus,
.form-group textarea:focus {
    outline: none;
    border-color: var(--primary-color);
    box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
    transform: translateY(-1px);
}

.form-group input.readonly-field {
    background: var(--bg-light);
    color: var(--text-secondary);
    cursor: not-allowed;
    border-color: var(--border-color);
}

.form-group input.readonly-field:hover {
    border-color: var(--border-color);
    box-shadow: none;
    transform: none;
}

.form-group input.readonly-field:focus {
    border-color: var(--border-color);
    box-shadow: none;
    transform: none;
}

.form-group .help-text {
    font-size: 0.875rem;
    color: var(--text-secondary);
    margin-top: 6px;
    font-weight: 400;
}

.required {
    color: var(--error-color);
    font-weight: 600;
}

.file-upload {
    border: 2px dashed var(--border-color);
    border-radius: 12px;
    padding: 24px;
    text-align: center;
    transition: all 0.3s ease;
    background: var(--bg-light);
}

.file-upload:hover {
    border-color: var(--primary-color);
    background: rgba(102, 126, 234, 0.05);
    transform: translateY(-2px);
}

.file-upload input[type="file"] {
    display: none;
}

.file-upload-label {
    cursor: pointer;
    color: var(--primary-color);
    font-weight: 600;
    font-size: 15px;
    display: inline-flex;
    align-items: center;
    gap: 8px;
    transition: color 0.3s ease;
}

.file-upload-label:hover {
    color: var(--primary-dark);
}

.uploaded-files {
    margin-top: 16px;
}

.uploaded-file {
    display: flex;
    align-items: center;
    justify-content: space-between;
    background: var(--bg-white);
    padding: 12px 16px;
    border-radius: 10px;
    margin-bottom: 8px;
    border: 1px solid var(--border-color);
    transition: all 0.2s ease;
}

.uploaded-file:hover {
    box-shadow: var(--shadow-sm);
    border-color: var(--primary-color);
}

.uploaded-file .file-name {
    font-weight: 500;
    color: var(--text-primary);
}

.uploaded-file .remove-file {
    color: var(--error-color);
    cursor: pointer;
    font-weight: bold;
    font-size: 1.2rem;
    padding: 4px 8px;
    border-radius: 6px;
    transition: all 0.2s ease;
}

.uploaded-file .remove-file:hover {
    background: rgba(239, 68, 68, 0.1);
    transform: scale(1.1);
}

.checkbox-group {
    display: flex;
    align-items: center;
    margin-bottom: 16px;
    padding: 12px;
    border-radius: 10px;
    transition: background-color 0.2s ease;
}

.checkbox-group:hover {
    background: var(--bg-light);
}

.checkbox-group input[type="checkbox"] {
    margin-right: 12px;
    transform: scale(1.3);
    cursor: pointer;
    accent-color: var(--primary-color);
}

.checkbox-group label {
    margin-bottom: 0;
    font-weight: 500;
    color: var(--text-primary);
    cursor: pointer;
}

.submit-section {
    text-align: center;
    margin-top: 40px;
    padding-top: 30px;
    border-top: 2px solid var(--border-color);
    display: flex;
    justify-content: center;
    align-items: center;
    gap: 20px;
    flex-wrap: wrap;
}

.btn-back {
    display: inline-flex;
    align-items: center;
    gap: 8px;
    padding: 12px 24px;
    background: var(--bg-white);
    color: var(--text-secondary);
    border: 2px solid var(--border-color);
    border-radius: 12px;
    font-size: 15px;
    font-weight: 600;
    text-decoration: none;
    transition: all 0.3s ease;
    cursor: pointer;
}

.btn-back:hover {
    background: var(--bg-light);
    border-color: var(--text-secondary);
    color: var(--text-primary);
    transform: translateY(-2px);
    box-shadow: var(--shadow-md);
}

.btn-register,
.btn-save {
    background: linear-gradient(135deg, var(--primary-color), var(--primary-light));
    color: white;
    padding: 14px 36px;
    border: none;
    border-radius: 12px;
    font-size: 16px;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.3s ease;
    min-width: 180px;
    box-shadow: var(--shadow-md);
    display: inline-flex;
    align-items: center;
    justify-content: center;
    gap: 8px;
}

.btn-register:hover,
.btn-save:hover {
    transform: translateY(-3px);
    box-shadow: var(--shadow-lg);
    background: linear-gradient(135deg, var(--primary-dark), var(--primary-color));
}

.btn-register:active,
.btn-save:active {
    transform: translateY(-1px);
}

.btn-register:disabled,
.btn-save:disabled {
    background: var(--text-secondary);
    cursor: not-allowed;
    transform: none;
    box-shadow: none;
    opacity: 0.6;
}

.error-message {
    color: var(--error-color);
    font-size: 0.875rem;
    margin-top: 6px;
    font-weight: 500;
    display: flex;
    align-items: center;
    gap: 6px;
}

.error-message::before {
    content: 'âš ';
    font-size: 1rem;
}

.success-message {
    color: var(--success-color);
    font-size: 0.875rem;
    margin-top: 6px;
    font-weight: 500;
    display: flex;
    align-items: center;
    gap: 6px;
}

.success-message::before {
    content: 'âœ“';
    font-size: 1rem;
}

/* Ð¨Ð°Ð³Ð¸ Ð½Ð°Ð²Ð¸Ð³Ð°Ñ†Ð¸Ð¸ ÑƒÐ´Ð°Ð»ÐµÐ½Ñ‹ */

.consent-block {
    background: linear-gradient(135deg, rgba(102, 126, 234, 0.05), rgba(118, 75, 162, 0.05));
    border: 2px solid var(--border-color);
    border-left: 4px solid var(--primary-color);
    border-radius: 12px;
    padding: 24px;
    margin-bottom: 24px;
    transition: all 0.3s ease;
}

.consent-block:hover {
    box-shadow: var(--shadow-md);
    border-left-color: var(--primary-light);
}

.consent-block h4 {
    color: var(--text-primary);
    margin-bottom: 16px;
    font-size: 1.1rem;
    font-weight: 600;
    display: flex;
    align-items: center;
}

.consent-block h4 i {
    margin-right: 12px;
    color: var(--primary-color);
    font-size: 1.2rem;
}

.consent-content {
    margin-bottom: 16px;
}

.consent-content p {
    margin-bottom: 12px;
    color: var(--text-primary);
    font-weight: 500;
    line-height: 1.6;
}

.consent-content ul {
    margin: 12px 0;
    padding-left: 24px;
}

.consent-content li {
    margin-bottom: 8px;
    color: var(--text-secondary);
    line-height: 1.6;
}

.signature-block {
    background: linear-gradient(135deg, rgba(245, 158, 11, 0.1), rgba(251, 191, 36, 0.1));
    border: 2px solid rgba(245, 158, 11, 0.3);
    border-left: 4px solid #f59e0b;
    border-radius: 12px;
    padding: 24px;
    margin-top: 24px;
    transition: all 0.3s ease;
}

.signature-block:hover {
    box-shadow: var(--shadow-md);
    border-left-color: #d97706;
}

.signature-block h4 {
    color: #92400e;
    margin-bottom: 16px;
    font-size: 1.1rem;
    font-weight: 600;
}

.signature-block .form-group {
    margin-bottom: 0;
}

.phone-input-group {
    display: flex;
    gap: 12px;
    align-items: stretch;
}

.country-code-select {
    flex: 0 0 200px;
    padding: 14px 16px;
    border: 2px solid var(--border-color);
    border-radius: 12px;
    font-size: 15px;
    background: var(--bg-white);
    transition: all 0.3s ease;
    color: var(--text-primary);
}

.country-code-select:hover {
    border-color: var(--primary-color);
    box-shadow: var(--shadow-sm);
}

.country-code-select:focus {
    outline: none;
    border-color: var(--primary-color);
    box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
}

.phone-number-input {
    flex: 1;
    padding: 14px 16px;
    border: 2px solid var(--border-color);
    border-radius: 12px;
    font-size: 15px;
    transition: all 0.3s ease;
    background: var(--bg-white);
    color: var(--text-primary);
}

.phone-number-input:hover {
    border-color: var(--primary-color);
    box-shadow: var(--shadow-sm);
}

.phone-number-input:focus {
    outline: none;
    border-color: var(--primary-color);
    box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
    transform: translateY(-1px);
}

@media (max-width: 768px) {
    .personal-info-container {
        padding: 16px;
        padding-top: 80px;
    }

    .personal-info-header h1 {
        font-size: 2rem;
    }

    .personal-info-form {
        padding: 24px 20px;
        border-radius: 16px;
    }

    .form-section {
        padding: 20px;
        margin-bottom: 24px;
    }

    .form-row {
        flex-direction: column;
        gap: 0;
    }
    
    .consent-block,
    .signature-block {
        padding: 16px;
    }
    
    .phone-input-group {
        flex-direction: column;
        gap: 12px;
    }
    
    .country-code-select {
        flex: none;
        width: 100%;
    }

    .submit-section {
        flex-direction: column;
    }

    .btn-back,
    .btn-register,
    .btn-save {
        width: 100%;
    }
}

.password-input-container {
    position: relative;
    display: flex;
    align-items: center;
}

.password-input-container input {
    padding-right: 45px;
}

.password-toggle {
    position: absolute;
    right: 14px;
    top: 50%;
    transform: translateY(-50%);
    background: none;
    border: none;
    cursor: pointer;
    color: var(--text-secondary);
    font-size: 18px;
    padding: 6px;
    border-radius: 6px;
    transition: all 0.2s ease;
    display: flex;
    align-items: center;
    justify-content: center;
}

.password-toggle:hover {
    color: var(--primary-color);
    background: rgba(102, 126, 234, 0.1);
}

.password-toggle:focus {
    outline: none;
    color: var(--primary-color);
    box-shadow: 0 0 0 2px rgba(102, 126, 234, 0.2);
}

.nationality-search-container {
    position: relative;
    margin-bottom: 12px;
}

.nationality-search {
    width: 100%;
    padding: 14px 40px 14px 16px;
    border: 2px solid var(--border-color);
    border-radius: 12px;
    font-size: 15px;
    transition: all 0.3s ease;
    background: var(--bg-white);
    color: var(--text-primary);
}

.nationality-search:hover {
    border-color: var(--primary-color);
    box-shadow: var(--shadow-sm);
}

.nationality-search:focus {
    outline: none;
    border-color: var(--primary-color);
    box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
}

.nationality-search-icon {
    position: absolute;
    right: 14px;
    top: 50%;
    transform: translateY(-50%);
    color: var(--text-secondary);
    font-size: 16px;
}

.nationality-select {
    max-height: 200px;
    overflow-y: auto;
    border-radius: 12px;
}

.nationality-select option {
    padding: 12px 16px;
    transition: background-color 0.2s ease;
}

.nationality-select option:hover {
    background: rgba(102, 126, 234, 0.1);
}

.year-range-container {
    display: flex;
    align-items: center;
    gap: 12px;
}

.year-input {
    flex: 1;
    padding: 14px 16px;
    border: 2px solid var(--border-color);
    border-radius: 12px;
    font-size: 15px;
    transition: all 0.3s ease;
    background: var(--bg-white);
    color: var(--text-primary);
}

.year-input:hover {
    border-color: var(--primary-color);
    box-shadow: var(--shadow-sm);
}

.year-input:focus {
    outline: none;
    border-color: var(--primary-color);
    box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
    transform: translateY(-1px);
}

.year-separator {
    color: var(--text-secondary);
    font-weight: 700;
    font-size: 18px;
    padding: 0 4px;
}
</style>
{% endblock %}

{% block content %}
<div class="personal-info-container">
    <div class="personal-info-header">
        <h1>{{ t('personal_info', lang) | default('Personal Information') }}</h1>
        <p>{{ t('personal_info_subtitle', lang) | default('Update your personal information and professional details') }}</p>
    </div>

    <form class="personal-info-form" id="personalInfoForm" method="POST" action="{{ url_for('profile.update_personal_info', lang=lang) }}">
        <input type="hidden" name="csrf_token" value="{{ csrf_token() }}"/>
        
        <!-- Personal Information Section -->
        <div class="form-section">
            <h3><i class="fas fa-user"></i> {{ t('personal_information', lang) | default('Personal Information') }}</h3>
            
            <div class="form-row">
                <div class="form-group">
                    <label for="first_name">{{ t('first_name', lang) | default('First Name') }} <span class="required">*</span></label>
                    <input type="text" id="first_name" name="first_name" value="{{ user.first_name or '' }}" autocomplete="given-name" required>
                </div>
                <div class="form-group">
                    <label for="last_name">{{ t('last_name', lang) | default('Last Name') }} <span class="required">*</span></label>
                    <input type="text" id="last_name" name="last_name" value="{{ user.last_name or '' }}" autocomplete="family-name" required>
                </div>
            </div>

            <div class="form-row">
                <div class="form-group">
                    <label for="email">{{ t('email', lang) | default('Email') }} <span class="required">*</span></label>
                    <input type="email" id="email" name="email" value="{{ user.email }}" class="readonly-field" readonly>
                    <div class="help-text">{{ t('email_cannot_be_changed', lang) | default('Email cannot be changed') }}</div>
                </div>
                <div class="form-group">
                    <label for="phone">{{ t('phone', lang) | default('Phone Number') }}</label>
                    <div class="phone-input-group">
                        <select id="country_code" name="country_code" class="country-code-select">
                            <option value="+31" {% if user.country_code == '+31' %}selected{% endif %}>ðŸ‡³ðŸ‡± +31 (Netherlands)</option>
                            <option value="+49" {% if user.country_code == '+49' %}selected{% endif %}>ðŸ‡©ðŸ‡ª +49 (Germany)</option>
                            <option value="+32" {% if user.country_code == '+32' %}selected{% endif %}>ðŸ‡§ðŸ‡ª +32 (Belgium)</option>
                            <option value="+33" {% if user.country_code == '+33' %}selected{% endif %}>ðŸ‡«ðŸ‡· +33 (France)</option>
                            <option value="+34" {% if user.country_code == '+34' %}selected{% endif %}>ðŸ‡ªðŸ‡¸ +34 (Spain)</option>
                            <option value="+39" {% if user.country_code == '+39' %}selected{% endif %}>ðŸ‡®ðŸ‡¹ +39 (Italy)</option>
                            <option value="+351" {% if user.country_code == '+351' %}selected{% endif %}>ðŸ‡µðŸ‡¹ +351 (Portugal)</option>
                            <option value="+48" {% if user.country_code == '+48' %}selected{% endif %}>ðŸ‡µðŸ‡± +48 (Poland)</option>
                            <option value="+40" {% if user.country_code == '+40' %}selected{% endif %}>ðŸ‡·ðŸ‡´ +40 (Romania)</option>
                            <option value="+359" {% if user.country_code == '+359' %}selected{% endif %}>ðŸ‡§ðŸ‡¬ +359 (Bulgaria)</option>
                            <option value="+36" {% if user.country_code == '+36' %}selected{% endif %}>ðŸ‡­ðŸ‡º +36 (Hungary)</option>
                            <option value="+420" {% if user.country_code == '+420' %}selected{% endif %}>ðŸ‡¨ðŸ‡¿ +420 (Czech Republic)</option>
                            <option value="+421" {% if user.country_code == '+421' %}selected{% endif %}>ðŸ‡¸ðŸ‡° +421 (Slovakia)</option>
                            <option value="+385" {% if user.country_code == '+385' %}selected{% endif %}>ðŸ‡­ðŸ‡· +385 (Croatia)</option>
                            <option value="+386" {% if user.country_code == '+386' %}selected{% endif %}>ðŸ‡¸ðŸ‡® +386 (Slovenia)</option>
                            <option value="+372" {% if user.country_code == '+372' %}selected{% endif %}>ðŸ‡ªðŸ‡ª +372 (Estonia)</option>
                            <option value="+371" {% if user.country_code == '+371' %}selected{% endif %}>ðŸ‡±ðŸ‡» +371 (Latvia)</option>
                            <option value="+370" {% if user.country_code == '+370' %}selected{% endif %}>ðŸ‡±ðŸ‡¹ +370 (Lithuania)</option>
                            <option value="+356" {% if user.country_code == '+356' %}selected{% endif %}>ðŸ‡²ðŸ‡¹ +356 (Malta)</option>
                            <option value="+357" {% if user.country_code == '+357' %}selected{% endif %}>ðŸ‡¨ðŸ‡¾ +357 (Cyprus)</option>
                            <option value="+352" {% if user.country_code == '+352' %}selected{% endif %}>ðŸ‡±ðŸ‡º +352 (Luxembourg)</option>
                            <option value="+43" {% if user.country_code == '+43' %}selected{% endif %}>ðŸ‡¦ðŸ‡¹ +43 (Austria)</option>
                            <option value="+41" {% if user.country_code == '+41' %}selected{% endif %}>ðŸ‡¨ðŸ‡­ +41 (Switzerland)</option>
                            <option value="+46" {% if user.country_code == '+46' %}selected{% endif %}>ðŸ‡¸ðŸ‡ª +46 (Sweden)</option>
                            <option value="+47" {% if user.country_code == '+47' %}selected{% endif %}>ðŸ‡³ðŸ‡´ +47 (Norway)</option>
                            <option value="+45" {% if user.country_code == '+45' %}selected{% endif %}>ðŸ‡©ðŸ‡° +45 (Denmark)</option>
                            <option value="+358" {% if user.country_code == '+358' %}selected{% endif %}>ðŸ‡«ðŸ‡® +358 (Finland)</option>
                            <option value="+354" {% if user.country_code == '+354' %}selected{% endif %}>ðŸ‡®ðŸ‡¸ +354 (Iceland)</option>
                            <option value="+353" {% if user.country_code == '+353' %}selected{% endif %}>ðŸ‡®ðŸ‡ª +353 (Ireland)</option>
                            <option value="+44" {% if user.country_code == '+44' %}selected{% endif %}>ðŸ‡¬ðŸ‡§ +44 (United Kingdom)</option>
                            <option value="+1" {% if user.country_code == '+1' %}selected{% endif %}>ðŸ‡ºðŸ‡¸ +1 (United States)</option>
                            <option value="+1" {% if user.country_code == '+1' %}selected{% endif %}>ðŸ‡¨ðŸ‡¦ +1 (Canada)</option>
                            <option value="+61" {% if user.country_code == '+61' %}selected{% endif %}>ðŸ‡¦ðŸ‡º +61 (Australia)</option>
                            <option value="+64" {% if user.country_code == '+64' %}selected{% endif %}>ðŸ‡³ðŸ‡¿ +64 (New Zealand)</option>
                            <option value="+27" {% if user.country_code == '+27' %}selected{% endif %}>ðŸ‡¿ðŸ‡¦ +27 (South Africa)</option>
                            <option value="+55" {% if user.country_code == '+55' %}selected{% endif %}>ðŸ‡§ðŸ‡· +55 (Brazil)</option>
                            <option value="+54" {% if user.country_code == '+54' %}selected{% endif %}>ðŸ‡¦ðŸ‡· +54 (Argentina)</option>
                            <option value="+52" {% if user.country_code == '+52' %}selected{% endif %}>ðŸ‡²ðŸ‡½ +52 (Mexico)</option>
                            <option value="+91" {% if user.country_code == '+91' %}selected{% endif %}>ðŸ‡®ðŸ‡³ +91 (India)</option>
                            <option value="+86" {% if user.country_code == '+86' %}selected{% endif %}>ðŸ‡¨ðŸ‡³ +86 (China)</option>
                            <option value="+81" {% if user.country_code == '+81' %}selected{% endif %}>ðŸ‡¯ðŸ‡µ +81 (Japan)</option>
                            <option value="+82" {% if user.country_code == '+82' %}selected{% endif %}>ðŸ‡°ðŸ‡· +82 (South Korea)</option>
                            <option value="+66" {% if user.country_code == '+66' %}selected{% endif %}>ðŸ‡¹ðŸ‡­ +66 (Thailand)</option>
                            <option value="+84" {% if user.country_code == '+84' %}selected{% endif %}>ðŸ‡»ðŸ‡³ +84 (Vietnam)</option>
                            <option value="+63" {% if user.country_code == '+63' %}selected{% endif %}>ðŸ‡µðŸ‡­ +63 (Philippines)</option>
                            <option value="+62" {% if user.country_code == '+62' %}selected{% endif %}>ðŸ‡®ðŸ‡© +62 (Indonesia)</option>
                            <option value="+60" {% if user.country_code == '+60' %}selected{% endif %}>ðŸ‡²ðŸ‡¾ +60 (Malaysia)</option>
                            <option value="+65" {% if user.country_code == '+65' %}selected{% endif %}>ðŸ‡¸ðŸ‡¬ +65 (Singapore)</option>
                            <option value="+90" {% if user.country_code == '+90' %}selected{% endif %}>ðŸ‡¹ðŸ‡· +90 (Turkey)</option>
                            <option value="+20" {% if user.country_code == '+20' %}selected{% endif %}>ðŸ‡ªðŸ‡¬ +20 (Egypt)</option>
                            <option value="+212" {% if user.country_code == '+212' %}selected{% endif %}>ðŸ‡²ðŸ‡¦ +212 (Morocco)</option>
                            <option value="+216" {% if user.country_code == '+216' %}selected{% endif %}>ðŸ‡¹ðŸ‡³ +216 (Tunisia)</option>
                            <option value="+213" {% if user.country_code == '+213' %}selected{% endif %}>ðŸ‡©ðŸ‡¿ +213 (Algeria)</option>
                            <option value="+234" {% if user.country_code == '+234' %}selected{% endif %}>ðŸ‡³ðŸ‡¬ +234 (Nigeria)</option>
                            <option value="+254" {% if user.country_code == '+254' %}selected{% endif %}>ðŸ‡°ðŸ‡ª +254 (Kenya)</option>
                            <option value="+233" {% if user.country_code == '+233' %}selected{% endif %}>ðŸ‡¬ðŸ‡­ +233 (Ghana)</option>
                            <option value="+251" {% if user.country_code == '+251' %}selected{% endif %}>ðŸ‡ªðŸ‡¹ +251 (Ethiopia)</option>
                            <option value="+380" {% if user.country_code == '+380' %}selected{% endif %}>ðŸ‡ºðŸ‡¦ +380 (Ukraine)</option>
                            <option value="+375" {% if user.country_code == '+375' %}selected{% endif %}>ðŸ‡§ðŸ‡¾ +375 (Belarus)</option>
                            <option value="+7" {% if user.country_code == '+7' %}selected{% endif %}>ðŸ‡·ðŸ‡º +7 (Russia)</option>
                            <option value="+381" {% if user.country_code == '+381' %}selected{% endif %}>ðŸ‡·ðŸ‡¸ +381 (Serbia)</option>
                            <option value="+387" {% if user.country_code == '+387' %}selected{% endif %}>ðŸ‡§ðŸ‡¦ +387 (Bosnia)</option>
                            <option value="+382" {% if user.country_code == '+382' %}selected{% endif %}>ðŸ‡²ðŸ‡ª +382 (Montenegro)</option>
                            <option value="+389" {% if user.country_code == '+389' %}selected{% endif %}>ðŸ‡²ðŸ‡° +389 (Macedonia)</option>
                            <option value="+355" {% if user.country_code == '+355' %}selected{% endif %}>ðŸ‡¦ðŸ‡± +355 (Albania)</option>
                            <option value="+373" {% if user.country_code == '+373' %}selected{% endif %}>ðŸ‡²ðŸ‡© +373 (Moldova)</option>
                        </select>
                        <input type="tel" id="phone" name="phone" value="{{ user.phone or '' }}" placeholder="{{ t('phone_placeholder', lang) | default('123456789') }}" class="phone-number-input" autocomplete="tel">
                    </div>
                </div>
            </div>


            <div class="form-row">
                <div class="form-group">
                    <label for="birth_date">{{ t('birth_date', lang) | default('Date of Birth') }} <span class="required">*</span></label>
                    <input type="date" id="birth_date" name="birth_date" value="{{ user.birth_date or '' }}" required>
                </div>
                <div class="form-group">
                    <label for="nationality">{{ t('nationality', lang) | default('Nationality') }} <span class="required">*</span></label>
                    <div class="nationality-search-container">
                        <input type="text" id="nationality_search" placeholder="{{ t('search_nationality', lang) | default('Search nationality...') }}" class="nationality-search">
                        <i class="fas fa-search nationality-search-icon"></i>
                    </div>
                    <select id="nationality" name="nationality" required onchange="toggleOtherField('nationality', 'other_nationality')" class="nationality-select">
                        <option value="">{{ t('select_nationality', lang) | default('Select Nationality') }}</option>
                        <!-- All countries sorted alphabetically -->
                        <option value="AL" {% if user.nationality == 'AL' %}selected{% endif %}>{{ t('albanian', lang) | default('Albanian') }}</option>
                        <option value="DZ" {% if user.nationality == 'DZ' %}selected{% endif %}>{{ t('algerian', lang) | default('Algerian') }}</option>
                        <option value="AR" {% if user.nationality == 'AR' %}selected{% endif %}>{{ t('argentinian', lang) | default('Argentinian') }}</option>
                        <option value="AU" {% if user.nationality == 'AU' %}selected{% endif %}>{{ t('australian', lang) | default('Australian') }}</option>
                        <option value="AT" {% if user.nationality == 'AT' %}selected{% endif %}>{{ t('austrian', lang) | default('Austrian') }}</option>
                        <option value="BA" {% if user.nationality == 'BA' %}selected{% endif %}>{{ t('bosnian', lang) | default('Bosnian') }}</option>
                        <option value="BR" {% if user.nationality == 'BR' %}selected{% endif %}>{{ t('brazilian', lang) | default('Brazilian') }}</option>
                        <option value="BG" {% if user.nationality == 'BG' %}selected{% endif %}>{{ t('bulgarian', lang) | default('Bulgarian') }}</option>
                        <option value="BY" {% if user.nationality == 'BY' %}selected{% endif %}>{{ t('belarusian', lang) | default('Belarusian') }}</option>
                        <option value="BE" {% if user.nationality == 'BE' %}selected{% endif %}>{{ t('belgian', lang) | default('Belgian') }}</option>
                        <option value="GB" {% if user.nationality == 'GB' %}selected{% endif %}>{{ t('british', lang) | default('British') }}</option>
                        <option value="CA" {% if user.nationality == 'CA' %}selected{% endif %}>{{ t('canadian', lang) | default('Canadian') }}</option>
                        <option value="CN" {% if user.nationality == 'CN' %}selected{% endif %}>{{ t('chinese', lang) | default('Chinese') }}</option>
                        <option value="HR" {% if user.nationality == 'HR' %}selected{% endif %}>{{ t('croatian', lang) | default('Croatian') }}</option>
                        <option value="CY" {% if user.nationality == 'CY' %}selected{% endif %}>{{ t('cypriot', lang) | default('Cypriot') }}</option>
                        <option value="CZ" {% if user.nationality == 'CZ' %}selected{% endif %}>{{ t('czech', lang) | default('Czech') }}</option>
                        <option value="DK" {% if user.nationality == 'DK' %}selected{% endif %}>{{ t('danish', lang) | default('Danish') }}</option>
                        <option value="EG" {% if user.nationality == 'EG' %}selected{% endif %}>{{ t('egyptian', lang) | default('Egyptian') }}</option>
                        <option value="ET" {% if user.nationality == 'ET' %}selected{% endif %}>{{ t('ethiopian', lang) | default('Ethiopian') }}</option>
                        <option value="EE" {% if user.nationality == 'EE' %}selected{% endif %}>{{ t('estonian', lang) | default('Estonian') }}</option>
                        <option value="FI" {% if user.nationality == 'FI' %}selected{% endif %}>{{ t('finnish', lang) | default('Finnish') }}</option>
                        <option value="FR" {% if user.nationality == 'FR' %}selected{% endif %}>{{ t('french', lang) | default('French') }}</option>
                        <option value="DE" {% if user.nationality == 'DE' %}selected{% endif %}>{{ t('german', lang) | default('German') }}</option>
                        <option value="GH" {% if user.nationality == 'GH' %}selected{% endif %}>{{ t('ghanaian', lang) | default('Ghanaian') }}</option>
                        <option value="GR" {% if user.nationality == 'GR' %}selected{% endif %}>{{ t('greek', lang) | default('Greek') }}</option>
                        <option value="HU" {% if user.nationality == 'HU' %}selected{% endif %}>{{ t('hungarian', lang) | default('Hungarian') }}</option>
                        <option value="IS" {% if user.nationality == 'IS' %}selected{% endif %}>{{ t('icelandic', lang) | default('Icelandic') }}</option>
                        <option value="IN" {% if user.nationality == 'IN' %}selected{% endif %}>{{ t('indian', lang) | default('Indian') }}</option>
                        <option value="ID" {% if user.nationality == 'ID' %}selected{% endif %}>{{ t('indonesian', lang) | default('Indonesian') }}</option>
                        <option value="IE" {% if user.nationality == 'IE' %}selected{% endif %}>{{ t('irish', lang) | default('Irish') }}</option>
                        <option value="IT" {% if user.nationality == 'IT' %}selected{% endif %}>{{ t('italian', lang) | default('Italian') }}</option>
                        <option value="JP" {% if user.nationality == 'JP' %}selected{% endif %}>{{ t('japanese', lang) | default('Japanese') }}</option>
                        <option value="KE" {% if user.nationality == 'KE' %}selected{% endif %}>{{ t('kenyan', lang) | default('Kenyan') }}</option>
                        <option value="KR" {% if user.nationality == 'KR' %}selected{% endif %}>{{ t('korean', lang) | default('Korean') }}</option>
                        <option value="LV" {% if user.nationality == 'LV' %}selected{% endif %}>{{ t('latvian', lang) | default('Latvian') }}</option>
                        <option value="LT" {% if user.nationality == 'LT' %}selected{% endif %}>{{ t('lithuanian', lang) | default('Lithuanian') }}</option>
                        <option value="LU" {% if user.nationality == 'LU' %}selected{% endif %}>{{ t('luxembourgish', lang) | default('Luxembourgish') }}</option>
                        <option value="MK" {% if user.nationality == 'MK' %}selected{% endif %}>{{ t('macedonian', lang) | default('Macedonian') }}</option>
                        <option value="MT" {% if user.nationality == 'MT' %}selected{% endif %}>{{ t('maltese', lang) | default('Maltese') }}</option>
                        <option value="MX" {% if user.nationality == 'MX' %}selected{% endif %}>{{ t('mexican', lang) | default('Mexican') }}</option>
                        <option value="MD" {% if user.nationality == 'MD' %}selected{% endif %}>{{ t('moldovan', lang) | default('Moldovan') }}</option>
                        <option value="ME" {% if user.nationality == 'ME' %}selected{% endif %}>{{ t('montenegrin', lang) | default('Montenegrin') }}</option>
                        <option value="MA" {% if user.nationality == 'MA' %}selected{% endif %}>{{ t('moroccan', lang) | default('Moroccan') }}</option>
                        <option value="NL" {% if user.nationality == 'NL' %}selected{% endif %}>{{ t('dutch', lang) | default('Dutch') }}</option>
                        <option value="NZ" {% if user.nationality == 'NZ' %}selected{% endif %}>{{ t('new_zealand', lang) | default('New Zealand') }}</option>
                        <option value="NG" {% if user.nationality == 'NG' %}selected{% endif %}>{{ t('nigerian', lang) | default('Nigerian') }}</option>
                        <option value="NO" {% if user.nationality == 'NO' %}selected{% endif %}>{{ t('norwegian', lang) | default('Norwegian') }}</option>
                        <option value="PH" {% if user.nationality == 'PH' %}selected{% endif %}>{{ t('filipino', lang) | default('Filipino') }}</option>
                        <option value="PL" {% if user.nationality == 'PL' %}selected{% endif %}>{{ t('polish', lang) | default('Polish') }}</option>
                        <option value="PT" {% if user.nationality == 'PT' %}selected{% endif %}>{{ t('portuguese', lang) | default('Portuguese') }}</option>
                        <option value="RO" {% if user.nationality == 'RO' %}selected{% endif %}>{{ t('romanian', lang) | default('Romanian') }}</option>
                        <option value="RU" {% if user.nationality == 'RU' %}selected{% endif %}>{{ t('russian', lang) | default('Russian') }}</option>
                        <option value="RS" {% if user.nationality == 'RS' %}selected{% endif %}>{{ t('serbian', lang) | default('Serbian') }}</option>
                        <option value="SG" {% if user.nationality == 'SG' %}selected{% endif %}>{{ t('singaporean', lang) | default('Singaporean') }}</option>
                        <option value="SK" {% if user.nationality == 'SK' %}selected{% endif %}>{{ t('slovak', lang) | default('Slovak') }}</option>
                        <option value="SI" {% if user.nationality == 'SI' %}selected{% endif %}>{{ t('slovenian', lang) | default('Slovenian') }}</option>
                        <option value="ZA" {% if user.nationality == 'ZA' %}selected{% endif %}>{{ t('south_african', lang) | default('South African') }}</option>
                        <option value="ES" {% if user.nationality == 'ES' %}selected{% endif %}>{{ t('spanish', lang) | default('Spanish') }}</option>
                        <option value="SE" {% if user.nationality == 'SE' %}selected{% endif %}>{{ t('swedish', lang) | default('Swedish') }}</option>
                        <option value="CH" {% if user.nationality == 'CH' %}selected{% endif %}>{{ t('swiss', lang) | default('Swiss') }}</option>
                        <option value="TH" {% if user.nationality == 'TH' %}selected{% endif %}>{{ t('thai', lang) | default('Thai') }}</option>
                        <option value="TN" {% if user.nationality == 'TN' %}selected{% endif %}>{{ t('tunisian', lang) | default('Tunisian') }}</option>
                        <option value="TR" {% if user.nationality == 'TR' %}selected{% endif %}>{{ t('turkish', lang) | default('Turkish') }}</option>
                        <option value="UA" {% if user.nationality == 'UA' %}selected{% endif %}>{{ t('ukrainian', lang) | default('Ukrainian') }}</option>
                        <option value="US" {% if user.nationality == 'US' %}selected{% endif %}>{{ t('american', lang) | default('American') }}</option>
                        <option value="VN" {% if user.nationality == 'VN' %}selected{% endif %}>{{ t('vietnamese', lang) | default('Vietnamese') }}</option>
                        <option value="OTHER" {% if user.nationality == 'OTHER' %}selected{% endif %}>{{ t('other', lang) | default('Other') }}</option>
                    </select>
                </div>
            </div>

            <div class="form-group" id="other_nationality_group" style="display: none;">
                <label for="other_nationality">{{ t('specify_nationality', lang) | default('Please specify your nationality') }} <span class="required">*</span></label>
                <input type="text" id="other_nationality" name="other_nationality" value="{{ user.other_nationality or '' }}" placeholder="{{ t('nationality_placeholder', lang) | default('Enter your nationality') }}">
            </div>

            <div class="form-row">
                <div class="form-group">
                    <label for="gender">{{ t('gender', lang) | default('Gender') }}</label>
                    <select id="gender" name="gender">
                        <option value="">{{ t('select_gender', lang) | default('Select Gender') }}</option>
                        <option value="male" {% if user.gender == 'male' %}selected{% endif %}>{{ t('male', lang) | default('Male') }}</option>
                        <option value="female" {% if user.gender == 'female' %}selected{% endif %}>{{ t('female', lang) | default('Female') }}</option>
                        <option value="other" {% if user.gender == 'other' %}selected{% endif %}>{{ t('other', lang) | default('Other') }}</option>
                    </select>
                </div>
            </div>
        </div>


        <!-- Language Certificates Section -->
        <div class="form-section">
            <h3><i class="fas fa-language"></i> {{ t('language_certificates', lang) | default('Language Certificates') }}</h3>
            
            <div class="form-group">
                <label for="dutch_level">{{ t('dutch_language_level', lang) | default('Dutch Language Level') }} <span class="required">*</span></label>
                <select id="dutch_level" name="dutch_level" required>
                    <option value="">{{ t('select_level', lang) | default('Select Level') }}</option>
                    <option value="A1" {% if user.dutch_level == 'A1' %}selected{% endif %}>{{ t('a1_basic', lang) | default('A1 - Basic') }}</option>
                    <option value="A2" {% if user.dutch_level == 'A2' %}selected{% endif %}>{{ t('a2_elementary', lang) | default('A2 - Elementary') }}</option>
                    <option value="B1" {% if user.dutch_level == 'B1' %}selected{% endif %}>{{ t('b1_intermediate', lang) | default('B1 - Intermediate') }}</option>
                    <option value="B2" {% if user.dutch_level == 'B2' %}selected{% endif %}>{{ t('b2_upper_intermediate', lang) | default('B2 - Upper Intermediate') }}</option>
                    <option value="C1" {% if user.dutch_level == 'C1' %}selected{% endif %}>{{ t('c1_advanced', lang) | default('C1 - Advanced') }}</option>
                    <option value="C2" {% if user.dutch_level == 'C2' %}selected{% endif %}>{{ t('c2_proficient', lang) | default('C2 - Proficient') }}</option>
                    <option value="native" {% if user.dutch_level == 'native' %}selected{% endif %}>{{ t('native_speaker', lang) | default('Native Speaker') }}</option>
                </select>
            </div>

            <div class="form-group">
                <label for="english_level">{{ t('english_language_level', lang) | default('English Language Level') }}</label>
                <select id="english_level" name="english_level">
                    <option value="">{{ t('select_level', lang) | default('Select Level') }}</option>
                    <option value="A1" {% if user.english_level == 'A1' %}selected{% endif %}>{{ t('a1_basic', lang) | default('A1 - Basic') }}</option>
                    <option value="A2" {% if user.english_level == 'A2' %}selected{% endif %}>{{ t('a2_elementary', lang) | default('A2 - Elementary') }}</option>
                    <option value="B1" {% if user.english_level == 'B1' %}selected{% endif %}>{{ t('b1_intermediate', lang) | default('B1 - Intermediate') }}</option>
                    <option value="B2" {% if user.english_level == 'B2' %}selected{% endif %}>{{ t('b2_upper_intermediate', lang) | default('B2 - Upper Intermediate') }}</option>
                    <option value="C1" {% if user.english_level == 'C1' %}selected{% endif %}>{{ t('c1_advanced', lang) | default('C1 - Advanced') }}</option>
                    <option value="C2" {% if user.english_level == 'C2' %}selected{% endif %}>{{ t('c2_proficient', lang) | default('C2 - Proficient') }}</option>
                    <option value="native" {% if user.english_level == 'native' %}selected{% endif %}>{{ t('native_speaker', lang) | default('Native Speaker') }}</option>
                </select>
            </div>

        </div>

        <!-- Professional Information Section -->
        <div class="form-section">
            <h3><i class="fas fa-briefcase"></i> {{ t('professional_information', lang) | default('Professional Information') }}</h3>
            
            <!-- Professional Information -->
            <div class="form-group">
                <label for="profession">{{ t('profession', lang) | default('Profession') }} <span class="required">*</span></label>
                <select id="profession" name="profession" required>
                    <option value="">{{ t('select_profession', lang) | default('Select Profession') }}</option>
                    <option value="tandarts" {% if user.profession == 'tandarts' %}selected{% endif %}>{{ t('dentist', lang) | default('Dentist') }}</option>
                    <option value="huisarts" {% if user.profession == 'huisarts' %}selected{% endif %}>{{ t('general_practitioner', lang) | default('General Practitioner') }}</option>
                    <option value="verpleegkundige" {% if user.profession == 'verpleegkundige' %}selected{% endif %}>{{ t('nurse', lang) | default('Nurse') }}</option>
                    <option value="apotheker" {% if user.profession == 'apotheker' %}selected{% endif %}>{{ t('pharmacist', lang) | default('Pharmacist') }}</option>
                </select>
            </div>

            <div class="form-row">
                <div class="form-group">
                    <label for="workplace">{{ t('current_workplace', lang) | default('Current Workplace') }}</label>
                    <input type="text" id="workplace" name="workplace" value="{{ user.workplace or '' }}" placeholder="{{ t('workplace_placeholder', lang) | default('Hospital, Clinic, Practice, etc.') }}">
                </div>
                <div class="form-group">
                    <label for="workplace_specialization">{{ t('specialization', lang) | default('Specialization') }}</label>
                    <input type="text" id="workplace_specialization" name="workplace_specialization" value="{{ user.specialization or '' }}" placeholder="{{ t('specialization_placeholder', lang) | default('Your medical specialization') }}">
                </div>
            </div>

            <div class="form-group">
                <label for="legal_status">{{ t('legal_status', lang) | default('Legal Status in Netherlands') }} <span class="required">*</span></label>
                <select id="legal_status" name="legal_status" required onchange="toggleOtherField('legal_status', 'other_legal_status')">
                    <option value="">{{ t('select_legal_status', lang) | default('Select Legal Status') }}</option>
                    <option value="eu_citizen" {% if user.legal_status == 'eu_citizen' %}selected{% endif %}>{{ t('eu_citizen', lang) | default('EU Citizen') }}</option>
                    <option value="non_eu_resident" {% if user.legal_status == 'non_eu_resident' %}selected{% endif %}>{{ t('non_eu_resident', lang) | default('Non-EU Resident') }}</option>
                    <option value="refugee" {% if user.legal_status == 'refugee' %}selected{% endif %}>{{ t('refugee', lang) | default('Refugee') }}</option>
                    <option value="student_visa" {% if user.legal_status == 'student_visa' %}selected{% endif %}>{{ t('student_visa', lang) | default('Student Visa') }}</option>
                    <option value="work_visa" {% if user.legal_status == 'work_visa' %}selected{% endif %}>{{ t('work_visa', lang) | default('Work Visa') }}</option>
                    <option value="other" {% if user.legal_status == 'other' %}selected{% endif %}>{{ t('other_status', lang) | default('Other') }}</option>
                </select>
            </div>

            <div class="form-group" id="other_legal_status_group" style="display: none;">
                <label for="other_legal_status">{{ t('specify_legal_status', lang) | default('Please specify your legal status') }} <span class="required">*</span></label>
                <input type="text" id="other_legal_status" name="other_legal_status" value="{{ user.other_legal_status or '' }}" placeholder="{{ t('legal_status_placeholder', lang) | default('Enter your legal status') }}">
            </div>
            
            <div class="form-group">
                <label>{{ t('diploma_information', lang) | default('Diploma/Certificate Information') }} <span class="required">*</span></label>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="university_name">{{ t('university_name', lang) | default('University/Institution Name') }} <span class="required">*</span></label>
                        <input type="text" id="university_name" name="university_name" value="{{ user.university_name or '' }}" required placeholder="{{ t('university_placeholder', lang) | default('Enter university or institution name') }}">
                    </div>
                    <div class="form-group">
                        <label for="degree_type">{{ t('degree_type', lang) | default('Degree Type') }} <span class="required">*</span></label>
                        <select id="degree_type" name="degree_type" required>
                            <option value="">{{ t('select_degree', lang) | default('Select Degree Type') }}</option>
                            <option value="bachelor" {% if user.degree_type == 'bachelor' %}selected{% endif %}>{{ t('bachelor', lang) | default('Bachelor') }}</option>
                            <option value="master" {% if user.degree_type == 'master' %}selected{% endif %}>{{ t('master', lang) | default('Master') }}</option>
                            <option value="doctorate" {% if user.degree_type == 'doctorate' %}selected{% endif %}>{{ t('doctorate', lang) | default('Doctorate (PhD)') }}</option>
                            <option value="medical_degree" {% if user.degree_type == 'medical_degree' %}selected{% endif %}>{{ t('medical_degree', lang) | default('Medical Degree (MD)') }}</option>
                            <option value="dental_degree" {% if user.degree_type == 'dental_degree' %}selected{% endif %}>{{ t('dental_degree', lang) | default('Dental Degree (DDS/DMD)') }}</option>
                            <option value="pharmacy_degree" {% if user.degree_type == 'pharmacy_degree' %}selected{% endif %}>{{ t('pharmacy_degree', lang) | default('Pharmacy Degree (PharmD)') }}</option>
                            <option value="nursing_degree" {% if user.degree_type == 'nursing_degree' %}selected{% endif %}>{{ t('nursing_degree', lang) | default('Nursing Degree') }}</option>
                            <option value="certificate" {% if user.degree_type == 'certificate' %}selected{% endif %}>{{ t('certificate', lang) | default('Professional Certificate') }}</option>
                            <option value="diploma" {% if user.degree_type == 'diploma' %}selected{% endif %}>{{ t('diploma', lang) | default('Diploma') }}</option>
                            <option value="other" {% if user.degree_type == 'other' %}selected{% endif %}>{{ t('other_degree', lang) | default('Other') }}</option>
                        </select>
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label for="study_years">{{ t('study_years', lang) | default('Study Period') }} <span class="required">*</span></label>
                        <div class="year-range-container">
                            <input type="number" id="study_start_year" name="study_start_year" value="{{ user.study_start_year or '' }}" required placeholder="{{ t('start_year', lang) | default('Start Year') }}" min="1950" max="2030" class="year-input">
                            <span class="year-separator">-</span>
                            <input type="number" id="study_end_year" name="study_end_year" value="{{ user.study_end_year or '' }}" required placeholder="{{ t('end_year', lang) | default('End Year') }}" min="1950" max="2030" class="year-input">
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="study_country">{{ t('study_country', lang) | default('Country of Study') }} <span class="required">*</span></label>
                        <select id="study_country" name="study_country" required onchange="toggleOtherField('study_country', 'other_study_country')">
                            <option value="">{{ t('select_country', lang) | default('Select Country') }}</option>
                            <option value="NL" {% if user.study_country == 'NL' %}selected{% endif %}>{{ t('netherlands', lang) | default('Netherlands') }}</option>
                            <option value="DE" {% if user.study_country == 'DE' %}selected{% endif %}>{{ t('germany', lang) | default('Germany') }}</option>
                            <option value="BE" {% if user.study_country == 'BE' %}selected{% endif %}>{{ t('belgium', lang) | default('Belgium') }}</option>
                            <option value="FR" {% if user.study_country == 'FR' %}selected{% endif %}>{{ t('france', lang) | default('France') }}</option>
                            <option value="ES" {% if user.study_country == 'ES' %}selected{% endif %}>{{ t('spain', lang) | default('Spain') }}</option>
                            <option value="IT" {% if user.study_country == 'IT' %}selected{% endif %}>{{ t('italy', lang) | default('Italy') }}</option>
                            <option value="PT" {% if user.study_country == 'PT' %}selected{% endif %}>{{ t('portugal', lang) | default('Portugal') }}</option>
                            <option value="PL" {% if user.study_country == 'PL' %}selected{% endif %}>{{ t('poland', lang) | default('Poland') }}</option>
                            <option value="RO" {% if user.study_country == 'RO' %}selected{% endif %}>{{ t('romania', lang) | default('Romania') }}</option>
                            <option value="BG" {% if user.study_country == 'BG' %}selected{% endif %}>{{ t('bulgaria', lang) | default('Bulgaria') }}</option>
                            <option value="HU" {% if user.study_country == 'HU' %}selected{% endif %}>{{ t('hungary', lang) | default('Hungary') }}</option>
                            <option value="CZ" {% if user.study_country == 'CZ' %}selected{% endif %}>{{ t('czech_republic', lang) | default('Czech Republic') }}</option>
                            <option value="SK" {% if user.study_country == 'SK' %}selected{% endif %}>{{ t('slovakia', lang) | default('Slovakia') }}</option>
                            <option value="HR" {% if user.study_country == 'HR' %}selected{% endif %}>{{ t('croatia', lang) | default('Croatia') }}</option>
                            <option value="SI" {% if user.study_country == 'SI' %}selected{% endif %}>{{ t('slovenia', lang) | default('Slovenia') }}</option>
                            <option value="EE" {% if user.study_country == 'EE' %}selected{% endif %}>{{ t('estonia', lang) | default('Estonia') }}</option>
                            <option value="LV" {% if user.study_country == 'LV' %}selected{% endif %}>{{ t('latvia', lang) | default('Latvia') }}</option>
                            <option value="LT" {% if user.study_country == 'LT' %}selected{% endif %}>{{ t('lithuania', lang) | default('Lithuania') }}</option>
                            <option value="MT" {% if user.study_country == 'MT' %}selected{% endif %}>{{ t('malta', lang) | default('Malta') }}</option>
                            <option value="CY" {% if user.study_country == 'CY' %}selected{% endif %}>{{ t('cyprus', lang) | default('Cyprus') }}</option>
                            <option value="LU" {% if user.study_country == 'LU' %}selected{% endif %}>{{ t('luxembourg', lang) | default('Luxembourg') }}</option>
                            <option value="AT" {% if user.study_country == 'AT' %}selected{% endif %}>{{ t('austria', lang) | default('Austria') }}</option>
                            <option value="IE" {% if user.study_country == 'IT' %}selected{% endif %}>{{ t('ireland', lang) | default('Ireland') }}</option>
                            <option value="CH" {% if user.study_country == 'CH' %}selected{% endif %}>{{ t('switzerland', lang) | default('Switzerland') }}</option>
                            <option value="SE" {% if user.study_country == 'SE' %}selected{% endif %}>{{ t('sweden', lang) | default('Sweden') }}</option>
                            <option value="NO" {% if user.study_country == 'NO' %}selected{% endif %}>{{ t('norway', lang) | default('Norway') }}</option>
                            <option value="DK" {% if user.study_country == 'DK' %}selected{% endif %}>{{ t('denmark', lang) | default('Denmark') }}</option>
                            <option value="FI" {% if user.study_country == 'FI' %}selected{% endif %}>{{ t('finland', lang) | default('Finland') }}</option>
                            <option value="IS" {% if user.study_country == 'IS' %}selected{% endif %}>{{ t('iceland', lang) | default('Iceland') }}</option>
                            <option value="GB" {% if user.study_country == 'GB' %}selected{% endif %}>{{ t('united_kingdom', lang) | default('United Kingdom') }}</option>
                            <option value="US" {% if user.study_country == 'US' %}selected{% endif %}>{{ t('united_states', lang) | default('United States') }}</option>
                            <option value="CA" {% if user.study_country == 'CA' %}selected{% endif %}>{{ t('canada', lang) | default('Canada') }}</option>
                            <option value="AU" {% if user.study_country == 'AU' %}selected{% endif %}>{{ t('australia', lang) | default('Australia') }}</option>
                            <option value="NZ" {% if user.study_country == 'NZ' %}selected{% endif %}>{{ t('new_zealand', lang) | default('New Zealand') }}</option>
                            <option value="OTHER" {% if user.study_country == 'OTHER' %}selected{% endif %}>{{ t('other', lang) | default('Other') }}</option>
                        </select>
                    </div>
                </div>

                <div class="form-group" id="other_study_country_group" style="display: none;">
                    <label for="other_study_country">{{ t('specify_study_country', lang) | default('Please specify the country of study') }} <span class="required">*</span></label>
                    <input type="text" id="other_study_country" name="other_study_country" value="{{ user.other_study_country or '' }}" placeholder="{{ t('study_country_placeholder', lang) | default('Enter the country where you studied') }}">
                </div>

                <div class="form-group">
                    <label for="medical_specialization">{{ t('medical_specialization', lang) | default('Medical Specialization') }}</label>
                    <input type="text" id="medical_specialization" name="medical_specialization" value="{{ user.medical_specialization or '' }}" placeholder="{{ t('specialization_placeholder', lang) | default('e.g., General Medicine, Dentistry, Pharmacy, Nursing, etc.') }}">
                </div>

            </div>

        </div>

        <!-- Submit Section -->
        <div class="submit-section">
            <a href="{{ url_for('profile.profile', lang=lang) }}" class="btn-back">
                <i class="fas fa-arrow-left"></i>
                {{ t('back_to_profile', lang) | default('Back to Profile') }}
            </a>
            <button type="submit" class="btn-save" id="submitBtn">
                <i class="fas fa-save"></i> {{ t('save_changes', lang) | default('Save Changes') }}
            </button>
        </div>
    </form>
    
    <!-- Membership Card Section -->
    {% if user.member_id or user.membership_type == 'premium' %}
    <style>
        @keyframes miniGradientPulse {
            0%, 100% { opacity: 0.4; }
            50% { opacity: 0.7; }
        }
        .membership-preview-section .mini-card-bg::before {
            content: '';
            position: absolute;
            top: -50%;
            right: -50%;
            width: 150%;
            height: 150%;
            background: radial-gradient(circle, rgba(79, 70, 229, 0.08) 0%, rgba(20, 184, 166, 0.06) 40%, transparent 70%);
            animation: miniGradientPulse 6s ease-in-out infinite;
            pointer-events: none;
            z-index: 0;
        }
        .membership-preview-section .mini-card-content {
            position: relative;
            z-index: 1;
        }
    </style>
    <div class="membership-preview-section" style="margin-top: 2rem; padding-top: 2rem; border-top: 2px solid #e5e7eb;">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
            <h3 style="font-size: 1.3rem; font-weight: 700; color: #111827; margin: 0; background: linear-gradient(135deg, #4f46e5, #14b8a6); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text;">
                {{ t('membership_card', lang) | default('Lidmaatschapskaart') }}
            </h3>
            <a href="{{ url_for('profile.membership_card', lang=lang) }}" class="btn-view-card" style="padding: 0.625rem 1.5rem; background: linear-gradient(135deg, #4f46e5, #818cf8); color: white; border-radius: 12px; text-decoration: none; font-weight: 600; transition: all 0.3s ease; box-shadow: 0 4px 12px rgba(79, 70, 229, 0.3); display: inline-flex; align-items: center; gap: 0.5rem;">
                <i class="fas fa-id-card"></i> {{ t('view_full_card', lang) | default('Bekijk kaart') }}
            </a>
        </div>
        <div class="mini-card-bg" style="background: linear-gradient(135deg, rgba(240, 249, 255, 0.9) 0%, rgba(224, 242, 254, 0.95) 25%, rgba(255, 255, 255, 1) 50%, rgba(240, 253, 250, 0.95) 75%, rgba(224, 242, 254, 0.9) 100%); border: 3px solid #e5e7eb; border-radius: 16px; padding: 1.5rem; display: flex; justify-content: space-between; align-items: center; box-shadow: 0 10px 30px rgba(79, 70, 229, 0.1), 0 5px 15px rgba(20, 184, 166, 0.08); position: relative; overflow: hidden;">
            <div class="mini-card-content" style="flex: 1;">
                <div style="margin-bottom: 1rem;">
                    <img src="{{ url_for('static', filename='images/logo.png') }}" alt="Mentora" style="height: 35px; width: auto;">
                </div>
                <p style="color: #111827; font-size: 1.15rem; font-weight: 700; margin: 0.5rem 0;">{{ user.get_display_name() }}</p>
                <p style="color: #14b8a6; font-size: 0.95rem; font-weight: 600; margin: 0.25rem 0;">
                    {% if user.profession == 'tandarts' %}{{ t('dentist', lang) | default('Tandarts') }}
                    {% elif user.profession == 'huisarts' %}{{ t('general_practitioner', lang) | default('Huisarts') }}
                    {% elif user.profession == 'verpleegkundige' %}{{ t('nurse', lang) | default('Verpleegkundige') }}
                    {% elif user.profession == 'apotheker' %}{{ t('pharmacist', lang) | default('Apotheker') }}
                    {% else %}{{ user.profession or 'Medical Professional' }}
                    {% endif %}
                </p>
                <p style="color: #6b7280; font-size: 0.8rem; margin-top: 0.5rem; padding-top: 0.5rem; border-top: 2px solid #e5e7eb;"><strong>ID:</strong> {{ user.member_id or 'MNT-XXXXX' }}</p>
            </div>
            <div class="mini-card-content" style="margin-left: 1.5rem;">
                {% if user.qr_code_path %}
                <div style="background: white; border: 3px solid #e5e7eb; border-radius: 10px; padding: 0.5rem; box-shadow: 0 4px 15px rgba(0, 0, 0, 0.08);">
                    <img src="{{ url_for('static', filename=user.qr_code_path) }}" 
                         alt="QR Code" 
                         class="no-optimize"
                         data-no-optimize="true"
                         loading="eager"
                         style="width: 90px; height: 90px; display: block;">
                </div>
                {% else %}
                <div style="width: 90px; height: 90px; background: white; border: 3px solid #e5e7eb; border-radius: 10px; display: flex; flex-direction: column; align-items: center; justify-content: center; color: #cbd5e0; font-size: 0.7rem; text-align: center; padding: 0.5rem; box-shadow: 0 4px 15px rgba(0, 0, 0, 0.08);">
                    <i class="fas fa-qrcode" style="font-size: 2rem; margin-bottom: 0.25rem;"></i>
                    <span style="font-size: 0.65rem;">{{ t('qr_not_generated', lang) | default('Niet gegenereerd') }}</span>
                </div>
                {% endif %}
            </div>
        </div>
    </div>
    {% endif %}
</div>
{% endblock %}

{% block extra_js %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    // Form validation
    setupFormValidation();
    
    // Initialize other fields
    initializeOtherFields();
    
    // Initialize nationality search
    initializeNationalitySearch();
});

// Function to toggle "Other" fields
function toggleOtherField(selectId, otherFieldId) {
    const select = document.getElementById(selectId);
    const otherGroup = document.getElementById(otherFieldId + '_group');
    const otherField = document.getElementById(otherFieldId);
    
    // Check for both 'other' and 'OTHER' values
    if (select.value === 'other' || select.value === 'OTHER') {
        otherGroup.style.display = 'block';
        otherField.required = true;
    } else {
        otherGroup.style.display = 'none';
        otherField.required = false;
        otherField.value = '';
    }
}

// Initialize other fields on page load
function initializeOtherFields() {
    // Check nationality field
    toggleOtherField('nationality', 'other_nationality');
    
    // Check legal status field
    toggleOtherField('legal_status', 'other_legal_status');
    
    // Check study country field
    toggleOtherField('study_country', 'other_study_country');
    
    // Initialize phone number formatting
    setupPhoneNumberFormatting();
}

// Initialize auto-fill signature functionality
function initializeAutoFillSignature() {
    const autoFillBtn = document.getElementById('autoFillSignature');
    const signatureField = document.getElementById('digital_signature');
    const firstNameField = document.getElementById('first_name');
    const lastNameField = document.getElementById('last_name');
    
    if (autoFillBtn && signatureField && firstNameField && lastNameField) {
        // Auto-fill button click
        autoFillBtn.addEventListener('click', function() {
            const firstName = firstNameField.value.trim();
            const lastName = lastNameField.value.trim();
            
            if (firstName && lastName) {
                signatureField.value = `${firstName} ${lastName}`;
                signatureField.style.borderColor = '#27ae60';
                
                // Show success message
                showFieldSuccess(signatureField, '{{ t("signature_auto_filled", lang) | default("Signature auto-filled successfully!") }}');
            } else {
                showFieldError(signatureField, '{{ t("fill_name_first", lang) | default("Please fill in your first and last name first") }}');
            }
        });
        
        // Auto-fill when name fields change
        firstNameField.addEventListener('input', updateSignaturePreview);
        lastNameField.addEventListener('input', updateSignaturePreview);
        
        // Real-time validation for signature
        signatureField.addEventListener('input', function() {
            const firstName = firstNameField.value.trim();
            const lastName = lastNameField.value.trim();
            const signature = this.value.trim();
            const expectedSignature = `${firstName} ${lastName}`.trim();
            
            if (signature === expectedSignature && signature.length > 0) {
                this.style.borderColor = '#27ae60';
                clearFieldError(this);
            } else if (signature.length > 0) {
                this.style.borderColor = '#e74c3c';
            } else {
                this.style.borderColor = '#ecf0f1';
                clearFieldError(this);
            }
        });
    }
}

// Update signature preview
function updateSignaturePreview() {
    const firstName = document.getElementById('first_name').value.trim();
    const lastName = document.getElementById('last_name').value.trim();
    const signatureField = document.getElementById('digital_signature');
    
    if (firstName && lastName && !signatureField.value.trim()) {
        // Show preview in placeholder
        signatureField.placeholder = `{{ t('signature_preview', lang) | default('Will be:') }} ${firstName} ${lastName}`;
    }
}

// Show field success message
function showFieldSuccess(field, message) {
    clearFieldError(field);
    
    const successDiv = document.createElement('div');
    successDiv.className = 'success-message';
    successDiv.textContent = message;
    
    field.parentNode.appendChild(successDiv);
    
    // Remove success message after 3 seconds
    setTimeout(() => {
        if (successDiv.parentNode) {
            successDiv.remove();
        }
    }, 3000);
}

// Setup phone number formatting
function setupPhoneNumberFormatting() {
    const countryCodeSelect = document.getElementById('country_code');
    const phoneInput = document.getElementById('phone');
    
    if (countryCodeSelect && phoneInput) {
        // Update phone placeholder based on country code
        countryCodeSelect.addEventListener('change', function() {
            const countryCode = this.value;
            const placeholders = {
                '+31': '612345678',  // Netherlands
                '+49': '15123456789', // Germany
                '+32': '471234567',  // Belgium
                '+33': '612345678',  // France
                '+34': '612345678',  // Spain
                '+39': '3123456789', // Italy
                '+351': '912345678', // Portugal
                '+48': '123456789',  // Poland
                '+40': '712345678',  // Romania
                '+359': '871234567', // Bulgaria
                '+36': '201234567',  // Hungary
                '+420': '123456789', // Czech Republic
                '+421': '123456789', // Slovakia
                '+385': '912345678', // Croatia
                '+386': '401234567', // Slovenia
                '+372': '51234567',  // Estonia
                '+371': '21234567',  // Latvia
                '+370': '61234567',  // Lithuania
                '+356': '21234567',  // Malta
                '+357': '96123456',  // Cyprus
                '+352': '621123456', // Luxembourg
                '+43': '664123456',  // Austria
                '+41': '791234567',  // Switzerland
                '+46': '701234567',  // Sweden
                '+47': '41234567',   // Norway
                '+45': '20123456',   // Denmark
                '+358': '401234567', // Finland
                '+354': '6123456',   // Iceland
                '+353': '851234567', // Ireland
                '+44': '7123456789', // United Kingdom
                '+1': '5551234567',  // United States/Canada
                '+61': '412345678',  // Australia
                '+64': '211234567',  // New Zealand
                '+27': '821234567',  // South Africa
                '+55': '11987654321', // Brazil
                '+54': '91123456789', // Argentina
                '+52': '5512345678', // Mexico
                '+91': '9876543210', // India
                '+86': '13812345678', // China
                '+81': '9012345678', // Japan
                '+82': '1012345678', // South Korea
                '+66': '812345678',  // Thailand
                '+84': '912345678',  // Vietnam
                '+63': '9171234567', // Philippines
                '+62': '8123456789', // Indonesia
                '+60': '123456789',  // Malaysia
                '+65': '81234567',   // Singapore
                '+90': '5321234567', // Turkey
                '+20': '1012345678', // Egypt
                '+212': '612345678', // Morocco
                '+216': '20123456',  // Tunisia
                '+213': '551234567', // Algeria
                '+234': '8012345678', // Nigeria
                '+254': '712345678', // Kenya
                '+233': '241234567', // Ghana
                '+251': '911234567', // Ethiopia
                '+380': '501234567', // Ukraine
                '+375': '291234567', // Belarus
                '+7': '9123456789',  // Russia
                '+381': '601234567', // Serbia
                '+387': '61123456',  // Bosnia
                '+382': '67123456',  // Montenegro
                '+389': '70123456',  // Macedonia
                '+355': '691234567', // Albania
                '+373': '60123456'   // Moldova
            };
            
            phoneInput.placeholder = placeholders[countryCode] || '123456789';
        });
        
        // Trigger initial placeholder update
        countryCodeSelect.dispatchEvent(new Event('change'));
    }
}

function setupFileUploads() {
    // Diploma file upload
    const diplomaInput = document.getElementById('diploma_file');
    const diplomaList = document.getElementById('diploma-list');
    
    diplomaInput.addEventListener('change', function(e) {
        handleFileUpload(e, diplomaList, 'diploma');
    });
    
    
    // Additional documents upload
    const additionalInput = document.getElementById('additional_documents');
    const additionalList = document.getElementById('additional-documents-list');
    
    additionalInput.addEventListener('change', function(e) {
        handleFileUpload(e, additionalList, 'additional');
    });
}

function handleFileUpload(event, container, type) {
    const files = event.target.files;
    
    // Clear previous files
    container.innerHTML = '';
    
    Array.from(files).forEach((file, index) => {
        const fileItem = document.createElement('div');
        fileItem.className = 'uploaded-file';
        fileItem.innerHTML = `
            <span class="file-name">${file.name}</span>
            <span class="remove-file" onclick="removeFile('${type}', ${index})">Ã—</span>
        `;
        container.appendChild(fileItem);
    });
}

function removeFile(type, index) {
    const input = document.getElementById(type === 'diploma' ? 'diploma_file' : 'additional_documents');
    
    // Create new FileList without the removed file
    const dt = new DataTransfer();
    Array.from(input.files).forEach((file, i) => {
        if (i !== index) {
            dt.items.add(file);
        }
    });
    input.files = dt.files;
    
    // Update display
    const container = document.getElementById(type === 'diploma' ? 'diploma-list' : 'additional-documents-list');
    handleFileUpload({target: {files: input.files}}, container, type);
}

function setupFormValidation() {
    const form = document.getElementById('personalInfoForm');
    if (!form) {
        console.warn('Form personalInfoForm not found');
        return;
    }
    
    const submitBtn = document.getElementById('submitBtn');
    if (!submitBtn) {
        console.warn('Submit button not found');
        return;
    }
    
    form.addEventListener('submit', function(e) {
        e.preventDefault();
        
        if (validateForm()) {
            submitForm();
        }
    });
    
    // Real-time validation
    const requiredFields = form.querySelectorAll('[required]');
    requiredFields.forEach(field => {
        field.addEventListener('blur', validateField);
        field.addEventListener('input', clearFieldError);
    });
}

function validateForm() {
    let isValid = true;
    const form = document.getElementById('personalInfoForm');
    if (!form) {
        return false;
    }
    
    // Check required fields
    const requiredFields = form.querySelectorAll('[required]');
    requiredFields.forEach(field => {
        if (!validateField({target: field})) {
            isValid = false;
        }
    });
    
    // Check new diploma fields (only if they exist)
    const universityName = document.getElementById('university_name');
    const degreeType = document.getElementById('degree_type');
    const studyStartYear = document.getElementById('study_start_year');
    const studyEndYear = document.getElementById('study_end_year');
    const studyCountry = document.getElementById('study_country');
    
    if (universityName && !universityName.value.trim()) {
        showFieldError(universityName, '{{ t("university_required", lang) | default("University name is required") }}');
        isValid = false;
    }
    
    if (degreeType && !degreeType.value) {
        showFieldError(degreeType, '{{ t("degree_type_required", lang) | default("Degree type is required") }}');
        isValid = false;
    }
    
    if (studyStartYear && studyEndYear) {
        if (!studyStartYear.value || !studyEndYear.value) {
            if (!studyStartYear.value) {
                showFieldError(studyStartYear, '{{ t("start_year_required", lang) | default("Start year is required") }}');
            }
            if (!studyEndYear.value) {
                showFieldError(studyEndYear, '{{ t("end_year_required", lang) | default("End year is required") }}');
            }
            isValid = false;
        } else {
            // Validate year range
            const startYear = parseInt(studyStartYear.value);
            const endYear = parseInt(studyEndYear.value);
            const currentYear = new Date().getFullYear();
            
            if (startYear > endYear) {
                showFieldError(studyEndYear, '{{ t("end_year_before_start", lang) | default("End year must be after start year") }}');
                isValid = false;
            }
            
            if (startYear < 1950 || startYear > currentYear) {
                showFieldError(studyStartYear, '{{ t("invalid_start_year", lang) | default("Start year must be between 1950 and current year") }}');
                isValid = false;
            }
            
            if (endYear < 1950 || endYear > currentYear) {
                showFieldError(studyEndYear, '{{ t("invalid_end_year", lang) | default("End year must be between 1950 and current year") }}');
                isValid = false;
            }
        }
    }
    
    if (studyCountry && !studyCountry.value) {
        showFieldError(studyCountry, '{{ t("study_country_required", lang) | default("Country of study is required") }}');
        isValid = false;
    }
    
    // Check "Other" fields
    const nationality = document.getElementById('nationality');
    const otherNationality = document.getElementById('other_nationality');
    if (nationality && otherNationality && nationality.value === 'OTHER' && !otherNationality.value.trim()) {
        showFieldError(otherNationality, '{{ t("other_nationality_required", lang) | default("Please specify your nationality") }}');
        isValid = false;
    }
    
    const legalStatus = document.getElementById('legal_status');
    const otherLegalStatus = document.getElementById('other_legal_status');
    if (legalStatus && otherLegalStatus && legalStatus.value === 'other' && !otherLegalStatus.value.trim()) {
        showFieldError(otherLegalStatus, '{{ t("other_legal_status_required", lang) | default("Please specify your legal status") }}');
        isValid = false;
    }
    
    const otherStudyCountry = document.getElementById('other_study_country');
    if (studyCountry && otherStudyCountry && studyCountry.value === 'OTHER' && !otherStudyCountry.value.trim()) {
        showFieldError(otherStudyCountry, '{{ t("other_study_country_required", lang) | default("Please specify the country of study") }}');
        isValid = false;
    }
    
    // Check password confirmation (only if password fields exist - for registration forms)
    const password = document.getElementById('password');
    const confirmPassword = document.getElementById('confirm_password');
    if (password && confirmPassword) {
        if (password.value !== confirmPassword.value) {
            showFieldError(confirmPassword, '{{ t("passwords_dont_match", lang) | default("Passwords do not match") }}');
            isValid = false;
        }
        
        // Check password strength
        if (password.value && !isPasswordStrong(password.value)) {
            showFieldError(password, '{{ t("password_weak", lang) | default("Password must contain at least 8 characters with letters and numbers") }}');
            isValid = false;
        }
    }
    
    // Check digital signature (only if signature field exists - for registration forms)
    const digitalSignature = document.getElementById('digital_signature');
    if (digitalSignature) {
        const firstName = document.getElementById('first_name');
        const lastName = document.getElementById('last_name');
        
        if (firstName && lastName) {
            const firstNameValue = firstName.value.trim();
            const lastNameValue = lastName.value.trim();
            const signature = digitalSignature.value.trim();
            
            if (!signature) {
                showFieldError(digitalSignature, '{{ t("signature_required", lang) | default("Digital signature is required") }}');
                isValid = false;
            } else if (signature.length < 3) {
                showFieldError(digitalSignature, '{{ t("signature_too_short", lang) | default("Digital signature must be at least 3 characters long") }}');
                isValid = false;
            } else {
                // Check if signature contains both first and last name (flexible matching)
                const firstNameLower = firstNameValue.toLowerCase();
                const lastNameLower = lastNameValue.toLowerCase();
                const signatureLower = signature.toLowerCase();
                
                if (firstNameLower && lastNameLower && 
                    (!signatureLower.includes(firstNameLower) || !signatureLower.includes(lastNameLower))) {
                    showFieldError(digitalSignature, '{{ t("signature_should_contain_name", lang) | default("Digital signature should contain your first and last name") }}');
                    isValid = false;
                }
            }
        }
    }
    
    return isValid;
}

// Check password strength
function isPasswordStrong(password) {
    // At least 8 characters
    if (password.length < 8) return false;
    
    // Contains at least one letter
    if (!/[a-zA-Z]/.test(password)) return false;
    
    // Contains at least one number
    if (!/[0-9]/.test(password)) return false;
    
    return true;
}

function validateField(event) {
    const field = event.target;
    const value = field.value.trim();
    
    clearFieldError(field);
    
    if (field.hasAttribute('required') && !value) {
        showFieldError(field, '{{ t("field_required", lang) | default("This field is required") }}');
        return false;
    }
    
    // Email validation
    if (field.type === 'email' && value) {
        const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
        if (!emailRegex.test(value)) {
            showFieldError(field, '{{ t("invalid_email", lang) | default("Please enter a valid email address") }}');
            return false;
        }
    }
    
    // Phone validation
    if (field.type === 'tel' && value) {
        const phoneRegex = /^[0-9\s\-\(\)]{7,15}$/;
        if (!phoneRegex.test(value)) {
            showFieldError(field, '{{ t("invalid_phone", lang) | default("Please enter a valid phone number") }}');
            return false;
        }
    }
    
    // Date validation
    if (field.type === 'date' && value) {
        const date = new Date(value);
        const today = new Date();
        
        if (field.id === 'birth_date' && date >= today) {
            showFieldError(field, '{{ t("invalid_birth_date", lang) | default("Birth date cannot be in the future") }}');
            return false;
        }
        
        if (field.id === 'exam_date' && date <= today) {
            showFieldError(field, '{{ t("invalid_exam_date", lang) | default("Exam date must be in the future") }}');
            return false;
        }
    }
    
    return true;
}

function showFieldError(field, message) {
    if (!field || !field.parentNode) {
        return;
    }
    clearFieldError(field);
    
    const errorDiv = document.createElement('div');
    errorDiv.className = 'error-message';
    errorDiv.textContent = message;
    
    field.parentNode.appendChild(errorDiv);
    field.style.borderColor = '#e74c3c';
}

function clearFieldError(field) {
    if (!field || !field.parentNode) {
        return;
    }
    const errorDiv = field.parentNode.querySelector('.error-message');
    if (errorDiv) {
        errorDiv.remove();
    }
    field.style.borderColor = '#ecf0f1';
}

function setupProgressIndicator() {
    const sections = document.querySelectorAll('.form-section');
    const steps = document.querySelectorAll('.progress-step');
    
    // Update progress based on completed sections
    function updateProgress() {
        let completedSections = 0;
        
        sections.forEach((section, index) => {
            const requiredFields = section.querySelectorAll('[required]');
            let sectionCompleted = true;
            
            requiredFields.forEach(field => {
                if (!field.value.trim()) {
                    sectionCompleted = false;
                }
            });
            
            if (sectionCompleted && requiredFields.length > 0) {
                completedSections++;
                if (steps[index]) {
                    steps[index].classList.add('completed');
                    steps[index].classList.remove('active');
                }
            } else if (steps[index]) {
                steps[index].classList.remove('completed');
                if (index === completedSections) {
                    steps[index].classList.add('active');
                }
            }
        });
    }
    
    // Update progress on field changes
    const allFields = document.querySelectorAll('input, select, textarea');
    allFields.forEach(field => {
        field.addEventListener('change', updateProgress);
        field.addEventListener('input', updateProgress);
    });
    
    // Initial progress update
    updateProgress();
}

async function submitForm() {
    const form = document.getElementById('personalInfoForm');
    const submitBtn = document.getElementById('submitBtn');
    const formData = new FormData(form);
    
    // Disable submit button
    submitBtn.disabled = true;
    submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> {{ t("processing", lang) | default("Processing...") }}';
    
    try {
        const response = await fetch('{{ url_for("profile.update_personal_info", lang=lang) }}', {
            method: 'POST',
            body: formData
        });
        
        if (response.ok) {
            // Success - redirect to the same page to show updated data
            window.location.reload();
        } else {
            // Show error message
            showErrorMessage('{{ t("update_error", lang) | default("Failed to update personal information. Please try again.") }}');
        }
    } catch (error) {
        console.error('Update error:', error);
        showErrorMessage('{{ t("network_error", lang) | default("Network error. Please check your connection and try again.") }}');
    } finally {
        // Re-enable submit button
        submitBtn.disabled = false;
        submitBtn.innerHTML = '<i class="fas fa-save"></i> {{ t("save_changes", lang) | default("Save Changes") }}';
    }
}

function showSuccessMessage(message) {
    const messageDiv = document.createElement('div');
    messageDiv.className = 'success-message';
    messageDiv.style.cssText = 'position: fixed; top: 20px; right: 20px; background: #27ae60; color: white; padding: 15px 20px; border-radius: 5px; z-index: 1000;';
    messageDiv.textContent = message;
    document.body.appendChild(messageDiv);
    
    setTimeout(() => {
        messageDiv.remove();
    }, 5000);
}

function showErrorMessage(message) {
    const messageDiv = document.createElement('div');
    messageDiv.className = 'error-message';
    messageDiv.style.cssText = 'position: fixed; top: 20px; right: 20px; background: #e74c3c; color: white; padding: 15px 20px; border-radius: 5px; z-index: 1000;';
    messageDiv.textContent = message;
    document.body.appendChild(messageDiv);
    
    setTimeout(() => {
        messageDiv.remove();
    }, 5000);
}

function togglePassword(fieldId) {
    const passwordField = document.getElementById(fieldId);
    const eyeIcon = document.getElementById(fieldId + '-eye');
    
    if (passwordField.type === 'password') {
        passwordField.type = 'text';
        eyeIcon.classList.remove('fa-eye');
        eyeIcon.classList.add('fa-eye-slash');
    } else {
        passwordField.type = 'password';
        eyeIcon.classList.remove('fa-eye-slash');
        eyeIcon.classList.add('fa-eye');
    }
}

// Initialize nationality search functionality
function initializeNationalitySearch() {
    const searchInput = document.getElementById('nationality_search');
    const selectElement = document.getElementById('nationality');
    
    if (searchInput && selectElement) {
        searchInput.addEventListener('input', function() {
            const searchTerm = this.value.toLowerCase();
            const options = selectElement.querySelectorAll('option');
            
            options.forEach(option => {
                const text = option.textContent.toLowerCase();
                if (text.includes(searchTerm) || searchTerm === '') {
                    option.style.display = 'block';
                } else {
                    option.style.display = 'none';
                }
            });
            
            // If search matches exactly one option, select it
            const visibleOptions = Array.from(options).filter(option => 
                option.style.display !== 'none' && option.value !== ''
            );
            
            if (visibleOptions.length === 1 && searchTerm.length > 2) {
                selectElement.value = visibleOptions[0].value;
                toggleOtherField('nationality', 'other_nationality');
            }
        });
        
        // Clear search when selection is made
        selectElement.addEventListener('change', function() {
            if (this.value) {
                searchInput.value = this.options[this.selectedIndex].textContent;
            }
        });
    }
}

// reCAPTCHA validation
function validateRecaptcha() {
    // Check if reCAPTCHA is configured
    if (typeof grecaptcha === 'undefined') {
        return true; // Skip validation if reCAPTCHA is not configured
    }
    
    const recaptchaResponse = grecaptcha.getResponse();
    if (recaptchaResponse.length === 0) {
        showErrorMessage('{{ t("recaptcha_required", lang) | default("Please complete the reCAPTCHA verification") }}');
        return false;
    }
    return true;
}
</script>

<!-- reCAPTCHA Script -->
{% if config.RECAPTCHA_PUBLIC_KEY %}
<script src="https://www.google.com/recaptcha/api.js?hl={{ lang }}" async defer></script>
{% endif %}
{% endblock %}
