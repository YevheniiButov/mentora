{% extends "base.html" %}

{% block title %}{{ t('personal_info', lang) | default('Personal Information') }} - Mentora{% endblock %}

{% block description %}{{ t('personal_info_description', lang) | default('Update your personal information and professional details') }}{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/auth.css') }}">
<style>
.personal-info-container {
    max-width: 800px;
    margin: 0 auto;
    padding: 20px;
    padding-top: 100px; /* ĞÑ‚ÑÑ‚ÑƒĞ¿ ÑĞ²ĞµÑ€Ñ…Ñƒ Ğ´Ğ»Ñ ÑˆĞ°Ğ¿ĞºĞ¸ */
}

.personal-info-header {
    text-align: center;
    margin-bottom: 30px;
}

.personal-info-header h1 {
    color: #2c3e50;
    margin-bottom: 10px;
}

.personal-info-header p {
    color: #7f8c8d;
    font-size: 16px;
}

.personal-info-form {
    background: white;
    border-radius: 10px;
    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
    padding: 30px;
}

.form-section {
    margin-bottom: 30px;
    padding-bottom: 20px;
    border-bottom: 1px solid #ecf0f1;
}

.form-section:last-child {
    border-bottom: none;
}

.form-section h3 {
    color: #2c3e50;
    margin-bottom: 20px;
    font-size: 18px;
    display: flex;
    align-items: center;
}

.form-section h3 i {
    margin-right: 10px;
    color: #3498db;
}

.form-row {
    display: flex;
    gap: 20px;
    margin-bottom: 20px;
}

.form-group {
    flex: 1;
    margin-bottom: 20px;
}

.form-group label {
    display: block;
    margin-bottom: 5px;
    font-weight: 600;
    color: #2c3e50;
}

.form-group input,
.form-group select,
.form-group textarea {
    width: 100%;
    padding: 12px;
    border: 2px solid #ecf0f1;
    border-radius: 5px;
    font-size: 14px;
    transition: border-color 0.3s;
}

.form-group input:focus,
.form-group select:focus,
.form-group textarea:focus {
    outline: none;
    border-color: #3498db;
}

.form-group .help-text {
    font-size: 12px;
    color: #7f8c8d;
    margin-top: 5px;
}

.required {
    color: #e74c3c;
}

.file-upload {
    border: 2px dashed #bdc3c7;
    border-radius: 5px;
    padding: 20px;
    text-align: center;
    transition: border-color 0.3s;
}

.file-upload:hover {
    border-color: #3498db;
}

.file-upload input[type="file"] {
    display: none;
}

.file-upload-label {
    cursor: pointer;
    color: #3498db;
    font-weight: 600;
}

.file-upload-label:hover {
    color: #2980b9;
}

.uploaded-files {
    margin-top: 10px;
}

.uploaded-file {
    display: flex;
    align-items: center;
    justify-content: space-between;
    background: #f8f9fa;
    padding: 10px;
    border-radius: 5px;
    margin-bottom: 5px;
}

.uploaded-file .file-name {
    font-weight: 500;
}

.uploaded-file .remove-file {
    color: #e74c3c;
    cursor: pointer;
    font-weight: bold;
}

.checkbox-group {
    display: flex;
    align-items: center;
    margin-bottom: 15px;
}

.checkbox-group input[type="checkbox"] {
    margin-right: 10px;
    transform: scale(1.2);
}

.checkbox-group label {
    margin-bottom: 0;
    font-weight: normal;
}

.submit-section {
    text-align: center;
    margin-top: 30px;
    padding-top: 20px;
    border-top: 1px solid #ecf0f1;
}

.btn-register {
    background: linear-gradient(135deg, #3498db, #2980b9);
    color: white;
    padding: 15px 40px;
    border: none;
    border-radius: 25px;
    font-size: 16px;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.3s;
    min-width: 200px;
}

.btn-register:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 8px rgba(52, 152, 219, 0.3);
}

.btn-register:disabled {
    background: #bdc3c7;
    cursor: not-allowed;
    transform: none;
    box-shadow: none;
}

.error-message {
    color: #e74c3c;
    font-size: 12px;
    margin-top: 5px;
}

.success-message {
    color: #27ae60;
    font-size: 12px;
    margin-top: 5px;
}

/* Ğ¨Ğ°Ğ³Ğ¸ Ğ½Ğ°Ğ²Ğ¸Ğ³Ğ°Ñ†Ğ¸Ğ¸ ÑƒĞ´Ğ°Ğ»ĞµĞ½Ñ‹ */

.consent-block {
    background: #f8f9fa;
    border: 1px solid #e9ecef;
    border-radius: 8px;
    padding: 20px;
    margin-bottom: 20px;
}

.consent-block h4 {
    color: #2c3e50;
    margin-bottom: 15px;
    font-size: 16px;
    display: flex;
    align-items: center;
}

.consent-block h4 i {
    margin-right: 8px;
    color: #3498db;
}

.consent-content {
    margin-bottom: 15px;
}

.consent-content p {
    margin-bottom: 10px;
    color: #555;
    font-weight: 500;
}

.consent-content ul {
    margin: 10px 0;
    padding-left: 20px;
}

.consent-content li {
    margin-bottom: 5px;
    color: #666;
}

.signature-block {
    background: #fff3cd;
    border: 1px solid #ffeaa7;
    border-radius: 8px;
    padding: 20px;
    margin-top: 20px;
}

.signature-block h4 {
    color: #856404;
    margin-bottom: 15px;
    font-size: 16px;
}

.signature-block .form-group {
    margin-bottom: 0;
}

.phone-input-group {
    display: flex;
    gap: 10px;
    align-items: stretch;
}

.country-code-select {
    flex: 0 0 200px;
    padding: 12px;
    border: 2px solid #ecf0f1;
    border-radius: 5px;
    font-size: 14px;
    background: white;
    transition: border-color 0.3s;
}

.country-code-select:focus {
    outline: none;
    border-color: #3498db;
}

.phone-number-input {
    flex: 1;
    padding: 12px;
    border: 2px solid #ecf0f1;
    border-radius: 5px;
    font-size: 14px;
    transition: border-color 0.3s;
}

.phone-number-input:focus {
    outline: none;
    border-color: #3498db;
}

@media (max-width: 768px) {
    .form-row {
        flex-direction: column;
        gap: 0;
    }
    
    /* ĞœĞ¾Ğ±Ğ¸Ğ»ÑŒĞ½Ñ‹Ğµ ÑÑ‚Ğ¸Ğ»Ğ¸ Ğ´Ğ»Ñ ÑˆĞ°Ğ³Ğ¾Ğ² Ğ½Ğ°Ğ²Ğ¸Ğ³Ğ°Ñ†Ğ¸Ğ¸ ÑƒĞ´Ğ°Ğ»ĞµĞ½Ñ‹ */
    
    .consent-block,
    .signature-block {
        padding: 15px;
    }
    
    .phone-input-group {
        flex-direction: column;
        gap: 10px;
    }
    
    .country-code-select {
        flex: none;
        width: 100%;
    }
}

.password-input-container {
    position: relative;
    display: flex;
    align-items: center;
}

.password-input-container input {
    padding-right: 45px;
}

.password-toggle {
    position: absolute;
    right: 12px;
    top: 50%;
    transform: translateY(-50%);
    background: none;
    border: none;
    cursor: pointer;
    color: #7f8c8d;
    font-size: 16px;
    padding: 5px;
    transition: color 0.3s;
}

.password-toggle:hover {
    color: #3498db;
}

.password-toggle:focus {
    outline: none;
    color: #3498db;
}

.nationality-search-container {
    position: relative;
    margin-bottom: 10px;
}

.nationality-search {
    width: 100%;
    padding: 10px 35px 10px 12px;
    border: 2px solid #ecf0f1;
    border-radius: 5px;
    font-size: 14px;
    transition: border-color 0.3s;
}

.nationality-search:focus {
    outline: none;
    border-color: #3498db;
}

.nationality-search-icon {
    position: absolute;
    right: 12px;
    top: 50%;
    transform: translateY(-50%);
    color: #7f8c8d;
    font-size: 14px;
}

.nationality-select {
    max-height: 200px;
    overflow-y: auto;
}

.nationality-select option {
    padding: 8px 12px;
}

.year-range-container {
    display: flex;
    align-items: center;
    gap: 10px;
}

.year-input {
    flex: 1;
    padding: 12px;
    border: 2px solid #ecf0f1;
    border-radius: 5px;
    font-size: 14px;
    transition: border-color 0.3s;
}

.year-input:focus {
    outline: none;
    border-color: #3498db;
}

.year-separator {
    color: #7f8c8d;
    font-weight: bold;
    font-size: 16px;
}
</style>
{% endblock %}

{% block content %}
<div class="personal-info-container">
    <div class="personal-info-header">
        <h1>{{ t('personal_info', lang) | default('Personal Information') }}</h1>
        <p>{{ t('personal_info_subtitle', lang) | default('Update your personal information and professional details') }}</p>
    </div>

    <form class="personal-info-form" id="personalInfoForm" method="POST" action="{{ url_for('profile.update_personal_info', lang=lang) }}">
        <input type="hidden" name="csrf_token" value="{{ csrf_token() }}"/>
        
        <!-- Personal Information Section -->
        <div class="form-section">
            <h3><i class="fas fa-user"></i> {{ t('personal_information', lang) | default('Personal Information') }}</h3>
            
            <div class="form-row">
                <div class="form-group">
                    <label for="first_name">{{ t('first_name', lang) | default('First Name') }} <span class="required">*</span></label>
                    <input type="text" id="first_name" name="first_name" value="{{ user.first_name or '' }}" autocomplete="given-name" required>
                </div>
                <div class="form-group">
                    <label for="last_name">{{ t('last_name', lang) | default('Last Name') }} <span class="required">*</span></label>
                    <input type="text" id="last_name" name="last_name" value="{{ user.last_name or '' }}" autocomplete="family-name" required>
                </div>
            </div>

            <div class="form-row">
                <div class="form-group">
                    <label for="email">{{ t('email', lang) | default('Email') }} <span class="required">*</span></label>
                    <input type="email" id="email" name="email" value="{{ user.email }}" class="readonly-field" readonly>
                    <div class="help-text">{{ t('email_cannot_be_changed', lang) | default('Email cannot be changed') }}</div>
                </div>
                <div class="form-group">
                    <label for="phone">{{ t('phone', lang) | default('Phone Number') }}</label>
                    <div class="phone-input-group">
                        <select id="country_code" name="country_code" class="country-code-select">
                            <option value="+31" {% if user.country_code == '+31' %}selected{% endif %}>ğŸ‡³ğŸ‡± +31 (Netherlands)</option>
                            <option value="+49" {% if user.country_code == '+49' %}selected{% endif %}>ğŸ‡©ğŸ‡ª +49 (Germany)</option>
                            <option value="+32" {% if user.country_code == '+32' %}selected{% endif %}>ğŸ‡§ğŸ‡ª +32 (Belgium)</option>
                            <option value="+33" {% if user.country_code == '+33' %}selected{% endif %}>ğŸ‡«ğŸ‡· +33 (France)</option>
                            <option value="+34" {% if user.country_code == '+34' %}selected{% endif %}>ğŸ‡ªğŸ‡¸ +34 (Spain)</option>
                            <option value="+39" {% if user.country_code == '+39' %}selected{% endif %}>ğŸ‡®ğŸ‡¹ +39 (Italy)</option>
                            <option value="+351" {% if user.country_code == '+351' %}selected{% endif %}>ğŸ‡µğŸ‡¹ +351 (Portugal)</option>
                            <option value="+48" {% if user.country_code == '+48' %}selected{% endif %}>ğŸ‡µğŸ‡± +48 (Poland)</option>
                            <option value="+40" {% if user.country_code == '+40' %}selected{% endif %}>ğŸ‡·ğŸ‡´ +40 (Romania)</option>
                            <option value="+359" {% if user.country_code == '+359' %}selected{% endif %}>ğŸ‡§ğŸ‡¬ +359 (Bulgaria)</option>
                            <option value="+36" {% if user.country_code == '+36' %}selected{% endif %}>ğŸ‡­ğŸ‡º +36 (Hungary)</option>
                            <option value="+420" {% if user.country_code == '+420' %}selected{% endif %}>ğŸ‡¨ğŸ‡¿ +420 (Czech Republic)</option>
                            <option value="+421" {% if user.country_code == '+421' %}selected{% endif %}>ğŸ‡¸ğŸ‡° +421 (Slovakia)</option>
                            <option value="+385" {% if user.country_code == '+385' %}selected{% endif %}>ğŸ‡­ğŸ‡· +385 (Croatia)</option>
                            <option value="+386" {% if user.country_code == '+386' %}selected{% endif %}>ğŸ‡¸ğŸ‡® +386 (Slovenia)</option>
                            <option value="+372" {% if user.country_code == '+372' %}selected{% endif %}>ğŸ‡ªğŸ‡ª +372 (Estonia)</option>
                            <option value="+371" {% if user.country_code == '+371' %}selected{% endif %}>ğŸ‡±ğŸ‡» +371 (Latvia)</option>
                            <option value="+370" {% if user.country_code == '+370' %}selected{% endif %}>ğŸ‡±ğŸ‡¹ +370 (Lithuania)</option>
                            <option value="+356" {% if user.country_code == '+356' %}selected{% endif %}>ğŸ‡²ğŸ‡¹ +356 (Malta)</option>
                            <option value="+357" {% if user.country_code == '+357' %}selected{% endif %}>ğŸ‡¨ğŸ‡¾ +357 (Cyprus)</option>
                            <option value="+352" {% if user.country_code == '+352' %}selected{% endif %}>ğŸ‡±ğŸ‡º +352 (Luxembourg)</option>
                            <option value="+43" {% if user.country_code == '+43' %}selected{% endif %}>ğŸ‡¦ğŸ‡¹ +43 (Austria)</option>
                            <option value="+41" {% if user.country_code == '+41' %}selected{% endif %}>ğŸ‡¨ğŸ‡­ +41 (Switzerland)</option>
                            <option value="+46" {% if user.country_code == '+46' %}selected{% endif %}>ğŸ‡¸ğŸ‡ª +46 (Sweden)</option>
                            <option value="+47" {% if user.country_code == '+47' %}selected{% endif %}>ğŸ‡³ğŸ‡´ +47 (Norway)</option>
                            <option value="+45" {% if user.country_code == '+45' %}selected{% endif %}>ğŸ‡©ğŸ‡° +45 (Denmark)</option>
                            <option value="+358" {% if user.country_code == '+358' %}selected{% endif %}>ğŸ‡«ğŸ‡® +358 (Finland)</option>
                            <option value="+354" {% if user.country_code == '+354' %}selected{% endif %}>ğŸ‡®ğŸ‡¸ +354 (Iceland)</option>
                            <option value="+353" {% if user.country_code == '+353' %}selected{% endif %}>ğŸ‡®ğŸ‡ª +353 (Ireland)</option>
                            <option value="+44" {% if user.country_code == '+44' %}selected{% endif %}>ğŸ‡¬ğŸ‡§ +44 (United Kingdom)</option>
                            <option value="+1" {% if user.country_code == '+1' %}selected{% endif %}>ğŸ‡ºğŸ‡¸ +1 (United States)</option>
                            <option value="+1" {% if user.country_code == '+1' %}selected{% endif %}>ğŸ‡¨ğŸ‡¦ +1 (Canada)</option>
                            <option value="+61" {% if user.country_code == '+61' %}selected{% endif %}>ğŸ‡¦ğŸ‡º +61 (Australia)</option>
                            <option value="+64" {% if user.country_code == '+64' %}selected{% endif %}>ğŸ‡³ğŸ‡¿ +64 (New Zealand)</option>
                            <option value="+27" {% if user.country_code == '+27' %}selected{% endif %}>ğŸ‡¿ğŸ‡¦ +27 (South Africa)</option>
                            <option value="+55" {% if user.country_code == '+55' %}selected{% endif %}>ğŸ‡§ğŸ‡· +55 (Brazil)</option>
                            <option value="+54" {% if user.country_code == '+54' %}selected{% endif %}>ğŸ‡¦ğŸ‡· +54 (Argentina)</option>
                            <option value="+52" {% if user.country_code == '+52' %}selected{% endif %}>ğŸ‡²ğŸ‡½ +52 (Mexico)</option>
                            <option value="+91" {% if user.country_code == '+91' %}selected{% endif %}>ğŸ‡®ğŸ‡³ +91 (India)</option>
                            <option value="+86" {% if user.country_code == '+86' %}selected{% endif %}>ğŸ‡¨ğŸ‡³ +86 (China)</option>
                            <option value="+81" {% if user.country_code == '+81' %}selected{% endif %}>ğŸ‡¯ğŸ‡µ +81 (Japan)</option>
                            <option value="+82" {% if user.country_code == '+82' %}selected{% endif %}>ğŸ‡°ğŸ‡· +82 (South Korea)</option>
                            <option value="+66" {% if user.country_code == '+66' %}selected{% endif %}>ğŸ‡¹ğŸ‡­ +66 (Thailand)</option>
                            <option value="+84" {% if user.country_code == '+84' %}selected{% endif %}>ğŸ‡»ğŸ‡³ +84 (Vietnam)</option>
                            <option value="+63" {% if user.country_code == '+63' %}selected{% endif %}>ğŸ‡µğŸ‡­ +63 (Philippines)</option>
                            <option value="+62" {% if user.country_code == '+62' %}selected{% endif %}>ğŸ‡®ğŸ‡© +62 (Indonesia)</option>
                            <option value="+60" {% if user.country_code == '+60' %}selected{% endif %}>ğŸ‡²ğŸ‡¾ +60 (Malaysia)</option>
                            <option value="+65" {% if user.country_code == '+65' %}selected{% endif %}>ğŸ‡¸ğŸ‡¬ +65 (Singapore)</option>
                            <option value="+90" {% if user.country_code == '+90' %}selected{% endif %}>ğŸ‡¹ğŸ‡· +90 (Turkey)</option>
                            <option value="+20" {% if user.country_code == '+20' %}selected{% endif %}>ğŸ‡ªğŸ‡¬ +20 (Egypt)</option>
                            <option value="+212" {% if user.country_code == '+212' %}selected{% endif %}>ğŸ‡²ğŸ‡¦ +212 (Morocco)</option>
                            <option value="+216" {% if user.country_code == '+216' %}selected{% endif %}>ğŸ‡¹ğŸ‡³ +216 (Tunisia)</option>
                            <option value="+213" {% if user.country_code == '+213' %}selected{% endif %}>ğŸ‡©ğŸ‡¿ +213 (Algeria)</option>
                            <option value="+234" {% if user.country_code == '+234' %}selected{% endif %}>ğŸ‡³ğŸ‡¬ +234 (Nigeria)</option>
                            <option value="+254" {% if user.country_code == '+254' %}selected{% endif %}>ğŸ‡°ğŸ‡ª +254 (Kenya)</option>
                            <option value="+233" {% if user.country_code == '+233' %}selected{% endif %}>ğŸ‡¬ğŸ‡­ +233 (Ghana)</option>
                            <option value="+251" {% if user.country_code == '+251' %}selected{% endif %}>ğŸ‡ªğŸ‡¹ +251 (Ethiopia)</option>
                            <option value="+380" {% if user.country_code == '+380' %}selected{% endif %}>ğŸ‡ºğŸ‡¦ +380 (Ukraine)</option>
                            <option value="+375" {% if user.country_code == '+375' %}selected{% endif %}>ğŸ‡§ğŸ‡¾ +375 (Belarus)</option>
                            <option value="+7" {% if user.country_code == '+7' %}selected{% endif %}>ğŸ‡·ğŸ‡º +7 (Russia)</option>
                            <option value="+381" {% if user.country_code == '+381' %}selected{% endif %}>ğŸ‡·ğŸ‡¸ +381 (Serbia)</option>
                            <option value="+387" {% if user.country_code == '+387' %}selected{% endif %}>ğŸ‡§ğŸ‡¦ +387 (Bosnia)</option>
                            <option value="+382" {% if user.country_code == '+382' %}selected{% endif %}>ğŸ‡²ğŸ‡ª +382 (Montenegro)</option>
                            <option value="+389" {% if user.country_code == '+389' %}selected{% endif %}>ğŸ‡²ğŸ‡° +389 (Macedonia)</option>
                            <option value="+355" {% if user.country_code == '+355' %}selected{% endif %}>ğŸ‡¦ğŸ‡± +355 (Albania)</option>
                            <option value="+373" {% if user.country_code == '+373' %}selected{% endif %}>ğŸ‡²ğŸ‡© +373 (Moldova)</option>
                        </select>
                        <input type="tel" id="phone" name="phone" value="{{ user.phone or '' }}" placeholder="{{ t('phone_placeholder', lang) | default('123456789') }}" class="phone-number-input" autocomplete="tel">
                    </div>
                </div>
            </div>


            <div class="form-row">
                <div class="form-group">
                    <label for="birth_date">{{ t('birth_date', lang) | default('Date of Birth') }} <span class="required">*</span></label>
                    <input type="date" id="birth_date" name="birth_date" value="{{ user.birth_date or '' }}" required>
                </div>
                <div class="form-group">
                    <label for="nationality">{{ t('nationality', lang) | default('Nationality') }} <span class="required">*</span></label>
                    <div class="nationality-search-container">
                        <input type="text" id="nationality_search" placeholder="{{ t('search_nationality', lang) | default('Search nationality...') }}" class="nationality-search">
                        <i class="fas fa-search nationality-search-icon"></i>
                    </div>
                    <select id="nationality" name="nationality" required onchange="toggleOtherField('nationality', 'other_nationality')" class="nationality-select">
                        <option value="">{{ t('select_nationality', lang) | default('Select Nationality') }}</option>
                        <!-- All countries sorted alphabetically -->
                        <option value="AL">{{ t('albanian', lang) | default('Albanian') }}</option>
                        <option value="DZ">{{ t('algerian', lang) | default('Algerian') }}</option>
                        <option value="AR">{{ t('argentinian', lang) | default('Argentinian') }}</option>
                        <option value="AU">{{ t('australian', lang) | default('Australian') }}</option>
                        <option value="AT">{{ t('austrian', lang) | default('Austrian') }}</option>
                        <option value="BA">{{ t('bosnian', lang) | default('Bosnian') }}</option>
                        <option value="BR">{{ t('brazilian', lang) | default('Brazilian') }}</option>
                        <option value="BG">{{ t('bulgarian', lang) | default('Bulgarian') }}</option>
                        <option value="BY">{{ t('belarusian', lang) | default('Belarusian') }}</option>
                        <option value="BE">{{ t('belgian', lang) | default('Belgian') }}</option>
                        <option value="GB">{{ t('british', lang) | default('British') }}</option>
                        <option value="CA">{{ t('canadian', lang) | default('Canadian') }}</option>
                        <option value="CN">{{ t('chinese', lang) | default('Chinese') }}</option>
                        <option value="HR">{{ t('croatian', lang) | default('Croatian') }}</option>
                        <option value="CY">{{ t('cypriot', lang) | default('Cypriot') }}</option>
                        <option value="CZ">{{ t('czech', lang) | default('Czech') }}</option>
                        <option value="DK">{{ t('danish', lang) | default('Danish') }}</option>
                        <option value="EG">{{ t('egyptian', lang) | default('Egyptian') }}</option>
                        <option value="ET">{{ t('ethiopian', lang) | default('Ethiopian') }}</option>
                        <option value="EE">{{ t('estonian', lang) | default('Estonian') }}</option>
                        <option value="FI">{{ t('finnish', lang) | default('Finnish') }}</option>
                        <option value="FR">{{ t('french', lang) | default('French') }}</option>
                        <option value="DE">{{ t('german', lang) | default('German') }}</option>
                        <option value="GH">{{ t('ghanaian', lang) | default('Ghanaian') }}</option>
                        <option value="GR">{{ t('greek', lang) | default('Greek') }}</option>
                        <option value="HU">{{ t('hungarian', lang) | default('Hungarian') }}</option>
                        <option value="IS">{{ t('icelandic', lang) | default('Icelandic') }}</option>
                        <option value="IN">{{ t('indian', lang) | default('Indian') }}</option>
                        <option value="ID">{{ t('indonesian', lang) | default('Indonesian') }}</option>
                        <option value="IE">{{ t('irish', lang) | default('Irish') }}</option>
                        <option value="IT">{{ t('italian', lang) | default('Italian') }}</option>
                        <option value="JP">{{ t('japanese', lang) | default('Japanese') }}</option>
                        <option value="KE">{{ t('kenyan', lang) | default('Kenyan') }}</option>
                        <option value="KR">{{ t('korean', lang) | default('Korean') }}</option>
                        <option value="LV">{{ t('latvian', lang) | default('Latvian') }}</option>
                        <option value="LT">{{ t('lithuanian', lang) | default('Lithuanian') }}</option>
                        <option value="LU">{{ t('luxembourgish', lang) | default('Luxembourgish') }}</option>
                        <option value="MK">{{ t('macedonian', lang) | default('Macedonian') }}</option>
                        <option value="MT">{{ t('maltese', lang) | default('Maltese') }}</option>
                        <option value="MX">{{ t('mexican', lang) | default('Mexican') }}</option>
                        <option value="MD">{{ t('moldovan', lang) | default('Moldovan') }}</option>
                        <option value="ME">{{ t('montenegrin', lang) | default('Montenegrin') }}</option>
                        <option value="MA">{{ t('moroccan', lang) | default('Moroccan') }}</option>
                        <option value="NL">{{ t('dutch', lang) | default('Dutch') }}</option>
                        <option value="NZ">{{ t('new_zealand', lang) | default('New Zealand') }}</option>
                        <option value="NG">{{ t('nigerian', lang) | default('Nigerian') }}</option>
                        <option value="NO">{{ t('norwegian', lang) | default('Norwegian') }}</option>
                        <option value="PH">{{ t('filipino', lang) | default('Filipino') }}</option>
                        <option value="PL">{{ t('polish', lang) | default('Polish') }}</option>
                        <option value="PT">{{ t('portuguese', lang) | default('Portuguese') }}</option>
                        <option value="RO">{{ t('romanian', lang) | default('Romanian') }}</option>
                        <option value="RU">{{ t('russian', lang) | default('Russian') }}</option>
                        <option value="RS">{{ t('serbian', lang) | default('Serbian') }}</option>
                        <option value="SG">{{ t('singaporean', lang) | default('Singaporean') }}</option>
                        <option value="SK">{{ t('slovak', lang) | default('Slovak') }}</option>
                        <option value="SI">{{ t('slovenian', lang) | default('Slovenian') }}</option>
                        <option value="ZA">{{ t('south_african', lang) | default('South African') }}</option>
                        <option value="ES">{{ t('spanish', lang) | default('Spanish') }}</option>
                        <option value="SE">{{ t('swedish', lang) | default('Swedish') }}</option>
                        <option value="CH">{{ t('swiss', lang) | default('Swiss') }}</option>
                        <option value="TH">{{ t('thai', lang) | default('Thai') }}</option>
                        <option value="TN">{{ t('tunisian', lang) | default('Tunisian') }}</option>
                        <option value="TR">{{ t('turkish', lang) | default('Turkish') }}</option>
                        <option value="UA">{{ t('ukrainian', lang) | default('Ukrainian') }}</option>
                        <option value="US">{{ t('american', lang) | default('American') }}</option>
                        <option value="VN">{{ t('vietnamese', lang) | default('Vietnamese') }}</option>
                        <option value="OTHER">{{ t('other', lang) | default('Other') }}</option>
                    </select>
                </div>
            </div>

            <div class="form-group" id="other_nationality_group" style="display: none;">
                <label for="other_nationality">{{ t('specify_nationality', lang) | default('Please specify your nationality') }} <span class="required">*</span></label>
                <input type="text" id="other_nationality" name="other_nationality" placeholder="{{ t('nationality_placeholder', lang) | default('Enter your nationality') }}">
            </div>

            <div class="form-row">
                <div class="form-group">
                    <label for="gender">{{ t('gender', lang) | default('Gender') }}</label>
                    <select id="gender" name="gender">
                        <option value="">{{ t('select_gender', lang) | default('Select Gender') }}</option>
                        <option value="male">{{ t('male', lang) | default('Male') }}</option>
                        <option value="female">{{ t('female', lang) | default('Female') }}</option>
                        <option value="other">{{ t('other', lang) | default('Other') }}</option>
                    </select>
                </div>
            </div>
        </div>


        <!-- Language Certificates Section -->
        <div class="form-section">
            <h3><i class="fas fa-language"></i> {{ t('language_certificates', lang) | default('Language Certificates') }}</h3>
            
            <div class="form-group">
                <label for="dutch_level">{{ t('dutch_language_level', lang) | default('Dutch Language Level') }} <span class="required">*</span></label>
                <select id="dutch_level" name="dutch_level" required>
                    <option value="">{{ t('select_level', lang) | default('Select Level') }}</option>
                    <option value="A1">{{ t('a1_basic', lang) | default('A1 - Basic') }}</option>
                    <option value="A2">{{ t('a2_elementary', lang) | default('A2 - Elementary') }}</option>
                    <option value="B1">{{ t('b1_intermediate', lang) | default('B1 - Intermediate') }}</option>
                    <option value="B2">{{ t('b2_upper_intermediate', lang) | default('B2 - Upper Intermediate') }}</option>
                    <option value="C1">{{ t('c1_advanced', lang) | default('C1 - Advanced') }}</option>
                    <option value="C2">{{ t('c2_proficient', lang) | default('C2 - Proficient') }}</option>
                    <option value="native">{{ t('native_speaker', lang) | default('Native Speaker') }}</option>
                </select>
            </div>

            <div class="form-group">
                <label for="english_level">{{ t('english_language_level', lang) | default('English Language Level') }}</label>
                <select id="english_level" name="english_level">
                    <option value="">{{ t('select_level', lang) | default('Select Level') }}</option>
                    <option value="A1">{{ t('a1_basic', lang) | default('A1 - Basic') }}</option>
                    <option value="A2">{{ t('a2_elementary', lang) | default('A2 - Elementary') }}</option>
                    <option value="B1">{{ t('b1_intermediate', lang) | default('B1 - Intermediate') }}</option>
                    <option value="B2">{{ t('b2_upper_intermediate', lang) | default('B2 - Upper Intermediate') }}</option>
                    <option value="C1">{{ t('c1_advanced', lang) | default('C1 - Advanced') }}</option>
                    <option value="C2">{{ t('c2_proficient', lang) | default('C2 - Proficient') }}</option>
                    <option value="native">{{ t('native_speaker', lang) | default('Native Speaker') }}</option>
                </select>
            </div>

            <div class="form-group">
                <label for="language_certificates">{{ t('upload_language_certificates', lang) | default('Upload Language Certificates') }}</label>
                <div class="file-upload">
                    <input type="file" id="language_certificates" name="language_certificates" multiple accept=".pdf,.jpg,.jpeg,.png">
                    <label for="language_certificates" class="file-upload-label">
                        <i class="fas fa-upload"></i> {{ t('upload_files', lang) | default('Upload Files') }}
                    </label>
                    <div class="help-text">{{ t('language_certificates_help', lang) | default('Upload your language certificates (PDF, JPG, PNG)') }}</div>
                </div>
                <div class="uploaded-files" id="language-certificates-list"></div>
            </div>
        </div>

        <!-- Professional Information Section -->
        <div class="form-section">
            <h3><i class="fas fa-briefcase"></i> {{ t('professional_information', lang) | default('Professional Information') }}</h3>
            
            <!-- Professional Information -->
            <div class="form-group">
                <label for="profession">{{ t('profession', lang) | default('Profession') }} <span class="required">*</span></label>
                <select id="profession" name="profession" required onchange="toggleOtherField('profession', 'other_profession')">
                    <option value="">{{ t('select_profession', lang) | default('Select Profession') }}</option>
                    <option value="tandarts" {% if user.profession == 'tandarts' %}selected{% endif %}>{{ t('dentist', lang) | default('Dentist') }}</option>
                    <option value="apotheker" {% if user.profession == 'apotheker' %}selected{% endif %}>{{ t('pharmacist', lang) | default('Pharmacist') }}</option>
                    <option value="huisarts" {% if user.profession == 'huisarts' %}selected{% endif %}>{{ t('general_practitioner', lang) | default('General Practitioner') }}</option>
                    <option value="verpleegkundige" {% if user.profession == 'verpleegkundige' %}selected{% endif %}>{{ t('nurse', lang) | default('Nurse') }}</option>
                    <option value="fysiotherapeut" {% if user.profession == 'fysiotherapeut' %}selected{% endif %}>{{ t('physiotherapist', lang) | default('Physiotherapist') }}</option>
                    <option value="psycholoog" {% if user.profession == 'psycholoog' %}selected{% endif %}>{{ t('psychologist', lang) | default('Psychologist') }}</option>
                    <option value="dietist" {% if user.profession == 'dietist' %}selected{% endif %}>{{ t('dietitian', lang) | default('Dietitian') }}</option>
                    <option value="logopedist" {% if user.profession == 'logopedist' %}selected{% endif %}>{{ t('speech_therapist', lang) | default('Speech Therapist') }}</option>
                    <option value="ergotherapeut" {% if user.profession == 'ergotherapeut' %}selected{% endif %}>{{ t('occupational_therapist', lang) | default('Occupational Therapist') }}</option>
                    <option value="podotherapeut" {% if user.profession == 'podotherapeut' %}selected{% endif %}>{{ t('podiatrist', lang) | default('Podiatrist') }}</option>
                    <option value="other" {% if user.profession == 'other' %}selected{% endif %}>{{ t('other_medical', lang) | default('Other Medical Profession') }}</option>
                </select>
            </div>

            <div class="form-group" id="other_profession_group" style="display: none;">
                <label for="other_profession">{{ t('specify_profession', lang) | default('Please specify your profession') }} <span class="required">*</span></label>
                <input type="text" id="other_profession" name="other_profession" value="{{ user.other_profession or '' }}" placeholder="{{ t('profession_placeholder', lang) | default('Enter your medical profession') }}">
            </div>

            <div class="form-row">
                <div class="form-group">
                    <label for="workplace">{{ t('current_workplace', lang) | default('Current Workplace') }}</label>
                    <input type="text" id="workplace" name="workplace" value="{{ user.workplace or '' }}" placeholder="{{ t('workplace_placeholder', lang) | default('Hospital, Clinic, Practice, etc.') }}">
                </div>
                <div class="form-group">
                    <label for="workplace_specialization">{{ t('specialization', lang) | default('Specialization') }}</label>
                    <input type="text" id="workplace_specialization" name="workplace_specialization" placeholder="{{ t('specialization_placeholder', lang) | default('Your medical specialization') }}">
                </div>
            </div>

            <div class="form-group">
                <label for="legal_status">{{ t('legal_status', lang) | default('Legal Status in Netherlands') }} <span class="required">*</span></label>
                <select id="legal_status" name="legal_status" required onchange="toggleOtherField('legal_status', 'other_legal_status')">
                    <option value="">{{ t('select_legal_status', lang) | default('Select Legal Status') }}</option>
                    <option value="eu_citizen">{{ t('eu_citizen', lang) | default('EU Citizen') }}</option>
                    <option value="non_eu_resident">{{ t('non_eu_resident', lang) | default('Non-EU Resident') }}</option>
                    <option value="refugee">{{ t('refugee', lang) | default('Refugee') }}</option>
                    <option value="student_visa">{{ t('student_visa', lang) | default('Student Visa') }}</option>
                    <option value="work_visa">{{ t('work_visa', lang) | default('Work Visa') }}</option>
                    <option value="other">{{ t('other_status', lang) | default('Other') }}</option>
                </select>
            </div>

            <div class="form-group" id="other_legal_status_group" style="display: none;">
                <label for="other_legal_status">{{ t('specify_legal_status', lang) | default('Please specify your legal status') }} <span class="required">*</span></label>
                <input type="text" id="other_legal_status" name="other_legal_status" placeholder="{{ t('legal_status_placeholder', lang) | default('Enter your legal status') }}">
            </div>
            
            <div class="form-group">
                <label>{{ t('diploma_information', lang) | default('Diploma/Certificate Information') }} <span class="required">*</span></label>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="university_name">{{ t('university_name', lang) | default('University/Institution Name') }} <span class="required">*</span></label>
                        <input type="text" id="university_name" name="university_name" required placeholder="{{ t('university_placeholder', lang) | default('Enter university or institution name') }}">
                    </div>
                    <div class="form-group">
                        <label for="degree_type">{{ t('degree_type', lang) | default('Degree Type') }} <span class="required">*</span></label>
                        <select id="degree_type" name="degree_type" required>
                            <option value="">{{ t('select_degree', lang) | default('Select Degree Type') }}</option>
                            <option value="bachelor">{{ t('bachelor', lang) | default('Bachelor') }}</option>
                            <option value="master">{{ t('master', lang) | default('Master') }}</option>
                            <option value="doctorate">{{ t('doctorate', lang) | default('Doctorate (PhD)') }}</option>
                            <option value="medical_degree">{{ t('medical_degree', lang) | default('Medical Degree (MD)') }}</option>
                            <option value="dental_degree">{{ t('dental_degree', lang) | default('Dental Degree (DDS/DMD)') }}</option>
                            <option value="pharmacy_degree">{{ t('pharmacy_degree', lang) | default('Pharmacy Degree (PharmD)') }}</option>
                            <option value="nursing_degree">{{ t('nursing_degree', lang) | default('Nursing Degree') }}</option>
                            <option value="certificate">{{ t('certificate', lang) | default('Professional Certificate') }}</option>
                            <option value="diploma">{{ t('diploma', lang) | default('Diploma') }}</option>
                            <option value="other">{{ t('other_degree', lang) | default('Other') }}</option>
                        </select>
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label for="study_years">{{ t('study_years', lang) | default('Study Period') }} <span class="required">*</span></label>
                        <div class="year-range-container">
                            <input type="number" id="study_start_year" name="study_start_year" required placeholder="{{ t('start_year', lang) | default('Start Year') }}" min="1950" max="2030" class="year-input">
                            <span class="year-separator">-</span>
                            <input type="number" id="study_end_year" name="study_end_year" required placeholder="{{ t('end_year', lang) | default('End Year') }}" min="1950" max="2030" class="year-input">
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="study_country">{{ t('study_country', lang) | default('Country of Study') }} <span class="required">*</span></label>
                        <select id="study_country" name="study_country" required>
                            <option value="">{{ t('select_country', lang) | default('Select Country') }}</option>
                            <option value="NL">{{ t('netherlands', lang) | default('Netherlands') }}</option>
                            <option value="DE">{{ t('germany', lang) | default('Germany') }}</option>
                            <option value="BE">{{ t('belgium', lang) | default('Belgium') }}</option>
                            <option value="FR">{{ t('france', lang) | default('France') }}</option>
                            <option value="ES">{{ t('spain', lang) | default('Spain') }}</option>
                            <option value="IT">{{ t('italy', lang) | default('Italy') }}</option>
                            <option value="PT">{{ t('portugal', lang) | default('Portugal') }}</option>
                            <option value="PL">{{ t('poland', lang) | default('Poland') }}</option>
                            <option value="RO">{{ t('romania', lang) | default('Romania') }}</option>
                            <option value="BG">{{ t('bulgaria', lang) | default('Bulgaria') }}</option>
                            <option value="HU">{{ t('hungary', lang) | default('Hungary') }}</option>
                            <option value="CZ">{{ t('czech_republic', lang) | default('Czech Republic') }}</option>
                            <option value="SK">{{ t('slovakia', lang) | default('Slovakia') }}</option>
                            <option value="HR">{{ t('croatia', lang) | default('Croatia') }}</option>
                            <option value="SI">{{ t('slovenia', lang) | default('Slovenia') }}</option>
                            <option value="EE">{{ t('estonia', lang) | default('Estonia') }}</option>
                            <option value="LV">{{ t('latvia', lang) | default('Latvia') }}</option>
                            <option value="LT">{{ t('lithuania', lang) | default('Lithuania') }}</option>
                            <option value="MT">{{ t('malta', lang) | default('Malta') }}</option>
                            <option value="CY">{{ t('cyprus', lang) | default('Cyprus') }}</option>
                            <option value="LU">{{ t('luxembourg', lang) | default('Luxembourg') }}</option>
                            <option value="AT">{{ t('austria', lang) | default('Austria') }}</option>
                            <option value="IE">{{ t('ireland', lang) | default('Ireland') }}</option>
                            <option value="CH">{{ t('switzerland', lang) | default('Switzerland') }}</option>
                            <option value="SE">{{ t('sweden', lang) | default('Sweden') }}</option>
                            <option value="NO">{{ t('norway', lang) | default('Norway') }}</option>
                            <option value="DK">{{ t('denmark', lang) | default('Denmark') }}</option>
                            <option value="FI">{{ t('finland', lang) | default('Finland') }}</option>
                            <option value="IS">{{ t('iceland', lang) | default('Iceland') }}</option>
                            <option value="GB">{{ t('united_kingdom', lang) | default('United Kingdom') }}</option>
                            <option value="US">{{ t('united_states', lang) | default('United States') }}</option>
                            <option value="CA">{{ t('canada', lang) | default('Canada') }}</option>
                            <option value="AU">{{ t('australia', lang) | default('Australia') }}</option>
                            <option value="NZ">{{ t('new_zealand', lang) | default('New Zealand') }}</option>
                            <option value="OTHER">{{ t('other_country', lang) | default('Other') }}</option>
                        </select>
                    </div>
                </div>

                <div class="form-group">
                    <label for="medical_specialization">{{ t('medical_specialization', lang) | default('Medical Specialization') }}</label>
                    <input type="text" id="medical_specialization" name="medical_specialization" placeholder="{{ t('specialization_placeholder', lang) | default('e.g., General Medicine, Dentistry, Pharmacy, Nursing, etc.') }}">
                </div>

                <div class="form-group">
                    <label for="additional_education_info">{{ t('additional_education_info', lang) | default('Additional Education Information') }}</label>
                    <textarea id="additional_education_info" name="additional_education_info" rows="2" placeholder="{{ t('additional_education_placeholder', lang) | default('Any additional information about your education, honors, awards, or special achievements') }}"></textarea>
                    <div class="help-text">{{ t('additional_education_help', lang) | default('Optional: Include any honors, awards, or special achievements') }}</div>
                </div>
            </div>

            <div class="form-group">
                <label for="work_experience">{{ t('work_experience', lang) | default('Work Experience') }}</label>
                <textarea id="work_experience" name="work_experience" rows="3" placeholder="{{ t('work_experience_placeholder', lang) | default('Describe your professional work experience in the medical field') }}"></textarea>
                <div class="help-text">{{ t('work_experience_help', lang) | default('Include years of experience, positions held, and areas of expertise') }}</div>
            </div>

            <div class="form-group">
                <label for="additional_qualifications">{{ t('additional_qualifications', lang) | default('Additional Qualifications') }}</label>
                <textarea id="additional_qualifications" name="additional_qualifications" rows="2" placeholder="{{ t('additional_qualifications_placeholder', lang) | default('Any additional certifications, courses, or specializations') }}"></textarea>
                <div class="help-text">{{ t('additional_qualifications_help', lang) | default('List any additional professional qualifications or certifications') }}</div>
            </div>

        </div>

        <!-- Submit Section -->
        <div class="submit-section">
            <a href="{{ url_for('profile.index', lang=lang) }}" class="btn-back">
                <i class="fas fa-arrow-left"></i>
                {{ t('back_to_profile', lang) | default('Back to Profile') }}
            </a>
            <button type="submit" class="btn-save" id="submitBtn">
                <i class="fas fa-save"></i> {{ t('save_changes', lang) | default('Save Changes') }}
            </button>
        </div>
    </form>
</div>
{% endblock %}

{% block extra_js %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    // Form validation
    setupFormValidation();
    
    // Initialize other fields
    initializeOtherFields();
    
    // Initialize nationality search
    initializeNationalitySearch();
});

// Function to toggle "Other" fields
function toggleOtherField(selectId, otherFieldId) {
    const select = document.getElementById(selectId);
    const otherGroup = document.getElementById(otherFieldId + '_group');
    const otherField = document.getElementById(otherFieldId);
    
    // Check for both 'other' and 'OTHER' values
    if (select.value === 'other' || select.value === 'OTHER') {
        otherGroup.style.display = 'block';
        otherField.required = true;
    } else {
        otherGroup.style.display = 'none';
        otherField.required = false;
        otherField.value = '';
    }
}

// Initialize other fields on page load
function initializeOtherFields() {
    // Check profession field
    toggleOtherField('profession', 'other_profession');
    
    // Check nationality field
    toggleOtherField('nationality', 'other_nationality');
    
    // Check legal status field
    toggleOtherField('legal_status', 'other_legal_status');
    
    // Initialize phone number formatting
    setupPhoneNumberFormatting();
}

// Initialize auto-fill signature functionality
function initializeAutoFillSignature() {
    const autoFillBtn = document.getElementById('autoFillSignature');
    const signatureField = document.getElementById('digital_signature');
    const firstNameField = document.getElementById('first_name');
    const lastNameField = document.getElementById('last_name');
    
    if (autoFillBtn && signatureField && firstNameField && lastNameField) {
        // Auto-fill button click
        autoFillBtn.addEventListener('click', function() {
            const firstName = firstNameField.value.trim();
            const lastName = lastNameField.value.trim();
            
            if (firstName && lastName) {
                signatureField.value = `${firstName} ${lastName}`;
                signatureField.style.borderColor = '#27ae60';
                
                // Show success message
                showFieldSuccess(signatureField, '{{ t("signature_auto_filled", lang) | default("Signature auto-filled successfully!") }}');
            } else {
                showFieldError(signatureField, '{{ t("fill_name_first", lang) | default("Please fill in your first and last name first") }}');
            }
        });
        
        // Auto-fill when name fields change
        firstNameField.addEventListener('input', updateSignaturePreview);
        lastNameField.addEventListener('input', updateSignaturePreview);
        
        // Real-time validation for signature
        signatureField.addEventListener('input', function() {
            const firstName = firstNameField.value.trim();
            const lastName = lastNameField.value.trim();
            const signature = this.value.trim();
            const expectedSignature = `${firstName} ${lastName}`.trim();
            
            if (signature === expectedSignature && signature.length > 0) {
                this.style.borderColor = '#27ae60';
                clearFieldError(this);
            } else if (signature.length > 0) {
                this.style.borderColor = '#e74c3c';
            } else {
                this.style.borderColor = '#ecf0f1';
                clearFieldError(this);
            }
        });
    }
}

// Update signature preview
function updateSignaturePreview() {
    const firstName = document.getElementById('first_name').value.trim();
    const lastName = document.getElementById('last_name').value.trim();
    const signatureField = document.getElementById('digital_signature');
    
    if (firstName && lastName && !signatureField.value.trim()) {
        // Show preview in placeholder
        signatureField.placeholder = `{{ t('signature_preview', lang) | default('Will be:') }} ${firstName} ${lastName}`;
    }
}

// Show field success message
function showFieldSuccess(field, message) {
    clearFieldError(field);
    
    const successDiv = document.createElement('div');
    successDiv.className = 'success-message';
    successDiv.textContent = message;
    
    field.parentNode.appendChild(successDiv);
    
    // Remove success message after 3 seconds
    setTimeout(() => {
        if (successDiv.parentNode) {
            successDiv.remove();
        }
    }, 3000);
}

// Setup phone number formatting
function setupPhoneNumberFormatting() {
    const countryCodeSelect = document.getElementById('country_code');
    const phoneInput = document.getElementById('phone');
    
    if (countryCodeSelect && phoneInput) {
        // Update phone placeholder based on country code
        countryCodeSelect.addEventListener('change', function() {
            const countryCode = this.value;
            const placeholders = {
                '+31': '612345678',  // Netherlands
                '+49': '15123456789', // Germany
                '+32': '471234567',  // Belgium
                '+33': '612345678',  // France
                '+34': '612345678',  // Spain
                '+39': '3123456789', // Italy
                '+351': '912345678', // Portugal
                '+48': '123456789',  // Poland
                '+40': '712345678',  // Romania
                '+359': '871234567', // Bulgaria
                '+36': '201234567',  // Hungary
                '+420': '123456789', // Czech Republic
                '+421': '123456789', // Slovakia
                '+385': '912345678', // Croatia
                '+386': '401234567', // Slovenia
                '+372': '51234567',  // Estonia
                '+371': '21234567',  // Latvia
                '+370': '61234567',  // Lithuania
                '+356': '21234567',  // Malta
                '+357': '96123456',  // Cyprus
                '+352': '621123456', // Luxembourg
                '+43': '664123456',  // Austria
                '+41': '791234567',  // Switzerland
                '+46': '701234567',  // Sweden
                '+47': '41234567',   // Norway
                '+45': '20123456',   // Denmark
                '+358': '401234567', // Finland
                '+354': '6123456',   // Iceland
                '+353': '851234567', // Ireland
                '+44': '7123456789', // United Kingdom
                '+1': '5551234567',  // United States/Canada
                '+61': '412345678',  // Australia
                '+64': '211234567',  // New Zealand
                '+27': '821234567',  // South Africa
                '+55': '11987654321', // Brazil
                '+54': '91123456789', // Argentina
                '+52': '5512345678', // Mexico
                '+91': '9876543210', // India
                '+86': '13812345678', // China
                '+81': '9012345678', // Japan
                '+82': '1012345678', // South Korea
                '+66': '812345678',  // Thailand
                '+84': '912345678',  // Vietnam
                '+63': '9171234567', // Philippines
                '+62': '8123456789', // Indonesia
                '+60': '123456789',  // Malaysia
                '+65': '81234567',   // Singapore
                '+90': '5321234567', // Turkey
                '+20': '1012345678', // Egypt
                '+212': '612345678', // Morocco
                '+216': '20123456',  // Tunisia
                '+213': '551234567', // Algeria
                '+234': '8012345678', // Nigeria
                '+254': '712345678', // Kenya
                '+233': '241234567', // Ghana
                '+251': '911234567', // Ethiopia
                '+380': '501234567', // Ukraine
                '+375': '291234567', // Belarus
                '+7': '9123456789',  // Russia
                '+381': '601234567', // Serbia
                '+387': '61123456',  // Bosnia
                '+382': '67123456',  // Montenegro
                '+389': '70123456',  // Macedonia
                '+355': '691234567', // Albania
                '+373': '60123456'   // Moldova
            };
            
            phoneInput.placeholder = placeholders[countryCode] || '123456789';
        });
        
        // Trigger initial placeholder update
        countryCodeSelect.dispatchEvent(new Event('change'));
    }
}

function setupFileUploads() {
    // Diploma file upload
    const diplomaInput = document.getElementById('diploma_file');
    const diplomaList = document.getElementById('diploma-list');
    
    diplomaInput.addEventListener('change', function(e) {
        handleFileUpload(e, diplomaList, 'diploma');
    });
    
    // Language certificates upload
    const languageInput = document.getElementById('language_certificates');
    const languageList = document.getElementById('language-certificates-list');
    
    languageInput.addEventListener('change', function(e) {
        handleFileUpload(e, languageList, 'language');
    });
    
    // Additional documents upload
    const additionalInput = document.getElementById('additional_documents');
    const additionalList = document.getElementById('additional-documents-list');
    
    additionalInput.addEventListener('change', function(e) {
        handleFileUpload(e, additionalList, 'additional');
    });
}

function handleFileUpload(event, container, type) {
    const files = event.target.files;
    
    // Clear previous files
    container.innerHTML = '';
    
    Array.from(files).forEach((file, index) => {
        const fileItem = document.createElement('div');
        fileItem.className = 'uploaded-file';
        fileItem.innerHTML = `
            <span class="file-name">${file.name}</span>
            <span class="remove-file" onclick="removeFile('${type}', ${index})">Ã—</span>
        `;
        container.appendChild(fileItem);
    });
}

function removeFile(type, index) {
    const input = document.getElementById(type === 'diploma' ? 'diploma_file' : 
                                   type === 'language' ? 'language_certificates' : 'additional_documents');
    
    // Create new FileList without the removed file
    const dt = new DataTransfer();
    Array.from(input.files).forEach((file, i) => {
        if (i !== index) {
            dt.items.add(file);
        }
    });
    input.files = dt.files;
    
    // Update display
    const container = document.getElementById(type === 'diploma' ? 'diploma-list' : 
                                           type === 'language' ? 'language-certificates-list' : 'additional-documents-list');
    handleFileUpload({target: {files: input.files}}, container, type);
}

function setupFormValidation() {
    const form = document.getElementById('registrationForm');
    const submitBtn = document.getElementById('submitBtn');
    
    form.addEventListener('submit', function(e) {
        e.preventDefault();
        
        if (validateForm()) {
            submitForm();
        }
    });
    
    // Real-time validation
    const requiredFields = form.querySelectorAll('[required]');
    requiredFields.forEach(field => {
        field.addEventListener('blur', validateField);
        field.addEventListener('input', clearFieldError);
    });
}

function validateForm() {
    let isValid = true;
    const form = document.getElementById('registrationForm');
    
    // Check required fields
    const requiredFields = form.querySelectorAll('[required]');
    requiredFields.forEach(field => {
        if (!validateField({target: field})) {
            isValid = false;
        }
    });
    
    // Check new diploma fields
    const universityName = document.getElementById('university_name');
    const degreeType = document.getElementById('degree_type');
    const studyStartYear = document.getElementById('study_start_year');
    const studyEndYear = document.getElementById('study_end_year');
    const studyCountry = document.getElementById('study_country');
    
    if (!universityName.value.trim()) {
        showFieldError(universityName, '{{ t("university_required", lang) | default("University name is required") }}');
        isValid = false;
    }
    
    if (!degreeType.value) {
        showFieldError(degreeType, '{{ t("degree_type_required", lang) | default("Degree type is required") }}');
        isValid = false;
    }
    
    if (!studyStartYear.value || !studyEndYear.value) {
        if (!studyStartYear.value) {
            showFieldError(studyStartYear, '{{ t("start_year_required", lang) | default("Start year is required") }}');
        }
        if (!studyEndYear.value) {
            showFieldError(studyEndYear, '{{ t("end_year_required", lang) | default("End year is required") }}');
        }
        isValid = false;
    } else {
        // Validate year range
        const startYear = parseInt(studyStartYear.value);
        const endYear = parseInt(studyEndYear.value);
        const currentYear = new Date().getFullYear();
        
        if (startYear > endYear) {
            showFieldError(studyEndYear, '{{ t("end_year_before_start", lang) | default("End year must be after start year") }}');
            isValid = false;
        }
        
        if (startYear < 1950 || startYear > currentYear) {
            showFieldError(studyStartYear, '{{ t("invalid_start_year", lang) | default("Start year must be between 1950 and current year") }}');
            isValid = false;
        }
        
        if (endYear < 1950 || endYear > currentYear) {
            showFieldError(studyEndYear, '{{ t("invalid_end_year", lang) | default("End year must be between 1950 and current year") }}');
            isValid = false;
        }
    }
    
    if (!studyCountry.value) {
        showFieldError(studyCountry, '{{ t("study_country_required", lang) | default("Country of study is required") }}');
        isValid = false;
    }
    
    // Check "Other" fields
    const profession = document.getElementById('profession');
    const otherProfession = document.getElementById('other_profession');
    if (profession.value === 'other' && !otherProfession.value.trim()) {
        showFieldError(otherProfession, '{{ t("other_profession_required", lang) | default("Please specify your profession") }}');
        isValid = false;
    }
    
    const nationality = document.getElementById('nationality');
    const otherNationality = document.getElementById('other_nationality');
    if (nationality.value === 'OTHER' && !otherNationality.value.trim()) {
        showFieldError(otherNationality, '{{ t("other_nationality_required", lang) | default("Please specify your nationality") }}');
        isValid = false;
    }
    
    const legalStatus = document.getElementById('legal_status');
    const otherLegalStatus = document.getElementById('other_legal_status');
    if (legalStatus.value === 'other' && !otherLegalStatus.value.trim()) {
        showFieldError(otherLegalStatus, '{{ t("other_legal_status_required", lang) | default("Please specify your legal status") }}');
        isValid = false;
    }
    
    // Check password confirmation
    const password = document.getElementById('password');
    const confirmPassword = document.getElementById('confirm_password');
    if (password.value !== confirmPassword.value) {
        showFieldError(confirmPassword, '{{ t("passwords_dont_match", lang) | default("Passwords do not match") }}');
        isValid = false;
    }
    
    // Check password strength
    if (password.value && !isPasswordStrong(password.value)) {
        showFieldError(password, '{{ t("password_weak", lang) | default("Password must contain at least 8 characters with letters and numbers") }}');
        isValid = false;
    }
    
    // Check digital signature
    const digitalSignature = document.getElementById('digital_signature');
    const firstName = document.getElementById('first_name').value.trim();
    const lastName = document.getElementById('last_name').value.trim();
    const signature = digitalSignature.value.trim();
    
    if (!signature) {
        showFieldError(digitalSignature, '{{ t("signature_required", lang) | default("Digital signature is required") }}');
        isValid = false;
    } else if (signature.length < 3) {
        showFieldError(digitalSignature, '{{ t("signature_too_short", lang) | default("Digital signature must be at least 3 characters long") }}');
        isValid = false;
    } else {
        // Check if signature contains both first and last name (flexible matching)
        const firstNameLower = firstName.toLowerCase();
        const lastNameLower = lastName.toLowerCase();
        const signatureLower = signature.toLowerCase();
        
        if (firstNameLower && lastNameLower && 
            (!signatureLower.includes(firstNameLower) || !signatureLower.includes(lastNameLower))) {
            showFieldError(digitalSignature, '{{ t("signature_should_contain_name", lang) | default("Digital signature should contain your first and last name") }}');
            isValid = false;
        }
    }
    
    return isValid;
}

// Check password strength
function isPasswordStrong(password) {
    // At least 8 characters
    if (password.length < 8) return false;
    
    // Contains at least one letter
    if (!/[a-zA-Z]/.test(password)) return false;
    
    // Contains at least one number
    if (!/[0-9]/.test(password)) return false;
    
    return true;
}

function validateField(event) {
    const field = event.target;
    const value = field.value.trim();
    
    clearFieldError(field);
    
    if (field.hasAttribute('required') && !value) {
        showFieldError(field, '{{ t("field_required", lang) | default("This field is required") }}');
        return false;
    }
    
    // Email validation
    if (field.type === 'email' && value) {
        const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
        if (!emailRegex.test(value)) {
            showFieldError(field, '{{ t("invalid_email", lang) | default("Please enter a valid email address") }}');
            return false;
        }
    }
    
    // Phone validation
    if (field.type === 'tel' && value) {
        const phoneRegex = /^[0-9\s\-\(\)]{7,15}$/;
        if (!phoneRegex.test(value)) {
            showFieldError(field, '{{ t("invalid_phone", lang) | default("Please enter a valid phone number") }}');
            return false;
        }
    }
    
    // Date validation
    if (field.type === 'date' && value) {
        const date = new Date(value);
        const today = new Date();
        
        if (field.id === 'birth_date' && date >= today) {
            showFieldError(field, '{{ t("invalid_birth_date", lang) | default("Birth date cannot be in the future") }}');
            return false;
        }
        
        if (field.id === 'exam_date' && date <= today) {
            showFieldError(field, '{{ t("invalid_exam_date", lang) | default("Exam date must be in the future") }}');
            return false;
        }
    }
    
    return true;
}

function showFieldError(field, message) {
    if (!field || !field.parentNode) {
        return;
    }
    clearFieldError(field);
    
    const errorDiv = document.createElement('div');
    errorDiv.className = 'error-message';
    errorDiv.textContent = message;
    
    field.parentNode.appendChild(errorDiv);
    field.style.borderColor = '#e74c3c';
}

function clearFieldError(field) {
    if (!field || !field.parentNode) {
        return;
    }
    const errorDiv = field.parentNode.querySelector('.error-message');
    if (errorDiv) {
        errorDiv.remove();
    }
    field.style.borderColor = '#ecf0f1';
}

function setupProgressIndicator() {
    const sections = document.querySelectorAll('.form-section');
    const steps = document.querySelectorAll('.progress-step');
    
    // Update progress based on completed sections
    function updateProgress() {
        let completedSections = 0;
        
        sections.forEach((section, index) => {
            const requiredFields = section.querySelectorAll('[required]');
            let sectionCompleted = true;
            
            requiredFields.forEach(field => {
                if (!field.value.trim()) {
                    sectionCompleted = false;
                }
            });
            
            if (sectionCompleted && requiredFields.length > 0) {
                completedSections++;
                if (steps[index]) {
                    steps[index].classList.add('completed');
                    steps[index].classList.remove('active');
                }
            } else if (steps[index]) {
                steps[index].classList.remove('completed');
                if (index === completedSections) {
                    steps[index].classList.add('active');
                }
            }
        });
    }
    
    // Update progress on field changes
    const allFields = document.querySelectorAll('input, select, textarea');
    allFields.forEach(field => {
        field.addEventListener('change', updateProgress);
        field.addEventListener('input', updateProgress);
    });
    
    // Initial progress update
    updateProgress();
}

async function submitForm() {
    const form = document.getElementById('registrationForm');
    const submitBtn = document.getElementById('submitBtn');
    const formData = new FormData(form);
    
    // Validate reCAPTCHA
    if (!validateRecaptcha()) {
        return;
    }
    
    // Disable submit button
    submitBtn.disabled = true;
    submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> {{ t("processing", lang) | default("Processing...") }}';
    
    try {
        const response = await fetch('{{ url_for("auth.register") }}', {
            method: 'POST',
            body: formData
        });
        
        const result = await response.json();
        
        if (result.success) {
            // Show success message with spam folder warning
            const successMessage = '{{ t("registration_success", lang) | default("Registration completed successfully!") }}' + 
                '<br><br><strong>ğŸ“§ {{ t("check_spam_folder", lang) | default("Important: Please check your spam folder!") }}</strong><br>' +
                '{{ t("spam_folder_warning", lang) | default("Confirmation email might be in your spam/junk folder. Please check and mark as not spam if found.") }}';
            showSuccessMessage(successMessage);
            
            // Redirect to login or dashboard
            setTimeout(() => {
                window.location.href = '{{ url_for("auth.login") }}';
            }, 5000); // Increased timeout to give time to read the message
        } else {
            // Show error message
            showErrorMessage(result.error || '{{ t("registration_error", lang) | default("Registration failed. Please try again.") }}');
        }
    } catch (error) {
        console.error('Registration error:', error);
        showErrorMessage('{{ t("network_error", lang) | default("Network error. Please check your connection and try again.") }}');
    } finally {
        // Re-enable submit button
        submitBtn.disabled = false;
        submitBtn.innerHTML = '<i class="fas fa-user-plus"></i> {{ t("complete_registration", lang) | default("Complete Registration") }}';
    }
}

function showSuccessMessage(message) {
    const messageDiv = document.createElement('div');
    messageDiv.className = 'success-message';
    messageDiv.style.cssText = 'position: fixed; top: 20px; right: 20px; background: #27ae60; color: white; padding: 15px 20px; border-radius: 5px; z-index: 1000;';
    messageDiv.textContent = message;
    document.body.appendChild(messageDiv);
    
    setTimeout(() => {
        messageDiv.remove();
    }, 5000);
}

function showErrorMessage(message) {
    const messageDiv = document.createElement('div');
    messageDiv.className = 'error-message';
    messageDiv.style.cssText = 'position: fixed; top: 20px; right: 20px; background: #e74c3c; color: white; padding: 15px 20px; border-radius: 5px; z-index: 1000;';
    messageDiv.textContent = message;
    document.body.appendChild(messageDiv);
    
    setTimeout(() => {
        messageDiv.remove();
    }, 5000);
}

function togglePassword(fieldId) {
    const passwordField = document.getElementById(fieldId);
    const eyeIcon = document.getElementById(fieldId + '-eye');
    
    if (passwordField.type === 'password') {
        passwordField.type = 'text';
        eyeIcon.classList.remove('fa-eye');
        eyeIcon.classList.add('fa-eye-slash');
    } else {
        passwordField.type = 'password';
        eyeIcon.classList.remove('fa-eye-slash');
        eyeIcon.classList.add('fa-eye');
    }
}

// Initialize nationality search functionality
function initializeNationalitySearch() {
    const searchInput = document.getElementById('nationality_search');
    const selectElement = document.getElementById('nationality');
    
    if (searchInput && selectElement) {
        searchInput.addEventListener('input', function() {
            const searchTerm = this.value.toLowerCase();
            const options = selectElement.querySelectorAll('option');
            
            options.forEach(option => {
                const text = option.textContent.toLowerCase();
                if (text.includes(searchTerm) || searchTerm === '') {
                    option.style.display = 'block';
                } else {
                    option.style.display = 'none';
                }
            });
            
            // If search matches exactly one option, select it
            const visibleOptions = Array.from(options).filter(option => 
                option.style.display !== 'none' && option.value !== ''
            );
            
            if (visibleOptions.length === 1 && searchTerm.length > 2) {
                selectElement.value = visibleOptions[0].value;
                toggleOtherField('nationality', 'other_nationality');
            }
        });
        
        // Clear search when selection is made
        selectElement.addEventListener('change', function() {
            if (this.value) {
                searchInput.value = this.options[this.selectedIndex].textContent;
            }
        });
    }
}

// reCAPTCHA validation
function validateRecaptcha() {
    // Check if reCAPTCHA is configured
    if (typeof grecaptcha === 'undefined') {
        return true; // Skip validation if reCAPTCHA is not configured
    }
    
    const recaptchaResponse = grecaptcha.getResponse();
    if (recaptchaResponse.length === 0) {
        showErrorMessage('{{ t("recaptcha_required", lang) | default("Please complete the reCAPTCHA verification") }}');
        return false;
    }
    return true;
}
</script>

<!-- reCAPTCHA Script -->
{% if config.RECAPTCHA_PUBLIC_KEY %}
<script src="https://www.google.com/recaptcha/api.js?hl={{ lang }}" async defer></script>
{% endif %}
{% endblock %}
