{% extends "base.html" %}

{% block title %}{{ t('registration', lang) | default('Registration') }} - {{ t('dental_academy', lang) | default('Dental Academy') }}{% endblock %}

{% block description %}{{ t('registration_description', lang) | default('Register for the Dental Academy BIG preparation program') }}{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/auth.css') }}">
<style>
.registration-container {
    max-width: 800px;
    margin: 0 auto;
    padding: 20px;
}

.registration-header {
    text-align: center;
    margin-bottom: 30px;
}

.registration-header h1 {
    color: #2c3e50;
    margin-bottom: 10px;
}

.registration-header p {
    color: #7f8c8d;
    font-size: 16px;
}

.registration-form {
    background: white;
    border-radius: 10px;
    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
    padding: 30px;
}

.form-section {
    margin-bottom: 30px;
    padding-bottom: 20px;
    border-bottom: 1px solid #ecf0f1;
}

.form-section:last-child {
    border-bottom: none;
}

.form-section h3 {
    color: #2c3e50;
    margin-bottom: 20px;
    font-size: 18px;
    display: flex;
    align-items: center;
}

.form-section h3 i {
    margin-right: 10px;
    color: #3498db;
}

.form-row {
    display: flex;
    gap: 20px;
    margin-bottom: 20px;
}

.form-group {
    flex: 1;
    margin-bottom: 20px;
}

.form-group label {
    display: block;
    margin-bottom: 5px;
    font-weight: 600;
    color: #2c3e50;
}

.form-group input,
.form-group select,
.form-group textarea {
    width: 100%;
    padding: 12px;
    border: 2px solid #ecf0f1;
    border-radius: 5px;
    font-size: 14px;
    transition: border-color 0.3s;
}

.form-group input:focus,
.form-group select:focus,
.form-group textarea:focus {
    outline: none;
    border-color: #3498db;
}

.form-group .help-text {
    font-size: 12px;
    color: #7f8c8d;
    margin-top: 5px;
}

.required {
    color: #e74c3c;
}

.file-upload {
    border: 2px dashed #bdc3c7;
    border-radius: 5px;
    padding: 20px;
    text-align: center;
    transition: border-color 0.3s;
}

.file-upload:hover {
    border-color: #3498db;
}

.file-upload input[type="file"] {
    display: none;
}

.file-upload-label {
    cursor: pointer;
    color: #3498db;
    font-weight: 600;
}

.file-upload-label:hover {
    color: #2980b9;
}

.uploaded-files {
    margin-top: 10px;
}

.uploaded-file {
    display: flex;
    align-items: center;
    justify-content: space-between;
    background: #f8f9fa;
    padding: 10px;
    border-radius: 5px;
    margin-bottom: 5px;
}

.uploaded-file .file-name {
    font-weight: 500;
}

.uploaded-file .remove-file {
    color: #e74c3c;
    cursor: pointer;
    font-weight: bold;
}

.checkbox-group {
    display: flex;
    align-items: center;
    margin-bottom: 15px;
}

.checkbox-group input[type="checkbox"] {
    margin-right: 10px;
    transform: scale(1.2);
}

.checkbox-group label {
    margin-bottom: 0;
    font-weight: normal;
}

.submit-section {
    text-align: center;
    margin-top: 30px;
    padding-top: 20px;
    border-top: 1px solid #ecf0f1;
}

.btn-register {
    background: linear-gradient(135deg, #3498db, #2980b9);
    color: white;
    padding: 15px 40px;
    border: none;
    border-radius: 25px;
    font-size: 16px;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.3s;
    min-width: 200px;
}

.btn-register:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 8px rgba(52, 152, 219, 0.3);
}

.btn-register:disabled {
    background: #bdc3c7;
    cursor: not-allowed;
    transform: none;
    box-shadow: none;
}

.error-message {
    color: #e74c3c;
    font-size: 12px;
    margin-top: 5px;
}

.success-message {
    color: #27ae60;
    font-size: 12px;
    margin-top: 5px;
}

.progress-indicator {
    display: flex;
    justify-content: center;
    margin-bottom: 30px;
}

.progress-step {
    display: flex;
    align-items: center;
    margin: 0 10px;
}

.progress-step .step-number {
    width: 30px;
    height: 30px;
    border-radius: 50%;
    background: #ecf0f1;
    color: #7f8c8d;
    display: flex;
    align-items: center;
    justify-content: center;
    font-weight: bold;
    margin-right: 10px;
}

.progress-step.active .step-number {
    background: #3498db;
    color: white;
}

.progress-step.completed .step-number {
    background: #27ae60;
    color: white;
}

.progress-step .step-label {
    font-size: 12px;
    color: #7f8c8d;
}

.progress-step.active .step-label,
.progress-step.completed .step-label {
    color: #2c3e50;
    font-weight: 600;
}

.consent-block {
    background: #f8f9fa;
    border: 1px solid #e9ecef;
    border-radius: 8px;
    padding: 20px;
    margin-bottom: 20px;
}

.consent-block h4 {
    color: #2c3e50;
    margin-bottom: 15px;
    font-size: 16px;
    display: flex;
    align-items: center;
}

.consent-block h4 i {
    margin-right: 8px;
    color: #3498db;
}

.consent-content {
    margin-bottom: 15px;
}

.consent-content p {
    margin-bottom: 10px;
    color: #555;
    font-weight: 500;
}

.consent-content ul {
    margin: 10px 0;
    padding-left: 20px;
}

.consent-content li {
    margin-bottom: 5px;
    color: #666;
}

.signature-block {
    background: #fff3cd;
    border: 1px solid #ffeaa7;
    border-radius: 8px;
    padding: 20px;
    margin-top: 20px;
}

.signature-block h4 {
    color: #856404;
    margin-bottom: 15px;
    font-size: 16px;
}

.signature-block .form-group {
    margin-bottom: 0;
}

.phone-input-group {
    display: flex;
    gap: 10px;
    align-items: stretch;
}

.country-code-select {
    flex: 0 0 200px;
    padding: 12px;
    border: 2px solid #ecf0f1;
    border-radius: 5px;
    font-size: 14px;
    background: white;
    transition: border-color 0.3s;
}

.country-code-select:focus {
    outline: none;
    border-color: #3498db;
}

.phone-number-input {
    flex: 1;
    padding: 12px;
    border: 2px solid #ecf0f1;
    border-radius: 5px;
    font-size: 14px;
    transition: border-color 0.3s;
}

.phone-number-input:focus {
    outline: none;
    border-color: #3498db;
}

@media (max-width: 768px) {
    .form-row {
        flex-direction: column;
        gap: 0;
    }
    
    .progress-indicator {
        flex-direction: column;
        gap: 10px;
    }
    
    .progress-step {
        margin: 5px 0;
    }
    
    .consent-block,
    .signature-block {
        padding: 15px;
    }
    
    .phone-input-group {
        flex-direction: column;
        gap: 10px;
    }
    
    .country-code-select {
        flex: none;
        width: 100%;
    }
}
</style>
{% endblock %}

{% block content %}
<div class="registration-container">
    <div class="registration-header">
        <h1>{{ t('registration', lang) | default('Registration') }}</h1>
        <p>{{ t('registration_subtitle', lang) | default('Complete your registration to access the Dental Academy BIG preparation program') }}</p>
    </div>

    <div class="progress-indicator">
        <div class="progress-step active">
            <div class="step-number">1</div>
            <div class="step-label">{{ t('personal_info', lang) | default('Personal Info') }}</div>
        </div>
        <div class="progress-step">
            <div class="step-number">2</div>
            <div class="step-label">{{ t('professional_info', lang) | default('Professional Info') }}</div>
        </div>
        <div class="progress-step">
            <div class="step-number">3</div>
            <div class="step-label">{{ t('documents', lang) | default('Documents') }}</div>
        </div>
        <div class="progress-step">
            <div class="step-number">4</div>
            <div class="step-label">{{ t('review', lang) | default('Review') }}</div>
        </div>
    </div>

    <form class="registration-form" id="registrationForm" method="POST" enctype="multipart/form-data">
        <input type="hidden" name="csrf_token" value="{{ csrf_token() }}"/>
        
        <!-- Personal Information Section -->
        <div class="form-section">
            <h3><i class="fas fa-user"></i> {{ t('personal_information', lang) | default('Personal Information') }}</h3>
            
            <div class="form-row">
                <div class="form-group">
                    <label for="first_name">{{ t('first_name', lang) | default('First Name') }} <span class="required">*</span></label>
                    <input type="text" id="first_name" name="first_name" required>
                </div>
                <div class="form-group">
                    <label for="last_name">{{ t('last_name', lang) | default('Last Name') }} <span class="required">*</span></label>
                    <input type="text" id="last_name" name="last_name" required>
                </div>
            </div>

            <div class="form-row">
                <div class="form-group">
                    <label for="email">{{ t('email', lang) | default('Email') }} <span class="required">*</span></label>
                    <input type="email" id="email" name="email" required>
                </div>
                <div class="form-group">
                    <label for="phone">{{ t('phone', lang) | default('Phone Number') }}</label>
                    <div class="phone-input-group">
                        <select id="country_code" name="country_code" class="country-code-select">
                            <option value="+31">ðŸ‡³ðŸ‡± +31 (Netherlands)</option>
                            <option value="+49">ðŸ‡©ðŸ‡ª +49 (Germany)</option>
                            <option value="+32">ðŸ‡§ðŸ‡ª +32 (Belgium)</option>
                            <option value="+33">ðŸ‡«ðŸ‡· +33 (France)</option>
                            <option value="+34">ðŸ‡ªðŸ‡¸ +34 (Spain)</option>
                            <option value="+39">ðŸ‡®ðŸ‡¹ +39 (Italy)</option>
                            <option value="+351">ðŸ‡µðŸ‡¹ +351 (Portugal)</option>
                            <option value="+48">ðŸ‡µðŸ‡± +48 (Poland)</option>
                            <option value="+40">ðŸ‡·ðŸ‡´ +40 (Romania)</option>
                            <option value="+359">ðŸ‡§ðŸ‡¬ +359 (Bulgaria)</option>
                            <option value="+36">ðŸ‡­ðŸ‡º +36 (Hungary)</option>
                            <option value="+420">ðŸ‡¨ðŸ‡¿ +420 (Czech Republic)</option>
                            <option value="+421">ðŸ‡¸ðŸ‡° +421 (Slovakia)</option>
                            <option value="+385">ðŸ‡­ðŸ‡· +385 (Croatia)</option>
                            <option value="+386">ðŸ‡¸ðŸ‡® +386 (Slovenia)</option>
                            <option value="+372">ðŸ‡ªðŸ‡ª +372 (Estonia)</option>
                            <option value="+371">ðŸ‡±ðŸ‡» +371 (Latvia)</option>
                            <option value="+370">ðŸ‡±ðŸ‡¹ +370 (Lithuania)</option>
                            <option value="+356">ðŸ‡²ðŸ‡¹ +356 (Malta)</option>
                            <option value="+357">ðŸ‡¨ðŸ‡¾ +357 (Cyprus)</option>
                            <option value="+352">ðŸ‡±ðŸ‡º +352 (Luxembourg)</option>
                            <option value="+43">ðŸ‡¦ðŸ‡¹ +43 (Austria)</option>
                            <option value="+41">ðŸ‡¨ðŸ‡­ +41 (Switzerland)</option>
                            <option value="+46">ðŸ‡¸ðŸ‡ª +46 (Sweden)</option>
                            <option value="+47">ðŸ‡³ðŸ‡´ +47 (Norway)</option>
                            <option value="+45">ðŸ‡©ðŸ‡° +45 (Denmark)</option>
                            <option value="+358">ðŸ‡«ðŸ‡® +358 (Finland)</option>
                            <option value="+354">ðŸ‡®ðŸ‡¸ +354 (Iceland)</option>
                            <option value="+353">ðŸ‡®ðŸ‡ª +353 (Ireland)</option>
                            <option value="+44">ðŸ‡¬ðŸ‡§ +44 (United Kingdom)</option>
                            <option value="+1">ðŸ‡ºðŸ‡¸ +1 (United States)</option>
                            <option value="+1">ðŸ‡¨ðŸ‡¦ +1 (Canada)</option>
                            <option value="+61">ðŸ‡¦ðŸ‡º +61 (Australia)</option>
                            <option value="+64">ðŸ‡³ðŸ‡¿ +64 (New Zealand)</option>
                            <option value="+27">ðŸ‡¿ðŸ‡¦ +27 (South Africa)</option>
                            <option value="+55">ðŸ‡§ðŸ‡· +55 (Brazil)</option>
                            <option value="+54">ðŸ‡¦ðŸ‡· +54 (Argentina)</option>
                            <option value="+52">ðŸ‡²ðŸ‡½ +52 (Mexico)</option>
                            <option value="+91">ðŸ‡®ðŸ‡³ +91 (India)</option>
                            <option value="+86">ðŸ‡¨ðŸ‡³ +86 (China)</option>
                            <option value="+81">ðŸ‡¯ðŸ‡µ +81 (Japan)</option>
                            <option value="+82">ðŸ‡°ðŸ‡· +82 (South Korea)</option>
                            <option value="+66">ðŸ‡¹ðŸ‡­ +66 (Thailand)</option>
                            <option value="+84">ðŸ‡»ðŸ‡³ +84 (Vietnam)</option>
                            <option value="+63">ðŸ‡µðŸ‡­ +63 (Philippines)</option>
                            <option value="+62">ðŸ‡®ðŸ‡© +62 (Indonesia)</option>
                            <option value="+60">ðŸ‡²ðŸ‡¾ +60 (Malaysia)</option>
                            <option value="+65">ðŸ‡¸ðŸ‡¬ +65 (Singapore)</option>
                            <option value="+90">ðŸ‡¹ðŸ‡· +90 (Turkey)</option>
                            <option value="+20">ðŸ‡ªðŸ‡¬ +20 (Egypt)</option>
                            <option value="+212">ðŸ‡²ðŸ‡¦ +212 (Morocco)</option>
                            <option value="+216">ðŸ‡¹ðŸ‡³ +216 (Tunisia)</option>
                            <option value="+213">ðŸ‡©ðŸ‡¿ +213 (Algeria)</option>
                            <option value="+234">ðŸ‡³ðŸ‡¬ +234 (Nigeria)</option>
                            <option value="+254">ðŸ‡°ðŸ‡ª +254 (Kenya)</option>
                            <option value="+233">ðŸ‡¬ðŸ‡­ +233 (Ghana)</option>
                            <option value="+251">ðŸ‡ªðŸ‡¹ +251 (Ethiopia)</option>
                            <option value="+380">ðŸ‡ºðŸ‡¦ +380 (Ukraine)</option>
                            <option value="+375">ðŸ‡§ðŸ‡¾ +375 (Belarus)</option>
                            <option value="+7">ðŸ‡·ðŸ‡º +7 (Russia)</option>
                            <option value="+381">ðŸ‡·ðŸ‡¸ +381 (Serbia)</option>
                            <option value="+387">ðŸ‡§ðŸ‡¦ +387 (Bosnia)</option>
                            <option value="+382">ðŸ‡²ðŸ‡ª +382 (Montenegro)</option>
                            <option value="+389">ðŸ‡²ðŸ‡° +389 (Macedonia)</option>
                            <option value="+355">ðŸ‡¦ðŸ‡± +355 (Albania)</option>
                            <option value="+373">ðŸ‡²ðŸ‡© +373 (Moldova)</option>
                        </select>
                        <input type="tel" id="phone" name="phone" placeholder="{{ t('phone_placeholder', lang) | default('123456789') }}" class="phone-number-input">
                    </div>
                </div>
            </div>

            <div class="form-row">
                <div class="form-group">
                    <label for="password">{{ t('password', lang) | default('Password') }} <span class="required">*</span></label>
                    <input type="password" id="password" name="password" required minlength="8" placeholder="{{ t('password_placeholder', lang) | default('Enter your password') }}">
                    <div class="help-text">{{ t('password_help', lang) | default('Minimum 8 characters, must contain letters and numbers') }}</div>
                </div>
                <div class="form-group">
                    <label for="confirm_password">{{ t('confirm_password', lang) | default('Confirm Password') }} <span class="required">*</span></label>
                    <input type="password" id="confirm_password" name="confirm_password" required minlength="8" placeholder="{{ t('confirm_password_placeholder', lang) | default('Confirm your password') }}">
                </div>
            </div>

            <div class="form-row">
                <div class="form-group">
                    <label for="birth_date">{{ t('birth_date', lang) | default('Date of Birth') }} <span class="required">*</span></label>
                    <input type="date" id="birth_date" name="birth_date" required>
                </div>
                <div class="form-group">
                    <label for="nationality">{{ t('nationality', lang) | default('Nationality') }} <span class="required">*</span></label>
                    <select id="nationality" name="nationality" required onchange="toggleOtherField('nationality', 'other_nationality')">
                        <option value="">{{ t('select_nationality', lang) | default('Select Nationality') }}</option>
                        <!-- EU Countries -->
                        <optgroup label="{{ t('eu_countries', lang) | default('EU Countries') }}">
                        <option value="NL">{{ t('dutch', lang) | default('Dutch') }}</option>
                        <option value="DE">{{ t('german', lang) | default('German') }}</option>
                        <option value="BE">{{ t('belgian', lang) | default('Belgian') }}</option>
                        <option value="FR">{{ t('french', lang) | default('French') }}</option>
                        <option value="ES">{{ t('spanish', lang) | default('Spanish') }}</option>
                        <option value="IT">{{ t('italian', lang) | default('Italian') }}</option>
                        <option value="PT">{{ t('portuguese', lang) | default('Portuguese') }}</option>
                        <option value="PL">{{ t('polish', lang) | default('Polish') }}</option>
                        <option value="RO">{{ t('romanian', lang) | default('Romanian') }}</option>
                        <option value="BG">{{ t('bulgarian', lang) | default('Bulgarian') }}</option>
                        <option value="HU">{{ t('hungarian', lang) | default('Hungarian') }}</option>
                        <option value="CZ">{{ t('czech', lang) | default('Czech') }}</option>
                        <option value="SK">{{ t('slovak', lang) | default('Slovak') }}</option>
                        <option value="HR">{{ t('croatian', lang) | default('Croatian') }}</option>
                        <option value="SI">{{ t('slovenian', lang) | default('Slovenian') }}</option>
                        <option value="EE">{{ t('estonian', lang) | default('Estonian') }}</option>
                        <option value="LV">{{ t('latvian', lang) | default('Latvian') }}</option>
                        <option value="LT">{{ t('lithuanian', lang) | default('Lithuanian') }}</option>
                        <option value="MT">{{ t('maltese', lang) | default('Maltese') }}</option>
                        <option value="CY">{{ t('cypriot', lang) | default('Cypriot') }}</option>
                        <option value="LU">{{ t('luxembourgish', lang) | default('Luxembourgish') }}</option>
                        <option value="AT">{{ t('austrian', lang) | default('Austrian') }}</option>
                            <option value="IE">{{ t('irish', lang) | default('Irish') }}</option>
                        </optgroup>
                        <!-- Non-EU European Countries -->
                        <optgroup label="{{ t('non_eu_european', lang) | default('Non-EU European Countries') }}">
                        <option value="CH">{{ t('swiss', lang) | default('Swiss') }}</option>
                        <option value="SE">{{ t('swedish', lang) | default('Swedish') }}</option>
                        <option value="NO">{{ t('norwegian', lang) | default('Norwegian') }}</option>
                        <option value="DK">{{ t('danish', lang) | default('Danish') }}</option>
                        <option value="FI">{{ t('finnish', lang) | default('Finnish') }}</option>
                        <option value="IS">{{ t('icelandic', lang) | default('Icelandic') }}</option>
                        <option value="GB">{{ t('british', lang) | default('British') }}</option>
                            <option value="RS">{{ t('serbian', lang) | default('Serbian') }}</option>
                            <option value="BA">{{ t('bosnian', lang) | default('Bosnian') }}</option>
                            <option value="ME">{{ t('montenegrin', lang) | default('Montenegrin') }}</option>
                            <option value="MK">{{ t('macedonian', lang) | default('Macedonian') }}</option>
                            <option value="AL">{{ t('albanian', lang) | default('Albanian') }}</option>
                            <option value="MD">{{ t('moldovan', lang) | default('Moldovan') }}</option>
                            <option value="UA">{{ t('ukrainian', lang) | default('Ukrainian') }}</option>
                            <option value="BY">{{ t('belarusian', lang) | default('Belarusian') }}</option>
                            <option value="RU">{{ t('russian', lang) | default('Russian') }}</option>
                        </optgroup>
                        <!-- Other Countries -->
                        <optgroup label="{{ t('other_countries', lang) | default('Other Countries') }}">
                            <option value="US">{{ t('american', lang) | default('American') }}</option>
                            <option value="CA">{{ t('canadian', lang) | default('Canadian') }}</option>
                            <option value="AU">{{ t('australian', lang) | default('Australian') }}</option>
                            <option value="NZ">{{ t('new_zealand', lang) | default('New Zealand') }}</option>
                            <option value="ZA">{{ t('south_african', lang) | default('South African') }}</option>
                            <option value="BR">{{ t('brazilian', lang) | default('Brazilian') }}</option>
                            <option value="AR">{{ t('argentinian', lang) | default('Argentinian') }}</option>
                            <option value="MX">{{ t('mexican', lang) | default('Mexican') }}</option>
                            <option value="IN">{{ t('indian', lang) | default('Indian') }}</option>
                            <option value="CN">{{ t('chinese', lang) | default('Chinese') }}</option>
                            <option value="JP">{{ t('japanese', lang) | default('Japanese') }}</option>
                            <option value="KR">{{ t('korean', lang) | default('Korean') }}</option>
                            <option value="TH">{{ t('thai', lang) | default('Thai') }}</option>
                            <option value="VN">{{ t('vietnamese', lang) | default('Vietnamese') }}</option>
                            <option value="PH">{{ t('filipino', lang) | default('Filipino') }}</option>
                            <option value="ID">{{ t('indonesian', lang) | default('Indonesian') }}</option>
                            <option value="MY">{{ t('malaysian', lang) | default('Malaysian') }}</option>
                            <option value="SG">{{ t('singaporean', lang) | default('Singaporean') }}</option>
                            <option value="TR">{{ t('turkish', lang) | default('Turkish') }}</option>
                            <option value="EG">{{ t('egyptian', lang) | default('Egyptian') }}</option>
                            <option value="MA">{{ t('moroccan', lang) | default('Moroccan') }}</option>
                            <option value="TN">{{ t('tunisian', lang) | default('Tunisian') }}</option>
                            <option value="DZ">{{ t('algerian', lang) | default('Algerian') }}</option>
                            <option value="NG">{{ t('nigerian', lang) | default('Nigerian') }}</option>
                            <option value="KE">{{ t('kenyan', lang) | default('Kenyan') }}</option>
                            <option value="GH">{{ t('ghanaian', lang) | default('Ghanaian') }}</option>
                            <option value="ET">{{ t('ethiopian', lang) | default('Ethiopian') }}</option>
                        <option value="OTHER">{{ t('other', lang) | default('Other') }}</option>
                        </optgroup>
                    </select>
                </div>
            </div>

            <div class="form-group" id="other_nationality_group" style="display: none;">
                <label for="other_nationality">{{ t('specify_nationality', lang) | default('Please specify your nationality') }} <span class="required">*</span></label>
                <input type="text" id="other_nationality" name="other_nationality" placeholder="{{ t('nationality_placeholder', lang) | default('Enter your nationality') }}">
            </div>

            <div class="form-row">
                <div class="form-group">
                    <label for="gender">{{ t('gender', lang) | default('Gender') }}</label>
                    <select id="gender" name="gender">
                        <option value="">{{ t('select_gender', lang) | default('Select Gender') }}</option>
                        <option value="male">{{ t('male', lang) | default('Male') }}</option>
                        <option value="female">{{ t('female', lang) | default('Female') }}</option>
                        <option value="other">{{ t('other', lang) | default('Other') }}</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="language">{{ t('preferred_language', lang) | default('Preferred Language') }}</label>
                    <select id="language" name="language">
                        <option value="nl">{{ t('dutch', lang) | default('Dutch') }}</option>
                        <option value="en">{{ t('english', lang) | default('English') }}</option>
                        <option value="de">{{ t('german', lang) | default('German') }}</option>
                        <option value="fr">{{ t('french', lang) | default('French') }}</option>
                    </select>
                </div>
            </div>
        </div>

        <!-- Professional Information Section -->
        <div class="form-section">
            <h3><i class="fas fa-briefcase"></i> {{ t('professional_information', lang) | default('Professional Information') }}</h3>
            
            <div class="form-group">
                <label for="profession">{{ t('profession', lang) | default('Profession') }} <span class="required">*</span></label>
                <select id="profession" name="profession" required onchange="toggleOtherField('profession', 'other_profession')">
                    <option value="">{{ t('select_profession', lang) | default('Select Profession') }}</option>
                    <option value="tandarts">{{ t('dentist', lang) | default('Dentist') }}</option>
                    <option value="apotheker">{{ t('pharmacist', lang) | default('Pharmacist') }}</option>
                    <option value="huisarts">{{ t('general_practitioner', lang) | default('General Practitioner') }}</option>
                    <option value="verpleegkundige">{{ t('nurse', lang) | default('Nurse') }}</option>
                    <option value="fysiotherapeut">{{ t('physiotherapist', lang) | default('Physiotherapist') }}</option>
                    <option value="psycholoog">{{ t('psychologist', lang) | default('Psychologist') }}</option>
                    <option value="dietist">{{ t('dietitian', lang) | default('Dietitian') }}</option>
                    <option value="logopedist">{{ t('speech_therapist', lang) | default('Speech Therapist') }}</option>
                    <option value="ergotherapeut">{{ t('occupational_therapist', lang) | default('Occupational Therapist') }}</option>
                    <option value="podotherapeut">{{ t('podiatrist', lang) | default('Podiatrist') }}</option>
                    <option value="other">{{ t('other_medical', lang) | default('Other Medical Profession') }}</option>
                </select>
            </div>

            <div class="form-group" id="other_profession_group" style="display: none;">
                <label for="other_profession">{{ t('specify_profession', lang) | default('Please specify your profession') }} <span class="required">*</span></label>
                <input type="text" id="other_profession" name="other_profession" placeholder="{{ t('profession_placeholder', lang) | default('Enter your medical profession') }}">
            </div>

                <div class="form-group">
                    <label for="workplace">{{ t('current_workplace', lang) | default('Current Workplace') }}</label>
                    <input type="text" id="workplace" name="workplace" placeholder="{{ t('workplace_placeholder', lang) | default('Hospital, Clinic, Practice, etc.') }}">
            </div>

            <div class="form-group">
                <label for="specialization">{{ t('specialization', lang) | default('Specialization') }}</label>
                <input type="text" id="specialization" name="specialization" placeholder="{{ t('specialization_placeholder', lang) | default('Your medical specialization') }}">
            </div>

            <div class="form-group">
                <label for="legal_status">{{ t('legal_status', lang) | default('Legal Status in Netherlands') }} <span class="required">*</span></label>
                <select id="legal_status" name="legal_status" required onchange="toggleOtherField('legal_status', 'other_legal_status')">
                    <option value="">{{ t('select_legal_status', lang) | default('Select Legal Status') }}</option>
                    <option value="eu_citizen">{{ t('eu_citizen', lang) | default('EU Citizen') }}</option>
                    <option value="non_eu_resident">{{ t('non_eu_resident', lang) | default('Non-EU Resident') }}</option>
                    <option value="refugee">{{ t('refugee', lang) | default('Refugee') }}</option>
                    <option value="student_visa">{{ t('student_visa', lang) | default('Student Visa') }}</option>
                    <option value="work_visa">{{ t('work_visa', lang) | default('Work Visa') }}</option>
                    <option value="other">{{ t('other_status', lang) | default('Other') }}</option>
                </select>
            </div>

            <div class="form-group" id="other_legal_status_group" style="display: none;">
                <label for="other_legal_status">{{ t('specify_legal_status', lang) | default('Please specify your legal status') }} <span class="required">*</span></label>
                <input type="text" id="other_legal_status" name="other_legal_status" placeholder="{{ t('legal_status_placeholder', lang) | default('Enter your legal status') }}">
            </div>
        </div>

        <!-- Language Certificates Section -->
        <div class="form-section">
            <h3><i class="fas fa-language"></i> {{ t('language_certificates', lang) | default('Language Certificates') }}</h3>
            
            <div class="form-group">
                <label for="dutch_level">{{ t('dutch_language_level', lang) | default('Dutch Language Level') }} <span class="required">*</span></label>
                <select id="dutch_level" name="dutch_level" required>
                    <option value="">{{ t('select_level', lang) | default('Select Level') }}</option>
                    <option value="A1">{{ t('a1_basic', lang) | default('A1 - Basic') }}</option>
                    <option value="A2">{{ t('a2_elementary', lang) | default('A2 - Elementary') }}</option>
                    <option value="B1">{{ t('b1_intermediate', lang) | default('B1 - Intermediate') }}</option>
                    <option value="B2">{{ t('b2_upper_intermediate', lang) | default('B2 - Upper Intermediate') }}</option>
                    <option value="C1">{{ t('c1_advanced', lang) | default('C1 - Advanced') }}</option>
                    <option value="C2">{{ t('c2_proficient', lang) | default('C2 - Proficient') }}</option>
                    <option value="native">{{ t('native_speaker', lang) | default('Native Speaker') }}</option>
                </select>
            </div>

            <div class="form-group">
                <label for="english_level">{{ t('english_language_level', lang) | default('English Language Level') }}</label>
                <select id="english_level" name="english_level">
                    <option value="">{{ t('select_level', lang) | default('Select Level') }}</option>
                    <option value="A1">{{ t('a1_basic', lang) | default('A1 - Basic') }}</option>
                    <option value="A2">{{ t('a2_elementary', lang) | default('A2 - Elementary') }}</option>
                    <option value="B1">{{ t('b1_intermediate', lang) | default('B1 - Intermediate') }}</option>
                    <option value="B2">{{ t('b2_upper_intermediate', lang) | default('B2 - Upper Intermediate') }}</option>
                    <option value="C1">{{ t('c1_advanced', lang) | default('C1 - Advanced') }}</option>
                    <option value="C2">{{ t('c2_proficient', lang) | default('C2 - Proficient') }}</option>
                    <option value="native">{{ t('native_speaker', lang) | default('Native Speaker') }}</option>
                </select>
            </div>

            <div class="form-group">
                <label for="language_certificates">{{ t('upload_language_certificates', lang) | default('Upload Language Certificates') }}</label>
                <div class="file-upload">
                    <input type="file" id="language_certificates" name="language_certificates" multiple accept=".pdf,.jpg,.jpeg,.png">
                    <label for="language_certificates" class="file-upload-label">
                        <i class="fas fa-upload"></i> {{ t('upload_files', lang) | default('Upload Files') }}
                    </label>
                    <div class="help-text">{{ t('language_certificates_help', lang) | default('Upload your language certificates (PDF, JPG, PNG)') }}</div>
                </div>
                <div class="uploaded-files" id="language-certificates-list"></div>
            </div>
        </div>

        <!-- Documents Section -->
        <div class="form-section">
            <h3><i class="fas fa-file-alt"></i> {{ t('documents', lang) | default('Documents') }}</h3>
            
            <div class="form-group">
                <label for="diploma_info">{{ t('diploma_information', lang) | default('Diploma/Certificate Information') }} <span class="required">*</span></label>
                <textarea id="diploma_info" name="diploma_info" rows="3" placeholder="{{ t('diploma_info_placeholder', lang) | default('Please provide information about your medical diploma or certificate (institution, year, specialization, etc.)') }}" required></textarea>
                <div class="help-text">{{ t('diploma_info_help', lang) | default('Describe your medical education and qualifications') }}</div>
            </div>

            <div class="form-group">
                <label for="work_experience">{{ t('work_experience', lang) | default('Work Experience') }}</label>
                <textarea id="work_experience" name="work_experience" rows="3" placeholder="{{ t('work_experience_placeholder', lang) | default('Describe your professional work experience in the medical field') }}"></textarea>
                <div class="help-text">{{ t('work_experience_help', lang) | default('Include years of experience, positions held, and areas of expertise') }}</div>
            </div>

            <div class="form-group">
                <label for="additional_qualifications">{{ t('additional_qualifications', lang) | default('Additional Qualifications') }}</label>
                <textarea id="additional_qualifications" name="additional_qualifications" rows="2" placeholder="{{ t('additional_qualifications_placeholder', lang) | default('Any additional certifications, courses, or specializations') }}"></textarea>
                <div class="help-text">{{ t('additional_qualifications_help', lang) | default('List any additional professional qualifications or certifications') }}</div>
            </div>

            <div class="form-group">
                <label for="diploma_file">{{ t('upload_diploma_optional', lang) | default('Upload Diploma/Certificate (Optional)') }}</label>
                <div class="file-upload">
                    <input type="file" id="diploma_file" name="diploma_file" accept=".pdf,.jpg,.jpeg,.png">
                    <label for="diploma_file" class="file-upload-label">
                        <i class="fas fa-upload"></i> {{ t('upload_diploma', lang) | default('Upload Diploma') }}
                    </label>
                    <div class="help-text">{{ t('diploma_help', lang) | default('Upload your medical diploma or certificate (PDF, JPG, PNG) - Optional') }}</div>
                </div>
                <div class="uploaded-files" id="diploma-list"></div>
            </div>

            <div class="form-group">
                <label for="additional_documents">{{ t('additional_documents', lang) | default('Additional Documents (Optional)') }}</label>
                <div class="file-upload">
                    <input type="file" id="additional_documents" name="additional_documents" multiple accept=".pdf,.jpg,.jpeg,.png">
                    <label for="additional_documents" class="file-upload-label">
                        <i class="fas fa-upload"></i> {{ t('upload_additional', lang) | default('Upload Additional Documents') }}
                    </label>
                    <div class="help-text">{{ t('additional_documents_help', lang) | default('Upload any additional relevant documents (CV, work experience certificates, etc.) - Optional') }}</div>
                </div>
                <div class="uploaded-files" id="additional-documents-list"></div>
            </div>
        </div>

        <!-- BIG Exam Information Section -->
        <div class="form-section">
            <h3><i class="fas fa-graduation-cap"></i> {{ t('big_exam_information', lang) | default('BIG Exam Information') }}</h3>
            
            <div class="form-group">
                <label for="idw_assessment">{{ t('idw_assessment', lang) | default('IDW Assessment Status') }}</label>
                <select id="idw_assessment" name="idw_assessment">
                    <option value="">{{ t('select_status', lang) | default('Select Status') }}</option>
                    <option value="completed">{{ t('completed', lang) | default('Completed') }}</option>
                    <option value="in_progress">{{ t('in_progress', lang) | default('In Progress') }}</option>
                    <option value="not_started">{{ t('not_started', lang) | default('Not Started') }}</option>
                    <option value="not_required">{{ t('not_required', lang) | default('Not Required') }}</option>
                </select>
                <div class="help-text">{{ t('idw_assessment_help', lang) | default('IDW (Individual Assessment) is required for some professions') }}</div>
            </div>

            <div class="form-group">
                <label for="big_exam_registered">{{ t('big_exam_registered', lang) | default('BIG Exam Registration Status') }}</label>
                <select id="big_exam_registered" name="big_exam_registered">
                    <option value="">{{ t('select_status', lang) | default('Select Status') }}</option>
                    <option value="registered">{{ t('registered', lang) | default('Registered') }}</option>
                    <option value="not_registered">{{ t('not_registered', lang) | default('Not Registered') }}</option>
                    <option value="planning_to_register">{{ t('planning_to_register', lang) | default('Planning to Register') }}</option>
                </select>
            </div>

            <div class="form-row">
                <div class="form-group">
                    <label for="exam_date">{{ t('planned_exam_date', lang) | default('Planned Exam Date') }}</label>
                    <input type="date" id="exam_date" name="exam_date">
                </div>
                <div class="form-group">
                    <label for="preparation_time">{{ t('preparation_time', lang) | default('Preparation Time Available') }}</label>
                    <select id="preparation_time" name="preparation_time">
                        <option value="">{{ t('select_time', lang) | default('Select Time') }}</option>
                        <option value="1_month">{{ t('1_month', lang) | default('1 Month') }}</option>
                        <option value="3_months">{{ t('3_months', lang) | default('3 Months') }}</option>
                        <option value="6_months">{{ t('6_months', lang) | default('6 Months') }}</option>
                        <option value="1_year">{{ t('1_year', lang) | default('1 Year') }}</option>
                        <option value="more_than_year">{{ t('more_than_year', lang) | default('More than 1 Year') }}</option>
                    </select>
                </div>
            </div>
        </div>

        <!-- Terms and Conditions -->
        <div class="form-section">
            <h3><i class="fas fa-shield-alt"></i> {{ t('terms_and_conditions', lang) | default('Terms and Conditions') }}</h3>
            
            <!-- Required Consents -->
            <div class="consent-block">
                <h4>{{ t('required_consents', lang) | default('Required Consents') }} <span class="required">*</span></h4>
                <div class="consent-content">
                    <p>{{ t('required_consents_text', lang) | default('By checking the box below, I confirm that I have read and agree to:') }}</p>
                    <ul>
                        <li>{{ t('terms_conditions', lang) | default('Terms and Conditions') }}</li>
                        <li>{{ t('privacy_policy', lang) | default('Privacy Policy') }}</li>
                        <li>{{ t('data_processing_consent', lang) | default('Processing of my personal data for registration purposes') }}</li>
                        <li>{{ t('data_usage_consent', lang) | default('Use of my data for program development, research, and improvement of services') }}</li>
                    </ul>
            </div>
            <div class="checkbox-group">
                    <input type="checkbox" id="required_consents" name="required_consents" required>
                    <label for="required_consents">
                        {{ t('accept_required_consents', lang) | default('I accept all required terms and consents') }} <span class="required">*</span>
                </label>
            </div>
            </div>

            <!-- Optional Consents -->
            <div class="consent-block">
                <h4>{{ t('optional_consents', lang) | default('Optional Consents') }}</h4>
                <div class="consent-content">
                    <p>{{ t('optional_consents_text', lang) | default('I would like to receive:') }}</p>
                    <ul>
                        <li>{{ t('marketing_communications', lang) | default('Marketing communications and promotional materials') }}</li>
                        <li>{{ t('newsletters_updates', lang) | default('Newsletters and updates about the program') }}</li>
                        <li>{{ t('research_participation', lang) | default('Opportunities to participate in research (anonymized data sharing)') }}</li>
                    </ul>
            </div>
            <div class="checkbox-group">
                    <input type="checkbox" id="optional_consents" name="optional_consents">
                    <label for="optional_consents">
                        {{ t('accept_optional_consents', lang) | default('I accept optional communications and research participation') }}
                </label>
            </div>
            </div>

            <!-- Digital Signature -->
            <div class="signature-block">
                <h4>{{ t('digital_signature', lang) | default('Digital Signature') }} <span class="required">*</span></h4>
                <div class="form-group">
                    <label for="digital_signature">{{ t('signature_placeholder', lang) | default('Type your full name to sign') }} <span class="required">*</span></label>
                    <div style="display: flex; gap: 10px; align-items: center;">
                        <input type="text" id="digital_signature" name="digital_signature" required placeholder="{{ t('signature_placeholder', lang) | default('Enter your full name as digital signature') }}" style="flex: 1;">
                        <button type="button" id="autoFillSignature" class="btn-auto-fill" style="background: #3498db; color: white; border: none; padding: 8px 15px; border-radius: 5px; cursor: pointer; font-size: 12px;">
                            {{ t('auto_fill', lang) | default('Auto Fill') }}
                        </button>
                    </div>
                    <div class="help-text">{{ t('signature_help', lang) | default('By typing your name, you provide a digital signature confirming all the above consents. Click "Auto Fill" to use your name from the form above.') }}</div>
                </div>
            </div>
        </div>

        <!-- Submit Section -->
        <div class="submit-section">
            <button type="submit" class="btn-register" id="submitBtn">
                <i class="fas fa-user-plus"></i> {{ t('complete_registration', lang) | default('Complete Registration') }}
            </button>
        </div>
    </form>
</div>
{% endblock %}

{% block extra_js %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    // File upload handling
    setupFileUploads();
    
    // Form validation
    setupFormValidation();
    
    // Progress indicator
    setupProgressIndicator();
    
    // Initialize other fields
    initializeOtherFields();
    
    // Initialize auto-fill signature
    initializeAutoFillSignature();
});

// Function to toggle "Other" fields
function toggleOtherField(selectId, otherFieldId) {
    const select = document.getElementById(selectId);
    const otherGroup = document.getElementById(otherFieldId + '_group');
    const otherField = document.getElementById(otherFieldId);
    
    // Check for both 'other' and 'OTHER' values
    if (select.value === 'other' || select.value === 'OTHER') {
        otherGroup.style.display = 'block';
        otherField.required = true;
    } else {
        otherGroup.style.display = 'none';
        otherField.required = false;
        otherField.value = '';
    }
}

// Initialize other fields on page load
function initializeOtherFields() {
    // Check profession field
    toggleOtherField('profession', 'other_profession');
    
    // Check nationality field
    toggleOtherField('nationality', 'other_nationality');
    
    // Check legal status field
    toggleOtherField('legal_status', 'other_legal_status');
    
    // Initialize phone number formatting
    setupPhoneNumberFormatting();
}

// Initialize auto-fill signature functionality
function initializeAutoFillSignature() {
    const autoFillBtn = document.getElementById('autoFillSignature');
    const signatureField = document.getElementById('digital_signature');
    const firstNameField = document.getElementById('first_name');
    const lastNameField = document.getElementById('last_name');
    
    if (autoFillBtn && signatureField && firstNameField && lastNameField) {
        // Auto-fill button click
        autoFillBtn.addEventListener('click', function() {
            const firstName = firstNameField.value.trim();
            const lastName = lastNameField.value.trim();
            
            if (firstName && lastName) {
                signatureField.value = `${firstName} ${lastName}`;
                signatureField.style.borderColor = '#27ae60';
                
                // Show success message
                showFieldSuccess(signatureField, '{{ t("signature_auto_filled", lang) | default("Signature auto-filled successfully!") }}');
            } else {
                showFieldError(signatureField, '{{ t("fill_name_first", lang) | default("Please fill in your first and last name first") }}');
            }
        });
        
        // Auto-fill when name fields change
        firstNameField.addEventListener('input', updateSignaturePreview);
        lastNameField.addEventListener('input', updateSignaturePreview);
        
        // Real-time validation for signature
        signatureField.addEventListener('input', function() {
            const firstName = firstNameField.value.trim();
            const lastName = lastNameField.value.trim();
            const signature = this.value.trim();
            const expectedSignature = `${firstName} ${lastName}`.trim();
            
            if (signature === expectedSignature && signature.length > 0) {
                this.style.borderColor = '#27ae60';
                clearFieldError(this);
            } else if (signature.length > 0) {
                this.style.borderColor = '#e74c3c';
            } else {
                this.style.borderColor = '#ecf0f1';
                clearFieldError(this);
            }
        });
    }
}

// Update signature preview
function updateSignaturePreview() {
    const firstName = document.getElementById('first_name').value.trim();
    const lastName = document.getElementById('last_name').value.trim();
    const signatureField = document.getElementById('digital_signature');
    
    if (firstName && lastName && !signatureField.value.trim()) {
        // Show preview in placeholder
        signatureField.placeholder = `{{ t('signature_preview', lang) | default('Will be:') }} ${firstName} ${lastName}`;
    }
}

// Show field success message
function showFieldSuccess(field, message) {
    clearFieldError(field);
    
    const successDiv = document.createElement('div');
    successDiv.className = 'success-message';
    successDiv.textContent = message;
    
    field.parentNode.appendChild(successDiv);
    
    // Remove success message after 3 seconds
    setTimeout(() => {
        if (successDiv.parentNode) {
            successDiv.remove();
        }
    }, 3000);
}

// Setup phone number formatting
function setupPhoneNumberFormatting() {
    const countryCodeSelect = document.getElementById('country_code');
    const phoneInput = document.getElementById('phone');
    
    if (countryCodeSelect && phoneInput) {
        // Update phone placeholder based on country code
        countryCodeSelect.addEventListener('change', function() {
            const countryCode = this.value;
            const placeholders = {
                '+31': '612345678',  // Netherlands
                '+49': '15123456789', // Germany
                '+32': '471234567',  // Belgium
                '+33': '612345678',  // France
                '+34': '612345678',  // Spain
                '+39': '3123456789', // Italy
                '+351': '912345678', // Portugal
                '+48': '123456789',  // Poland
                '+40': '712345678',  // Romania
                '+359': '871234567', // Bulgaria
                '+36': '201234567',  // Hungary
                '+420': '123456789', // Czech Republic
                '+421': '123456789', // Slovakia
                '+385': '912345678', // Croatia
                '+386': '401234567', // Slovenia
                '+372': '51234567',  // Estonia
                '+371': '21234567',  // Latvia
                '+370': '61234567',  // Lithuania
                '+356': '21234567',  // Malta
                '+357': '96123456',  // Cyprus
                '+352': '621123456', // Luxembourg
                '+43': '664123456',  // Austria
                '+41': '791234567',  // Switzerland
                '+46': '701234567',  // Sweden
                '+47': '41234567',   // Norway
                '+45': '20123456',   // Denmark
                '+358': '401234567', // Finland
                '+354': '6123456',   // Iceland
                '+353': '851234567', // Ireland
                '+44': '7123456789', // United Kingdom
                '+1': '5551234567',  // United States/Canada
                '+61': '412345678',  // Australia
                '+64': '211234567',  // New Zealand
                '+27': '821234567',  // South Africa
                '+55': '11987654321', // Brazil
                '+54': '91123456789', // Argentina
                '+52': '5512345678', // Mexico
                '+91': '9876543210', // India
                '+86': '13812345678', // China
                '+81': '9012345678', // Japan
                '+82': '1012345678', // South Korea
                '+66': '812345678',  // Thailand
                '+84': '912345678',  // Vietnam
                '+63': '9171234567', // Philippines
                '+62': '8123456789', // Indonesia
                '+60': '123456789',  // Malaysia
                '+65': '81234567',   // Singapore
                '+90': '5321234567', // Turkey
                '+20': '1012345678', // Egypt
                '+212': '612345678', // Morocco
                '+216': '20123456',  // Tunisia
                '+213': '551234567', // Algeria
                '+234': '8012345678', // Nigeria
                '+254': '712345678', // Kenya
                '+233': '241234567', // Ghana
                '+251': '911234567', // Ethiopia
                '+380': '501234567', // Ukraine
                '+375': '291234567', // Belarus
                '+7': '9123456789',  // Russia
                '+381': '601234567', // Serbia
                '+387': '61123456',  // Bosnia
                '+382': '67123456',  // Montenegro
                '+389': '70123456',  // Macedonia
                '+355': '691234567', // Albania
                '+373': '60123456'   // Moldova
            };
            
            phoneInput.placeholder = placeholders[countryCode] || '123456789';
        });
        
        // Trigger initial placeholder update
        countryCodeSelect.dispatchEvent(new Event('change'));
    }
}

function setupFileUploads() {
    // Diploma file upload
    const diplomaInput = document.getElementById('diploma_file');
    const diplomaList = document.getElementById('diploma-list');
    
    diplomaInput.addEventListener('change', function(e) {
        handleFileUpload(e, diplomaList, 'diploma');
    });
    
    // Language certificates upload
    const languageInput = document.getElementById('language_certificates');
    const languageList = document.getElementById('language-certificates-list');
    
    languageInput.addEventListener('change', function(e) {
        handleFileUpload(e, languageList, 'language');
    });
    
    // Additional documents upload
    const additionalInput = document.getElementById('additional_documents');
    const additionalList = document.getElementById('additional-documents-list');
    
    additionalInput.addEventListener('change', function(e) {
        handleFileUpload(e, additionalList, 'additional');
    });
}

function handleFileUpload(event, container, type) {
    const files = event.target.files;
    
    // Clear previous files
    container.innerHTML = '';
    
    Array.from(files).forEach((file, index) => {
        const fileItem = document.createElement('div');
        fileItem.className = 'uploaded-file';
        fileItem.innerHTML = `
            <span class="file-name">${file.name}</span>
            <span class="remove-file" onclick="removeFile('${type}', ${index})">Ã—</span>
        `;
        container.appendChild(fileItem);
    });
}

function removeFile(type, index) {
    const input = document.getElementById(type === 'diploma' ? 'diploma_file' : 
                                   type === 'language' ? 'language_certificates' : 'additional_documents');
    
    // Create new FileList without the removed file
    const dt = new DataTransfer();
    Array.from(input.files).forEach((file, i) => {
        if (i !== index) {
            dt.items.add(file);
        }
    });
    input.files = dt.files;
    
    // Update display
    const container = document.getElementById(type === 'diploma' ? 'diploma-list' : 
                                           type === 'language' ? 'language-certificates-list' : 'additional-documents-list');
    handleFileUpload({target: {files: input.files}}, container, type);
}

function setupFormValidation() {
    const form = document.getElementById('registrationForm');
    const submitBtn = document.getElementById('submitBtn');
    
    form.addEventListener('submit', function(e) {
        e.preventDefault();
        
        if (validateForm()) {
            submitForm();
        }
    });
    
    // Real-time validation
    const requiredFields = form.querySelectorAll('[required]');
    requiredFields.forEach(field => {
        field.addEventListener('blur', validateField);
        field.addEventListener('input', clearFieldError);
    });
}

function validateForm() {
    let isValid = true;
    const form = document.getElementById('registrationForm');
    
    // Check required fields
    const requiredFields = form.querySelectorAll('[required]');
    requiredFields.forEach(field => {
        if (!validateField({target: field})) {
            isValid = false;
        }
    });
    
    // Check textarea fields
    const diplomaInfo = document.getElementById('diploma_info');
    if (!diplomaInfo.value.trim()) {
        showFieldError(diplomaInfo, '{{ t("diploma_info_required", lang) | default("Diploma information is required") }}');
        isValid = false;
    }
    
    // Check "Other" fields
    const profession = document.getElementById('profession');
    const otherProfession = document.getElementById('other_profession');
    if (profession.value === 'other' && !otherProfession.value.trim()) {
        showFieldError(otherProfession, '{{ t("other_profession_required", lang) | default("Please specify your profession") }}');
        isValid = false;
    }
    
    const nationality = document.getElementById('nationality');
    const otherNationality = document.getElementById('other_nationality');
    if (nationality.value === 'OTHER' && !otherNationality.value.trim()) {
        showFieldError(otherNationality, '{{ t("other_nationality_required", lang) | default("Please specify your nationality") }}');
        isValid = false;
    }
    
    const legalStatus = document.getElementById('legal_status');
    const otherLegalStatus = document.getElementById('other_legal_status');
    if (legalStatus.value === 'other' && !otherLegalStatus.value.trim()) {
        showFieldError(otherLegalStatus, '{{ t("other_legal_status_required", lang) | default("Please specify your legal status") }}');
        isValid = false;
    }
    
    // Check password confirmation
    const password = document.getElementById('password');
    const confirmPassword = document.getElementById('confirm_password');
    if (password.value !== confirmPassword.value) {
        showFieldError(confirmPassword, '{{ t("passwords_dont_match", lang) | default("Passwords do not match") }}');
        isValid = false;
    }
    
    // Check password strength
    if (password.value && !isPasswordStrong(password.value)) {
        showFieldError(password, '{{ t("password_weak", lang) | default("Password must contain at least 8 characters with letters and numbers") }}');
        isValid = false;
    }
    
    // Check digital signature
    const digitalSignature = document.getElementById('digital_signature');
    const firstName = document.getElementById('first_name').value.trim();
    const lastName = document.getElementById('last_name').value.trim();
    const signature = digitalSignature.value.trim();
    
    if (!signature) {
        showFieldError(digitalSignature, '{{ t("signature_required", lang) | default("Digital signature is required") }}');
        isValid = false;
    } else if (signature.length < 3) {
        showFieldError(digitalSignature, '{{ t("signature_too_short", lang) | default("Digital signature must be at least 3 characters long") }}');
        isValid = false;
    } else {
        // Check if signature contains both first and last name (flexible matching)
        const firstNameLower = firstName.toLowerCase();
        const lastNameLower = lastName.toLowerCase();
        const signatureLower = signature.toLowerCase();
        
        if (firstNameLower && lastNameLower && 
            (!signatureLower.includes(firstNameLower) || !signatureLower.includes(lastNameLower))) {
            showFieldError(digitalSignature, '{{ t("signature_should_contain_name", lang) | default("Digital signature should contain your first and last name") }}');
            isValid = false;
        }
    }
    
    return isValid;
}

// Check password strength
function isPasswordStrong(password) {
    // At least 8 characters
    if (password.length < 8) return false;
    
    // Contains at least one letter
    if (!/[a-zA-Z]/.test(password)) return false;
    
    // Contains at least one number
    if (!/[0-9]/.test(password)) return false;
    
    return true;
}

function validateField(event) {
    const field = event.target;
    const value = field.value.trim();
    
    clearFieldError(field);
    
    if (field.hasAttribute('required') && !value) {
        showFieldError(field, '{{ t("field_required", lang) | default("This field is required") }}');
        return false;
    }
    
    // Email validation
    if (field.type === 'email' && value) {
        const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
        if (!emailRegex.test(value)) {
            showFieldError(field, '{{ t("invalid_email", lang) | default("Please enter a valid email address") }}');
            return false;
        }
    }
    
    // Phone validation
    if (field.type === 'tel' && value) {
        const phoneRegex = /^[0-9\s\-\(\)]{7,15}$/;
        if (!phoneRegex.test(value)) {
            showFieldError(field, '{{ t("invalid_phone", lang) | default("Please enter a valid phone number") }}');
            return false;
        }
    }
    
    // Date validation
    if (field.type === 'date' && value) {
        const date = new Date(value);
        const today = new Date();
        
        if (field.id === 'birth_date' && date >= today) {
            showFieldError(field, '{{ t("invalid_birth_date", lang) | default("Birth date cannot be in the future") }}');
            return false;
        }
        
        if (field.id === 'exam_date' && date <= today) {
            showFieldError(field, '{{ t("invalid_exam_date", lang) | default("Exam date must be in the future") }}');
            return false;
        }
    }
    
    return true;
}

function showFieldError(field, message) {
    clearFieldError(field);
    
    const errorDiv = document.createElement('div');
    errorDiv.className = 'error-message';
    errorDiv.textContent = message;
    
    field.parentNode.appendChild(errorDiv);
    field.style.borderColor = '#e74c3c';
}

function clearFieldError(field) {
    const errorDiv = field.parentNode.querySelector('.error-message');
    if (errorDiv) {
        errorDiv.remove();
    }
    field.style.borderColor = '#ecf0f1';
}

function setupProgressIndicator() {
    const sections = document.querySelectorAll('.form-section');
    const steps = document.querySelectorAll('.progress-step');
    
    // Update progress based on completed sections
    function updateProgress() {
        let completedSections = 0;
        
        sections.forEach((section, index) => {
            const requiredFields = section.querySelectorAll('[required]');
            let sectionCompleted = true;
            
            requiredFields.forEach(field => {
                if (!field.value.trim()) {
                    sectionCompleted = false;
                }
            });
            
            if (sectionCompleted && requiredFields.length > 0) {
                completedSections++;
                if (steps[index]) {
                    steps[index].classList.add('completed');
                    steps[index].classList.remove('active');
                }
            } else if (steps[index]) {
                steps[index].classList.remove('completed');
                if (index === completedSections) {
                    steps[index].classList.add('active');
                }
            }
        });
    }
    
    // Update progress on field changes
    const allFields = document.querySelectorAll('input, select, textarea');
    allFields.forEach(field => {
        field.addEventListener('change', updateProgress);
        field.addEventListener('input', updateProgress);
    });
    
    // Initial progress update
    updateProgress();
}

async function submitForm() {
    const form = document.getElementById('registrationForm');
    const submitBtn = document.getElementById('submitBtn');
    const formData = new FormData(form);
    
    // Disable submit button
    submitBtn.disabled = true;
    submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> {{ t("processing", lang) | default("Processing...") }}';
    
    try {
        const response = await fetch('{{ url_for("auth.register") }}', {
            method: 'POST',
            body: formData
        });
        
        const result = await response.json();
        
        if (result.success) {
            // Show success message
            showSuccessMessage('{{ t("registration_success", lang) | default("Registration completed successfully!") }}');
            
            // Redirect to login or dashboard
            setTimeout(() => {
                window.location.href = '{{ url_for("auth.login") }}';
            }, 2000);
        } else {
            // Show error message
            showErrorMessage(result.error || '{{ t("registration_error", lang) | default("Registration failed. Please try again.") }}');
        }
    } catch (error) {
        console.error('Registration error:', error);
        showErrorMessage('{{ t("network_error", lang) | default("Network error. Please check your connection and try again.") }}');
    } finally {
        // Re-enable submit button
        submitBtn.disabled = false;
        submitBtn.innerHTML = '<i class="fas fa-user-plus"></i> {{ t("complete_registration", lang) | default("Complete Registration") }}';
    }
}

function showSuccessMessage(message) {
    const messageDiv = document.createElement('div');
    messageDiv.className = 'success-message';
    messageDiv.style.cssText = 'position: fixed; top: 20px; right: 20px; background: #27ae60; color: white; padding: 15px 20px; border-radius: 5px; z-index: 1000;';
    messageDiv.textContent = message;
    document.body.appendChild(messageDiv);
    
    setTimeout(() => {
        messageDiv.remove();
    }, 5000);
}

function showErrorMessage(message) {
    const messageDiv = document.createElement('div');
    messageDiv.className = 'error-message';
    messageDiv.style.cssText = 'position: fixed; top: 20px; right: 20px; background: #e74c3c; color: white; padding: 15px 20px; border-radius: 5px; z-index: 1000;';
    messageDiv.textContent = message;
    document.body.appendChild(messageDiv);
    
    setTimeout(() => {
        messageDiv.remove();
    }, 5000);
}
</script>
{% endblock %}
