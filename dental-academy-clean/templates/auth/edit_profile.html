{% extends "base.html" %}

{% block title %}Profiel bewerken - Mentora{% endblock %}

{% block head %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/pages/edit-profile.css') }}">
{% endblock %}

{% block content %}
<div class="edit-profile-container">
    <div class="container">
        <!-- Header -->
        <div class="profile-header">
            <div class="header-content">
                <div class="profile-avatar">
                    {% if current_user.profile_photo %}
                        <img src="{{ url_for('static', filename=current_user.profile_photo.replace('static/', '')) }}" alt="Profile Photo" class="avatar-img">
                    {% else %}
                        <div class="avatar-placeholder">
                            <i class="icon-user"></i>
                        </div>
                    {% endif %}
                </div>
                <div class="header-info">
                    <h1 class="profile-title">Profiel bewerken</h1>
                    <p class="profile-subtitle">{{ current_user.get_display_name() }}</p>
                    <div class="profile-badges">
                        <span class="badge profession-badge">{{ current_user.get_profession_display() }}</span>
                        {% if current_user.is_digid_user() %}
                        <span class="badge digid-badge">
                            <i class="icon-shield-check"></i>
                            DigiD Geverifieerd
                        </span>
                        {% endif %}
                        {% if current_user.big_number %}
                        <span class="badge big-badge">
                            <i class="icon-award"></i>
                            BIG: {{ current_user.big_number }}
                        </span>
                        {% endif %}
                    </div>
                </div>
            </div>
            <div class="last-updated">
                {% if current_user.profile_updated_at %}
                Laatst bijgewerkt: {{ current_user.profile_updated_at.strftime('%d-%m-%Y om %H:%M') }}
                {% endif %}
            </div>
        </div>

        <!-- Navigation Tabs -->
        <div class="profile-navigation">
            <nav class="profile-tabs">
                <button class="tab-btn active" data-tab="personal">
                    <i class="icon-user"></i>
                    <span>Persoonlijke Gegevens</span>
                </button>
                <button class="tab-btn" data-tab="professional">
                    <i class="icon-briefcase"></i>
                    <span>Professionele Gegevens</span>
                </button>
                <button class="tab-btn" data-tab="documents">
                    <i class="icon-file-text"></i>
                    <span>Documenten</span>
                </button>
                <button class="tab-btn" data-tab="settings">
                    <i class="icon-settings"></i>
                    <span>Instellingen</span>
                </button>
            </nav>
        </div>

        <!-- Content Sections -->
        <div class="profile-content">
            <!-- Personal Data Section -->
            <section class="profile-section active" id="personal">
                <div class="section-header">
                    <h2>Persoonlijke Gegevens</h2>
                    <p>Beheer uw persoonlijke informatie en contactgegevens</p>
                </div>

                <form method="POST" enctype="multipart/form-data" class="profile-form">
                    <input type="hidden" name="section" value="personal">
                    
                    <div class="form-grid">
                        <!-- Profile Photo -->
                        <div class="form-group photo-upload">
                            <label class="form-label">Profielfoto</label>
                            <div class="photo-upload-area">
                                <div class="current-photo">
                                    {% if current_user.profile_photo %}
                                        <img src="{{ url_for('static', filename=current_user.profile_photo.replace('static/', '')) }}" alt="Current Photo" class="current-photo-img">
                                    {% else %}
                                        <div class="photo-placeholder">
                                            <i class="icon-camera"></i>
                                            <span>Geen foto</span>
                                        </div>
                                    {% endif %}
                                </div>
                                <div class="photo-controls">
                                    <input type="file" id="profile_photo" name="profile_photo" accept="image/*" class="file-input">
                                    <label for="profile_photo" class="btn btn-secondary btn-sm">
                                        <i class="icon-upload"></i>
                                        Nieuwe foto uploaden
                                    </label>
                                    <p class="file-hint">PNG, JPG, GIF tot 5MB</p>
                                </div>
                            </div>
                        </div>

                        <!-- Name Fields -->
                        <div class="form-group">
                            <label for="first_name" class="form-label">Voornaam</label>
                            {% if current_user.is_digid_user() %}
                                <input type="text" id="first_name" name="first_name" value="{{ current_user.first_name or '' }}" 
                                       class="form-control readonly" readonly>
                                <span class="readonly-hint">
                                    <i class="icon-lock"></i>
                                    Dit veld wordt automatisch ingevuld via DigiD
                                </span>
                            {% else %}
                                <input type="text" id="first_name" name="first_name" value="{{ current_user.first_name or '' }}" 
                                       class="form-control" required>
                            {% endif %}
                        </div>

                        <div class="form-group">
                            <label for="last_name" class="form-label">Achternaam</label>
                            {% if current_user.is_digid_user() %}
                                <input type="text" id="last_name" name="last_name" value="{{ current_user.last_name or '' }}" 
                                       class="form-control readonly" readonly>
                                <span class="readonly-hint">
                                    <i class="icon-lock"></i>
                                    Dit veld wordt automatisch ingevuld via DigiD
                                </span>
                            {% else %}
                                <input type="text" id="last_name" name="last_name" value="{{ current_user.last_name or '' }}" 
                                       class="form-control" required>
                            {% endif %}
                        </div>

                        <!-- BSN -->
                        {% if current_user.bsn %}
                        <div class="form-group">
                            <label for="bsn" class="form-label">BSN</label>
                            <input type="text" id="bsn" value="{{ current_user.bsn }}" class="form-control readonly" readonly>
                            <span class="readonly-hint">
                                <i class="icon-shield-check"></i>
                                Dit veld is gekoppeld aan uw DigiD en kan niet worden gewijzigd
                            </span>
                        </div>
                        {% endif %}

                        <!-- Email -->
                        <div class="form-group">
                            <label for="email" class="form-label">E-mailadres</label>
                            <input type="email" id="email" name="email" value="{{ current_user.email }}" 
                                   class="form-control" required>
                        </div>

                        <!-- Phone -->
                        <div class="form-group">
                            <label for="phone" class="form-label">Telefoonnummer</label>
                            <input type="tel" id="phone" name="phone" value="{{ current_user.phone or '' }}" 
                                   class="form-control" placeholder="+31 6 12345678">
                        </div>
                    </div>

                    <div class="form-actions">
                        <button type="submit" class="btn btn-primary">
                            <i class="icon-save"></i>
                            Persoonlijke gegevens opslaan
                        </button>
                    </div>
                </form>
            </section>

            <!-- Professional Data Section -->
            <section class="profile-section" id="professional">
                <div class="section-header">
                    <h2>Professionele Gegevens</h2>
                    <p>Beheer uw professionele informatie en certificeringen</p>
                </div>

                <form method="POST" class="profile-form">
                    <input type="hidden" name="section" value="professional">
                    
                    <div class="form-grid">
                        <!-- Profession -->
                        <div class="form-group">
                            <label for="profession" class="form-label">Specialisme</label>
                            {% if current_user.profession %}
                                <input type="text" id="profession" value="{{ current_user.get_profession_display() }}" 
                                       class="form-control readonly" readonly>
                                <span class="readonly-hint">
                                    <i class="icon-lock"></i>
                                    Dit veld wordt ingesteld tijdens registratie
                                </span>
                            {% else %}
                                <input type="text" id="profession" value="Nog niet ingesteld" class="form-control readonly" readonly>
                                <span class="readonly-hint">
                                    <i class="icon-info-circle"></i>
                                    Voltooi uw registratie om dit veld in te stellen
                                </span>
                            {% endif %}
                        </div>

                        <!-- BIG Number -->
                        <div class="form-group">
                            <label for="big_number" class="form-label">BIG nummer</label>
                            <input type="text" id="big_number" name="big_number" value="{{ current_user.big_number or '' }}" 
                                   class="form-control" placeholder="Vul uw BIG nummer in wanneer ontvangen">
                            <span class="form-hint">
                                <i class="icon-info-circle"></i>
                                Vul dit veld in zodra u uw BIG-registratie heeft ontvangen
                            </span>
                        </div>

                        <!-- Workplace -->
                        <div class="form-group">
                            <label for="workplace" class="form-label">Werkplek/Praktijk</label>
                            <input type="text" id="workplace" name="workplace" value="{{ current_user.workplace or '' }}" 
                                   class="form-control" placeholder="Naam van uw werkplek of praktijk">
                        </div>

                        <!-- Specialization -->
                        <div class="form-group">
                            <label for="specialization" class="form-label">Subspecialisatie</label>
                            <input type="text" id="specialization" name="specialization" value="{{ current_user.specialization or '' }}" 
                                   class="form-control" placeholder="Eventuele subspecialisatie">
                        </div>

                        <!-- Registration Date -->
                        {% if current_user.registration_date %}
                        <div class="form-group">
                            <label for="registration_date" class="form-label">BIG registratiedatum</label>
                            <input type="date" id="registration_date" value="{{ current_user.registration_date.strftime('%Y-%m-%d') }}" 
                                   class="form-control readonly" readonly>
                        </div>
                        {% endif %}
                    </div>

                    <div class="form-actions">
                        <button type="submit" class="btn btn-primary">
                            <i class="icon-save"></i>
                            Professionele gegevens opslaan
                        </button>
                    </div>
                </form>
            </section>

            <!-- Documents Section -->
            <section class="profile-section" id="documents">
                <div class="section-header">
                    <h2>Documenten</h2>
                    <p>Beheer uw diploma's, certificaten en overige documenten</p>
                </div>

                <!-- Diploma Section -->
                <div class="document-category">
                    <h3 class="category-title">
                        <i class="icon-graduation-cap"></i>
                        Diploma
                    </h3>
                    
                    {% if current_user.diploma_file %}
                    <div class="current-document">
                        <div class="document-info">
                            <i class="icon-file-text"></i>
                            <div class="doc-details">
                                <span class="doc-name">{{ current_user.diploma_file.split('/')[-1] }}</span>
                                <span class="doc-meta">Huidige diploma</span>
                            </div>
                        </div>
                        <a href="{{ url_for('static', filename=current_user.diploma_file.replace('static/', '')) }}" 
                           target="_blank" class="btn btn-outline btn-sm">
                            <i class="icon-eye"></i>
                            Bekijken
                        </a>
                    </div>
                    {% endif %}

                    <form method="POST" enctype="multipart/form-data" class="document-form">
                        <input type="hidden" name="section" value="documents">
                        <div class="upload-area">
                            <input type="file" id="diploma_file" name="diploma_file" accept=".pdf,.doc,.docx,.jpg,.jpeg,.png" class="file-input">
                            <label for="diploma_file" class="upload-label">
                                <i class="icon-upload"></i>
                                <span>{{ 'Nieuw diploma uploaden' if current_user.diploma_file else 'Diploma uploaden' }}</span>
                                <small>PDF, DOC, DOCX, JPG, PNG tot 10MB</small>
                            </label>
                        </div>
                        <button type="submit" class="btn btn-secondary">
                            <i class="icon-upload"></i>
                            Diploma uploaden
                        </button>
                    </form>
                </div>

                <!-- Language Certificates -->
                <div class="document-category">
                    <h3 class="category-title">
                        <i class="icon-globe"></i>
                        Taalcertificaten
                    </h3>
                    
                    <!-- Existing Certificates -->
                    <div class="documents-list">
                        {% for cert in user_data.language_certificates %}
                        <div class="document-item" data-path="{{ cert.path }}">
                            <div class="document-info">
                                <i class="icon-award"></i>
                                <div class="doc-details">
                                    <span class="doc-name">{{ cert.type }} - {{ cert.level }}</span>
                                    <span class="doc-meta">Ge√ºpload op {{ cert.uploaded_at[:10] }}</span>
                                </div>
                            </div>
                            <div class="doc-actions">
                                <a href="{{ url_for('static', filename=cert.path.replace('static/', '')) }}" 
                                   target="_blank" class="btn btn-outline btn-sm">
                                    <i class="icon-eye"></i>
                                    Bekijken
                                </a>
                                <button type="button" class="btn btn-danger btn-sm delete-doc" 
                                        data-type="language" data-path="{{ cert.path }}">
                                    <i class="icon-trash"></i>
                                </button>
                            </div>
                        </div>
                        {% endfor %}
                    </div>

                    <!-- Add New Certificate -->
                    <form method="POST" enctype="multipart/form-data" class="document-form">
                        <input type="hidden" name="section" value="documents">
                        <div class="form-row">
                            <div class="form-group">
                                <label for="certificate_type" class="form-label">Type certificaat</label>
                                <select id="certificate_type" name="certificate_type" class="form-control">
                                    <option value="">Selecteer type</option>
                                    <option value="CNaVT">CNaVT (Nederlands)</option>
                                    <option value="IELTS">IELTS (Engels)</option>
                                    <option value="TOEFL">TOEFL (Engels)</option>
                                    <option value="TestDaF">TestDaF (Duits)</option>
                                    <option value="DELF">DELF (Frans)</option>
                                    <option value="Andere">Andere</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="certificate_level" class="form-label">Niveau</label>
                                <select id="certificate_level" name="certificate_level" class="form-control">
                                    <option value="">Selecteer niveau</option>
                                    <option value="A1">A1 (Beginner)</option>
                                    <option value="A2">A2 (Elementair)</option>
                                    <option value="B1">B1 (Intermediate)</option>
                                    <option value="B2">B2 (Gevorderd)</option>
                                    <option value="C1">C1 (Vaardig)</option>
                                    <option value="C2">C2 (Uitstekend)</option>
                                </select>
                            </div>
                        </div>
                        <div class="upload-area">
                            <input type="file" id="language_certificate" name="language_certificate" 
                                   accept=".pdf,.doc,.docx,.jpg,.jpeg,.png" class="file-input">
                            <label for="language_certificate" class="upload-label">
                                <i class="icon-upload"></i>
                                <span>Taalcertificaat selecteren</span>
                                <small>PDF, DOC, DOCX, JPG, PNG tot 10MB</small>
                            </label>
                        </div>
                        <button type="submit" class="btn btn-secondary">
                            <i class="icon-plus"></i>
                            Certificaat toevoegen
                        </button>
                    </form>
                </div>

                <!-- Additional Documents -->
                <div class="document-category">
                    <h3 class="category-title">
                        <i class="icon-file-plus"></i>
                        Aanvullende certificaten
                    </h3>
                    
                    <!-- Existing Documents -->
                    <div class="documents-list">
                        {% for doc in user_data.additional_documents %}
                        <div class="document-item" data-path="{{ doc.path }}">
                            <div class="document-info">
                                <i class="icon-file-text"></i>
                                <div class="doc-details">
                                    <span class="doc-name">{{ doc.name }}</span>
                                    <span class="doc-meta">{{ doc.type }} - Ge√ºpload op {{ doc.uploaded_at[:10] }}</span>
                                </div>
                            </div>
                            <div class="doc-actions">
                                <a href="{{ url_for('static', filename=doc.path.replace('static/', '')) }}" 
                                   target="_blank" class="btn btn-outline btn-sm">
                                    <i class="icon-eye"></i>
                                    Bekijken
                                </a>
                                <button type="button" class="btn btn-danger btn-sm delete-doc" 
                                        data-type="additional" data-path="{{ doc.path }}">
                                    <i class="icon-trash"></i>
                                </button>
                            </div>
                        </div>
                        {% endfor %}
                    </div>

                    <!-- Add New Document -->
                    <form method="POST" enctype="multipart/form-data" class="document-form">
                        <input type="hidden" name="section" value="documents">
                        <div class="form-row">
                            <div class="form-group">
                                <label for="document_type" class="form-label">Type document</label>
                                <select id="document_type" name="document_type" class="form-control">
                                    <option value="">Selecteer type</option>
                                    <option value="Specialisatie certificaat">Specialisatie certificaat</option>
                                    <option value="Werkervaring bewijs">Werkervaring bewijs</option>
                                    <option value="Nascholing certificaat">Nascholing certificaat</option>
                                    <option value="Referentiebrief">Referentiebrief</option>
                                    <option value="Andere">Andere</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="document_name" class="form-label">Documentnaam</label>
                                <input type="text" id="document_name" name="document_name" 
                                       class="form-control" placeholder="Geef het document een naam">
                            </div>
                        </div>
                        <div class="upload-area">
                            <input type="file" id="additional_document" name="additional_document" 
                                   accept=".pdf,.doc,.docx,.jpg,.jpeg,.png" class="file-input">
                            <label for="additional_document" class="upload-label">
                                <i class="icon-upload"></i>
                                <span>Document selecteren</span>
                                <small>PDF, DOC, DOCX, JPG, PNG tot 10MB</small>
                            </label>
                        </div>
                        <button type="submit" class="btn btn-secondary">
                            <i class="icon-plus"></i>
                            Document toevoegen
                        </button>
                    </form>
                </div>
            </section>

            <!-- Settings Section -->
            <section class="profile-section" id="settings">
                <div class="section-header">
                    <h2>Instellingen</h2>
                    <p>Beheer uw voorkeuren en privacy-instellingen</p>
                </div>

                <form method="POST" class="profile-form">
                    <input type="hidden" name="section" value="settings">
                    
                    <!-- Interface Settings -->
                    <div class="settings-category">
                        <h3 class="category-title">
                            <i class="icon-settings"></i>
                            Interface voorkeuren
                        </h3>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label for="language" class="form-label">Voorkeurstaal</label>
                                <select id="language" name="language" class="form-control">
                                    <option value="nl" {{ 'selected' if current_user.language == 'nl' }}>üá≥üá± Nederlands</option>
                                    <option value="en" {{ 'selected' if current_user.language == 'en' }}>üá∫üá∏ English</option>
                                    <option value="ru" {{ 'selected' if current_user.language == 'ru' }}>üá∑üá∫ –†—É—Å—Å–∫–∏–π</option>
                                    <option value="es" {{ 'selected' if current_user.language == 'es' }}>üá™üá∏ Espa√±ol</option>
                                    <option value="pt" {{ 'selected' if current_user.language == 'pt' }}>üáµüáπ Portugu√™s</option>
                                    <option value="uk" {{ 'selected' if current_user.language == 'uk' }}>üá∫üá¶ –£–∫—Ä–∞—ó–Ω—Å—å–∫–∞</option>
                                    <option value="tr" {{ 'selected' if current_user.language == 'tr' }}>üáπüá∑ T√ºrk√ße</option>
                                    <option value="fa" {{ 'selected' if current_user.language == 'fa' }}>üáÆüá∑ ŸÅÿßÿ±ÿ≥€å</option>
                                </select>
                            </div>
                            
                            <div class="form-group">
                                <label for="theme" class="form-label">Thema</label>
                                <select id="theme" name="theme" class="form-control">
                                    <option value="light" {{ 'selected' if current_user.theme == 'light' }}>Licht thema</option>
                                    <option value="dark" {{ 'selected' if current_user.theme == 'dark' }}>Donker thema</option>
                                </select>
                            </div>
                        </div>
                    </div>

                    <!-- Notification Settings -->
                    <div class="settings-category">
                        <h3 class="category-title">
                            <i class="icon-bell"></i>
                            Notificatie voorkeuren
                        </h3>
                        
                        <div class="settings-grid">
                            <div class="setting-item">
                                <div class="setting-info">
                                    <label for="email_notifications" class="setting-label">E-mail notificaties</label>
                                    <span class="setting-desc">Ontvang updates via e-mail</span>
                                </div>
                                <label class="toggle-switch">
                                    <input type="checkbox" id="email_notifications" name="email_notifications" 
                                           {{ 'checked' if user_data.notification_settings.email_notifications }}>
                                    <span class="slider"></span>
                                </label>
                            </div>

                            <div class="setting-item">
                                <div class="setting-info">
                                    <label for="push_notifications" class="setting-label">Push notificaties</label>
                                    <span class="setting-desc">Browser notificaties</span>
                                </div>
                                <label class="toggle-switch">
                                    <input type="checkbox" id="push_notifications" name="push_notifications" 
                                           {{ 'checked' if user_data.notification_settings.push_notifications }}>
                                    <span class="slider"></span>
                                </label>
                            </div>

                            <div class="setting-item">
                                <div class="setting-info">
                                    <label for="learning_reminders" class="setting-label">Leerherinneringen</label>
                                    <span class="setting-desc">Herinneringen voor studie sessies</span>
                                </div>
                                <label class="toggle-switch">
                                    <input type="checkbox" id="learning_reminders" name="learning_reminders" 
                                           {{ 'checked' if user_data.notification_settings.learning_reminders }}>
                                    <span class="slider"></span>
                                </label>
                            </div>

                            <div class="setting-item">
                                <div class="setting-info">
                                    <label for="exam_notifications" class="setting-label">Examen notificaties</label>
                                    <span class="setting-desc">Updates over examens en deadlines</span>
                                </div>
                                <label class="toggle-switch">
                                    <input type="checkbox" id="exam_notifications" name="exam_notifications" 
                                           {{ 'checked' if user_data.notification_settings.exam_notifications }}>
                                    <span class="slider"></span>
                                </label>
                            </div>

                            <div class="setting-item">
                                <div class="setting-info">
                                    <label for="community_updates" class="setting-label">Community updates</label>
                                    <span class="setting-desc">Nieuwe berichten in community</span>
                                </div>
                                <label class="toggle-switch">
                                    <input type="checkbox" id="community_updates" name="community_updates" 
                                           {{ 'checked' if user_data.notification_settings.community_updates }}>
                                    <span class="slider"></span>
                                </label>
                            </div>

                            <div class="setting-item">
                                <div class="setting-info">
                                    <label for="marketing_emails" class="setting-label">Marketing e-mails</label>
                                    <span class="setting-desc">Nieuwsbrieven en promoties</span>
                                </div>
                                <label class="toggle-switch">
                                    <input type="checkbox" id="marketing_emails" name="marketing_emails" 
                                           {{ 'checked' if user_data.notification_settings.marketing_emails }}>
                                    <span class="slider"></span>
                                </label>
                            </div>
                        </div>
                    </div>

                    <!-- Privacy Settings -->
                    <div class="settings-category">
                        <h3 class="category-title">
                            <i class="icon-shield"></i>
                            Privacy instellingen
                        </h3>
                        
                        <div class="form-group">
                            <label for="profile_visibility" class="form-label">Profiel zichtbaarheid</label>
                            <select id="profile_visibility" name="profile_visibility" class="form-control">
                                <option value="public" {{ 'selected' if user_data.privacy_settings.profile_visibility == 'public' }}>Openbaar</option>
                                <option value="registered_users" {{ 'selected' if user_data.privacy_settings.profile_visibility == 'registered_users' }}>Alleen geregistreerde gebruikers</option>
                                <option value="private" {{ 'selected' if user_data.privacy_settings.profile_visibility == 'private' }}>Priv√©</option>
                            </select>
                        </div>

                        <div class="settings-grid">
                            <div class="setting-item">
                                <div class="setting-info">
                                    <label for="show_progress" class="setting-label">Voortgang tonen</label>
                                    <span class="setting-desc">Anderen kunnen uw leervoortgang zien</span>
                                </div>
                                <label class="toggle-switch">
                                    <input type="checkbox" id="show_progress" name="show_progress" 
                                           {{ 'checked' if user_data.privacy_settings.show_progress }}>
                                    <span class="slider"></span>
                                </label>
                            </div>

                            <div class="setting-item">
                                <div class="setting-info">
                                    <label for="show_achievements" class="setting-label">Prestaties tonen</label>
                                    <span class="setting-desc">Badges en certificaten zichtbaar</span>
                                </div>
                                <label class="toggle-switch">
                                    <input type="checkbox" id="show_achievements" name="show_achievements" 
                                           {{ 'checked' if user_data.privacy_settings.show_achievements }}>
                                    <span class="slider"></span>
                                </label>
                            </div>

                            <div class="setting-item">
                                <div class="setting-info">
                                    <label for="allow_messages" class="setting-label">Berichten toestaan</label>
                                    <span class="setting-desc">Anderen kunnen u berichten sturen</span>
                                </div>
                                <label class="toggle-switch">
                                    <input type="checkbox" id="allow_messages" name="allow_messages" 
                                           {{ 'checked' if user_data.privacy_settings.allow_messages }}>
                                    <span class="slider"></span>
                                </label>
                            </div>

                            <div class="setting-item">
                                <div class="setting-info">
                                    <label for="analytics_tracking" class="setting-label">Analytics tracking</label>
                                    <span class="setting-desc">Help ons de app te verbeteren</span>
                                </div>
                                <label class="toggle-switch">
                                    <input type="checkbox" id="analytics_tracking" name="analytics_tracking" 
                                           {{ 'checked' if user_data.privacy_settings.analytics_tracking }}>
                                    <span class="slider"></span>
                                </label>
                            </div>
                        </div>
                    </div>

                    <div class="form-actions">
                        <button type="submit" class="btn btn-primary">
                            <i class="icon-save"></i>
                            Instellingen opslaan
                        </button>
                    </div>
                </form>
            </section>
        </div>

        <!-- Action Buttons -->
        <div class="profile-actions">
            <a href="{{ url_for('auth.profile') }}" class="btn btn-secondary">
                <i class="icon-arrow-left"></i>
                Terug naar profiel
            </a>
            <a href="{{ url_for('auth.change_password') }}" class="btn btn-outline">
                <i class="icon-key"></i>
                Wachtwoord wijzigen
            </a>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    // Tab navigation
    const tabButtons = document.querySelectorAll('.tab-btn');
    const sections = document.querySelectorAll('.profile-section');
    
    tabButtons.forEach(button => {
        button.addEventListener('click', function() {
            const targetTab = this.dataset.tab;
            
            // Update active tab
            tabButtons.forEach(btn => btn.classList.remove('active'));
            this.classList.add('active');
            
            // Update active section
            sections.forEach(section => {
                section.classList.remove('active');
                if (section.id === targetTab) {
                    section.classList.add('active');
                }
            });
        });
    });
    
    // File input labels
    const fileInputs = document.querySelectorAll('.file-input');
    fileInputs.forEach(input => {
        input.addEventListener('change', function() {
            const label = this.nextElementSibling;
            const fileName = this.files[0]?.name;
            if (fileName) {
                const span = label.querySelector('span');
                span.textContent = fileName;
                label.classList.add('file-selected');
            }
        });
    });
    
    // Delete document functionality
    const deleteButtons = document.querySelectorAll('.delete-doc');
    deleteButtons.forEach(button => {
        button.addEventListener('click', function() {
            if (confirm('Weet u zeker dat u dit document wilt verwijderen?')) {
                const type = this.dataset.type;
                const path = this.dataset.path;
                
                fetch('/profile/delete-document', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ type, path })
                })
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        this.closest('.document-item').remove();
                        showNotification('Document succesvol verwijderd', 'success');
                    } else {
                        showNotification('Fout bij verwijderen document: ' + data.message, 'error');
                    }
                })
                .catch(error => {
                    showNotification('Fout bij verwijderen document', 'error');
                });
            }
        });
    });
    
    // File validation
    function validateFile(input, maxSize, allowedTypes) {
        const file = input.files[0];
        if (!file) return true;
        
        // Check file size
        if (file.size > maxSize) {
            showNotification(`Bestand is te groot. Maximum ${Math.round(maxSize / 1024 / 1024)}MB toegestaan.`, 'error');
            input.value = '';
            return false;
        }
        
        // Check file type
        const fileType = file.name.split('.').pop().toLowerCase();
        if (!allowedTypes.includes(fileType)) {
            showNotification(`Bestandstype niet toegestaan. Toegestaan: ${allowedTypes.join(', ').toUpperCase()}`, 'error');
            input.value = '';
            return false;
        }
        
        return true;
    }
    
    // Apply file validation
    document.getElementById('profile_photo')?.addEventListener('change', function() {
        validateFile(this, 5 * 1024 * 1024, ['png', 'jpg', 'jpeg', 'gif', 'webp']);
    });
    
    document.querySelectorAll('input[type="file"]:not(#profile_photo)').forEach(input => {
        input.addEventListener('change', function() {
            validateFile(this, 10 * 1024 * 1024, ['pdf', 'doc', 'docx', 'jpg', 'jpeg', 'png']);
        });
    });
});

function showNotification(message, type) {
    // Create notification element
    const notification = document.createElement('div');
    notification.className = `notification ${type}`;
    notification.textContent = message;
    
    // Add to page
    document.body.appendChild(notification);
    
    // Show notification
    setTimeout(() => notification.classList.add('show'), 100);
    
    // Remove notification after 3 seconds
    setTimeout(() => {
        notification.classList.remove('show');
        setTimeout(() => notification.remove(), 300);
    }, 3000);
}
</script>
{% endblock %} 