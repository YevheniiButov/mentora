{% extends "base.html" %}

{% block title %}üß™ –¢–µ—Å—Ç–æ–≤–∞—è –∫–∞—Ä—Ç–∞ –æ–±—É—á–µ–Ω–∏—è - Mentora{% endblock %}

{% block head %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/pages/learning_map.css') }}">
<link rel="stylesheet" href="{{ url_for('static', filename='css/category-navigation.css') }}">
<style>
    .test-banner {
        background: linear-gradient(135deg, #ff6b6b, #ff8e8e);
        color: white;
        padding: 15px;
        text-align: center;
        font-weight: bold;
        margin-bottom: 20px;
        border-radius: 8px;
    }
    
    .test-section {
        background: #f8f9fa;
        border: 2px dashed #dee2e6;
        border-radius: 12px;
        padding: 20px;
        margin-bottom: 20px;
    }
    
    .test-section h3 {
        color: #495057;
        margin-bottom: 15px;
        display: flex;
        align-items: center;
        gap: 10px;
    }
    
    .test-section h3 i {
        color: #6c757d;
    }
    
    .status-card {
        background: white;
        border-radius: 8px;
        padding: 15px;
        margin-bottom: 15px;
        box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    
    .status-card.success {
        border-left: 4px solid #28a745;
    }
    
    .status-card.warning {
        border-left: 4px solid #ffc107;
    }
    
    .status-card.danger {
        border-left: 4px solid #dc3545;
    }
    
    .action-buttons {
        display: flex;
        gap: 10px;
        flex-wrap: wrap;
    }
    
    .btn-test {
        background: linear-gradient(135deg, #667eea, #764ba2);
        color: white;
        border: none;
        padding: 12px 20px;
        border-radius: 8px;
        text-decoration: none;
        font-weight: 500;
        transition: all 0.3s ease;
        display: inline-flex;
        align-items: center;
        gap: 8px;
    }
    
    .btn-test:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        color: white;
        text-decoration: none;
    }
    
    .btn-test.primary {
        background: linear-gradient(135deg, #3ECDC1, #2DB5A9);
    }
    
    .btn-test.success {
        background: linear-gradient(135deg, #28a745, #20c997);
    }
    
    .btn-test.warning {
        background: linear-gradient(135deg, #ffc107, #fd7e14);
    }
    
    .stats-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 15px;
        margin-bottom: 20px;
    }
    
    .stat-card {
        background: white;
        border-radius: 8px;
        padding: 20px;
        text-align: center;
        box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    
    .stat-number {
        font-size: 2rem;
        font-weight: bold;
        color: #3ECDC1;
        margin-bottom: 5px;
    }
    
    .stat-label {
        color: #6c757d;
        font-size: 0.9rem;
    }
    
    .recommendations-list {
        background: white;
        border-radius: 8px;
        padding: 20px;
        margin-top: 20px;
    }
    
    .recommendation-item {
        display: flex;
        align-items: center;
        padding: 15px;
        border: 1px solid #e9ecef;
        border-radius: 8px;
        margin-bottom: 10px;
        transition: all 0.3s ease;
    }
    
    .recommendation-item:hover {
        background: #f8f9fa;
        border-color: #3ECDC1;
    }
    
    .recommendation-priority {
        width: 12px;
        height: 12px;
        border-radius: 50%;
        margin-right: 15px;
    }
    
    .recommendation-priority.high {
        background: #dc3545;
    }
    
    .recommendation-priority.medium {
        background: #ffc107;
    }
    
    .recommendation-priority.low {
        background: #28a745;
    }
</style>
{% endblock %}

{% block content %}
<div class="container-fluid">
    <!-- –¢–µ—Å—Ç–æ–≤—ã–π –±–∞–Ω–Ω–µ—Ä -->
    <div class="test-banner">
        üß™ –¢–ï–°–¢–û–í–ê–Ø –ö–ê–†–¢–ê –û–ë–£–ß–ï–ù–ò–Ø - –†–ê–ó–†–ê–ë–û–¢–ö–ê –ò –¢–ï–°–¢–ò–†–û–í–ê–ù–ò–ï
    </div>
    
    <!-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è -->
    <div class="test-section">
        <h3><i class="fas fa-chart-bar"></i> –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</h3>
        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-number">{{ user_stats.total_modules }}</div>
                <div class="stat-label">–í—Å–µ–≥–æ –º–æ–¥—É–ª–µ–π</div>
            </div>
            <div class="stat-card">
                <div class="stat-number">{{ user_stats.completed_modules }}</div>
                <div class="stat-label">–ó–∞–≤–µ—Ä—à–µ–Ω–æ –º–æ–¥—É–ª–µ–π</div>
            </div>
            <div class="stat-card">
                <div class="stat-number">{{ user_stats.total_lessons }}</div>
                <div class="stat-label">–í—Å–µ–≥–æ —É—Ä–æ–∫–æ–≤</div>
            </div>
            <div class="stat-card">
                <div class="stat-number">{{ user_stats.completed_lessons }}</div>
                <div class="stat-label">–ó–∞–≤–µ—Ä—à–µ–Ω–æ —É—Ä–æ–∫–æ–≤</div>
            </div>
        </div>
    </div>
    
    <!-- –°—Ç–∞—Ç—É—Å –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏ -->
    <div class="test-section">
        <h3><i class="fas fa-clipboard-check"></i> –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –∑–Ω–∞–Ω–∏–π</h3>
        
        {% if latest_diagnostic %}
        <div class="status-card success">
            <h5><i class="fas fa-check-circle"></i> –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –ø—Ä–æ–π–¥–µ–Ω–∞</h5>
            <p>–ü–æ—Å–ª–µ–¥–Ω—è—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞: {{ latest_diagnostic.completed_at.strftime('%d.%m.%Y %H:%M') }}</p>
            <p>–¢–∏–ø: {{ latest_diagnostic.diagnostic_type }}</p>
            <p>–°—Ç–∞—Ç—É—Å: {{ latest_diagnostic.status }}</p>
        </div>
        {% else %}
        <div class="status-card danger">
            <h5><i class="fas fa-exclamation-triangle"></i> –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –Ω–µ –ø—Ä–æ–π–¥–µ–Ω–∞</h5>
            <p>–î–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –∏–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω–æ–≥–æ –ø–ª–∞–Ω–∞ –æ–±—É—á–µ–Ω–∏—è –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –ø—Ä–æ–π—Ç–∏ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫—É –∑–Ω–∞–Ω–∏–π.</p>
        </div>
        {% endif %}
        
        <div class="action-buttons">
            {% if not latest_diagnostic %}
            <a href="{{ url_for('learning.test_start_diagnostic') }}" class="btn-test primary">
                <i class="fas fa-play"></i> –ü—Ä–æ–π—Ç–∏ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫—É
            </a>
            {% else %}
            <a href="{{ url_for('learning.test_start_diagnostic') }}" class="btn-test warning">
                <i class="fas fa-redo"></i> –ü—Ä–æ–π—Ç–∏ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫—É —Å–Ω–æ–≤–∞
            </a>
            {% endif %}
        </div>
    </div>
    
    <!-- –ü–ª–∞–Ω –æ–±—É—á–µ–Ω–∏—è -->
    <div class="test-section">
        <h3><i class="fas fa-map"></i> –ü–ª–∞–Ω –æ–±—É—á–µ–Ω–∏—è</h3>
        
        {% if active_plan %}
        <div class="status-card success">
            <h5><i class="fas fa-check-circle"></i> –ü–ª–∞–Ω –æ–±—É—á–µ–Ω–∏—è –∞–∫—Ç–∏–≤–µ–Ω</h5>
            <p>–î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è: {{ active_plan.created_at.strftime('%d.%m.%Y') }}</p>
            <p>–ò–Ω—Ç–µ–Ω—Å–∏–≤–Ω–æ—Å—Ç—å: {{ active_plan.intensity }}</p>
            <p>–ß–∞—Å–æ–≤ –≤ –Ω–µ–¥–µ–ª—é: {{ active_plan.study_hours_per_week }}</p>
            <p>–ü—Ä–æ–≥—Ä–µ—Å—Å: {{ "%.1f"|format(active_plan.overall_progress) }}%</p>
        </div>
        {% else %}
        <div class="status-card warning">
            <h5><i class="fas fa-exclamation-triangle"></i> –ü–ª–∞–Ω –æ–±—É—á–µ–Ω–∏—è –Ω–µ —Å–æ–∑–¥–∞–Ω</h5>
            <p>–°–æ–∑–¥–∞–π—Ç–µ –∏–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω—ã–π –ø–ª–∞–Ω –æ–±—É—á–µ–Ω–∏—è –Ω–∞ –æ—Å–Ω–æ–≤–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏.</p>
        </div>
        {% endif %}
        
        <div class="action-buttons">
            {% if latest_diagnostic and not active_plan %}
            <a href="{{ url_for('learning.test_create_learning_plan') }}" class="btn-test primary">
                <i class="fas fa-plus"></i> –°–æ–∑–¥–∞—Ç—å –ø–ª–∞–Ω –æ–±—É—á–µ–Ω–∏—è
            </a>
            {% elif active_plan %}
            <a href="{{ url_for('learning.test_daily_plan') }}" class="btn-test success">
                <i class="fas fa-calendar-day"></i> –ï–∂–µ–¥–Ω–µ–≤–Ω—ã–π –ø–ª–∞–Ω
            </a>
            <a href="{{ url_for('learning.test_create_learning_plan') }}" class="btn-test warning">
                <i class="fas fa-edit"></i> –û–±–Ω–æ–≤–∏—Ç—å –ø–ª–∞–Ω
            </a>
            {% else %}
            <a href="#" class="btn-test" style="opacity: 0.5; cursor: not-allowed;">
                <i class="fas fa-lock"></i> –°–Ω–∞—á–∞–ª–∞ –ø—Ä–æ–π–¥–∏—Ç–µ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫—É
            </a>
            {% endif %}
        </div>
    </div>
    
    <!-- –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ -->
    {% if recommendations %}
    <div class="test-section">
        <h3><i class="fas fa-lightbulb"></i> –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –Ω–∞ –æ—Å–Ω–æ–≤–µ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏</h3>
        <div class="recommendations-list">
            {% for rec in recommendations %}
            <div class="recommendation-item">
                <div class="recommendation-priority {{ rec.priority }}"></div>
                <div style="flex: 1;">
                    <h6>{{ rec.domain }}</h6>
                    <p class="mb-0">{{ rec.description }}</p>
                    <small class="text-muted">{{ rec.modules_count }} –º–æ–¥—É–ª–µ–π –¥–æ—Å—Ç—É–ø–Ω–æ</small>
                </div>
            </div>
            {% endfor %}
        </div>
    </div>
    {% endif %}
    
    <!-- –î–æ–º–µ–Ω—ã BIG -->
    <div class="test-section">
        <h3><i class="fas fa-layer-group"></i> –î–æ–º–µ–Ω—ã BIG —ç–∫–∑–∞–º–µ–Ω–∞</h3>
        <div class="row">
            {% for domain in big_domains %}
            <div class="col-md-4 col-lg-3 mb-3">
                <div class="stat-card">
                    <h6>{{ domain.name }}</h6>
                    <small class="text-muted">ID: {{ domain.id }}</small>
                </div>
            </div>
            {% endfor %}
        </div>
    </div>
    
    <!-- –û—Ç–ª–∞–¥–æ—á–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è -->
    <div class="test-section">
        <h3><i class="fas fa-bug"></i> –û—Ç–ª–∞–¥–æ—á–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è</h3>
        <div class="row">
            <div class="col-md-6">
                <h6>–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å:</h6>
                <ul>
                    <li>ID: {{ user.id }}</li>
                    <li>Email: {{ user.email }}</li>
                    <li>–ò–º—è: {{ user.get_display_name() }}</li>
                    <li>–†–æ–ª—å: {{ user.role }}</li>
                </ul>
            </div>
            <div class="col-md-6">
                <h6>–°–∏—Å—Ç–µ–º–∞:</h6>
                <ul>
                    <li>–î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞: {{ '–î–∞' if user_stats.diagnostic_completed else '–ù–µ—Ç' }}</li>
                    <li>–ü–ª–∞–Ω –æ–±—É—á–µ–Ω–∏—è: {{ '–î–∞' if user_stats.learning_plan_active else '–ù–µ—Ç' }}</li>
                    <li>–í—Å–µ–≥–æ –¥–æ–º–µ–Ω–æ–≤: {{ big_domains|length }}</li>
                    <li>–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–π: {{ recommendations|length }}</li>
                </ul>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
    // –î–æ–±–∞–≤–ª—è–µ–º –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –¥–ª—è —Ç–µ—Å—Ç–æ–≤–æ–π –∫–∞—Ä—Ç—ã
    document.addEventListener('DOMContentLoaded', function() {
        console.log('üß™ –¢–µ—Å—Ç–æ–≤–∞—è –∫–∞—Ä—Ç–∞ –æ–±—É—á–µ–Ω–∏—è –∑–∞–≥—Ä—É–∂–µ–Ω–∞');
        
        // –ê–Ω–∏–º–∞—Ü–∏—è –¥–ª—è –∫–∞—Ä—Ç–æ—á–µ–∫ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
        const statCards = document.querySelectorAll('.stat-card');
        statCards.forEach((card, index) => {
            card.style.opacity = '0';
            card.style.transform = 'translateY(20px)';
            
            setTimeout(() => {
                card.style.transition = 'all 0.5s ease';
                card.style.opacity = '1';
                card.style.transform = 'translateY(0)';
            }, index * 100);
        });
        
        // –ü–æ–¥—Å–≤–µ—Ç–∫–∞ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–π –ø—Ä–∏ –Ω–∞–≤–µ–¥–µ–Ω–∏–∏
        const recommendations = document.querySelectorAll('.recommendation-item');
        recommendations.forEach(item => {
            item.addEventListener('mouseenter', function() {
                this.style.transform = 'translateX(5px)';
            });
            
            item.addEventListener('mouseleave', function() {
                this.style.transform = 'translateX(0)';
            });
        });
    });
</script>
{% endblock %}
