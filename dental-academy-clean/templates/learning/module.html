{% extends "base.html" %}

{% block title %}{{ module.title }} - Mentora{% endblock %}

{% block styles %}
    {{ super() }}
    <!-- Унифицированная система стилей -->
    <link rel="stylesheet" href="{{ url_for('static', filename='css/themes/themes.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/universal-styles.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/universal-layout-system.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/pages/learning_map.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/category-navigation.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/pages/module.css') }}">
{% endblock %}

{% block content %}
<div class="learning-map-container">
    <!-- Анимированные декоративные элементы -->
    <div class="floating-shape shape-1"></div>
    <div class="floating-shape shape-2"></div>
    <div class="floating-shape shape-3"></div>
    <div class="floating-shape shape-4"></div>
    
    <div class="main-container">
        <!-- Левая колонка с модулями -->
        <div class="left-column">
            <div class="section-header">
                <h2>{{ t('modules', lang) | default('Модули') }}</h2>
            </div>
            
            <div class="modules-list">
                {% if modules_with_progress %}
                    {% for module_data in modules_with_progress %}
                    <div class="module-item {% if module_data.is_current %}active{% endif %}">
                        <a href="{{ url_for('modules_bp.module_view', lang=lang, module_id=module_data.module.id) }}" 
                           class="module-link">
                            <div class="module-info">
                                <h3 class="module-title">{{ module_data.module.title }}</h3>
                                <div class="module-progress">
                                    <div class="progress-bar">
                                        <div class="progress-fill" style="width: {{ module_data.progress }}%"></div>
                                    </div>
                                    <span class="progress-text">{{ module_data.completed_lessons }}/{{ module_data.total_lessons }}</span>
                                </div>
                            </div>
                        </a>
                    </div>
                    {% endfor %}
                {% endif %}
            </div>
        </div>

        <!-- Центральная колонка с уроками -->
        <div class="center-column">
            <div class="module-header">
                <h1>{{ module.title }}</h1>
                <p class="module-description">{{ module.description or '' }}</p>
            </div>

            <div class="lessons-container">
                {% if topics_with_subtopics %}
                    {% for topic_data in topics_with_subtopics %}
                    <div class="topic-section">
                        <h2 class="topic-title">{{ topic_data.topic.name }}</h2>
                        <p class="topic-description">{{ topic_data.topic.description }}</p>
                        
                        <div class="topic-progress">
                            <div class="progress-bar">
                                <div class="progress-fill" style="width: {{ topic_data.progress_percent }}%"></div>
                            </div>
                            <span class="progress-text">{{ topic_data.completed_lessons }}/{{ topic_data.total_lessons }}</span>
                        </div>
                        
                        <div class="lessons-grid">
                            {% for lesson in topic_data.lessons %}
                            <div class="lesson-card">
                                <div class="lesson-header">
                                    <h4 class="lesson-title">{{ lesson.title }}</h4>
                                    <span class="lesson-type">{{ lesson.content_type | title }}</span>
                                </div>
                                
                                <div class="lesson-actions">
                                    <a href="{{ url_for('modules_bp.subtopic_lessons_list', lang=lang, module_id=module.id, slug=topic_data.topic.slug) }}" 
                                       class="btn btn-primary">
                                        {{ t('start_lesson', lang) | default('Начать урок') }}
                                    </a>
                                </div>
                            </div>
                            {% endfor %}
                        </div>
                    </div>
                    {% endfor %}
                {% else %}
                    <div class="no-lessons">
                        <p>{{ t('no_lessons_available', lang) | default('Уроки пока не доступны') }}</p>
                    </div>
                {% endif %}
            </div>
        </div>

        <!-- Правая колонка с рекомендациями -->
        <div class="right-column">
            <div class="section-header">
                <h2>{{ t('recommendations', lang) | default('Рекомендации') }}</h2>
            </div>
            
            {% if recommendations %}
            <div class="recommendations-list">
                {% for rec in recommendations %}
                <div class="recommendation-item">
                    <h4>{{ rec.title }}</h4>
                    <p>{{ rec.description }}</p>
                </div>
                {% endfor %}
            </div>
            {% else %}
            <div class="no-recommendations">
                <p>{{ t('no_recommendations', lang) | default('Рекомендации появятся после изучения материала') }}</p>
            </div>
            {% endif %}
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
    {{ super() }}
    <script src="{{ url_for('static', filename='js/universal-category-system.js') }}"></script>
    <script src="{{ url_for('static', filename='js/subject-navigation.js') }}"></script>
{% endblock %} 