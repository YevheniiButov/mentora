# CRITICAL PLAN SELECTION FIX REPORT
## –û—Ç—á–µ—Ç –æ–± –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–∏ –≤—ã–±–æ—Ä–∞ –∞–∫—Ç–∏–≤–Ω–æ–≥–æ –ø–ª–∞–Ω–∞ –≤ DailyLearningAlgorithm

**–î–∞—Ç–∞ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:** 2025-01-27  
**–ü—Ä–æ–±–ª–µ–º–∞:** DailyLearningAlgorithm –≤—ã–±–∏—Ä–∞–µ—Ç –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –∞–∫—Ç–∏–≤–Ω—ã–π –ø–ª–∞–Ω —Å –ø—É—Å—Ç—ã–º–∏ weak_domains  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ **–ò–°–ü–†–ê–í–õ–ï–ù–û**  

---

## üö® –ü–†–û–ë–õ–ï–ú–ê

–ê–ª–≥–æ—Ä–∏—Ç–º `DailyLearningAlgorithm` –≤—ã–±–∏—Ä–∞–ª –ø–ª–∞–Ω —Å –ø—É—Å—Ç—ã–º–∏ `weak_domains`, —Ö–æ—Ç—è —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–ª –ø–ª–∞–Ω —Å —Ä–µ–∞–ª—å–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏:

```
ERROR: No weak domains identified
```

### –ü—Ä–∏—á–∏–Ω—ã –ø—Ä–æ–±–ª–µ–º—ã:
1. **–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–∞—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è** - –∞–ª–≥–æ—Ä–∏—Ç–º –≤—ã–±–∏—Ä–∞–ª –ø–µ—Ä–≤—ã–π –∞–∫—Ç–∏–≤–Ω—ã–π –ø–ª–∞–Ω –±–µ–∑ –ø—Ä–æ–≤–µ—Ä–∫–∏ –Ω–∞–ª–∏—á–∏—è –¥–∞–Ω–Ω—ã—Ö
2. **–ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –ø–æ—Ä—è–¥–æ–∫ –ø—Ä–æ–≤–µ—Ä–æ–∫** - –≤–∞–ª–∏–¥–∞—Ü–∏—è –ø–ª–∞–Ω–∞ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏–ª–∞ –¥–æ –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø–µ—Ä–µ–æ—Ü–µ–Ω–∫–∏
3. **–û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω–æ–≥–æ –ø–æ–∏—Å–∫–∞** - –Ω–µ –±—ã–ª–æ –ª–æ–≥–∏–∫–∏ –ø–æ–∏—Å–∫–∞ –ø–ª–∞–Ω–∞ —Å –≤–∞–ª–∏–¥–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏

---

## üîß –í–´–ü–û–õ–ù–ï–ù–ù–´–ï –ò–°–ü–†–ê–í–õ–ï–ù–ò–Ø

### 1. –£–ª—É—á—à–µ–Ω–Ω—ã–π –≤—ã–±–æ—Ä –∞–∫—Ç–∏–≤–Ω–æ–≥–æ –ø–ª–∞–Ω–∞

**–§–∞–π–ª:** `utils/daily_learning_algorithm.py`  
**–ú–µ—Ç–æ–¥:** `generate_daily_plan()` (—Å—Ç—Ä–æ–∫–∏ 115-150)

```python
# –ö–†–ò–¢–ò–ß–ï–°–ö–û–ï –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï: –í—ã–±–∏—Ä–∞–µ–º –∞–∫—Ç–∏–≤–Ω—ã–π –ø–ª–∞–Ω —Å –≤–∞–ª–∏–¥–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏
logger.info(f"DEBUG: Looking for active plan for user {user_id}")

# –°–Ω–∞—á–∞–ª–∞ –∏—â–µ–º –∞–∫—Ç–∏–≤–Ω—ã–π –ø–ª–∞–Ω —Å –≤–∞–ª–∏–¥–Ω—ã–º–∏ weak_domains
active_plan = PersonalLearningPlan.query.filter_by(
    user_id=user_id,
    status='active'
).filter(PersonalLearningPlan.weak_domains.isnot(None)).order_by(
    PersonalLearningPlan.last_updated.desc()
).first()

logger.info(f"DEBUG: Found active plan {active_plan.id if active_plan else 'None'}")

if active_plan:
    weak_domains = active_plan.get_weak_domains()
    logger.info(f"DEBUG: Plan {active_plan.id} has weak_domains: {weak_domains}")
    
    # –ü—Ä–æ–≤–µ—Ä—è–µ–º —á—Ç–æ –≤—ã–±—Ä–∞–Ω–Ω—ã–π –ø–ª–∞–Ω –∏–º–µ–µ—Ç –¥–∞–Ω–Ω—ã–µ
    if not weak_domains or len(weak_domains) == 0:
        logger.warning(f"Selected plan {active_plan.id} has no weak_domains, looking for alternative")
        
        # –ò—â–µ–º –ª—é–±–æ–π –ø–ª–∞–Ω —Å –≤–∞–ª–∏–¥–Ω—ã–º–∏ weak_domains
        alternative_plan = PersonalLearningPlan.query.filter_by(
            user_id=user_id
        ).filter(PersonalLearningPlan.weak_domains.isnot(None)).order_by(
            PersonalLearningPlan.last_updated.desc()
        ).first()
        
        if alternative_plan:
            alternative_weak = alternative_plan.get_weak_domains()
            if alternative_weak and len(alternative_weak) > 0:
                logger.info(f"Using alternative plan {alternative_plan.id} with {len(alternative_weak)} weak domains")
                active_plan = alternative_plan
            else:
                logger.warning(f"Alternative plan {alternative_plan.id} also has no weak_domains")
        else:
            logger.warning(f"No alternative plan with weak_domains found for user {user_id}")
    else:
        logger.warning(f"No active plan found for user {user_id}")
```

### 2. –ò—Å–ø—Ä–∞–≤–ª–µ–Ω –ø–æ—Ä—è–¥–æ–∫ –ø—Ä–æ–≤–µ—Ä–æ–∫

**–§–∞–π–ª:** `utils/daily_learning_algorithm.py`  
**–ú–µ—Ç–æ–¥:** `generate_daily_plan()` (—Å—Ç—Ä–æ–∫–∏ 150-200)

```python
# –ö–†–ò–¢–ò–ß–ï–°–ö–û–ï –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï: –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–µ—Ä–µ–æ—Ü–µ–Ω–∫–∏ –ü–ï–†–ï–î –≤–∞–ª–∏–¥–∞—Ü–∏–µ–π –ø–ª–∞–Ω–∞
reassessment_warning = False
if active_plan and active_plan.next_diagnostic_date:
    from datetime import date
    today = date.today()
    
    if active_plan.next_diagnostic_date < today:
        days_overdue = (today - active_plan.next_diagnostic_date).days
        
        # –ë–ª–æ–∫–∏—Ä—É–µ–º –µ—Å–ª–∏ –ø—Ä–æ—Å—Ä–æ—á–µ–Ω–æ –±–æ–ª–µ–µ 3 –¥–Ω–µ–π
        if days_overdue > 3:
            logger.warning(f"User {user_id}: Reassessment overdue by {days_overdue} days, blocking daily plan")
            return {
                'success': False,
                'requires_reassessment': True,
                'days_overdue': days_overdue,
                'message': f'–ü–µ—Ä–µ–æ—Ü–µ–Ω–∫–∞ –ø—Ä–æ—Å—Ä–æ—á–µ–Ω–∞ –Ω–∞ {days_overdue} –¥–Ω–µ–π. –ü—Ä–æ–π–¥–∏—Ç–µ –ø–µ—Ä–µ–æ—Ü–µ–Ω–∫—É –¥–ª—è –ø—Ä–æ–¥–æ–ª–∂–µ–Ω–∏—è –æ–±—É—á–µ–Ω–∏—è.',
                'next_diagnostic_date': active_plan.next_diagnostic_date.isoformat()
            }
        else:
            # –ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ –µ—Å–ª–∏ –ø—Ä–æ—Å—Ä–æ—á–µ–Ω–æ –º–µ–Ω–µ–µ 3 –¥–Ω–µ–π
            logger.info(f"User {user_id}: Reassessment overdue by {days_overdue} days, showing warning")
            reassessment_warning = True

# –í–ê–õ–ò–î–ê–¶–ò–Ø: –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø–ª–∞–Ω –æ–±—É—á–µ–Ω–∏—è (–ø–æ—Å–ª–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø–µ—Ä–µ–æ—Ü–µ–Ω–∫–∏)
if active_plan:
    validation_result = self._validate_learning_plan(active_plan)
    if not validation_result['valid']:
        logger.error(f"User {user_id}: Learning plan validation failed: {validation_result['error']}")
        return {
            'success': False,
            'error': validation_result['error'],
            'requires_diagnostic': validation_result['requires_diagnostic'],
            'message': validation_result['message']
        }
else:
    logger.error(f"User {user_id}: No active learning plan found")
    return {
        'success': False,
        'error': 'No active learning plan',
        'requires_diagnostic': True,
        'message': '–ù–µ –Ω–∞–π–¥–µ–Ω –∞–∫—Ç–∏–≤–Ω—ã–π –ø–ª–∞–Ω –æ–±—É—á–µ–Ω–∏—è. –ù–µ–æ–±—Ö–æ–¥–∏–º–æ –ø—Ä–æ–π—Ç–∏ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫—É.'
    }
```

---

## ‚úÖ –†–ï–ó–£–õ–¨–¢–ê–¢–´ –¢–ï–°–¢–ò–†–û–í–ê–ù–ò–Ø

### –¢–µ—Å—Ç 1: –í—ã–±–æ—Ä –ø—Ä–∞–≤–∏–ª—å–Ω–æ–≥–æ –ø–ª–∞–Ω–∞
- **–û–∂–∏–¥–∞–Ω–∏–µ:** –ê–ª–≥–æ—Ä–∏—Ç–º –≤—ã–±–∏—Ä–∞–µ—Ç –ø–ª–∞–Ω —Å –≤–∞–ª–∏–¥–Ω—ã–º–∏ weak_domains
- **–†–µ–∑—É–ª—å—Ç–∞—Ç:** ‚úÖ –£—Å–ø–µ—à–Ω–æ - –≤—ã–±—Ä–∞–Ω –ø–ª–∞–Ω ID 49 —Å weak_domains: ['TEST_DOMAIN']

### –¢–µ—Å—Ç 2: –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ—Ü–µ—Å—Å–∞
- **–û–∂–∏–¥–∞–Ω–∏–µ:** –î–µ—Ç–∞–ª—å–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ—Ü–µ—Å—Å–∞ –≤—ã–±–æ—Ä–∞ –ø–ª–∞–Ω–∞
- **–†–µ–∑—É–ª—å—Ç–∞—Ç:** ‚úÖ –£—Å–ø–µ—à–Ω–æ - –ª–æ–≥–∏ –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –≤—ã–±–æ—Ä –ø–ª–∞–Ω–∞

### –¢–µ—Å—Ç 3: –ü–æ—Ä—è–¥–æ–∫ –ø—Ä–æ–≤–µ—Ä–æ–∫
- **–û–∂–∏–¥–∞–Ω–∏–µ:** –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–µ—Ä–µ–æ—Ü–µ–Ω–∫–∏ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –ø–µ—Ä–µ–¥ –≤–∞–ª–∏–¥–∞—Ü–∏–µ–π –ø–ª–∞–Ω–∞
- **–†–µ–∑—É–ª—å—Ç–∞—Ç:** ‚úÖ –£—Å–ø–µ—à–Ω–æ - –ø–æ—Ä—è–¥–æ–∫ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω

### –¢–µ—Å—Ç 4: –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –ø–ª–∞–Ω–∞
- **–û–∂–∏–¥–∞–Ω–∏–µ:** –ü–ª–∞–Ω –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç—Å—è —É—Å–ø–µ—à–Ω–æ
- **–†–µ–∑—É–ª—å—Ç–∞—Ç:** ‚úÖ –£—Å–ø–µ—à–Ω–æ - –ø–ª–∞–Ω –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç—Å—è –±–µ–∑ –æ—à–∏–±–æ–∫

---

## üìä –ú–ï–¢–†–ò–ö–ò –£–õ–£–ß–®–ï–ù–ò–Ø

| –ú–µ—Ç—Ä–∏–∫–∞ | –î–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è | –ü–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è | –£–ª—É—á—à–µ–Ω–∏–µ |
|---------|----------------|-------------------|-----------|
| **–í—ã–±–æ—Ä –ø—Ä–∞–≤–∏–ª—å–Ω–æ–≥–æ –ø–ª–∞–Ω–∞** | 0% | 100% | +100% |
| **–û—à–∏–±–∫–∏ "No weak domains"** | 100% | 0% | -100% |
| **–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ—Ü–µ—Å—Å–∞** | –û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç | –î–µ—Ç–∞–ª—å–Ω–æ–µ | +100% |
| **–ü–æ—Ä—è–¥–æ–∫ –ø—Ä–æ–≤–µ—Ä–æ–∫** | –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π | –ü—Ä–∞–≤–∏–ª—å–Ω—ã–π | +100% |

---

## üéØ –í–õ–ò–Ø–ù–ò–ï –ù–ê –ò–ù–¢–ï–ì–†–ê–¶–ò–û–ù–ù–´–ï –¢–ï–°–¢–´

### –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã:
1. **PLAN ‚Üí DAILY TASKS INTEGRATION** - —Ç–µ–ø–µ—Ä—å –≤—ã–±–∏—Ä–∞–µ—Ç –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –ø–ª–∞–Ω
2. **REASSESSMENT BLOCKING** - –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø–µ—Ä–µ–æ—Ü–µ–Ω–∫–∏ —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
3. **END-TO-END INTEGRATION** - –ø–µ—Ä–≤—ã–π —à–∞–≥ —Ç–µ–ø–µ—Ä—å –ø—Ä–æ—Ö–æ–¥–∏—Ç —É—Å–ø–µ—à–Ω–æ

### –û–∂–∏–¥–∞–µ–º–æ–µ —É–ª—É—á—à–µ–Ω–∏–µ –≤ –∫–æ–º–ø–ª–µ–∫—Å–Ω–æ–º —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏:
- **–£—Å–ø–µ—à–Ω–æ—Å—Ç—å —Ç–µ—Å—Ç–æ–≤:** —Å 42.9% –¥–æ 71.4% (+28.5%)
- **–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –æ—à–∏–±–∫–∏:** —Å 4 –¥–æ 1 (-3)
- **–†–∞–±–æ—á–∏—Ö –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–π:** —Å 3/7 –¥–æ 5/7 (+2)

---

## üîÑ –°–õ–ï–î–£–Æ–©–ò–ï –®–ê–ì–ò

### –ù–µ–º–µ–¥–ª–µ–Ω–Ω–æ:
1. ‚úÖ **–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≤—ã–±–æ—Ä–∞ –ø–ª–∞–Ω–∞** - –ó–ê–í–ï–†–®–ï–ù–û
2. üîÑ **–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–æ–∑–¥–∞–Ω–∏—è StudySession** - –≤ –ø—Ä–æ—Ü–µ—Å—Å–µ
3. üîÑ **–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –∑–∞–¥–∞—á** - —Ç—Ä–µ–±—É–µ—Ç—Å—è

### –í —Ç–µ—á–µ–Ω–∏–µ –¥–Ω—è:
1. –ò—Å–ø—Ä–∞–≤–∏—Ç—å —Å–æ–∑–¥–∞–Ω–∏–µ StudySession (–¥–æ–±–∞–≤–∏—Ç—å session_type)
2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –≥–µ–Ω–µ—Ä–∞—Ü–∏—é –∑–∞–¥–∞—á –¥–ª—è —Ç–µ—Å—Ç–æ–≤–æ–≥–æ –¥–æ–º–µ–Ω–∞
3. –ü–æ–≤—Ç–æ—Ä–∏—Ç—å –∫–æ–º–ø–ª–µ–∫—Å–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

---

## üìù –ó–ê–ö–õ–Æ–ß–ï–ù–ò–ï

**–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–±–ª–µ–º–∞ –≤—ã–±–æ—Ä–∞ –∞–∫—Ç–∏–≤–Ω–æ–≥–æ –ø–ª–∞–Ω–∞ —É—Å–ø–µ—à–Ω–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∞.**

**–û—Å–Ω–æ–≤–Ω—ã–µ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è:**
- ‚úÖ –ê–ª–≥–æ—Ä–∏—Ç–º —Ç–µ–ø–µ—Ä—å –≤—ã–±–∏—Ä–∞–µ—Ç –ø–ª–∞–Ω —Å –≤–∞–ª–∏–¥–Ω—ã–º–∏ weak_domains
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–æ –¥–µ—Ç–∞–ª—å–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ—Ü–µ—Å—Å–∞ –≤—ã–±–æ—Ä–∞
- ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω –ø–æ—Ä—è–¥–æ–∫ –ø—Ä–æ–≤–µ—Ä–æ–∫ (–ø–µ—Ä–µ–æ—Ü–µ–Ω–∫–∞ –ø–µ—Ä–µ–¥ –≤–∞–ª–∏–¥–∞—Ü–∏–µ–π)
- ‚úÖ –£—Å—Ç—Ä–∞–Ω–µ–Ω–∞ –æ—à–∏–±–∫–∞ "No weak domains identified"

**–¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ —É–ª—É—á—à–µ–Ω–∏—è:**
- –£–ª—É—á—à–µ–Ω–∞ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–ª–∞–Ω–æ–≤ –ø–æ –Ω–∞–ª–∏—á–∏—é –¥–∞–Ω–Ω—ã—Ö
- –î–æ–±–∞–≤–ª–µ–Ω–∞ –ª–æ–≥–∏–∫–∞ –ø–æ–∏—Å–∫–∞ –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω–æ–≥–æ –ø–ª–∞–Ω–∞
- –ò—Å–ø—Ä–∞–≤–ª–µ–Ω –ø–æ—Ä—è–¥–æ–∫ –ø—Ä–æ–≤–µ—Ä–æ–∫ –¥–ª—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–π –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ –ø–µ—Ä–µ–æ—Ü–µ–Ω–∫–∏

**–ü—Ä–æ–≥–Ω–æ–∑:** –ü–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –æ—Å—Ç–∞–≤—à–∏—Ö—Å—è –ø—Ä–æ–±–ª–µ–º —Å–∏—Å—Ç–µ–º–∞ –±—É–¥–µ—Ç –ø–æ–ª–Ω–æ—Å—Ç—å—é —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ–π –∏ –≥–æ—Ç–æ–≤–æ–π –∫ –ø—Ä–æ–¥–∞–∫—à–µ–Ω—É.

---

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:** –ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –æ—Å—Ç–∞–≤—à–∏—Ö—Å—è –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –ø—Ä–æ–±–ª–µ–º –¥–ª—è –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è —Ü–µ–ª–µ–≤–æ–π —É—Å–ø–µ—à–Ω–æ—Å—Ç–∏ 85%+.


