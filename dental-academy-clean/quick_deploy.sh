#!/bin/bash
# –ë—ã—Å—Ç—Ä—ã–π –¥–µ–ø–ª–æ–π –Ω–∞ mentora.com.in

echo "üöÄ –ë—ã—Å—Ç—Ä—ã–π –¥–µ–ø–ª–æ–π –Ω–∞ mentora.com.in"
echo "=================================="

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ –º—ã –Ω–∞ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–º –∫–æ–º–º–∏—Ç–µ
echo "üìã –¢–µ–∫—É—â–∏–π –∫–æ–º–º–∏—Ç:"
git log --oneline -1

echo ""
echo "üìã –ö–æ–º–º–∏—Ç—ã –¥–ª—è –¥–µ–ø–ª–æ—è:"
git log --oneline d727518..HEAD

echo ""
read -p "‚ùì –ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å –¥–µ–ø–ª–æ–π? (y/N): " -n 1 -r
echo
if [[ ! $REPLY =~ ^[Yy]$ ]]; then
    echo "‚ùå –î–µ–ø–ª–æ–π –æ—Ç–º–µ–Ω–µ–Ω"
    exit 1
fi

# –ü–µ—Ä–µ–∫–ª—é—á–∏—Ç—å—Å—è –Ω–∞ —Ç–µ—Å—Ç–æ–≤—É—é –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é
echo "üîß –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏..."
if [ -f "mentora_test_config.env" ]; then
    cp mentora_test_config.env .env
    echo "‚úÖ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è mentora.com.in"
elif [ -f ".env.test" ]; then
    cp .env.test .env
    echo "‚úÖ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∞ —Ç–µ—Å—Ç–æ–≤–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è"
else
    echo "‚ùå –§–∞–π–ª—ã –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã"
    exit 1
fi

# –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
echo "üì¶ –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π..."
pip install -r requirements.txt

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è
echo "üß™ –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è..."
python3 -c "from app import create_app; app = create_app(); print('‚úÖ –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —Å–æ–∑–¥–∞–µ—Ç—Å—è —É—Å–ø–µ—à–Ω–æ')"

if [ $? -eq 0 ]; then
    echo ""
    echo "‚úÖ –î–µ–ø–ª–æ–π –≥–æ—Ç–æ–≤!"
    echo ""
    echo "üìã –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏:"
    echo "1. –ó–∞–ø—É—Å—Ç–∏—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ: gunicorn --bind 0.0.0.0:5000 app:app"
    echo "2. –ù–∞—Å—Ç—Ä–æ–∏—Ç—å Nginx (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ)"
    echo "3. –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å: python3 test_mentora_landing.py"
    echo "4. –û—Ç–∫—Ä—ã—Ç—å: https://mentora.com.in"
else
    echo "‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è"
    exit 1
fi
