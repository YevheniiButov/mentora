# SUBMIT ANSWER RESPONSE FORMAT FIX REPORT

## üéØ –ü–†–û–ë–õ–ï–ú–ê

**–û—à–∏–±–∫–∞:** `Server error` –≤ JavaScript –ø—Ä–∏ —É—Å–ø–µ—à–Ω–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–µ –æ—Ç–≤–µ—Ç–∞ —Å–µ—Ä–≤–µ—Ä–æ–º

**–ö–æ–Ω—Ç–µ–∫—Å—Ç:** –°–µ—Ä–≤–µ—Ä –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–ª –æ—Ç–≤–µ—Ç —É—Å–ø–µ—à–Ω–æ (HTTP 200, ability updated), –Ω–æ JavaScript –ø–æ–ª—É—á–∞–ª "Server error"

**–ü—Ä–∏—á–∏–Ω–∞:** –ù–µ—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ —Ñ–æ—Ä–º–∞—Ç–∞ –æ—Ç–≤–µ—Ç–∞ –º–µ–∂–¥—É —Å–µ—Ä–≤–µ—Ä–æ–º –∏ –∫–ª–∏–µ–Ω—Ç–æ–º

## üîç –î–ò–ê–ì–ù–û–°–¢–ò–ö–ê

### 1. –ê–Ω–∞–ª–∏–∑ —Å–µ—Ä–≤–µ—Ä–Ω–æ–≥–æ –∫–æ–¥–∞
**–§–∞–π–ª:** `routes/diagnostic_routes.py`
**–§—É–Ω–∫—Ü–∏—è:** `submit_answer(session_id)`

**–ü—Ä–æ–±–ª–µ–º–Ω—ã–π –∫–æ–¥:**
```python
# Prepare response
response_data = {
    'is_correct': response.is_correct,
    'correct_answer': question.correct_answer_text,
    'explanation': question.explanation,
    'current_ability': session.current_ability,
    'ability_se': session.ability_se,
    'questions_answered': session.questions_answered,
    'session_completed': should_complete
}

return jsonify(response_data)  # ‚Üê –û–¢–°–£–¢–°–¢–í–£–ï–¢ –ü–û–õ–ï 'success'
```

### 2. –ê–Ω–∞–ª–∏–∑ –∫–ª–∏–µ–Ω—Ç—Å–∫–æ–≥–æ –∫–æ–¥–∞
**–§–∞–π–ª:** `templates/assessment/question.html`
**–§—É–Ω–∫—Ü–∏—è:** `submitAnswer()`

**–û–∂–∏–¥–∞–µ–º—ã–π —Ñ–æ—Ä–º–∞—Ç:**
```javascript
if (data.success) {  // ‚Üê –û–ñ–ò–î–ê–ï–¢–°–Ø –ü–û–õ–ï 'success'
    // –û–±—Ä–∞–±–æ—Ç–∫–∞ —É—Å–ø–µ—à–Ω–æ–≥–æ –æ—Ç–≤–µ—Ç–∞
} else {
    throw new Error(data.error || 'Server error');
}
```

### 3. –í—ã—è–≤–ª–µ–Ω–∏–µ –Ω–µ—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏—è
- **–°–µ—Ä–≤–µ—Ä –≤–æ–∑–≤—Ä–∞—â–∞–ª:** `{'is_correct': true, 'current_ability': 0.5, ...}`
- **JavaScript –æ–∂–∏–¥–∞–ª:** `{'success': true, 'is_correct': true, ...}`

## üîß –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï

### 1. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —É—Å–ø–µ—à–Ω–æ–≥–æ –æ—Ç–≤–µ—Ç–∞
```python
# Prepare response
response_data = {
    'success': True,  # ‚Üê –î–û–ë–ê–í–õ–ï–ù–û
    'is_correct': response.is_correct,
    'correct_answer': question.correct_answer_text,
    'explanation': question.explanation,
    'current_ability': session.current_ability,
    'ability_se': session.ability_se,
    'questions_answered': session.questions_answered,
    'session_completed': should_complete
}

# –î–æ–±–∞–≤–ª—è–µ–º –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏
logger.info(f"Sending response: {response_data}")

return jsonify(response_data)
```

### 2. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –æ—Ç–≤–µ—Ç–æ–≤ —Å –æ—à–∏–±–∫–∞–º–∏
–í—Å–µ –æ—Ç–≤–µ—Ç—ã —Å –æ—à–∏–±–∫–∞–º–∏ —Ç–µ–ø–µ—Ä—å –≤–∫–ª—é—á–∞—é—Ç –ø–æ–ª–µ `success: False`:

```python
# –ë—ã–ª–æ:
return jsonify({'error': 'Unauthorized'}), 403

# –°—Ç–∞–ª–æ:
return jsonify({'success': False, 'error': 'Unauthorized'}), 403
```

### 3. –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–µ –≤–∞–ª–∏–¥–∞—Ü–∏–∏
–û–±–Ω–æ–≤–ª–µ–Ω—ã –≤—Å–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ –≤–∞–ª–∏–¥–∞—Ü–∏–∏:

- ‚úÖ –í–∞–ª–∏–¥–∞—Ü–∏—è –≤–ª–∞–¥–µ–Ω–∏—è —Å–µ—Å—Å–∏–µ–π
- ‚úÖ –í–∞–ª–∏–¥–∞—Ü–∏—è —Å—Ç–∞—Ç—É—Å–∞ —Å–µ—Å—Å–∏–∏
- ‚úÖ –í–∞–ª–∏–¥–∞—Ü–∏—è –≤—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
- ‚úÖ –í–∞–ª–∏–¥–∞—Ü–∏—è question_id
- ‚úÖ –í–∞–ª–∏–¥–∞—Ü–∏—è selected_option
- ‚úÖ –í–∞–ª–∏–¥–∞—Ü–∏—è response_time
- ‚úÖ –í–∞–ª–∏–¥–∞—Ü–∏—è –≤—ã–±—Ä–∞–Ω–Ω–æ–≥–æ –≤–∞—Ä–∏–∞–Ω—Ç–∞
- ‚úÖ –í–∞–ª–∏–¥–∞—Ü–∏—è —Å–æ–∑–¥–∞–Ω–∏—è –æ—Ç–≤–µ—Ç–∞
- ‚úÖ –í–∞–ª–∏–¥–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö —Å–µ—Å—Å–∏–∏
- ‚úÖ –í–∞–ª–∏–¥–∞—Ü–∏—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
- ‚úÖ –û–±—Ä–∞–±–æ—Ç–∫–∞ –∏—Å–∫–ª—é—á–µ–Ω–∏–π

## üìä –†–ï–ó–£–õ–¨–¢–ê–¢–´ –ò–°–ü–†–ê–í–õ–ï–ù–ò–Ø

### –î–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:
```json
{
  "is_correct": true,
  "correct_answer": "–ü—Ä–∞–≤–∏–ª—å–Ω—ã–π –æ—Ç–≤–µ—Ç",
  "current_ability": 0.5,
  "questions_answered": 5
}
```

### –ü–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:
```json
{
  "success": true,
  "is_correct": true,
  "correct_answer": "–ü—Ä–∞–≤–∏–ª—å–Ω—ã–π –æ—Ç–≤–µ—Ç",
  "current_ability": 0.5,
  "questions_answered": 5
}
```

### –û—Ç–≤–µ—Ç—ã —Å –æ—à–∏–±–∫–∞–º–∏:
```json
{
  "success": false,
  "error": "Unauthorized"
}
```

## üß™ –¢–ï–°–¢–ò–†–û–í–ê–ù–ò–ï

–°–æ–∑–¥–∞–Ω —Ç–µ—Å—Ç–æ–≤—ã–π —Å–∫—Ä–∏–ø—Ç `test_submit_answer_fix.py` –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏:

1. **–¢–µ—Å—Ç —É—Å–ø–µ—à–Ω–æ–≥–æ –æ—Ç–≤–µ—Ç–∞:**
   - –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –Ω–∞–ª–∏—á–∏–µ –ø–æ–ª—è `success: true`
   - –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è –æ—Ç–≤–µ—Ç–∞
   - –í–∞–ª–∏–¥–∏—Ä—É–µ—Ç —Ñ–æ—Ä–º–∞—Ç JSON

2. **–¢–µ—Å—Ç –æ—Ç–≤–µ—Ç–∞ —Å –æ—à–∏–±–∫–æ–π:**
   - –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –Ω–∞–ª–∏—á–∏–µ –ø–æ–ª—è `success: false`
   - –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –Ω–∞–ª–∏—á–∏–µ –ø–æ–ª—è `error`
   - –í–∞–ª–∏–¥–∏—Ä—É–µ—Ç —Ñ–æ—Ä–º–∞—Ç JSON

## üéØ –ó–ê–ö–õ–Æ–ß–ï–ù–ò–ï

**–ü—Ä–æ–±–ª–µ–º–∞ —Ä–µ—à–µ–Ω–∞:** –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—è `success` –≤–æ –≤—Å–µ –æ—Ç–≤–µ—Ç—ã API —É—Å—Ç—Ä–∞–Ω–∏–ª–æ –Ω–µ—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ —Ñ–æ—Ä–º–∞—Ç–∞ –º–µ–∂–¥—É —Å–µ—Ä–≤–µ—Ä–æ–º –∏ –∫–ª–∏–µ–Ω—Ç–æ–º.

**–°—Ç–∞—Ç—É—Å:** ‚úÖ **–ò–°–ü–†–ê–í–õ–ï–ù–û**

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** JavaScript –±–æ–ª—å—à–µ –Ω–µ –ø–æ–ª—É—á–∞–µ—Ç "Server error" –ø—Ä–∏ —É—Å–ø–µ—à–Ω–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–µ –æ—Ç–≤–µ—Ç–∞ —Å–µ—Ä–≤–µ—Ä–æ–º.

## üìÅ –§–ê–ô–õ–´

- `routes/diagnostic_routes.py` - –ò—Å–ø—Ä–∞–≤–ª–µ–Ω —Ñ–æ—Ä–º–∞—Ç –æ—Ç–≤–µ—Ç–æ–≤
- `test_submit_answer_fix.py` - –¢–µ—Å—Ç–æ–≤—ã–π —Å–∫—Ä–∏–ø—Ç
- `SUBMIT_ANSWER_RESPONSE_FORMAT_FIX_REPORT.md` - –≠—Ç–æ—Ç –æ—Ç—á–µ—Ç

---

**–î–∞—Ç–∞:** $(date)
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –†–ï–®–ï–ù–û
**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** üî¥ –ö–†–ò–¢–ò–ß–ï–°–ö–ò–ô
