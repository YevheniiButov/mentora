# Адаптивный Селектор Путей Обучения

## Обзор

Адаптивный селектор путей обучения (`AdaptivePathSelector`) - это система, которая автоматически выбирает и персонализирует пути обучения для каждого пользователя на основе их IRT способностей, слабых и сильных доменов.

## Основные возможности

### 1. Адаптивный выбор путей
- Анализирует способности пользователя по IRT шкале
- Учитывает слабые и сильные домены
- Выбирает пути с подходящей сложностью
- Персонализирует модули и уроки

### 2. Интеграция с IRT
- Использует IRT параметры для оценки сложности
- Учитывает диапазоны сложности путей обучения
- Адаптирует контент под текущие способности

### 3. Динамическое обновление
- Обновляет пути после переоценки способностей
- Корректирует рекомендации на основе прогресса
- Поддерживает непрерывное обучение

## Архитектура

### Основные компоненты

```
AdaptivePathSelector
├── select_adaptive_path()          # Основной метод выбора пути
├── _find_suitable_paths()          # Поиск подходящих путей
├── _select_optimal_path()          # Выбор оптимального пути
├── _personalize_path()             # Персонализация пути
├── _adapt_module()                 # Адаптация модулей
├── _adapt_lessons()                # Адаптация уроков
└── update_path_after_reassessment() # Обновление после переоценки
```

### Интеграция с моделями

- **PersonalLearningPlan**: Основная модель для хранения планов обучения
- **LearningPath**: Модель путей обучения с IRT параметрами
- **Module/Lesson**: Модели контента с уровнями сложности
- **BIGDomain**: Домены знаний для классификации

## Использование

### 1. Базовое использование

```python
from utils.adaptive_path_selector import AdaptivePathSelector

# Создаем селектор
selector = AdaptivePathSelector()

# Выбираем адаптивный путь
result = selector.select_adaptive_path(user_id=123)

if result['success']:
    print(f"Выбранный путь: {result['path_name']}")
    print(f"Модули: {len(result['modules'])}")
    print(f"Уровень сложности: {result['difficulty_level']}")
```

### 2. Выбор пути для конкретного домена

```python
# Выбираем путь для теоретического компонента
result = selector.select_adaptive_path(
    user_id=123, 
    target_domain='THEORETICAL'
)
```

### 3. Обновление после переоценки

```python
# Новые способности после переоценки
new_abilities = {
    'THER': 0.6,  # Улучшился
    'SURG': 0.8,  # Остался сильным
    'PEDO': 0.4   # Улучшился
}

# Обновляем путь
result = selector.update_path_after_reassessment(
    user_id=123, 
    new_abilities=new_abilities
)
```

### 4. Использование через PersonalLearningPlan

```python
# Получаем план обучения
plan = PersonalLearningPlan.query.filter_by(
    user_id=123, 
    status='active'
).first()

# Получаем адаптивный путь
adaptive_path = plan.get_adaptive_learning_path()

# Обновляем путь после переоценки
result = plan.update_adaptive_path_after_reassessment(new_abilities)
```

## API Endpoints

### GET /api/adaptive-path
Получает адаптивный путь обучения для пользователя.

**Параметры:**
- `domain` (опционально): Целевой домен

**Ответ:**
```json
{
    "success": true,
    "path_id": "path_1",
    "path_name": "Базовый путь для начинающих",
    "estimated_duration": 8,
    "total_hours": 40,
    "modules": [...],
    "difficulty_level": "intermediate",
    "target_ability": 1.0,
    "current_ability": 0.5,
    "weak_domains": ["PEDO", "THER"],
    "strong_domains": ["RAD", "SURG"]
}
```

### POST /api/adaptive-path/update
Обновляет адаптивный путь после переоценки способностей.

**Тело запроса:**
```json
{
    "new_abilities": {
        "THER": 0.6,
        "SURG": 0.8,
        "PEDO": 0.4
    }
}
```

**Ответ:**
```json
{
    "success": true,
    "message": "Путь обучения обновлен после переоценки",
    "new_path": {...}
}
```

## Алгоритм выбора пути

### 1. Анализ способностей
- Получение текущих способностей из PersonalLearningPlan
- Определение слабых и сильных доменов
- Расчет общей способности пользователя

### 2. Поиск подходящих путей
- Фильтрация путей по активности
- Проверка соответствия сложности способностям
- Учет целевого домена (если указан)

### 3. Расчет релевантности
- Вес экзамена (exam_weight)
- Соответствие сложности (distance-based)
- Целевые уровни способностей
- Покрытие слабых доменов

### 4. Персонализация
- Адаптация модулей под способности
- Фильтрация уроков по сложности
- Распределение контента по секциям

## Конфигурация

### Пороги способностей
```python
ABILITY_THRESHOLDS = {
    'beginner': -1.0,      # Начинающий уровень
    'intermediate': 0.0,   # Средний уровень  
    'advanced': 1.0,       # Продвинутый уровень
    'expert': 2.0          # Эксперт уровень
}
```

### Параметры адаптации
```python
DIFFICULTY_MARGIN = 0.5    # Допустимое отклонение сложности
MAX_PATH_LENGTH = 10       # Максимальное количество модулей
```

## Интеграция с DailyLearningAlgorithm

Адаптивный селектор интегрирован с алгоритмом ежедневного обучения:

1. **Получение адаптивного пути** в `generate_daily_plan()`
2. **Выбор контента** с учетом адаптивного пути
3. **Распределение времени** по модулям пути
4. **Создание StudySession** для каждого элемента

## Тестирование

Запуск тестового скрипта:

```bash
python scripts/test_adaptive_path_selector.py
```

Тест проверяет:
- Создание тестовых данных
- Выбор адаптивного пути
- Обновление после переоценки
- Интеграцию с PersonalLearningPlan

## Логирование

Система использует стандартное логирование Python:

```python
import logging
logger = logging.getLogger(__name__)

# Логирование ошибок
logger.error(f"Ошибка выбора адаптивного пути: {e}")

# Логирование предупреждений
logger.warning(f"Не удалось получить адаптивный путь: {e}")

# Логирование информации
logger.info(f"Создан адаптивный путь для пользователя {user_id}")
```

## Обработка ошибок

### Типичные ошибки и решения

1. **"Нет активного плана обучения"**
   - Создать PersonalLearningPlan для пользователя
   - Пройти диагностику для получения начальных способностей

2. **"Не удалось получить способности пользователя"**
   - Проверить наличие domain_analysis в плане
   - Обновить способности через диагностику

3. **"Нет подходящих путей обучения"**
   - Создать базовый путь обучения
   - Проверить настройки сложности путей

## Производительность

### Оптимизации
- Кэширование результатов выбора путей
- Индексирование по сложности и доменам
- Ограничение количества модулей в пути

### Мониторинг
- Время выполнения выбора пути
- Количество подходящих путей
- Частота обновлений

## Будущие улучшения

1. **Машинное обучение**
   - Предсказание успешности путей
   - Оптимизация рекомендаций

2. **Социальные элементы**
   - Рекомендации на основе успехов других пользователей
   - Групповое обучение

3. **Адаптивность в реальном времени**
   - Обновление путей во время обучения
   - Динамическая корректировка сложности

## Заключение

Адаптивный селектор путей обучения обеспечивает персонализированный подход к образованию, учитывая индивидуальные способности и прогресс каждого пользователя. Система интегрирована с существующей архитектурой и поддерживает непрерывное улучшение на основе IRT результатов. 