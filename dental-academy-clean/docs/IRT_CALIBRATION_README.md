# IRT Calibration System

## Обзор

Система калибровки IRT (Item Response Theory) параметров для автоматической генерации реалистичных параметров сложности, дискриминации и угадывания для всех вопросов в системе.

## Компоненты

### 1. Скрипт калибровки
- **Файл**: `scripts/calibrate_irt_parameters.py`
- **Назначение**: Основной скрипт для генерации IRT параметров

### 2. Модель данных
- **Файл**: `models.py`
- **Изменения**: Добавлено поле `difficulty` в модель `Lesson`

### 3. CLI команда
- **Команда**: `flask calibrate-irt`
- **Назначение**: Удобный запуск калибровки через командную строку

## Использование

### Запуск калибровки

```bash
# Через CLI команду
flask calibrate-irt

# Или напрямую через Python
python scripts/calibrate_irt_parameters.py
```

### Миграция базы данных

```bash
# Применить миграцию для добавления поля difficulty
flask db upgrade
```

## Алгоритм калибровки

### 1. Расчет эмпирической сложности
- Анализирует все ответы на вопрос из `TestAttempt` и `DiagnosticResponse`
- Вычисляет процент правильных ответов
- Преобразует в IRT difficulty (b-параметр) через логит-преобразование

### 2. Оценка дискриминации
- Базовая дискриминация: 1.0
- Корректировка по домену (некоторые домены более дискриминативны)
- Корректировка по типу вопроса (клинические случаи vs теория)
- Корректировка по уровню сложности
- Добавление случайной вариации

### 3. Оценка параметра угадывания
- Базовый параметр: 0.25 (для 4 вариантов ответа)
- Корректировка по типу вопроса
- Корректировка по домену
- Небольшая случайная вариация

### 4. Расчет надежности
- Зависит от размера выборки
- Корректировка по дискриминации
- Стандартные ошибки на основе размера выборки

## Параметры доменов

| Домен | Дискриминация | Угадывание | Описание |
|-------|---------------|------------|----------|
| MED | 1.2 | 0.85 | Медицинская этика - высокая дискриминация |
| ANAT | 0.9 | 0.9 | Анатомия - средняя, сложно угадать |
| PHARMA | 1.1 | 1.1 | Фармакология - выше средней, легче угадать |
| PATH | 1.15 | 1.0 | Патология - высокая |
| THER | 1.1 | 1.0 | Терапевтическая стоматология |
| SURG | 1.05 | 1.0 | Хирургическая стоматология |
| ORTH | 1.0 | 1.0 | Ортодонтия |
| PEDO | 0.95 | 1.0 | Детская стоматология |
| PERI | 1.1 | 1.0 | Пародонтология |
| ENDO | 1.15 | 1.0 | Эндодонтия |
| RAD | 1.0 | 1.0 | Радиология |
| PHAR | 1.1 | 1.0 | Фармакология |
| COMM | 1.2 | 0.85 | Коммуникация - высокая дискриминация |

## Выходные данные

### Статистика калибровки
```
Найдено 1500 вопросов для калибровки
==================================================
[   1] Вопрос 1: сложность=-0.45, выборка=23
[   2] Вопрос 2: сложность=1.23, выборка=15
...
==================================================
Калибровка завершена!
Всего вопросов: 1500
Калибровано: 1500
Создано новых: 1200
Обновлено: 300
Пропущено: 0

Статистика сложности:
Средняя сложность: 0.12
Стандартное отклонение: 1.45
Мин/Макс: -2.98 / 3.00

Статистика дискриминации:
Средняя дискриминация: 1.08
Стандартное отклонение: 0.32
Мин/Макс: 0.52 / 2.48
```

### Валидация параметров
- Проверка диапазонов значений
- Выявление невалидных параметров
- Рекомендации по исправлению

## Интеграция с системой

### Daily Learning Algorithm
Скрипт интегрирован с `utils/daily_learning_algorithm.py` для:
- Выбора контента подходящей сложности
- Приоритизации слабых доменов
- Адаптивного обучения

### IRT Engine
Параметры используются в `utils/irt_engine.py` для:
- Оценки способностей пользователей
- Адаптивного выбора вопросов
- Прогнозирования вероятности правильного ответа

## Мониторинг и обслуживание

### Регулярная калибровка
Рекомендуется запускать калибровку:
- После добавления новых вопросов
- При накоплении достаточного количества ответов
- Ежемесячно для обновления параметров

### Проверка качества
```bash
# Запуск только валидации
python -c "from scripts.calibrate_irt_parameters import validate_irt_parameters; validate_irt_parameters()"
```

## Требования

- Python 3.8+
- NumPy
- SQLAlchemy
- Flask
- Доступ к базе данных с данными ответов

## Устранение неполадок

### Ошибки калибровки
1. **Нет данных для вопроса**: Используются случайные параметры
2. **Ошибки в данных**: Вопрос пропускается, ошибка логируется
3. **Проблемы с БД**: Проверьте подключение и права доступа

### Низкое качество параметров
1. **Мало данных**: Дождитесь накопления ответов
2. **Неправильные домены**: Проверьте соответствие доменов
3. **Проблемы с типами вопросов**: Убедитесь в корректности `question_type`

## Разработка

### Добавление новых доменов
1. Добавьте домен в `domain_factors` в функции `estimate_discrimination`
2. Добавьте домен в `domain_guessing_factors` в функции `estimate_guessing_parameter`
3. Обновите документацию

### Модификация алгоритмов
1. Измените соответствующие функции в скрипте
2. Добавьте тесты для новых алгоритмов
3. Обновите документацию
4. Проведите тестирование на реальных данных 